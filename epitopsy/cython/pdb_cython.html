<!-- Generated by Cython 0.19.1 on Thu Nov 21 17:12:31 2013 -->
<html>

<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<style type="text/css">

body { font-family: courier; font-size: 12; }

.code  { font-size: 9; color: #444444; display: none; margin-left: 20px; }
.py_c_api  { color: red; }
.py_macro_api  { color: #FF7000; }
.pyx_c_api  { color: #FF3000; }
.pyx_macro_api  { color: #FF7000; }
.refnanny  { color: #FFA000; }

.error_goto  { color: #FFA000; }

.tag  {  }

.coerce  { color: #008000; border: 1px dotted #008000 }

.py_attr { color: #FF0000; font-weight: bold; }
.c_attr  { color: #0000FF; }

.py_call { color: #FF0000; font-weight: bold; }
.c_call  { color: #0000FF; }

.line { margin: 0em }

</style>
<script>
function toggleDiv(id) {
    theDiv = document.getElementById(id);
    if (theDiv.style.display == 'none') theDiv.style.display = 'block';
    else theDiv.style.display = 'none';
}
</script>
</head>
        <body>
<p>Generated by Cython 0.19.1 on Thu Nov 21 17:12:31 2013
<p>Raw output: <a href="pdb_cython.c">pdb_cython.c</a>
<pre class='line' style='background-color: #FFFF79' onclick='toggleDiv("line1")'> 1: """</pre>
<pre id='line1' class='code' style='background-color: #FFFF79'>
  /* "epitopsy/cython/pdb_cython.pyx":1
 * """             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * @author: Christoph Wilms
 * """
 */
  __pyx_t_2 = <span class='py_c_api'>PyDict_New</span>();<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(((PyObject *)__pyx_t_2));
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s____test__, ((PyObject *)__pyx_t_2)) <code><</code> 0)<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_2)); __pyx_t_2 = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2")'> 2: @author: Christoph Wilms</pre>
<pre id='line2' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line3")'> 3: """</pre>
<pre id='line3' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF8d' onclick='toggleDiv("line4")'> 4: import numpy as np</pre>
<pre id='line4' class='code' style='background-color: #FFFF8d'>
  /* "epitopsy/cython/pdb_cython.pyx":4
 * @author: Christoph Wilms
 * """
 * import numpy as np             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * # "cimport" is used to import special compile-time information
 */
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_Import</span>(((PyObject *)__pyx_n_s__numpy), 0, -1);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 4; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s__np, __pyx_t_1) <code><</code> 0)<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 4; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line5")'> 5: </pre>
<pre id='line5' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line6")'> 6: # "cimport" is used to import special compile-time information</pre>
<pre id='line6' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line7")'> 7: # about the numpy module (this is stored in a file numpy.pxd which is</pre>
<pre id='line7' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line8")'> 8: # currently part of the Cython distribution).</pre>
<pre id='line8' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line9")'> 9: cimport numpy as np</pre>
<pre id='line9' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line10")'> 10: cimport cython</pre>
<pre id='line10' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line11")'> 11: </pre>
<pre id='line11' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line12")'> 12: from libc.math cimport sqrt, round, exp, pow</pre>
<pre id='line12' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line13")'> 13: </pre>
<pre id='line13' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line14")'> 14: # We now need to fix a datatype for our arrays. I've used the variable</pre>
<pre id='line14' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line15")'> 15: # DTYPE for this, which is assigned to the usual NumPy runtime</pre>
<pre id='line15' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line16")'> 16: # type info object.</pre>
<pre id='line16' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF6a' onclick='toggleDiv("line17")'> 17: DTYPE_int = np.int</pre>
<pre id='line17' class='code' style='background-color: #FFFF6a'>
  /* "epitopsy/cython/pdb_cython.pyx":17
 * # DTYPE for this, which is assigned to the usual NumPy runtime
 * # type info object.
 * DTYPE_int = np.int             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * DTYPE_float = np.float
 * DTYPE_cmplx = np.complex
 */
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s__np);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 17; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  __pyx_t_2 = __Pyx_<span class='py_c_api'>PyObject_GetAttrStr</span>(__pyx_t_1, __pyx_n_s__int);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 17; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s__DTYPE_int, __pyx_t_2) <code><</code> 0)<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 17; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
</pre><pre class='line' style='background-color: #FFFF6a' onclick='toggleDiv("line18")'> 18: DTYPE_float = np.float</pre>
<pre id='line18' class='code' style='background-color: #FFFF6a'>
  /* "epitopsy/cython/pdb_cython.pyx":18
 * # type info object.
 * DTYPE_int = np.int
 * DTYPE_float = np.float             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * DTYPE_cmplx = np.complex
 * 
 */
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s__np);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 18; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  __pyx_t_1 = __Pyx_<span class='py_c_api'>PyObject_GetAttrStr</span>(__pyx_t_2, __pyx_n_s__float);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 18; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s__DTYPE_float, __pyx_t_1) <code><</code> 0)<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 18; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
</pre><pre class='line' style='background-color: #FFFF6a' onclick='toggleDiv("line19")'> 19: DTYPE_cmplx = np.complex</pre>
<pre id='line19' class='code' style='background-color: #FFFF6a'>
  /* "epitopsy/cython/pdb_cython.pyx":19
 * DTYPE_int = np.int
 * DTYPE_float = np.float
 * DTYPE_cmplx = np.complex             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * # "ctypedef" assigns a corresponding compile-time type to DTYPE_t. For
 */
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s__np);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 19; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  __pyx_t_2 = __Pyx_<span class='py_c_api'>PyObject_GetAttrStr</span>(__pyx_t_1, __pyx_n_s__complex);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 19; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s__DTYPE_cmplx, __pyx_t_2) <code><</code> 0)<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 19; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line20")'> 20: </pre>
<pre id='line20' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line21")'> 21: # "ctypedef" assigns a corresponding compile-time type to DTYPE_t. For</pre>
<pre id='line21' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line22")'> 22: # every type in the numpy module there's a corresponding compile-time</pre>
<pre id='line22' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line23")'> 23: # type with a _t-suffix.</pre>
<pre id='line23' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line24")'> 24: ctypedef np.int_t DTYPE_int_t</pre>
<pre id='line24' class='code' style='background-color: #FFFFff'>
/* "epitopsy/cython/pdb_cython.pyx":24
 * # every type in the numpy module there's a corresponding compile-time
 * # type with a _t-suffix.
 * ctypedef np.int_t DTYPE_int_t             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * ctypedef np.float_t DTYPE_float_t
 * ctypedef np.complex_t DTYPE_cmplx_t
 */
typedef __pyx_t_5numpy_int_t __pyx_t_8epitopsy_6cython_10pdb_cython_DTYPE_int_t;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line25")'> 25: ctypedef np.float_t DTYPE_float_t</pre>
<pre id='line25' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line26")'> 26: ctypedef np.complex_t DTYPE_cmplx_t</pre>
<pre id='line26' class='code' style='background-color: #FFFFff'>
/* "epitopsy/cython/pdb_cython.pyx":26
 * ctypedef np.int_t DTYPE_int_t
 * ctypedef np.float_t DTYPE_float_t
 * ctypedef np.complex_t DTYPE_cmplx_t             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * 
 */
typedef __pyx_t_5numpy_complex_t __pyx_t_8epitopsy_6cython_10pdb_cython_DTYPE_cmplx_t;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line27")'> 27: </pre>
<pre id='line27' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line28")'> 28: </pre>
<pre id='line28' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF5b' onclick='toggleDiv("line29")'> 29: def determine_max_diameter(np.ndarray[DTYPE_float_t, ndim=2] atom_coord not None):</pre>
<pre id='line29' class='code' style='background-color: #FFFF5b'>
/* "epitopsy/cython/pdb_cython.pyx":29
 * 
 * 
 * def determine_max_diameter(np.ndarray[DTYPE_float_t, ndim=2] atom_coord not None):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     # This function calculates the max diameter of a protein.
 *     cdef int xdim = atom_coord.shape[0]
 */

static PyObject *__pyx_pf_8epitopsy_6cython_10pdb_cython_determine_max_diameter(CYTHON_UNUSED PyObject *__pyx_self, PyArrayObject *__pyx_v_atom_coord) {
  int __pyx_v_xdim;
  int __pyx_v_i;
  int __pyx_v_j;
  float __pyx_v_maxDiameter;
  float __pyx_v_diam;
  float __pyx_v_x;
  float __pyx_v_y;
  float __pyx_v_z;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_atom_coord;
  __Pyx_Buffer __pyx_pybuffer_atom_coord;
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("determine_max_diameter", 0);
  __pyx_pybuffer_atom_coord.pybuffer.buf = NULL;
  __pyx_pybuffer_atom_coord.refcount = 0;
  __pyx_pybuffernd_atom_coord.data = NULL;
  __pyx_pybuffernd_atom_coord.rcbuffer = &__pyx_pybuffer_atom_coord;
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&__pyx_pybuffernd_atom_coord.rcbuffer->pybuffer, (PyObject*)__pyx_v_atom_coord, &__Pyx_TypeInfo_nn___pyx_t_8epitopsy_6cython_10pdb_cython_DTYPE_float_t, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack) == -1))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 29; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  }
  __pyx_pybuffernd_atom_coord.diminfo[0].strides = __pyx_pybuffernd_atom_coord.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_atom_coord.diminfo[0].shape = __pyx_pybuffernd_atom_coord.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_atom_coord.diminfo[1].strides = __pyx_pybuffernd_atom_coord.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_atom_coord.diminfo[1].shape = __pyx_pybuffernd_atom_coord.rcbuffer->pybuffer.shape[1];

  /* "epitopsy/cython/pdb_cython.pyx":29
 * 
 * 
 * def determine_max_diameter(np.ndarray[DTYPE_float_t, ndim=2] atom_coord not None):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     # This function calculates the max diameter of a protein.
 *     cdef int xdim = atom_coord.shape[0]
 */
  __pyx_k_tuple_47 = <span class='py_c_api'>PyTuple_Pack</span>(9, ((PyObject *)__pyx_n_s__atom_coord), ((PyObject *)__pyx_n_s__xdim), ((PyObject *)__pyx_n_s__i), ((PyObject *)__pyx_n_s__j), ((PyObject *)__pyx_n_s__maxDiameter), ((PyObject *)__pyx_n_s__diam), ((PyObject *)__pyx_n_s__x), ((PyObject *)__pyx_n_s__y), ((PyObject *)__pyx_n_s__z));<span class='error_goto'> if (unlikely(!__pyx_k_tuple_47)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 29; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_k_tuple_47);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_k_tuple_47));

  /* "epitopsy/cython/pdb_cython.pyx":29
 * 
 * 
 * def determine_max_diameter(np.ndarray[DTYPE_float_t, ndim=2] atom_coord not None):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     # This function calculates the max diameter of a protein.
 *     cdef int xdim = atom_coord.shape[0]
 */
  __pyx_t_2 = PyCFunction_NewEx(&__pyx_mdef_8epitopsy_6cython_10pdb_cython_1determine_max_diameter, NULL, __pyx_n_s_51);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 29; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_49, __pyx_t_2) <code><</code> 0)<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 29; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_k_codeobj_48 = (PyObject*)__Pyx_<span class='py_c_api'>PyCode_New</span>(1, 0, 9, 0, 0, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_k_tuple_47, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_50, __pyx_n_s_49, 29, __pyx_empty_bytes);<span class='error_goto'> if (unlikely(!__pyx_k_codeobj_48)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 29; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line30")'> 30:     # This function calculates the max diameter of a protein.</pre>
<pre id='line30' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line31")'> 31:     cdef int xdim = atom_coord.shape[0]</pre>
<pre id='line31' class='code' style='background-color: #FFFFff'>
  /* "epitopsy/cython/pdb_cython.pyx":31
 * def determine_max_diameter(np.ndarray[DTYPE_float_t, ndim=2] atom_coord not None):
 *     # This function calculates the max diameter of a protein.
 *     cdef int xdim = atom_coord.shape[0]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     cdef int i,j
 *     cdef float maxDiameter = 0
 */
  __pyx_v_xdim = (__pyx_v_atom_coord->dimensions[0]);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line32")'> 32:     cdef int i,j</pre>
<pre id='line32' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line33")'> 33:     cdef float maxDiameter = 0</pre>
<pre id='line33' class='code' style='background-color: #FFFFff'>
  /* "epitopsy/cython/pdb_cython.pyx":33
 *     cdef int xdim = atom_coord.shape[0]
 *     cdef int i,j
 *     cdef float maxDiameter = 0             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     cdef float diam = 0
 *     cdef float x,y,z
 */
  __pyx_v_maxDiameter = 0.0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line34")'> 34:     cdef float diam = 0</pre>
<pre id='line34' class='code' style='background-color: #FFFFff'>
  /* "epitopsy/cython/pdb_cython.pyx":34
 *     cdef int i,j
 *     cdef float maxDiameter = 0
 *     cdef float diam = 0             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     cdef float x,y,z
 * 
 */
  __pyx_v_diam = 0.0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line35")'> 35:     cdef float x,y,z</pre>
<pre id='line35' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line36")'> 36: </pre>
<pre id='line36' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line37")'> 37:     for i from 0 &lt;= i &lt; xdim:</pre>
<pre id='line37' class='code' style='background-color: #FFFFff'>
  /* "epitopsy/cython/pdb_cython.pyx":37
 *     cdef float x,y,z
 * 
 *     for i from 0 <code><</code>= i <code><</code> xdim:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         for j from i+1 <code><</code>=j <code><</code> xdim:
 *             x = atom_coord[i,0] - atom_coord[j,0]
 */
  __pyx_t_1 = __pyx_v_xdim;
  for (__pyx_v_i = 0; __pyx_v_i <code><</code> __pyx_t_1; __pyx_v_i++) {
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line38")'> 38:         for j from i+1 &lt;=j &lt; xdim:</pre>
<pre id='line38' class='code' style='background-color: #FFFFff'>
    /* "epitopsy/cython/pdb_cython.pyx":38
 * 
 *     for i from 0 <code><</code>= i <code><</code> xdim:
 *         for j from i+1 <code><</code>=j <code><</code> xdim:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             x = atom_coord[i,0] - atom_coord[j,0]
 *             y = atom_coord[i,1] - atom_coord[j,1]
 */
    __pyx_t_2 = __pyx_v_xdim;
    for (__pyx_v_j = (__pyx_v_i + 1); __pyx_v_j <code><</code> __pyx_t_2; __pyx_v_j++) {
</pre><pre class='line' style='background-color: #FFFFb6' onclick='toggleDiv("line39")'> 39:             x = atom_coord[i,0] - atom_coord[j,0]</pre>
<pre id='line39' class='code' style='background-color: #FFFFb6'>
      /* "epitopsy/cython/pdb_cython.pyx":39
 *     for i from 0 <code><</code>= i <code><</code> xdim:
 *         for j from i+1 <code><</code>=j <code><</code> xdim:
 *             x = atom_coord[i,0] - atom_coord[j,0]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             y = atom_coord[i,1] - atom_coord[j,1]
 *             z = atom_coord[i,2] - atom_coord[j,2]
 */
      __pyx_t_3 = __pyx_v_i;
      __pyx_t_4 = 0;
      __pyx_t_5 = -1;
      if (__pyx_t_3 <code><</code> 0) {
        __pyx_t_3 += __pyx_pybuffernd_atom_coord.diminfo[0].shape;
        if (unlikely(__pyx_t_3 <code><</code> 0)) __pyx_t_5 = 0;
      } else if (unlikely(__pyx_t_3 >= __pyx_pybuffernd_atom_coord.diminfo[0].shape)) __pyx_t_5 = 0;
      if (__pyx_t_4 <code><</code> 0) {
        __pyx_t_4 += __pyx_pybuffernd_atom_coord.diminfo[1].shape;
        if (unlikely(__pyx_t_4 <code><</code> 0)) __pyx_t_5 = 1;
      } else if (unlikely(__pyx_t_4 >= __pyx_pybuffernd_atom_coord.diminfo[1].shape)) __pyx_t_5 = 1;
      if (unlikely(__pyx_t_5 != -1)) {
        <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_5);
       <span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 39; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      }
      __pyx_t_5 = __pyx_v_j;
      __pyx_t_6 = 0;
      __pyx_t_7 = -1;
      if (__pyx_t_5 <code><</code> 0) {
        __pyx_t_5 += __pyx_pybuffernd_atom_coord.diminfo[0].shape;
        if (unlikely(__pyx_t_5 <code><</code> 0)) __pyx_t_7 = 0;
      } else if (unlikely(__pyx_t_5 >= __pyx_pybuffernd_atom_coord.diminfo[0].shape)) __pyx_t_7 = 0;
      if (__pyx_t_6 <code><</code> 0) {
        __pyx_t_6 += __pyx_pybuffernd_atom_coord.diminfo[1].shape;
        if (unlikely(__pyx_t_6 <code><</code> 0)) __pyx_t_7 = 1;
      } else if (unlikely(__pyx_t_6 >= __pyx_pybuffernd_atom_coord.diminfo[1].shape)) __pyx_t_7 = 1;
      if (unlikely(__pyx_t_7 != -1)) {
        <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_7);
       <span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 39; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      }
      __pyx_v_x = ((*__Pyx_BufPtrStrided2d(__pyx_t_8epitopsy_6cython_10pdb_cython_DTYPE_float_t *, __pyx_pybuffernd_atom_coord.rcbuffer->pybuffer.buf, __pyx_t_3, __pyx_pybuffernd_atom_coord.diminfo[0].strides, __pyx_t_4, __pyx_pybuffernd_atom_coord.diminfo[1].strides)) - (*__Pyx_BufPtrStrided2d(__pyx_t_8epitopsy_6cython_10pdb_cython_DTYPE_float_t *, __pyx_pybuffernd_atom_coord.rcbuffer->pybuffer.buf, __pyx_t_5, __pyx_pybuffernd_atom_coord.diminfo[0].strides, __pyx_t_6, __pyx_pybuffernd_atom_coord.diminfo[1].strides)));
</pre><pre class='line' style='background-color: #FFFFb6' onclick='toggleDiv("line40")'> 40:             y = atom_coord[i,1] - atom_coord[j,1]</pre>
<pre id='line40' class='code' style='background-color: #FFFFb6'>
      /* "epitopsy/cython/pdb_cython.pyx":40
 *         for j from i+1 <code><</code>=j <code><</code> xdim:
 *             x = atom_coord[i,0] - atom_coord[j,0]
 *             y = atom_coord[i,1] - atom_coord[j,1]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             z = atom_coord[i,2] - atom_coord[j,2]
 *             diam = sqrt(x*x + y*y + z*z)
 */
      __pyx_t_7 = __pyx_v_i;
      __pyx_t_8 = 1;
      __pyx_t_9 = -1;
      if (__pyx_t_7 <code><</code> 0) {
        __pyx_t_7 += __pyx_pybuffernd_atom_coord.diminfo[0].shape;
        if (unlikely(__pyx_t_7 <code><</code> 0)) __pyx_t_9 = 0;
      } else if (unlikely(__pyx_t_7 >= __pyx_pybuffernd_atom_coord.diminfo[0].shape)) __pyx_t_9 = 0;
      if (__pyx_t_8 <code><</code> 0) {
        __pyx_t_8 += __pyx_pybuffernd_atom_coord.diminfo[1].shape;
        if (unlikely(__pyx_t_8 <code><</code> 0)) __pyx_t_9 = 1;
      } else if (unlikely(__pyx_t_8 >= __pyx_pybuffernd_atom_coord.diminfo[1].shape)) __pyx_t_9 = 1;
      if (unlikely(__pyx_t_9 != -1)) {
        <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_9);
       <span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 40; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      }
      __pyx_t_9 = __pyx_v_j;
      __pyx_t_10 = 1;
      __pyx_t_11 = -1;
      if (__pyx_t_9 <code><</code> 0) {
        __pyx_t_9 += __pyx_pybuffernd_atom_coord.diminfo[0].shape;
        if (unlikely(__pyx_t_9 <code><</code> 0)) __pyx_t_11 = 0;
      } else if (unlikely(__pyx_t_9 >= __pyx_pybuffernd_atom_coord.diminfo[0].shape)) __pyx_t_11 = 0;
      if (__pyx_t_10 <code><</code> 0) {
        __pyx_t_10 += __pyx_pybuffernd_atom_coord.diminfo[1].shape;
        if (unlikely(__pyx_t_10 <code><</code> 0)) __pyx_t_11 = 1;
      } else if (unlikely(__pyx_t_10 >= __pyx_pybuffernd_atom_coord.diminfo[1].shape)) __pyx_t_11 = 1;
      if (unlikely(__pyx_t_11 != -1)) {
        <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_11);
       <span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 40; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      }
      __pyx_v_y = ((*__Pyx_BufPtrStrided2d(__pyx_t_8epitopsy_6cython_10pdb_cython_DTYPE_float_t *, __pyx_pybuffernd_atom_coord.rcbuffer->pybuffer.buf, __pyx_t_7, __pyx_pybuffernd_atom_coord.diminfo[0].strides, __pyx_t_8, __pyx_pybuffernd_atom_coord.diminfo[1].strides)) - (*__Pyx_BufPtrStrided2d(__pyx_t_8epitopsy_6cython_10pdb_cython_DTYPE_float_t *, __pyx_pybuffernd_atom_coord.rcbuffer->pybuffer.buf, __pyx_t_9, __pyx_pybuffernd_atom_coord.diminfo[0].strides, __pyx_t_10, __pyx_pybuffernd_atom_coord.diminfo[1].strides)));
</pre><pre class='line' style='background-color: #FFFFb6' onclick='toggleDiv("line41")'> 41:             z = atom_coord[i,2] - atom_coord[j,2]</pre>
<pre id='line41' class='code' style='background-color: #FFFFb6'>
      /* "epitopsy/cython/pdb_cython.pyx":41
 *             x = atom_coord[i,0] - atom_coord[j,0]
 *             y = atom_coord[i,1] - atom_coord[j,1]
 *             z = atom_coord[i,2] - atom_coord[j,2]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             diam = sqrt(x*x + y*y + z*z)
 *             if diam > maxDiameter:
 */
      __pyx_t_11 = __pyx_v_i;
      __pyx_t_12 = 2;
      __pyx_t_13 = -1;
      if (__pyx_t_11 <code><</code> 0) {
        __pyx_t_11 += __pyx_pybuffernd_atom_coord.diminfo[0].shape;
        if (unlikely(__pyx_t_11 <code><</code> 0)) __pyx_t_13 = 0;
      } else if (unlikely(__pyx_t_11 >= __pyx_pybuffernd_atom_coord.diminfo[0].shape)) __pyx_t_13 = 0;
      if (__pyx_t_12 <code><</code> 0) {
        __pyx_t_12 += __pyx_pybuffernd_atom_coord.diminfo[1].shape;
        if (unlikely(__pyx_t_12 <code><</code> 0)) __pyx_t_13 = 1;
      } else if (unlikely(__pyx_t_12 >= __pyx_pybuffernd_atom_coord.diminfo[1].shape)) __pyx_t_13 = 1;
      if (unlikely(__pyx_t_13 != -1)) {
        <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_13);
       <span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 41; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      }
      __pyx_t_13 = __pyx_v_j;
      __pyx_t_14 = 2;
      __pyx_t_15 = -1;
      if (__pyx_t_13 <code><</code> 0) {
        __pyx_t_13 += __pyx_pybuffernd_atom_coord.diminfo[0].shape;
        if (unlikely(__pyx_t_13 <code><</code> 0)) __pyx_t_15 = 0;
      } else if (unlikely(__pyx_t_13 >= __pyx_pybuffernd_atom_coord.diminfo[0].shape)) __pyx_t_15 = 0;
      if (__pyx_t_14 <code><</code> 0) {
        __pyx_t_14 += __pyx_pybuffernd_atom_coord.diminfo[1].shape;
        if (unlikely(__pyx_t_14 <code><</code> 0)) __pyx_t_15 = 1;
      } else if (unlikely(__pyx_t_14 >= __pyx_pybuffernd_atom_coord.diminfo[1].shape)) __pyx_t_15 = 1;
      if (unlikely(__pyx_t_15 != -1)) {
        <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_15);
       <span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 41; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      }
      __pyx_v_z = ((*__Pyx_BufPtrStrided2d(__pyx_t_8epitopsy_6cython_10pdb_cython_DTYPE_float_t *, __pyx_pybuffernd_atom_coord.rcbuffer->pybuffer.buf, __pyx_t_11, __pyx_pybuffernd_atom_coord.diminfo[0].strides, __pyx_t_12, __pyx_pybuffernd_atom_coord.diminfo[1].strides)) - (*__Pyx_BufPtrStrided2d(__pyx_t_8epitopsy_6cython_10pdb_cython_DTYPE_float_t *, __pyx_pybuffernd_atom_coord.rcbuffer->pybuffer.buf, __pyx_t_13, __pyx_pybuffernd_atom_coord.diminfo[0].strides, __pyx_t_14, __pyx_pybuffernd_atom_coord.diminfo[1].strides)));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line42")'> 42:             diam = sqrt(x*x + y*y + z*z)</pre>
<pre id='line42' class='code' style='background-color: #FFFFff'>
      /* "epitopsy/cython/pdb_cython.pyx":42
 *             y = atom_coord[i,1] - atom_coord[j,1]
 *             z = atom_coord[i,2] - atom_coord[j,2]
 *             diam = sqrt(x*x + y*y + z*z)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             if diam > maxDiameter:
 *                 maxDiameter = diam
 */
      __pyx_v_diam = sqrt((((__pyx_v_x * __pyx_v_x) + (__pyx_v_y * __pyx_v_y)) + (__pyx_v_z * __pyx_v_z)));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line43")'> 43:             if diam &gt; maxDiameter:</pre>
<pre id='line43' class='code' style='background-color: #FFFFff'>
      /* "epitopsy/cython/pdb_cython.pyx":43
 *             z = atom_coord[i,2] - atom_coord[j,2]
 *             diam = sqrt(x*x + y*y + z*z)
 *             if diam > maxDiameter:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                 maxDiameter = diam
 * 
 */
      __pyx_t_16 = ((__pyx_v_diam > __pyx_v_maxDiameter) != 0);
      if (__pyx_t_16) {
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line44")'> 44:                 maxDiameter = diam</pre>
<pre id='line44' class='code' style='background-color: #FFFFff'>
        /* "epitopsy/cython/pdb_cython.pyx":44
 *             diam = sqrt(x*x + y*y + z*z)
 *             if diam > maxDiameter:
 *                 maxDiameter = diam             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     return maxDiameter
 */
        __pyx_v_maxDiameter = __pyx_v_diam;
        goto __pyx_L7;
      }
      __pyx_L7:;
    }
  }
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line45")'> 45: </pre>
<pre id='line45' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF4b' onclick='toggleDiv("line46")'> 46:     return maxDiameter</pre>
<pre id='line46' class='code' style='background-color: #FFFF4b'>
  /* "epitopsy/cython/pdb_cython.pyx":46
 *                 maxDiameter = diam
 * 
 *     return maxDiameter             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * def build_vdw_surface(np.ndarray[DTYPE_float_t, ndim=3] vdw_array):
 */
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
  __pyx_t_17 = <span class='py_c_api'>PyFloat_FromDouble</span>(__pyx_v_maxDiameter);<span class='error_goto'> if (unlikely(!__pyx_t_17)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 46; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_17);
  __pyx_r = __pyx_t_17;
  __pyx_t_17 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_17);
  { PyObject *__pyx_type, *__pyx_value, *__pyx_tb;
    <span class='pyx_c_api'>__Pyx_ErrFetch</span>(&__pyx_type, &__pyx_value, &__pyx_tb);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&__pyx_pybuffernd_atom_coord.rcbuffer->pybuffer);
  <span class='pyx_c_api'>__Pyx_ErrRestore</span>(__pyx_type, __pyx_value, __pyx_tb);}
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("epitopsy.cython.pdb_cython.determine_max_diameter", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  goto __pyx_L2;
  __pyx_L0:;
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&__pyx_pybuffernd_atom_coord.rcbuffer->pybuffer);
  __pyx_L2:;
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_8epitopsy_6cython_10pdb_cython_3build_vdw_surface(PyObject *__pyx_self, PyObject *__pyx_v_vdw_array); /*proto*/
static PyMethodDef __pyx_mdef_8epitopsy_6cython_10pdb_cython_3build_vdw_surface = {<span class='pyx_macro_api'>__Pyx_NAMESTR</span>("build_vdw_surface"), (PyCFunction)__pyx_pw_8epitopsy_6cython_10pdb_cython_3build_vdw_surface, METH_O, <span class='pyx_macro_api'>__Pyx_DOCSTR</span>(0)};
static PyObject *__pyx_pw_8epitopsy_6cython_10pdb_cython_3build_vdw_surface(PyObject *__pyx_self, PyObject *__pyx_v_vdw_array) {
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("build_vdw_surface (wrapper)", 0);
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_vdw_array), __pyx_ptype_5numpy_ndarray, 1, "vdw_array", 0)))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 48; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_r = __pyx_pf_8epitopsy_6cython_10pdb_cython_2build_vdw_surface(__pyx_self, ((PyArrayObject *)__pyx_v_vdw_array));
  CYTHON_UNUSED int __pyx_lineno = 0;
  CYTHON_UNUSED const char *__pyx_filename = NULL;
  CYTHON_UNUSED int __pyx_clineno = 0;
  goto __pyx_L0;
  __pyx_L1_error:;
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line47")'> 47: </pre>
<pre id='line47' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF57' onclick='toggleDiv("line48")'> 48: def build_vdw_surface(np.ndarray[DTYPE_float_t, ndim=3] vdw_array):</pre>
<pre id='line48' class='code' style='background-color: #FFFF57'>
/* "epitopsy/cython/pdb_cython.pyx":48
 *     return maxDiameter
 * 
 * def build_vdw_surface(np.ndarray[DTYPE_float_t, ndim=3] vdw_array):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     # This function iterates over the grid and where it finds an element > 0
 *     # it will use this radius and fill all neighbors, which are 0, with -1.
 */

static PyObject *__pyx_pf_8epitopsy_6cython_10pdb_cython_2build_vdw_surface(CYTHON_UNUSED PyObject *__pyx_self, PyArrayObject *__pyx_v_vdw_array) {
  npy_intp *__pyx_v_shape;
  int __pyx_v_xdim;
  int __pyx_v_ydim;
  int __pyx_v_zdim;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_vdw_array;
  __Pyx_Buffer __pyx_pybuffer_vdw_array;
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("build_vdw_surface", 0);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>((PyObject *)__pyx_v_vdw_array);
  __pyx_pybuffer_vdw_array.pybuffer.buf = NULL;
  __pyx_pybuffer_vdw_array.refcount = 0;
  __pyx_pybuffernd_vdw_array.data = NULL;
  __pyx_pybuffernd_vdw_array.rcbuffer = &__pyx_pybuffer_vdw_array;
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&__pyx_pybuffernd_vdw_array.rcbuffer->pybuffer, (PyObject*)__pyx_v_vdw_array, &__Pyx_TypeInfo_nn___pyx_t_8epitopsy_6cython_10pdb_cython_DTYPE_float_t, PyBUF_FORMAT| PyBUF_STRIDES, 3, 0, __pyx_stack) == -1))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 48; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  }
  __pyx_pybuffernd_vdw_array.diminfo[0].strides = __pyx_pybuffernd_vdw_array.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_vdw_array.diminfo[0].shape = __pyx_pybuffernd_vdw_array.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_vdw_array.diminfo[1].strides = __pyx_pybuffernd_vdw_array.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_vdw_array.diminfo[1].shape = __pyx_pybuffernd_vdw_array.rcbuffer->pybuffer.shape[1]; __pyx_pybuffernd_vdw_array.diminfo[2].strides = __pyx_pybuffernd_vdw_array.rcbuffer->pybuffer.strides[2]; __pyx_pybuffernd_vdw_array.diminfo[2].shape = __pyx_pybuffernd_vdw_array.rcbuffer->pybuffer.shape[2];

  /* "epitopsy/cython/pdb_cython.pyx":48
 *     return maxDiameter
 * 
 * def build_vdw_surface(np.ndarray[DTYPE_float_t, ndim=3] vdw_array):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     # This function iterates over the grid and where it finds an element > 0
 *     # it will use this radius and fill all neighbors, which are 0, with -1.
 */
  __pyx_k_tuple_52 = <span class='py_c_api'>PyTuple_Pack</span>(5, ((PyObject *)__pyx_n_s__vdw_array), ((PyObject *)__pyx_n_s__shape), ((PyObject *)__pyx_n_s__xdim), ((PyObject *)__pyx_n_s__ydim), ((PyObject *)__pyx_n_s__zdim));<span class='error_goto'> if (unlikely(!__pyx_k_tuple_52)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 48; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_k_tuple_52);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_k_tuple_52));

  /* "epitopsy/cython/pdb_cython.pyx":48
 *     return maxDiameter
 * 
 * def build_vdw_surface(np.ndarray[DTYPE_float_t, ndim=3] vdw_array):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     # This function iterates over the grid and where it finds an element > 0
 *     # it will use this radius and fill all neighbors, which are 0, with -1.
 */
  __pyx_t_2 = PyCFunction_NewEx(&__pyx_mdef_8epitopsy_6cython_10pdb_cython_3build_vdw_surface, NULL, __pyx_n_s_51);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 48; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s__build_vdw_surface, __pyx_t_2) <code><</code> 0)<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 48; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_k_codeobj_53 = (PyObject*)__Pyx_<span class='py_c_api'>PyCode_New</span>(1, 0, 5, 0, 0, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_k_tuple_52, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_50, __pyx_n_s__build_vdw_surface, 48, __pyx_empty_bytes);<span class='error_goto'> if (unlikely(!__pyx_k_codeobj_53)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 48; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line49")'> 49:     # This function iterates over the grid and where it finds an element &gt; 0</pre>
<pre id='line49' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line50")'> 50:     # it will use this radius and fill all neighbors, which are 0, with -1.</pre>
<pre id='line50' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line51")'> 51:     # The vdw surface is then defined by all points != 0.</pre>
<pre id='line51' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line52")'> 52:     shape = vdw_array.shape</pre>
<pre id='line52' class='code' style='background-color: #FFFFff'>
  /* "epitopsy/cython/pdb_cython.pyx":52
 *     # it will use this radius and fill all neighbors, which are 0, with -1.
 *     # The vdw surface is then defined by all points != 0.
 *     shape = vdw_array.shape             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     cdef int xdim = <code><</code>int> shape[0]
 *     cdef int ydim = <code><</code>int> shape[1]
 */
  __pyx_t_1 = __pyx_v_vdw_array->dimensions;
  __pyx_v_shape = __pyx_t_1;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line53")'> 53:     cdef int xdim = &lt;int&gt; shape[0]</pre>
<pre id='line53' class='code' style='background-color: #FFFFff'>
  /* "epitopsy/cython/pdb_cython.pyx":53
 *     # The vdw surface is then defined by all points != 0.
 *     shape = vdw_array.shape
 *     cdef int xdim = <code><</code>int> shape[0]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     cdef int ydim = <code><</code>int> shape[1]
 *     cdef int zdim = <code><</code>int> shape[2]
 */
  __pyx_v_xdim = ((int)(__pyx_v_shape[0]));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line54")'> 54:     cdef int ydim = &lt;int&gt; shape[1]</pre>
<pre id='line54' class='code' style='background-color: #FFFFff'>
  /* "epitopsy/cython/pdb_cython.pyx":54
 *     shape = vdw_array.shape
 *     cdef int xdim = <code><</code>int> shape[0]
 *     cdef int ydim = <code><</code>int> shape[1]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     cdef int zdim = <code><</code>int> shape[2]
 *     vdw_array = _build_vdw_surface_fast(vdw_array, xdim, ydim, zdim)
 */
  __pyx_v_ydim = ((int)(__pyx_v_shape[1]));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line55")'> 55:     cdef int zdim = &lt;int&gt; shape[2]</pre>
<pre id='line55' class='code' style='background-color: #FFFFff'>
  /* "epitopsy/cython/pdb_cython.pyx":55
 *     cdef int xdim = <code><</code>int> shape[0]
 *     cdef int ydim = <code><</code>int> shape[1]
 *     cdef int zdim = <code><</code>int> shape[2]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     vdw_array = _build_vdw_surface_fast(vdw_array, xdim, ydim, zdim)
 *     return vdw_array
 */
  __pyx_v_zdim = ((int)(__pyx_v_shape[2]));
</pre><pre class='line' style='background-color: #FFFF57' onclick='toggleDiv("line56")'> 56:     vdw_array = _build_vdw_surface_fast(vdw_array, xdim, ydim, zdim)</pre>
<pre id='line56' class='code' style='background-color: #FFFF57'>
  /* "epitopsy/cython/pdb_cython.pyx":56
 *     cdef int ydim = <code><</code>int> shape[1]
 *     cdef int zdim = <code><</code>int> shape[2]
 *     vdw_array = _build_vdw_surface_fast(vdw_array, xdim, ydim, zdim)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     return vdw_array
 * 
 */
  __pyx_t_2 = ((PyObject *)__pyx_f_8epitopsy_6cython_10pdb_cython__build_vdw_surface_fast(((PyArrayObject *)__pyx_v_vdw_array), __pyx_v_xdim, __pyx_v_ydim, __pyx_v_zdim));<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 56; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&__pyx_pybuffernd_vdw_array.rcbuffer->pybuffer);
    __pyx_t_3 = <span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&__pyx_pybuffernd_vdw_array.rcbuffer->pybuffer, (PyObject*)((PyArrayObject *)__pyx_t_2), &__Pyx_TypeInfo_nn___pyx_t_8epitopsy_6cython_10pdb_cython_DTYPE_float_t, PyBUF_FORMAT| PyBUF_STRIDES, 3, 0, __pyx_stack);
    if (unlikely(__pyx_t_3 <code><</code> 0)) {
      <span class='py_c_api'>PyErr_Fetch</span>(&__pyx_t_4, &__pyx_t_5, &__pyx_t_6);
      if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&__pyx_pybuffernd_vdw_array.rcbuffer->pybuffer, (PyObject*)__pyx_v_vdw_array, &__Pyx_TypeInfo_nn___pyx_t_8epitopsy_6cython_10pdb_cython_DTYPE_float_t, PyBUF_FORMAT| PyBUF_STRIDES, 3, 0, __pyx_stack) == -1)) {
        Py_XDECREF(__pyx_t_4); Py_XDECREF(__pyx_t_5); Py_XDECREF(__pyx_t_6);
        <span class='pyx_c_api'>__Pyx_RaiseBufferFallbackError</span>();
      } else {
        <span class='py_c_api'>PyErr_Restore</span>(__pyx_t_4, __pyx_t_5, __pyx_t_6);
      }
    }
    __pyx_pybuffernd_vdw_array.diminfo[0].strides = __pyx_pybuffernd_vdw_array.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_vdw_array.diminfo[0].shape = __pyx_pybuffernd_vdw_array.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_vdw_array.diminfo[1].strides = __pyx_pybuffernd_vdw_array.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_vdw_array.diminfo[1].shape = __pyx_pybuffernd_vdw_array.rcbuffer->pybuffer.shape[1]; __pyx_pybuffernd_vdw_array.diminfo[2].strides = __pyx_pybuffernd_vdw_array.rcbuffer->pybuffer.strides[2]; __pyx_pybuffernd_vdw_array.diminfo[2].shape = __pyx_pybuffernd_vdw_array.rcbuffer->pybuffer.shape[2];
    if (unlikely(__pyx_t_3 <code><</code> 0))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 56; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  }
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_v_vdw_array));
  __pyx_v_vdw_array = ((PyArrayObject *)__pyx_t_2);
  __pyx_t_2 = 0;
</pre><pre class='line' style='background-color: #FFFF62' onclick='toggleDiv("line57")'> 57:     return vdw_array</pre>
<pre id='line57' class='code' style='background-color: #FFFF62'>
  /* "epitopsy/cython/pdb_cython.pyx":57
 *     cdef int zdim = <code><</code>int> shape[2]
 *     vdw_array = _build_vdw_surface_fast(vdw_array, xdim, ydim, zdim)
 *     return vdw_array             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * cdef np.ndarray _build_vdw_surface_fast(np.ndarray[DTYPE_float_t, ndim=3] vdw_array_np,
 */
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_v_vdw_array));
  __pyx_r = ((PyObject *)__pyx_v_vdw_array);
  goto __pyx_L0;

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  { PyObject *__pyx_type, *__pyx_value, *__pyx_tb;
    <span class='pyx_c_api'>__Pyx_ErrFetch</span>(&__pyx_type, &__pyx_value, &__pyx_tb);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&__pyx_pybuffernd_vdw_array.rcbuffer->pybuffer);
  <span class='pyx_c_api'>__Pyx_ErrRestore</span>(__pyx_type, __pyx_value, __pyx_tb);}
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("epitopsy.cython.pdb_cython.build_vdw_surface", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  goto __pyx_L2;
  __pyx_L0:;
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&__pyx_pybuffernd_vdw_array.rcbuffer->pybuffer);
  __pyx_L2:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_vdw_array);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line58")'> 58: </pre>
<pre id='line58' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line59")'> 59: cdef np.ndarray _build_vdw_surface_fast(np.ndarray[DTYPE_float_t, ndim=3] vdw_array_np,</pre>
<pre id='line59' class='code' style='background-color: #FFFFd4'>
/* "epitopsy/cython/pdb_cython.pyx":59
 *     return vdw_array
 * 
 * cdef np.ndarray _build_vdw_surface_fast(np.ndarray[DTYPE_float_t, ndim=3] vdw_array_np,             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                                        int xdim, int ydim, int zdim):
 *     # This function iterates over the grid and where it finds an element > 0
 */

static PyArrayObject *__pyx_f_8epitopsy_6cython_10pdb_cython__build_vdw_surface_fast(PyArrayObject *__pyx_v_vdw_array_np, int __pyx_v_xdim, int __pyx_v_ydim, int __pyx_v_zdim) {
  __Pyx_memviewslice __pyx_v_vdw_array = { 0, 0, { 0 }, { 0 }, { 0 } };
  int __pyx_v_x;
  int __pyx_v_y;
  int __pyx_v_z;
  int __pyx_v_i;
  int __pyx_v_j;
  int __pyx_v_k;
  int __pyx_v_radius;
  float __pyx_v_vdw_radius;
  float __pyx_v_point_distance;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_vdw_array_np;
  __Pyx_Buffer __pyx_pybuffer_vdw_array_np;
  PyArrayObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_build_vdw_surface_fast", 0);
  __pyx_pybuffer_vdw_array_np.pybuffer.buf = NULL;
  __pyx_pybuffer_vdw_array_np.refcount = 0;
  __pyx_pybuffernd_vdw_array_np.data = NULL;
  __pyx_pybuffernd_vdw_array_np.rcbuffer = &__pyx_pybuffer_vdw_array_np;
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&__pyx_pybuffernd_vdw_array_np.rcbuffer->pybuffer, (PyObject*)__pyx_v_vdw_array_np, &__Pyx_TypeInfo_nn___pyx_t_8epitopsy_6cython_10pdb_cython_DTYPE_float_t, PyBUF_FORMAT| PyBUF_STRIDES, 3, 0, __pyx_stack) == -1))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 59; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  }
  __pyx_pybuffernd_vdw_array_np.diminfo[0].strides = __pyx_pybuffernd_vdw_array_np.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_vdw_array_np.diminfo[0].shape = __pyx_pybuffernd_vdw_array_np.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_vdw_array_np.diminfo[1].strides = __pyx_pybuffernd_vdw_array_np.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_vdw_array_np.diminfo[1].shape = __pyx_pybuffernd_vdw_array_np.rcbuffer->pybuffer.shape[1]; __pyx_pybuffernd_vdw_array_np.diminfo[2].strides = __pyx_pybuffernd_vdw_array_np.rcbuffer->pybuffer.strides[2]; __pyx_pybuffernd_vdw_array_np.diminfo[2].shape = __pyx_pybuffernd_vdw_array_np.rcbuffer->pybuffer.shape[2];
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line60")'> 60:                                        int xdim, int ydim, int zdim):</pre>
<pre id='line60' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line61")'> 61:     # This function iterates over the grid and where it finds an element &gt; 0</pre>
<pre id='line61' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line62")'> 62:     # it will use this radius and fill all neighbors, which are 0, with -1.</pre>
<pre id='line62' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line63")'> 63:     # The vdw surface is then defined by all points != 0.</pre>
<pre id='line63' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line64")'> 64:     # This is 'pure' c code!</pre>
<pre id='line64' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line65")'> 65:     cdef double[:,:,:] vdw_array = vdw_array_np</pre>
<pre id='line65' class='code' style='background-color: #FFFFd4'>
  /* "epitopsy/cython/pdb_cython.pyx":65
 *     # The vdw surface is then defined by all points != 0.
 *     # This is 'pure' c code!
 *     cdef double[:,:,:] vdw_array = vdw_array_np             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     cdef int x,y,z
 *     cdef int i,j,k
 */
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_dsdsds_double</span>(((PyObject *)__pyx_v_vdw_array_np));
  if (unlikely(!__pyx_t_1.memview))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 65; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_v_vdw_array = __pyx_t_1;
  __pyx_t_1.memview = NULL;
  __pyx_t_1.data = NULL;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line66")'> 66:     cdef int x,y,z</pre>
<pre id='line66' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line67")'> 67:     cdef int i,j,k</pre>
<pre id='line67' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line68")'> 68:     cdef int radius</pre>
<pre id='line68' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line69")'> 69:     cdef float vdw_radius</pre>
<pre id='line69' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line70")'> 70:     cdef float point_distance</pre>
<pre id='line70' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line71")'> 71:     for x from 0 &lt;= x &lt; xdim:</pre>
<pre id='line71' class='code' style='background-color: #FFFFff'>
  /* "epitopsy/cython/pdb_cython.pyx":71
 *     cdef float vdw_radius
 *     cdef float point_distance
 *     for x from 0 <code><</code>= x <code><</code> xdim:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         for y from 0 <code><</code>= y <code><</code> ydim:
 *             for z from 0 <code><</code>= z <code><</code> zdim:
 */
  __pyx_t_2 = __pyx_v_xdim;
  for (__pyx_v_x = 0; __pyx_v_x <code><</code> __pyx_t_2; __pyx_v_x++) {
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line72")'> 72:         for y from 0 &lt;= y &lt; ydim:</pre>
<pre id='line72' class='code' style='background-color: #FFFFff'>
    /* "epitopsy/cython/pdb_cython.pyx":72
 *     cdef float point_distance
 *     for x from 0 <code><</code>= x <code><</code> xdim:
 *         for y from 0 <code><</code>= y <code><</code> ydim:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             for z from 0 <code><</code>= z <code><</code> zdim:
 *                 # find centers of atoms
 */
    __pyx_t_3 = __pyx_v_ydim;
    for (__pyx_v_y = 0; __pyx_v_y <code><</code> __pyx_t_3; __pyx_v_y++) {
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line73")'> 73:             for z from 0 &lt;= z &lt; zdim:</pre>
<pre id='line73' class='code' style='background-color: #FFFFff'>
      /* "epitopsy/cython/pdb_cython.pyx":73
 *     for x from 0 <code><</code>= x <code><</code> xdim:
 *         for y from 0 <code><</code>= y <code><</code> ydim:
 *             for z from 0 <code><</code>= z <code><</code> zdim:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                 # find centers of atoms
 *                 vdw_radius = vdw_array[x,y,z]
 */
      __pyx_t_4 = __pyx_v_zdim;
      for (__pyx_v_z = 0; __pyx_v_z <code><</code> __pyx_t_4; __pyx_v_z++) {
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line74")'> 74:                 # find centers of atoms</pre>
<pre id='line74' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line75")'> 75:                 vdw_radius = vdw_array[x,y,z]</pre>
<pre id='line75' class='code' style='background-color: #FFFFd4'>
        /* "epitopsy/cython/pdb_cython.pyx":75
 *             for z from 0 <code><</code>= z <code><</code> zdim:
 *                 # find centers of atoms
 *                 vdw_radius = vdw_array[x,y,z]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                 if vdw_radius > 0:
 *                     # set the current node to -1
 */
        __pyx_t_5 = __pyx_v_x;
        __pyx_t_6 = __pyx_v_y;
        __pyx_t_7 = __pyx_v_z;
        __pyx_t_8 = -1;
        if (__pyx_t_5 <code><</code> 0) {
          __pyx_t_5 += __pyx_v_vdw_array.shape[0];
          if (unlikely(__pyx_t_5 <code><</code> 0)) __pyx_t_8 = 0;
        } else if (unlikely(__pyx_t_5 >= __pyx_v_vdw_array.shape[0])) __pyx_t_8 = 0;
        if (__pyx_t_6 <code><</code> 0) {
          __pyx_t_6 += __pyx_v_vdw_array.shape[1];
          if (unlikely(__pyx_t_6 <code><</code> 0)) __pyx_t_8 = 1;
        } else if (unlikely(__pyx_t_6 >= __pyx_v_vdw_array.shape[1])) __pyx_t_8 = 1;
        if (__pyx_t_7 <code><</code> 0) {
          __pyx_t_7 += __pyx_v_vdw_array.shape[2];
          if (unlikely(__pyx_t_7 <code><</code> 0)) __pyx_t_8 = 2;
        } else if (unlikely(__pyx_t_7 >= __pyx_v_vdw_array.shape[2])) __pyx_t_8 = 2;
        if (unlikely(__pyx_t_8 != -1)) {
          <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_8);
         <span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 75; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        }
        __pyx_v_vdw_radius = (*((double *) ( /* dim=2 */ (( /* dim=1 */ (( /* dim=0 */ (__pyx_v_vdw_array.data + __pyx_t_5 * __pyx_v_vdw_array.strides[0]) ) + __pyx_t_6 * __pyx_v_vdw_array.strides[1]) ) + __pyx_t_7 * __pyx_v_vdw_array.strides[2]) )));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line76")'> 76:                 if vdw_radius &gt; 0:</pre>
<pre id='line76' class='code' style='background-color: #FFFFff'>
        /* "epitopsy/cython/pdb_cython.pyx":76
 *                 # find centers of atoms
 *                 vdw_radius = vdw_array[x,y,z]
 *                 if vdw_radius > 0:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                     # set the current node to -1
 *                     vdw_array[x,y,z] = -1.
 */
        __pyx_t_9 = ((__pyx_v_vdw_radius > 0.0) != 0);
        if (__pyx_t_9) {
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line77")'> 77:                     # set the current node to -1</pre>
<pre id='line77' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line78")'> 78:                     vdw_array[x,y,z] = -1.</pre>
<pre id='line78' class='code' style='background-color: #FFFFd4'>
          /* "epitopsy/cython/pdb_cython.pyx":78
 *                 if vdw_radius > 0:
 *                     # set the current node to -1
 *                     vdw_array[x,y,z] = -1.             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                     # iterate the environment and set all to -1 which are 0
 *                     radius = <code><</code>int> round(vdw_radius)
 */
          __pyx_t_8 = __pyx_v_x;
          __pyx_t_10 = __pyx_v_y;
          __pyx_t_11 = __pyx_v_z;
          __pyx_t_12 = -1;
          if (__pyx_t_8 <code><</code> 0) {
            __pyx_t_8 += __pyx_v_vdw_array.shape[0];
            if (unlikely(__pyx_t_8 <code><</code> 0)) __pyx_t_12 = 0;
          } else if (unlikely(__pyx_t_8 >= __pyx_v_vdw_array.shape[0])) __pyx_t_12 = 0;
          if (__pyx_t_10 <code><</code> 0) {
            __pyx_t_10 += __pyx_v_vdw_array.shape[1];
            if (unlikely(__pyx_t_10 <code><</code> 0)) __pyx_t_12 = 1;
          } else if (unlikely(__pyx_t_10 >= __pyx_v_vdw_array.shape[1])) __pyx_t_12 = 1;
          if (__pyx_t_11 <code><</code> 0) {
            __pyx_t_11 += __pyx_v_vdw_array.shape[2];
            if (unlikely(__pyx_t_11 <code><</code> 0)) __pyx_t_12 = 2;
          } else if (unlikely(__pyx_t_11 >= __pyx_v_vdw_array.shape[2])) __pyx_t_12 = 2;
          if (unlikely(__pyx_t_12 != -1)) {
            <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_12);
           <span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 78; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
          }
          *((double *) ( /* dim=2 */ (( /* dim=1 */ (( /* dim=0 */ (__pyx_v_vdw_array.data + __pyx_t_8 * __pyx_v_vdw_array.strides[0]) ) + __pyx_t_10 * __pyx_v_vdw_array.strides[1]) ) + __pyx_t_11 * __pyx_v_vdw_array.strides[2]) )) = -1.;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line79")'> 79:                     # iterate the environment and set all to -1 which are 0</pre>
<pre id='line79' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line80")'> 80:                     radius = &lt;int&gt; round(vdw_radius)</pre>
<pre id='line80' class='code' style='background-color: #FFFFff'>
          /* "epitopsy/cython/pdb_cython.pyx":80
 *                     vdw_array[x,y,z] = -1.
 *                     # iterate the environment and set all to -1 which are 0
 *                     radius = <code><</code>int> round(vdw_radius)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                     for i from x-radius <code><</code>= i <code><</code>= x+radius:
 *                         for j from y-radius <code><</code>= j <code><</code>= y+radius:
 */
          __pyx_v_radius = ((int)round(__pyx_v_vdw_radius));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line81")'> 81:                     for i from x-radius &lt;= i &lt;= x+radius:</pre>
<pre id='line81' class='code' style='background-color: #FFFFff'>
          /* "epitopsy/cython/pdb_cython.pyx":81
 *                     # iterate the environment and set all to -1 which are 0
 *                     radius = <code><</code>int> round(vdw_radius)
 *                     for i from x-radius <code><</code>= i <code><</code>= x+radius:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                         for j from y-radius <code><</code>= j <code><</code>= y+radius:
 *                             for k from z-radius <code><</code>= k <code><</code>= z+radius:
 */
          __pyx_t_12 = (__pyx_v_x + __pyx_v_radius);
          for (__pyx_v_i = (__pyx_v_x - __pyx_v_radius); __pyx_v_i <code><</code>= __pyx_t_12; __pyx_v_i++) {
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line82")'> 82:                         for j from y-radius &lt;= j &lt;= y+radius:</pre>
<pre id='line82' class='code' style='background-color: #FFFFff'>
            /* "epitopsy/cython/pdb_cython.pyx":82
 *                     radius = <code><</code>int> round(vdw_radius)
 *                     for i from x-radius <code><</code>= i <code><</code>= x+radius:
 *                         for j from y-radius <code><</code>= j <code><</code>= y+radius:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                             for k from z-radius <code><</code>= k <code><</code>= z+radius:
 *                                 point_distance = sqrt((x-i)*(x-i)
 */
            __pyx_t_13 = (__pyx_v_y + __pyx_v_radius);
            for (__pyx_v_j = (__pyx_v_y - __pyx_v_radius); __pyx_v_j <code><</code>= __pyx_t_13; __pyx_v_j++) {
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line83")'> 83:                             for k from z-radius &lt;= k &lt;= z+radius:</pre>
<pre id='line83' class='code' style='background-color: #FFFFff'>
              /* "epitopsy/cython/pdb_cython.pyx":83
 *                     for i from x-radius <code><</code>= i <code><</code>= x+radius:
 *                         for j from y-radius <code><</code>= j <code><</code>= y+radius:
 *                             for k from z-radius <code><</code>= k <code><</code>= z+radius:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                                 point_distance = sqrt((x-i)*(x-i)
 *                                                             +(y-j)*(y-j)
 */
              __pyx_t_14 = (__pyx_v_z + __pyx_v_radius);
              for (__pyx_v_k = (__pyx_v_z - __pyx_v_radius); __pyx_v_k <code><</code>= __pyx_t_14; __pyx_v_k++) {
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line84")'> 84:                                 point_distance = sqrt((x-i)*(x-i)</pre>
<pre id='line84' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line85")'> 85:                                                             +(y-j)*(y-j)</pre>
<pre id='line85' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line86")'> 86:                                                             +(z-k)*(z-k))</pre>
<pre id='line86' class='code' style='background-color: #FFFFff'>
                /* "epitopsy/cython/pdb_cython.pyx":86
 *                                 point_distance = sqrt((x-i)*(x-i)
 *                                                             +(y-j)*(y-j)
 *                                                             +(z-k)*(z-k))             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                                 if point_distance <code><</code>= vdw_radius:
 *                                     if (i >= 0 and j >= 0 and z >= 0 and
 */
                __pyx_v_point_distance = sqrt(((((__pyx_v_x - __pyx_v_i) * (__pyx_v_x - __pyx_v_i)) + ((__pyx_v_y - __pyx_v_j) * (__pyx_v_y - __pyx_v_j))) + ((__pyx_v_z - __pyx_v_k) * (__pyx_v_z - __pyx_v_k))));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line87")'> 87:                                 if point_distance &lt;= vdw_radius:</pre>
<pre id='line87' class='code' style='background-color: #FFFFff'>
                /* "epitopsy/cython/pdb_cython.pyx":87
 *                                                             +(y-j)*(y-j)
 *                                                             +(z-k)*(z-k))
 *                                 if point_distance <code><</code>= vdw_radius:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                                     if (i >= 0 and j >= 0 and z >= 0 and
 *                                         i <code><</code> xdim and j <code><</code> ydim and k <code><</code> zdim):
 */
                __pyx_t_9 = ((__pyx_v_point_distance <code><</code>= __pyx_v_vdw_radius) != 0);
                if (__pyx_t_9) {
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line88")'> 88:                                     if (i &gt;= 0 and j &gt;= 0 and z &gt;= 0 and</pre>
<pre id='line88' class='code' style='background-color: #FFFFff'>
                  /* "epitopsy/cython/pdb_cython.pyx":88
 *                                                             +(z-k)*(z-k))
 *                                 if point_distance <code><</code>= vdw_radius:
 *                                     if (i >= 0 and j >= 0 and z >= 0 and             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                                         i <code><</code> xdim and j <code><</code> ydim and k <code><</code> zdim):
 *                                         if vdw_array[i,j,k] == 0.:
 */
                  __pyx_t_9 = ((__pyx_v_i >= 0) != 0);
                  if (__pyx_t_9) {
                    __pyx_t_15 = ((__pyx_v_j >= 0) != 0);
                    if (__pyx_t_15) {
                      __pyx_t_16 = ((__pyx_v_z >= 0) != 0);
                      if (__pyx_t_16) {
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line89")'> 89:                                         i &lt; xdim and j &lt; ydim and k &lt; zdim):</pre>
<pre id='line89' class='code' style='background-color: #FFFFff'>
                        /* "epitopsy/cython/pdb_cython.pyx":89
 *                                 if point_distance <code><</code>= vdw_radius:
 *                                     if (i >= 0 and j >= 0 and z >= 0 and
 *                                         i <code><</code> xdim and j <code><</code> ydim and k <code><</code> zdim):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                                         if vdw_array[i,j,k] == 0.:
 *                                             vdw_array[i,j,k] = -1.
 */
                        __pyx_t_17 = ((__pyx_v_i <code><</code> __pyx_v_xdim) != 0);
                        if (__pyx_t_17) {
                          __pyx_t_18 = ((__pyx_v_j <code><</code> __pyx_v_ydim) != 0);
                          if (__pyx_t_18) {
                            __pyx_t_19 = ((__pyx_v_k <code><</code> __pyx_v_zdim) != 0);
                            __pyx_t_20 = __pyx_t_19;
                          } else {
                            __pyx_t_20 = __pyx_t_18;
                          }
                          __pyx_t_18 = __pyx_t_20;
                        } else {
                          __pyx_t_18 = __pyx_t_17;
                        }
                        __pyx_t_17 = __pyx_t_18;
                      } else {
                        __pyx_t_17 = __pyx_t_16;
                      }
                      __pyx_t_16 = __pyx_t_17;
                    } else {
                      __pyx_t_16 = __pyx_t_15;
                    }
                    __pyx_t_15 = __pyx_t_16;
                  } else {
                    __pyx_t_15 = __pyx_t_9;
                  }
                  if (__pyx_t_15) {
</pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line90")'> 90:                                         if vdw_array[i,j,k] == 0.:</pre>
<pre id='line90' class='code' style='background-color: #FFFFd4'>
                    /* "epitopsy/cython/pdb_cython.pyx":90
 *                                     if (i >= 0 and j >= 0 and z >= 0 and
 *                                         i <code><</code> xdim and j <code><</code> ydim and k <code><</code> zdim):
 *                                         if vdw_array[i,j,k] == 0.:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                                             vdw_array[i,j,k] = -1.
 * 
 */
                    __pyx_t_21 = __pyx_v_i;
                    __pyx_t_22 = __pyx_v_j;
                    __pyx_t_23 = __pyx_v_k;
                    __pyx_t_24 = -1;
                    if (__pyx_t_21 <code><</code> 0) {
                      __pyx_t_21 += __pyx_v_vdw_array.shape[0];
                      if (unlikely(__pyx_t_21 <code><</code> 0)) __pyx_t_24 = 0;
                    } else if (unlikely(__pyx_t_21 >= __pyx_v_vdw_array.shape[0])) __pyx_t_24 = 0;
                    if (__pyx_t_22 <code><</code> 0) {
                      __pyx_t_22 += __pyx_v_vdw_array.shape[1];
                      if (unlikely(__pyx_t_22 <code><</code> 0)) __pyx_t_24 = 1;
                    } else if (unlikely(__pyx_t_22 >= __pyx_v_vdw_array.shape[1])) __pyx_t_24 = 1;
                    if (__pyx_t_23 <code><</code> 0) {
                      __pyx_t_23 += __pyx_v_vdw_array.shape[2];
                      if (unlikely(__pyx_t_23 <code><</code> 0)) __pyx_t_24 = 2;
                    } else if (unlikely(__pyx_t_23 >= __pyx_v_vdw_array.shape[2])) __pyx_t_24 = 2;
                    if (unlikely(__pyx_t_24 != -1)) {
                      <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_24);
                     <span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 90; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
                    }
                    __pyx_t_15 = (((*((double *) ( /* dim=2 */ (( /* dim=1 */ (( /* dim=0 */ (__pyx_v_vdw_array.data + __pyx_t_21 * __pyx_v_vdw_array.strides[0]) ) + __pyx_t_22 * __pyx_v_vdw_array.strides[1]) ) + __pyx_t_23 * __pyx_v_vdw_array.strides[2]) ))) == 0.) != 0);
                    if (__pyx_t_15) {
</pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line91")'> 91:                                             vdw_array[i,j,k] = -1.</pre>
<pre id='line91' class='code' style='background-color: #FFFFd4'>
                      /* "epitopsy/cython/pdb_cython.pyx":91
 *                                         i <code><</code> xdim and j <code><</code> ydim and k <code><</code> zdim):
 *                                         if vdw_array[i,j,k] == 0.:
 *                                             vdw_array[i,j,k] = -1.             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     # set everything else than 0 to 1:
 */
                      __pyx_t_24 = __pyx_v_i;
                      __pyx_t_25 = __pyx_v_j;
                      __pyx_t_26 = __pyx_v_k;
                      __pyx_t_27 = -1;
                      if (__pyx_t_24 <code><</code> 0) {
                        __pyx_t_24 += __pyx_v_vdw_array.shape[0];
                        if (unlikely(__pyx_t_24 <code><</code> 0)) __pyx_t_27 = 0;
                      } else if (unlikely(__pyx_t_24 >= __pyx_v_vdw_array.shape[0])) __pyx_t_27 = 0;
                      if (__pyx_t_25 <code><</code> 0) {
                        __pyx_t_25 += __pyx_v_vdw_array.shape[1];
                        if (unlikely(__pyx_t_25 <code><</code> 0)) __pyx_t_27 = 1;
                      } else if (unlikely(__pyx_t_25 >= __pyx_v_vdw_array.shape[1])) __pyx_t_27 = 1;
                      if (__pyx_t_26 <code><</code> 0) {
                        __pyx_t_26 += __pyx_v_vdw_array.shape[2];
                        if (unlikely(__pyx_t_26 <code><</code> 0)) __pyx_t_27 = 2;
                      } else if (unlikely(__pyx_t_26 >= __pyx_v_vdw_array.shape[2])) __pyx_t_27 = 2;
                      if (unlikely(__pyx_t_27 != -1)) {
                        <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_27);
                       <span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 91; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
                      }
                      *((double *) ( /* dim=2 */ (( /* dim=1 */ (( /* dim=0 */ (__pyx_v_vdw_array.data + __pyx_t_24 * __pyx_v_vdw_array.strides[0]) ) + __pyx_t_25 * __pyx_v_vdw_array.strides[1]) ) + __pyx_t_26 * __pyx_v_vdw_array.strides[2]) )) = -1.;
                      goto __pyx_L18;
                    }
                    __pyx_L18:;
                    goto __pyx_L17;
                  }
                  __pyx_L17:;
                  goto __pyx_L16;
                }
                __pyx_L16:;
              }
            }
          }
          goto __pyx_L9;
        }
        __pyx_L9:;
      }
    }
  }
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line92")'> 92: </pre>
<pre id='line92' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line93")'> 93:     # set everything else than 0 to 1:</pre>
<pre id='line93' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line94")'> 94:     for x from 0 &lt;= x &lt; xdim:</pre>
<pre id='line94' class='code' style='background-color: #FFFFff'>
  /* "epitopsy/cython/pdb_cython.pyx":94
 * 
 *     # set everything else than 0 to 1:
 *     for x from 0 <code><</code>= x <code><</code> xdim:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         for y from 0 <code><</code>= y <code><</code> ydim:
 *             for z from 0 <code><</code>= z <code><</code> zdim:
 */
  __pyx_t_2 = __pyx_v_xdim;
  for (__pyx_v_x = 0; __pyx_v_x <code><</code> __pyx_t_2; __pyx_v_x++) {
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line95")'> 95:         for y from 0 &lt;= y &lt; ydim:</pre>
<pre id='line95' class='code' style='background-color: #FFFFff'>
    /* "epitopsy/cython/pdb_cython.pyx":95
 *     # set everything else than 0 to 1:
 *     for x from 0 <code><</code>= x <code><</code> xdim:
 *         for y from 0 <code><</code>= y <code><</code> ydim:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             for z from 0 <code><</code>= z <code><</code> zdim:
 *                 if vdw_array[x,y,z] != 0.0:
 */
    __pyx_t_3 = __pyx_v_ydim;
    for (__pyx_v_y = 0; __pyx_v_y <code><</code> __pyx_t_3; __pyx_v_y++) {
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line96")'> 96:             for z from 0 &lt;= z &lt; zdim:</pre>
<pre id='line96' class='code' style='background-color: #FFFFff'>
      /* "epitopsy/cython/pdb_cython.pyx":96
 *     for x from 0 <code><</code>= x <code><</code> xdim:
 *         for y from 0 <code><</code>= y <code><</code> ydim:
 *             for z from 0 <code><</code>= z <code><</code> zdim:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                 if vdw_array[x,y,z] != 0.0:
 *                     vdw_array[x,y,z] = 1.
 */
      __pyx_t_4 = __pyx_v_zdim;
      for (__pyx_v_z = 0; __pyx_v_z <code><</code> __pyx_t_4; __pyx_v_z++) {
</pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line97")'> 97:                 if vdw_array[x,y,z] != 0.0:</pre>
<pre id='line97' class='code' style='background-color: #FFFFd4'>
        /* "epitopsy/cython/pdb_cython.pyx":97
 *         for y from 0 <code><</code>= y <code><</code> ydim:
 *             for z from 0 <code><</code>= z <code><</code> zdim:
 *                 if vdw_array[x,y,z] != 0.0:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                     vdw_array[x,y,z] = 1.
 * 
 */
        __pyx_t_12 = __pyx_v_x;
        __pyx_t_13 = __pyx_v_y;
        __pyx_t_14 = __pyx_v_z;
        __pyx_t_27 = -1;
        if (__pyx_t_12 <code><</code> 0) {
          __pyx_t_12 += __pyx_v_vdw_array.shape[0];
          if (unlikely(__pyx_t_12 <code><</code> 0)) __pyx_t_27 = 0;
        } else if (unlikely(__pyx_t_12 >= __pyx_v_vdw_array.shape[0])) __pyx_t_27 = 0;
        if (__pyx_t_13 <code><</code> 0) {
          __pyx_t_13 += __pyx_v_vdw_array.shape[1];
          if (unlikely(__pyx_t_13 <code><</code> 0)) __pyx_t_27 = 1;
        } else if (unlikely(__pyx_t_13 >= __pyx_v_vdw_array.shape[1])) __pyx_t_27 = 1;
        if (__pyx_t_14 <code><</code> 0) {
          __pyx_t_14 += __pyx_v_vdw_array.shape[2];
          if (unlikely(__pyx_t_14 <code><</code> 0)) __pyx_t_27 = 2;
        } else if (unlikely(__pyx_t_14 >= __pyx_v_vdw_array.shape[2])) __pyx_t_27 = 2;
        if (unlikely(__pyx_t_27 != -1)) {
          <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_27);
         <span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 97; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        }
        __pyx_t_15 = (((*((double *) ( /* dim=2 */ (( /* dim=1 */ (( /* dim=0 */ (__pyx_v_vdw_array.data + __pyx_t_12 * __pyx_v_vdw_array.strides[0]) ) + __pyx_t_13 * __pyx_v_vdw_array.strides[1]) ) + __pyx_t_14 * __pyx_v_vdw_array.strides[2]) ))) != 0.0) != 0);
        if (__pyx_t_15) {
</pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line98")'> 98:                     vdw_array[x,y,z] = 1.</pre>
<pre id='line98' class='code' style='background-color: #FFFFd4'>
          /* "epitopsy/cython/pdb_cython.pyx":98
 *             for z from 0 <code><</code>= z <code><</code> zdim:
 *                 if vdw_array[x,y,z] != 0.0:
 *                     vdw_array[x,y,z] = 1.             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     return vdw_array_np
 */
          __pyx_t_27 = __pyx_v_x;
          __pyx_t_28 = __pyx_v_y;
          __pyx_t_29 = __pyx_v_z;
          __pyx_t_30 = -1;
          if (__pyx_t_27 <code><</code> 0) {
            __pyx_t_27 += __pyx_v_vdw_array.shape[0];
            if (unlikely(__pyx_t_27 <code><</code> 0)) __pyx_t_30 = 0;
          } else if (unlikely(__pyx_t_27 >= __pyx_v_vdw_array.shape[0])) __pyx_t_30 = 0;
          if (__pyx_t_28 <code><</code> 0) {
            __pyx_t_28 += __pyx_v_vdw_array.shape[1];
            if (unlikely(__pyx_t_28 <code><</code> 0)) __pyx_t_30 = 1;
          } else if (unlikely(__pyx_t_28 >= __pyx_v_vdw_array.shape[1])) __pyx_t_30 = 1;
          if (__pyx_t_29 <code><</code> 0) {
            __pyx_t_29 += __pyx_v_vdw_array.shape[2];
            if (unlikely(__pyx_t_29 <code><</code> 0)) __pyx_t_30 = 2;
          } else if (unlikely(__pyx_t_29 >= __pyx_v_vdw_array.shape[2])) __pyx_t_30 = 2;
          if (unlikely(__pyx_t_30 != -1)) {
            <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_30);
           <span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 98; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
          }
          *((double *) ( /* dim=2 */ (( /* dim=1 */ (( /* dim=0 */ (__pyx_v_vdw_array.data + __pyx_t_27 * __pyx_v_vdw_array.strides[0]) ) + __pyx_t_28 * __pyx_v_vdw_array.strides[1]) ) + __pyx_t_29 * __pyx_v_vdw_array.strides[2]) )) = 1.;
          goto __pyx_L25;
        }
        __pyx_L25:;
      }
    }
  }
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line99")'> 99: </pre>
<pre id='line99' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF6a' onclick='toggleDiv("line100")'> 100:     return vdw_array_np</pre>
<pre id='line100' class='code' style='background-color: #FFFF6a'>
  /* "epitopsy/cython/pdb_cython.pyx":100
 *                     vdw_array[x,y,z] = 1.
 * 
 *     return vdw_array_np             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * cdef float calculate_rmsd(np.ndarray[DTYPE_float_t, ndim=2] coord_1,
 */
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(((PyObject *)__pyx_r));
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_v_vdw_array_np));
  __pyx_r = ((PyArrayObject *)__pyx_v_vdw_array_np);
  goto __pyx_L0;

  __pyx_r = ((PyArrayObject *)Py_None); <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __PYX_XDEC_MEMVIEW(&__pyx_t_1, 1);
  { PyObject *__pyx_type, *__pyx_value, *__pyx_tb;
    <span class='pyx_c_api'>__Pyx_ErrFetch</span>(&__pyx_type, &__pyx_value, &__pyx_tb);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&__pyx_pybuffernd_vdw_array_np.rcbuffer->pybuffer);
  <span class='pyx_c_api'>__Pyx_ErrRestore</span>(__pyx_type, __pyx_value, __pyx_tb);}
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("epitopsy.cython.pdb_cython._build_vdw_surface_fast", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = 0;
  goto __pyx_L2;
  __pyx_L0:;
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&__pyx_pybuffernd_vdw_array_np.rcbuffer->pybuffer);
  __pyx_L2:;
  __PYX_XDEC_MEMVIEW(&__pyx_v_vdw_array, 1);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>((PyObject *)__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line101")'> 101: </pre>
<pre id='line101' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFb6' onclick='toggleDiv("line102")'> 102: cdef float calculate_rmsd(np.ndarray[DTYPE_float_t, ndim=2] coord_1,</pre>
<pre id='line102' class='code' style='background-color: #FFFFb6'>
/* "epitopsy/cython/pdb_cython.pyx":102
 *     return vdw_array_np
 * 
 * cdef float calculate_rmsd(np.ndarray[DTYPE_float_t, ndim=2] coord_1,             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         np.ndarray[DTYPE_float_t, ndim=2] coord_2):
 *     cdef int i
 */

static float __pyx_f_8epitopsy_6cython_10pdb_cython_calculate_rmsd(PyArrayObject *__pyx_v_coord_1, PyArrayObject *__pyx_v_coord_2) {
  int __pyx_v_i;
  float __pyx_v_rmsd;
  float __pyx_v_diff_x;
  float __pyx_v_diff_y;
  float __pyx_v_diff_z;
  int __pyx_v_xdim;
  float __pyx_v_n;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_coord_1;
  __Pyx_Buffer __pyx_pybuffer_coord_1;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_coord_2;
  __Pyx_Buffer __pyx_pybuffer_coord_2;
  float __pyx_r;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("calculate_rmsd", 0);
  __pyx_pybuffer_coord_1.pybuffer.buf = NULL;
  __pyx_pybuffer_coord_1.refcount = 0;
  __pyx_pybuffernd_coord_1.data = NULL;
  __pyx_pybuffernd_coord_1.rcbuffer = &__pyx_pybuffer_coord_1;
  __pyx_pybuffer_coord_2.pybuffer.buf = NULL;
  __pyx_pybuffer_coord_2.refcount = 0;
  __pyx_pybuffernd_coord_2.data = NULL;
  __pyx_pybuffernd_coord_2.rcbuffer = &__pyx_pybuffer_coord_2;
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&__pyx_pybuffernd_coord_1.rcbuffer->pybuffer, (PyObject*)__pyx_v_coord_1, &__Pyx_TypeInfo_nn___pyx_t_8epitopsy_6cython_10pdb_cython_DTYPE_float_t, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack) == -1))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 102; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  }
  __pyx_pybuffernd_coord_1.diminfo[0].strides = __pyx_pybuffernd_coord_1.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_coord_1.diminfo[0].shape = __pyx_pybuffernd_coord_1.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_coord_1.diminfo[1].strides = __pyx_pybuffernd_coord_1.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_coord_1.diminfo[1].shape = __pyx_pybuffernd_coord_1.rcbuffer->pybuffer.shape[1];
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&__pyx_pybuffernd_coord_2.rcbuffer->pybuffer, (PyObject*)__pyx_v_coord_2, &__Pyx_TypeInfo_nn___pyx_t_8epitopsy_6cython_10pdb_cython_DTYPE_float_t, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack) == -1))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 102; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  }
  __pyx_pybuffernd_coord_2.diminfo[0].strides = __pyx_pybuffernd_coord_2.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_coord_2.diminfo[0].shape = __pyx_pybuffernd_coord_2.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_coord_2.diminfo[1].strides = __pyx_pybuffernd_coord_2.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_coord_2.diminfo[1].shape = __pyx_pybuffernd_coord_2.rcbuffer->pybuffer.shape[1];
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line103")'> 103:         np.ndarray[DTYPE_float_t, ndim=2] coord_2):</pre>
<pre id='line103' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line104")'> 104:     cdef int i</pre>
<pre id='line104' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line105")'> 105:     cdef float rmsd = 0</pre>
<pre id='line105' class='code' style='background-color: #FFFFff'>
  /* "epitopsy/cython/pdb_cython.pyx":105
 *         np.ndarray[DTYPE_float_t, ndim=2] coord_2):
 *     cdef int i
 *     cdef float rmsd = 0             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     cdef float diff_x, diff_y, diff_z
 *     cdef int xdim = coord_1.shape[0]
 */
  __pyx_v_rmsd = 0.0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line106")'> 106:     cdef float diff_x, diff_y, diff_z</pre>
<pre id='line106' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line107")'> 107:     cdef int xdim = coord_1.shape[0]</pre>
<pre id='line107' class='code' style='background-color: #FFFFff'>
  /* "epitopsy/cython/pdb_cython.pyx":107
 *     cdef float rmsd = 0
 *     cdef float diff_x, diff_y, diff_z
 *     cdef int xdim = coord_1.shape[0]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     cdef float n = <code><</code>float> xdim
 *     for i from 0 <code><</code>= i <code><</code> xdim:
 */
  __pyx_v_xdim = (__pyx_v_coord_1->dimensions[0]);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line108")'> 108:     cdef float n = &lt;float&gt; xdim</pre>
<pre id='line108' class='code' style='background-color: #FFFFff'>
  /* "epitopsy/cython/pdb_cython.pyx":108
 *     cdef float diff_x, diff_y, diff_z
 *     cdef int xdim = coord_1.shape[0]
 *     cdef float n = <code><</code>float> xdim             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     for i from 0 <code><</code>= i <code><</code> xdim:
 *         diff_x = coord_1[i,0] - coord_2[i,0]
 */
  __pyx_v_n = ((float)__pyx_v_xdim);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line109")'> 109:     for i from 0 &lt;= i &lt; xdim:</pre>
<pre id='line109' class='code' style='background-color: #FFFFff'>
  /* "epitopsy/cython/pdb_cython.pyx":109
 *     cdef int xdim = coord_1.shape[0]
 *     cdef float n = <code><</code>float> xdim
 *     for i from 0 <code><</code>= i <code><</code> xdim:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         diff_x = coord_1[i,0] - coord_2[i,0]
 *         diff_y = coord_1[i,1] - coord_2[i,1]
 */
  __pyx_t_1 = __pyx_v_xdim;
  for (__pyx_v_i = 0; __pyx_v_i <code><</code> __pyx_t_1; __pyx_v_i++) {
</pre><pre class='line' style='background-color: #FFFFb6' onclick='toggleDiv("line110")'> 110:         diff_x = coord_1[i,0] - coord_2[i,0]</pre>
<pre id='line110' class='code' style='background-color: #FFFFb6'>
    /* "epitopsy/cython/pdb_cython.pyx":110
 *     cdef float n = <code><</code>float> xdim
 *     for i from 0 <code><</code>= i <code><</code> xdim:
 *         diff_x = coord_1[i,0] - coord_2[i,0]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         diff_y = coord_1[i,1] - coord_2[i,1]
 *         diff_z = coord_1[i,2] - coord_2[i,2]
 */
    __pyx_t_2 = __pyx_v_i;
    __pyx_t_3 = 0;
    __pyx_t_4 = -1;
    if (__pyx_t_2 <code><</code> 0) {
      __pyx_t_2 += __pyx_pybuffernd_coord_1.diminfo[0].shape;
      if (unlikely(__pyx_t_2 <code><</code> 0)) __pyx_t_4 = 0;
    } else if (unlikely(__pyx_t_2 >= __pyx_pybuffernd_coord_1.diminfo[0].shape)) __pyx_t_4 = 0;
    if (__pyx_t_3 <code><</code> 0) {
      __pyx_t_3 += __pyx_pybuffernd_coord_1.diminfo[1].shape;
      if (unlikely(__pyx_t_3 <code><</code> 0)) __pyx_t_4 = 1;
    } else if (unlikely(__pyx_t_3 >= __pyx_pybuffernd_coord_1.diminfo[1].shape)) __pyx_t_4 = 1;
    if (unlikely(__pyx_t_4 != -1)) {
      <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_4);
     <span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 110; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    }
    __pyx_t_4 = __pyx_v_i;
    __pyx_t_5 = 0;
    __pyx_t_6 = -1;
    if (__pyx_t_4 <code><</code> 0) {
      __pyx_t_4 += __pyx_pybuffernd_coord_2.diminfo[0].shape;
      if (unlikely(__pyx_t_4 <code><</code> 0)) __pyx_t_6 = 0;
    } else if (unlikely(__pyx_t_4 >= __pyx_pybuffernd_coord_2.diminfo[0].shape)) __pyx_t_6 = 0;
    if (__pyx_t_5 <code><</code> 0) {
      __pyx_t_5 += __pyx_pybuffernd_coord_2.diminfo[1].shape;
      if (unlikely(__pyx_t_5 <code><</code> 0)) __pyx_t_6 = 1;
    } else if (unlikely(__pyx_t_5 >= __pyx_pybuffernd_coord_2.diminfo[1].shape)) __pyx_t_6 = 1;
    if (unlikely(__pyx_t_6 != -1)) {
      <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_6);
     <span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 110; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    }
    __pyx_v_diff_x = ((*__Pyx_BufPtrStrided2d(__pyx_t_8epitopsy_6cython_10pdb_cython_DTYPE_float_t *, __pyx_pybuffernd_coord_1.rcbuffer->pybuffer.buf, __pyx_t_2, __pyx_pybuffernd_coord_1.diminfo[0].strides, __pyx_t_3, __pyx_pybuffernd_coord_1.diminfo[1].strides)) - (*__Pyx_BufPtrStrided2d(__pyx_t_8epitopsy_6cython_10pdb_cython_DTYPE_float_t *, __pyx_pybuffernd_coord_2.rcbuffer->pybuffer.buf, __pyx_t_4, __pyx_pybuffernd_coord_2.diminfo[0].strides, __pyx_t_5, __pyx_pybuffernd_coord_2.diminfo[1].strides)));
</pre><pre class='line' style='background-color: #FFFFb6' onclick='toggleDiv("line111")'> 111:         diff_y = coord_1[i,1] - coord_2[i,1]</pre>
<pre id='line111' class='code' style='background-color: #FFFFb6'>
    /* "epitopsy/cython/pdb_cython.pyx":111
 *     for i from 0 <code><</code>= i <code><</code> xdim:
 *         diff_x = coord_1[i,0] - coord_2[i,0]
 *         diff_y = coord_1[i,1] - coord_2[i,1]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         diff_z = coord_1[i,2] - coord_2[i,2]
 *         rmsd = rmsd + (diff_x * diff_x + diff_y * diff_y + diff_z * diff_z)
 */
    __pyx_t_6 = __pyx_v_i;
    __pyx_t_7 = 1;
    __pyx_t_8 = -1;
    if (__pyx_t_6 <code><</code> 0) {
      __pyx_t_6 += __pyx_pybuffernd_coord_1.diminfo[0].shape;
      if (unlikely(__pyx_t_6 <code><</code> 0)) __pyx_t_8 = 0;
    } else if (unlikely(__pyx_t_6 >= __pyx_pybuffernd_coord_1.diminfo[0].shape)) __pyx_t_8 = 0;
    if (__pyx_t_7 <code><</code> 0) {
      __pyx_t_7 += __pyx_pybuffernd_coord_1.diminfo[1].shape;
      if (unlikely(__pyx_t_7 <code><</code> 0)) __pyx_t_8 = 1;
    } else if (unlikely(__pyx_t_7 >= __pyx_pybuffernd_coord_1.diminfo[1].shape)) __pyx_t_8 = 1;
    if (unlikely(__pyx_t_8 != -1)) {
      <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_8);
     <span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 111; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    }
    __pyx_t_8 = __pyx_v_i;
    __pyx_t_9 = 1;
    __pyx_t_10 = -1;
    if (__pyx_t_8 <code><</code> 0) {
      __pyx_t_8 += __pyx_pybuffernd_coord_2.diminfo[0].shape;
      if (unlikely(__pyx_t_8 <code><</code> 0)) __pyx_t_10 = 0;
    } else if (unlikely(__pyx_t_8 >= __pyx_pybuffernd_coord_2.diminfo[0].shape)) __pyx_t_10 = 0;
    if (__pyx_t_9 <code><</code> 0) {
      __pyx_t_9 += __pyx_pybuffernd_coord_2.diminfo[1].shape;
      if (unlikely(__pyx_t_9 <code><</code> 0)) __pyx_t_10 = 1;
    } else if (unlikely(__pyx_t_9 >= __pyx_pybuffernd_coord_2.diminfo[1].shape)) __pyx_t_10 = 1;
    if (unlikely(__pyx_t_10 != -1)) {
      <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_10);
     <span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 111; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    }
    __pyx_v_diff_y = ((*__Pyx_BufPtrStrided2d(__pyx_t_8epitopsy_6cython_10pdb_cython_DTYPE_float_t *, __pyx_pybuffernd_coord_1.rcbuffer->pybuffer.buf, __pyx_t_6, __pyx_pybuffernd_coord_1.diminfo[0].strides, __pyx_t_7, __pyx_pybuffernd_coord_1.diminfo[1].strides)) - (*__Pyx_BufPtrStrided2d(__pyx_t_8epitopsy_6cython_10pdb_cython_DTYPE_float_t *, __pyx_pybuffernd_coord_2.rcbuffer->pybuffer.buf, __pyx_t_8, __pyx_pybuffernd_coord_2.diminfo[0].strides, __pyx_t_9, __pyx_pybuffernd_coord_2.diminfo[1].strides)));
</pre><pre class='line' style='background-color: #FFFFb6' onclick='toggleDiv("line112")'> 112:         diff_z = coord_1[i,2] - coord_2[i,2]</pre>
<pre id='line112' class='code' style='background-color: #FFFFb6'>
    /* "epitopsy/cython/pdb_cython.pyx":112
 *         diff_x = coord_1[i,0] - coord_2[i,0]
 *         diff_y = coord_1[i,1] - coord_2[i,1]
 *         diff_z = coord_1[i,2] - coord_2[i,2]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         rmsd = rmsd + (diff_x * diff_x + diff_y * diff_y + diff_z * diff_z)
 * 
 */
    __pyx_t_10 = __pyx_v_i;
    __pyx_t_11 = 2;
    __pyx_t_12 = -1;
    if (__pyx_t_10 <code><</code> 0) {
      __pyx_t_10 += __pyx_pybuffernd_coord_1.diminfo[0].shape;
      if (unlikely(__pyx_t_10 <code><</code> 0)) __pyx_t_12 = 0;
    } else if (unlikely(__pyx_t_10 >= __pyx_pybuffernd_coord_1.diminfo[0].shape)) __pyx_t_12 = 0;
    if (__pyx_t_11 <code><</code> 0) {
      __pyx_t_11 += __pyx_pybuffernd_coord_1.diminfo[1].shape;
      if (unlikely(__pyx_t_11 <code><</code> 0)) __pyx_t_12 = 1;
    } else if (unlikely(__pyx_t_11 >= __pyx_pybuffernd_coord_1.diminfo[1].shape)) __pyx_t_12 = 1;
    if (unlikely(__pyx_t_12 != -1)) {
      <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_12);
     <span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 112; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    }
    __pyx_t_12 = __pyx_v_i;
    __pyx_t_13 = 2;
    __pyx_t_14 = -1;
    if (__pyx_t_12 <code><</code> 0) {
      __pyx_t_12 += __pyx_pybuffernd_coord_2.diminfo[0].shape;
      if (unlikely(__pyx_t_12 <code><</code> 0)) __pyx_t_14 = 0;
    } else if (unlikely(__pyx_t_12 >= __pyx_pybuffernd_coord_2.diminfo[0].shape)) __pyx_t_14 = 0;
    if (__pyx_t_13 <code><</code> 0) {
      __pyx_t_13 += __pyx_pybuffernd_coord_2.diminfo[1].shape;
      if (unlikely(__pyx_t_13 <code><</code> 0)) __pyx_t_14 = 1;
    } else if (unlikely(__pyx_t_13 >= __pyx_pybuffernd_coord_2.diminfo[1].shape)) __pyx_t_14 = 1;
    if (unlikely(__pyx_t_14 != -1)) {
      <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_14);
     <span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 112; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    }
    __pyx_v_diff_z = ((*__Pyx_BufPtrStrided2d(__pyx_t_8epitopsy_6cython_10pdb_cython_DTYPE_float_t *, __pyx_pybuffernd_coord_1.rcbuffer->pybuffer.buf, __pyx_t_10, __pyx_pybuffernd_coord_1.diminfo[0].strides, __pyx_t_11, __pyx_pybuffernd_coord_1.diminfo[1].strides)) - (*__Pyx_BufPtrStrided2d(__pyx_t_8epitopsy_6cython_10pdb_cython_DTYPE_float_t *, __pyx_pybuffernd_coord_2.rcbuffer->pybuffer.buf, __pyx_t_12, __pyx_pybuffernd_coord_2.diminfo[0].strides, __pyx_t_13, __pyx_pybuffernd_coord_2.diminfo[1].strides)));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line113")'> 113:         rmsd = rmsd + (diff_x * diff_x + diff_y * diff_y + diff_z * diff_z)</pre>
<pre id='line113' class='code' style='background-color: #FFFFff'>
    /* "epitopsy/cython/pdb_cython.pyx":113
 *         diff_y = coord_1[i,1] - coord_2[i,1]
 *         diff_z = coord_1[i,2] - coord_2[i,2]
 *         rmsd = rmsd + (diff_x * diff_x + diff_y * diff_y + diff_z * diff_z)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     rmsd = sqrt(rmsd / n)
 */
    __pyx_v_rmsd = (__pyx_v_rmsd + (((__pyx_v_diff_x * __pyx_v_diff_x) + (__pyx_v_diff_y * __pyx_v_diff_y)) + (__pyx_v_diff_z * __pyx_v_diff_z)));
  }
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line114")'> 114: </pre>
<pre id='line114' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFaa' onclick='toggleDiv("line115")'> 115:     rmsd = sqrt(rmsd / n)</pre>
<pre id='line115' class='code' style='background-color: #FFFFaa'>
  /* "epitopsy/cython/pdb_cython.pyx":115
 *         rmsd = rmsd + (diff_x * diff_x + diff_y * diff_y + diff_z * diff_z)
 * 
 *     rmsd = sqrt(rmsd / n)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     return rmsd
 * 
 */
  if (unlikely(__pyx_v_n == 0)) {
    #ifdef WITH_THREAD
    PyGILState_STATE __pyx_gilstate_save = PyGILState_Ensure();
    #endif
    <span class='py_c_api'>PyErr_Format</span>(PyExc_ZeroDivisionError, "float division");
    #ifdef WITH_THREAD
    PyGILState_Release(__pyx_gilstate_save);
    #endif
   <span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 115; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  }
  __pyx_v_rmsd = sqrt((__pyx_v_rmsd / __pyx_v_n));
</pre><pre class='line' style='background-color: #FFFF28' onclick='toggleDiv("line116")'> 116:     return rmsd</pre>
<pre id='line116' class='code' style='background-color: #FFFF28'>
  /* "epitopsy/cython/pdb_cython.pyx":116
 * 
 *     rmsd = sqrt(rmsd / n)
 *     return rmsd             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * 
 */
  __pyx_r = __pyx_v_rmsd;
  goto __pyx_L0;

  __pyx_r = 0;
  goto __pyx_L0;
  __pyx_L1_error:;
  { PyObject *__pyx_type, *__pyx_value, *__pyx_tb;
    <span class='pyx_c_api'>__Pyx_ErrFetch</span>(&__pyx_type, &__pyx_value, &__pyx_tb);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&__pyx_pybuffernd_coord_1.rcbuffer->pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&__pyx_pybuffernd_coord_2.rcbuffer->pybuffer);
  <span class='pyx_c_api'>__Pyx_ErrRestore</span>(__pyx_type, __pyx_value, __pyx_tb);}
  <span class='pyx_c_api'>__Pyx_WriteUnraisable</span>("epitopsy.cython.pdb_cython.calculate_rmsd", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = 0;
  goto __pyx_L2;
  __pyx_L0:;
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&__pyx_pybuffernd_coord_1.rcbuffer->pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&__pyx_pybuffernd_coord_2.rcbuffer->pybuffer);
  __pyx_L2:;
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_8epitopsy_6cython_10pdb_cython_5get_rmsd(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyMethodDef __pyx_mdef_8epitopsy_6cython_10pdb_cython_5get_rmsd = {<span class='pyx_macro_api'>__Pyx_NAMESTR</span>("get_rmsd"), (PyCFunction)__pyx_pw_8epitopsy_6cython_10pdb_cython_5get_rmsd, METH_VARARGS|METH_KEYWORDS, <span class='pyx_macro_api'>__Pyx_DOCSTR</span>(0)};
static PyObject *__pyx_pw_8epitopsy_6cython_10pdb_cython_5get_rmsd(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyArrayObject *__pyx_v_reference_coords = 0;
  PyArrayObject *__pyx_v_coords = 0;
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("get_rmsd (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__reference_coords,&__pyx_n_s__coords,0};
    PyObject* values[2] = {0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
      switch (pos_args) {
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__reference_coords)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        case  1:
        if (likely((values[1] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__coords)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("get_rmsd", 1, 2, 2, 1);<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 120; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "get_rmsd") <code><</code> 0))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 120; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
      }
    } else if (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args) != 2) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
      values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
    }
    __pyx_v_reference_coords = ((PyArrayObject *)values[0]);
    __pyx_v_coords = ((PyArrayObject *)values[1]);
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("get_rmsd", 1, 2, 2, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args));<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 120; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("epitopsy.cython.pdb_cython.get_rmsd", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_reference_coords), __pyx_ptype_5numpy_ndarray, 1, "reference_coords", 0)))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 120; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_coords), __pyx_ptype_5numpy_ndarray, 1, "coords", 0)))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 121; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_r = __pyx_pf_8epitopsy_6cython_10pdb_cython_4get_rmsd(__pyx_self, __pyx_v_reference_coords, __pyx_v_coords);
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  goto __pyx_L0;
  __pyx_L1_error:;
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line117")'> 117: </pre>
<pre id='line117' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line118")'> 118: </pre>
<pre id='line118' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line119")'> 119: </pre>
<pre id='line119' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF55' onclick='toggleDiv("line120")'> 120: def get_rmsd(np.ndarray[DTYPE_float_t, ndim=2] reference_coords,</pre>
<pre id='line120' class='code' style='background-color: #FFFF55'>
/* "epitopsy/cython/pdb_cython.pyx":120
 * 
 * 
 * def get_rmsd(np.ndarray[DTYPE_float_t, ndim=2] reference_coords,             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *              np.ndarray[DTYPE_float_t, ndim=2] coords):
 *     cdef float rmsd
 */

static PyObject *__pyx_pf_8epitopsy_6cython_10pdb_cython_4get_rmsd(CYTHON_UNUSED PyObject *__pyx_self, PyArrayObject *__pyx_v_reference_coords, PyArrayObject *__pyx_v_coords) {
  float __pyx_v_rmsd;
  PyObject *__pyx_v_av_1 = NULL;
  PyObject *__pyx_v_av_2 = NULL;
  PyObject *__pyx_v_coords_n = NULL;
  PyObject *__pyx_v_reference_coords_n = NULL;
  PyObject *__pyx_v_a = NULL;
  PyObject *__pyx_v_u = NULL;
  CYTHON_UNUSED PyObject *__pyx_v_d = NULL;
  PyObject *__pyx_v_vt = NULL;
  PyObject *__pyx_v_rot = NULL;
  PyObject *__pyx_v_tran = NULL;
  PyObject *__pyx_v_new_coord = NULL;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_coords;
  __Pyx_Buffer __pyx_pybuffer_coords;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_reference_coords;
  __Pyx_Buffer __pyx_pybuffer_reference_coords;
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("get_rmsd", 0);
  __pyx_pybuffer_reference_coords.pybuffer.buf = NULL;
  __pyx_pybuffer_reference_coords.refcount = 0;
  __pyx_pybuffernd_reference_coords.data = NULL;
  __pyx_pybuffernd_reference_coords.rcbuffer = &__pyx_pybuffer_reference_coords;
  __pyx_pybuffer_coords.pybuffer.buf = NULL;
  __pyx_pybuffer_coords.refcount = 0;
  __pyx_pybuffernd_coords.data = NULL;
  __pyx_pybuffernd_coords.rcbuffer = &__pyx_pybuffer_coords;
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&__pyx_pybuffernd_reference_coords.rcbuffer->pybuffer, (PyObject*)__pyx_v_reference_coords, &__Pyx_TypeInfo_nn___pyx_t_8epitopsy_6cython_10pdb_cython_DTYPE_float_t, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack) == -1))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 120; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  }
  __pyx_pybuffernd_reference_coords.diminfo[0].strides = __pyx_pybuffernd_reference_coords.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_reference_coords.diminfo[0].shape = __pyx_pybuffernd_reference_coords.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_reference_coords.diminfo[1].strides = __pyx_pybuffernd_reference_coords.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_reference_coords.diminfo[1].shape = __pyx_pybuffernd_reference_coords.rcbuffer->pybuffer.shape[1];
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&__pyx_pybuffernd_coords.rcbuffer->pybuffer, (PyObject*)__pyx_v_coords, &__Pyx_TypeInfo_nn___pyx_t_8epitopsy_6cython_10pdb_cython_DTYPE_float_t, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack) == -1))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 120; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  }
  __pyx_pybuffernd_coords.diminfo[0].strides = __pyx_pybuffernd_coords.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_coords.diminfo[0].shape = __pyx_pybuffernd_coords.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_coords.diminfo[1].strides = __pyx_pybuffernd_coords.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_coords.diminfo[1].shape = __pyx_pybuffernd_coords.rcbuffer->pybuffer.shape[1];

  /* "epitopsy/cython/pdb_cython.pyx":120
 * 
 * 
 * def get_rmsd(np.ndarray[DTYPE_float_t, ndim=2] reference_coords,             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *              np.ndarray[DTYPE_float_t, ndim=2] coords):
 *     cdef float rmsd
 */
  __pyx_k_tuple_54 = <span class='py_c_api'>PyTuple_Pack</span>(14, ((PyObject *)__pyx_n_s__reference_coords), ((PyObject *)__pyx_n_s__coords), ((PyObject *)__pyx_n_s__rmsd), ((PyObject *)__pyx_n_s__av_1), ((PyObject *)__pyx_n_s__av_2), ((PyObject *)__pyx_n_s__coords_n), ((PyObject *)__pyx_n_s__reference_coords_n), ((PyObject *)__pyx_n_s__a), ((PyObject *)__pyx_n_s__u), ((PyObject *)__pyx_n_s__d), ((PyObject *)__pyx_n_s__vt), ((PyObject *)__pyx_n_s__rot), ((PyObject *)__pyx_n_s__tran), ((PyObject *)__pyx_n_s__new_coord));<span class='error_goto'> if (unlikely(!__pyx_k_tuple_54)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 120; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_k_tuple_54);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_k_tuple_54));

  /* "epitopsy/cython/pdb_cython.pyx":120
 * 
 * 
 * def get_rmsd(np.ndarray[DTYPE_float_t, ndim=2] reference_coords,             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *              np.ndarray[DTYPE_float_t, ndim=2] coords):
 *     cdef float rmsd
 */
  __pyx_t_2 = PyCFunction_NewEx(&__pyx_mdef_8epitopsy_6cython_10pdb_cython_5get_rmsd, NULL, __pyx_n_s_51);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 120; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s__get_rmsd, __pyx_t_2) <code><</code> 0)<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 120; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_k_codeobj_55 = (PyObject*)__Pyx_<span class='py_c_api'>PyCode_New</span>(2, 0, 14, 0, 0, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_k_tuple_54, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_50, __pyx_n_s__get_rmsd, 120, __pyx_empty_bytes);<span class='error_goto'> if (unlikely(!__pyx_k_codeobj_55)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 120; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line121")'> 121:              np.ndarray[DTYPE_float_t, ndim=2] coords):</pre>
<pre id='line121' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line122")'> 122:     cdef float rmsd</pre>
<pre id='line122' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line123")'> 123:     # center on centroid</pre>
<pre id='line123' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF3b' onclick='toggleDiv("line124")'> 124:     av_1 = np.sum(coords,0)/coords.shape[0]</pre>
<pre id='line124' class='code' style='background-color: #FFFF3b'>
  /* "epitopsy/cython/pdb_cython.pyx":124
 *     cdef float rmsd
 *     # center on centroid
 *     av_1 = np.sum(coords,0)/coords.shape[0]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     av_2 = np.sum(reference_coords,0)/reference_coords.shape[0]
 *     coords_n = coords- av_1
 */
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s__np);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 124; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  __pyx_t_2 = __Pyx_<span class='py_c_api'>PyObject_GetAttrStr</span>(__pyx_t_1, __pyx_n_s__sum);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 124; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = <span class='py_c_api'>PyTuple_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 124; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_v_coords));
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 0, ((PyObject *)__pyx_v_coords));
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_v_coords));
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_int_0);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 1, __pyx_int_0);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_int_0);
  __pyx_t_3 = <span class='py_c_api'>PyObject_Call</span>(__pyx_t_2, ((PyObject *)__pyx_t_1), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 124; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyInt_to_py_Py_intptr_t</span>((__pyx_v_coords->dimensions[0]));<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 124; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  __pyx_t_2 = __Pyx_<span class='py_c_api'>PyNumber_Divide</span>(__pyx_t_3, __pyx_t_1);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 124; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_v_av_1 = __pyx_t_2;
  __pyx_t_2 = 0;
</pre><pre class='line' style='background-color: #FFFF3b' onclick='toggleDiv("line125")'> 125:     av_2 = np.sum(reference_coords,0)/reference_coords.shape[0]</pre>
<pre id='line125' class='code' style='background-color: #FFFF3b'>
  /* "epitopsy/cython/pdb_cython.pyx":125
 *     # center on centroid
 *     av_1 = np.sum(coords,0)/coords.shape[0]
 *     av_2 = np.sum(reference_coords,0)/reference_coords.shape[0]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     coords_n = coords- av_1
 *     reference_coords_n = reference_coords - av_2
 */
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s__np);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 125; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  __pyx_t_1 = __Pyx_<span class='py_c_api'>PyObject_GetAttrStr</span>(__pyx_t_2, __pyx_n_s__sum);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 125; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = <span class='py_c_api'>PyTuple_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 125; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_v_reference_coords));
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_2, 0, ((PyObject *)__pyx_v_reference_coords));
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_v_reference_coords));
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_int_0);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_2, 1, __pyx_int_0);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_int_0);
  __pyx_t_3 = <span class='py_c_api'>PyObject_Call</span>(__pyx_t_1, ((PyObject *)__pyx_t_2), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 125; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_2)); __pyx_t_2 = 0;
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyInt_to_py_Py_intptr_t</span>((__pyx_v_reference_coords->dimensions[0]));<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 125; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  __pyx_t_1 = __Pyx_<span class='py_c_api'>PyNumber_Divide</span>(__pyx_t_3, __pyx_t_2);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 125; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_v_av_2 = __pyx_t_1;
  __pyx_t_1 = 0;
</pre><pre class='line' style='background-color: #FFFFaa' onclick='toggleDiv("line126")'> 126:     coords_n = coords- av_1</pre>
<pre id='line126' class='code' style='background-color: #FFFFaa'>
  /* "epitopsy/cython/pdb_cython.pyx":126
 *     av_1 = np.sum(coords,0)/coords.shape[0]
 *     av_2 = np.sum(reference_coords,0)/reference_coords.shape[0]
 *     coords_n = coords- av_1             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     reference_coords_n = reference_coords - av_2
 *     # correlation matrix
 */
  __pyx_t_1 = <span class='py_c_api'>PyNumber_Subtract</span>(((PyObject *)__pyx_v_coords), __pyx_v_av_1);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 126; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  __pyx_v_coords_n = __pyx_t_1;
  __pyx_t_1 = 0;
</pre><pre class='line' style='background-color: #FFFFaa' onclick='toggleDiv("line127")'> 127:     reference_coords_n = reference_coords - av_2</pre>
<pre id='line127' class='code' style='background-color: #FFFFaa'>
  /* "epitopsy/cython/pdb_cython.pyx":127
 *     av_2 = np.sum(reference_coords,0)/reference_coords.shape[0]
 *     coords_n = coords- av_1
 *     reference_coords_n = reference_coords - av_2             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     # correlation matrix
 *     a = np.dot(np.transpose(coords_n), reference_coords_n)
 */
  __pyx_t_1 = <span class='py_c_api'>PyNumber_Subtract</span>(((PyObject *)__pyx_v_reference_coords), __pyx_v_av_2);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 127; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  __pyx_v_reference_coords_n = __pyx_t_1;
  __pyx_t_1 = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line128")'> 128:     # correlation matrix</pre>
<pre id='line128' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF2e' onclick='toggleDiv("line129")'> 129:     a = np.dot(np.transpose(coords_n), reference_coords_n)</pre>
<pre id='line129' class='code' style='background-color: #FFFF2e'>
  /* "epitopsy/cython/pdb_cython.pyx":129
 *     reference_coords_n = reference_coords - av_2
 *     # correlation matrix
 *     a = np.dot(np.transpose(coords_n), reference_coords_n)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     u, d, vt = np.linalg.svd(a)
 *     rot = np.transpose(np.dot(np.transpose(vt),np.transpose(u)))
 */
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s__np);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 129; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  __pyx_t_2 = __Pyx_<span class='py_c_api'>PyObject_GetAttrStr</span>(__pyx_t_1, __pyx_n_s__dot);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 129; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s__np);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 129; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  __pyx_t_3 = __Pyx_<span class='py_c_api'>PyObject_GetAttrStr</span>(__pyx_t_1, __pyx_n_s__transpose);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 129; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 129; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_coords_n);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 0, __pyx_v_coords_n);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_v_coords_n);
  __pyx_t_4 = <span class='py_c_api'>PyObject_Call</span>(__pyx_t_3, ((PyObject *)__pyx_t_1), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 129; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;
  __pyx_t_1 = <span class='py_c_api'>PyTuple_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 129; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 0, __pyx_t_4);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_reference_coords_n);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 1, __pyx_v_reference_coords_n);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_v_reference_coords_n);
  __pyx_t_4 = 0;
  __pyx_t_4 = <span class='py_c_api'>PyObject_Call</span>(__pyx_t_2, ((PyObject *)__pyx_t_1), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 129; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;
  __pyx_v_a = __pyx_t_4;
  __pyx_t_4 = 0;
</pre><pre class='line' style='background-color: #FFFF1c' onclick='toggleDiv("line130")'> 130:     u, d, vt = np.linalg.svd(a)</pre>
<pre id='line130' class='code' style='background-color: #FFFF1c'>
  /* "epitopsy/cython/pdb_cython.pyx":130
 *     # correlation matrix
 *     a = np.dot(np.transpose(coords_n), reference_coords_n)
 *     u, d, vt = np.linalg.svd(a)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     rot = np.transpose(np.dot(np.transpose(vt),np.transpose(u)))
 *     # check if we have found a reflection
 */
  __pyx_t_4 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s__np);<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 130; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_4);
  __pyx_t_1 = __Pyx_<span class='py_c_api'>PyObject_GetAttrStr</span>(__pyx_t_4, __pyx_n_s__linalg);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 130; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_t_4 = __Pyx_<span class='py_c_api'>PyObject_GetAttrStr</span>(__pyx_t_1, __pyx_n_s__svd);<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 130; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 130; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_a);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 0, __pyx_v_a);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_v_a);
  __pyx_t_2 = <span class='py_c_api'>PyObject_Call</span>(__pyx_t_4, ((PyObject *)__pyx_t_1), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 130; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;
  if ((likely(<span class='py_c_api'>PyTuple_CheckExact</span>(__pyx_t_2))) || (<span class='py_c_api'>PyList_CheckExact</span>(__pyx_t_2))) {
    PyObject* sequence = __pyx_t_2;
    #if CYTHON_COMPILING_IN_CPYTHON
    Py_ssize_t size = Py_SIZE(sequence);
    #else
    Py_ssize_t size = <span class='py_c_api'>PySequence_Size</span>(sequence);
    #endif
    if (unlikely(size != 3)) {
      if (size > 3) <span class='pyx_c_api'>__Pyx_RaiseTooManyValuesError</span>(3);
      else if (size >= 0) <span class='pyx_c_api'>__Pyx_RaiseNeedMoreValuesError</span>(size);
     <span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 130; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    }
    #if CYTHON_COMPILING_IN_CPYTHON
    if (likely(<span class='py_c_api'>PyTuple_CheckExact</span>(sequence))) {
      __pyx_t_1 = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(sequence, 0); 
      __pyx_t_4 = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(sequence, 1); 
      __pyx_t_3 = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(sequence, 2); 
    } else {
      __pyx_t_1 = <span class='py_macro_api'>PyList_GET_ITEM</span>(sequence, 0); 
      __pyx_t_4 = <span class='py_macro_api'>PyList_GET_ITEM</span>(sequence, 1); 
      __pyx_t_3 = <span class='py_macro_api'>PyList_GET_ITEM</span>(sequence, 2); 
    }
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_1);
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_4);
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_3);
    #else
    __pyx_t_1 = <span class='py_macro_api'>PySequence_ITEM</span>(sequence, 0);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 130; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
    __pyx_t_4 = <span class='py_macro_api'>PySequence_ITEM</span>(sequence, 1);<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 130; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_4);
    __pyx_t_3 = <span class='py_macro_api'>PySequence_ITEM</span>(sequence, 2);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 130; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
    #endif
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  } else
  {
    Py_ssize_t index = -1;
    __pyx_t_5 = <span class='py_c_api'>PyObject_GetIter</span>(__pyx_t_2);<span class='error_goto'> if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 130; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_5);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_t_6 = Py_TYPE(__pyx_t_5)->tp_iternext;
    index = 0; __pyx_t_1 = __pyx_t_6(__pyx_t_5); if (unlikely(!__pyx_t_1)) goto __pyx_L3_unpacking_failed;
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
    index = 1; __pyx_t_4 = __pyx_t_6(__pyx_t_5); if (unlikely(!__pyx_t_4)) goto __pyx_L3_unpacking_failed;
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_4);
    index = 2; __pyx_t_3 = __pyx_t_6(__pyx_t_5); if (unlikely(!__pyx_t_3)) goto __pyx_L3_unpacking_failed;
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
    if (<span class='pyx_c_api'>__Pyx_IternextUnpackEndCheck</span>(__pyx_t_6(__pyx_t_5), 3) <code><</code> 0)<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 130; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    __pyx_t_6 = NULL;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
    goto __pyx_L4_unpacking_done;
    __pyx_L3_unpacking_failed:;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
    __pyx_t_6 = NULL;
    if (<span class='pyx_c_api'>__Pyx_IterFinish</span>() == 0) <span class='pyx_c_api'>__Pyx_RaiseNeedMoreValuesError</span>(index);
   <span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 130; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    __pyx_L4_unpacking_done:;
  }
  __pyx_v_u = __pyx_t_1;
  __pyx_t_1 = 0;
  __pyx_v_d = __pyx_t_4;
  __pyx_t_4 = 0;
  __pyx_v_vt = __pyx_t_3;
  __pyx_t_3 = 0;
</pre><pre class='line' style='background-color: #FFFF1a' onclick='toggleDiv("line131")'> 131:     rot = np.transpose(np.dot(np.transpose(vt),np.transpose(u)))</pre>
<pre id='line131' class='code' style='background-color: #FFFF1a'>
  /* "epitopsy/cython/pdb_cython.pyx":131
 *     a = np.dot(np.transpose(coords_n), reference_coords_n)
 *     u, d, vt = np.linalg.svd(a)
 *     rot = np.transpose(np.dot(np.transpose(vt),np.transpose(u)))             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     # check if we have found a reflection
 *     if np.linalg.det(rot)<code><</code>0:
 */
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s__np);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 131; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  __pyx_t_3 = __Pyx_<span class='py_c_api'>PyObject_GetAttrStr</span>(__pyx_t_2, __pyx_n_s__transpose);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 131; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s__np);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 131; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  __pyx_t_4 = __Pyx_<span class='py_c_api'>PyObject_GetAttrStr</span>(__pyx_t_2, __pyx_n_s__dot);<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 131; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s__np);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 131; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  __pyx_t_1 = __Pyx_<span class='py_c_api'>PyObject_GetAttrStr</span>(__pyx_t_2, __pyx_n_s__transpose);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 131; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 131; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_vt);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_2, 0, __pyx_v_vt);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_v_vt);
  __pyx_t_5 = <span class='py_c_api'>PyObject_Call</span>(__pyx_t_1, ((PyObject *)__pyx_t_2), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 131; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_5);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_2)); __pyx_t_2 = 0;
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s__np);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 131; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  __pyx_t_1 = __Pyx_<span class='py_c_api'>PyObject_GetAttrStr</span>(__pyx_t_2, __pyx_n_s__transpose);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 131; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 131; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_u);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_2, 0, __pyx_v_u);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_v_u);
  __pyx_t_7 = <span class='py_c_api'>PyObject_Call</span>(__pyx_t_1, ((PyObject *)__pyx_t_2), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 131; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_7);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_2)); __pyx_t_2 = 0;
  __pyx_t_2 = <span class='py_c_api'>PyTuple_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 131; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_2, 0, __pyx_t_5);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_t_5);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_2, 1, __pyx_t_7);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_t_7);
  __pyx_t_5 = 0;
  __pyx_t_7 = 0;
  __pyx_t_7 = <span class='py_c_api'>PyObject_Call</span>(__pyx_t_4, ((PyObject *)__pyx_t_2), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 131; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_7);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_2)); __pyx_t_2 = 0;
  __pyx_t_2 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 131; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_2, 0, __pyx_t_7);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_t_7);
  __pyx_t_7 = 0;
  __pyx_t_7 = <span class='py_c_api'>PyObject_Call</span>(__pyx_t_3, ((PyObject *)__pyx_t_2), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 131; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_7);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_2)); __pyx_t_2 = 0;
  __pyx_v_rot = __pyx_t_7;
  __pyx_t_7 = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line132")'> 132:     # check if we have found a reflection</pre>
<pre id='line132' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF33' onclick='toggleDiv("line133")'> 133:     if np.linalg.det(rot)&lt;0:</pre>
<pre id='line133' class='code' style='background-color: #FFFF33'>
  /* "epitopsy/cython/pdb_cython.pyx":133
 *     rot = np.transpose(np.dot(np.transpose(vt),np.transpose(u)))
 *     # check if we have found a reflection
 *     if np.linalg.det(rot)<code><</code>0:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         vt[2]=-vt[2]
 *         rot=np.transpose(np.dot(np.transpose(vt), np.transpose(u)))
 */
  __pyx_t_7 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s__np);<span class='error_goto'> if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 133; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_7);
  __pyx_t_2 = __Pyx_<span class='py_c_api'>PyObject_GetAttrStr</span>(__pyx_t_7, __pyx_n_s__linalg);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 133; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
  __pyx_t_7 = __Pyx_<span class='py_c_api'>PyObject_GetAttrStr</span>(__pyx_t_2, __pyx_n_s__det);<span class='error_goto'> if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 133; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_7);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 133; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_rot);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_2, 0, __pyx_v_rot);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_v_rot);
  __pyx_t_3 = <span class='py_c_api'>PyObject_Call</span>(__pyx_t_7, ((PyObject *)__pyx_t_2), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 133; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_2)); __pyx_t_2 = 0;
  __pyx_t_2 = <span class='py_c_api'>PyObject_RichCompare</span>(__pyx_t_3, __pyx_int_0, Py_LT); <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGOTREF</span></span>(__pyx_t_2);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 133; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_8 = __Pyx_<span class='py_c_api'>PyObject_IsTrue</span>(__pyx_t_2);<span class='error_goto'> if (unlikely(__pyx_t_8 <code><</code> 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 133; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  if (__pyx_t_8) {
</pre><pre class='line' style='background-color: #FFFF79' onclick='toggleDiv("line134")'> 134:         vt[2]=-vt[2]</pre>
<pre id='line134' class='code' style='background-color: #FFFF79'>
    /* "epitopsy/cython/pdb_cython.pyx":134
 *     # check if we have found a reflection
 *     if np.linalg.det(rot)<code><</code>0:
 *         vt[2]=-vt[2]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         rot=np.transpose(np.dot(np.transpose(vt), np.transpose(u)))
 *     tran=av_2-np.dot(av_1, rot)
 */
    __pyx_t_2 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(__pyx_v_vt, 2, sizeof(long), PyInt_FromLong, 0, 0, 1);<span class='error_goto'> if (!__pyx_t_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 134; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
    __pyx_t_3 = <span class='py_c_api'>PyNumber_Negative</span>(__pyx_t_2);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 134; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
    if (<span class='pyx_c_api'>__Pyx_SetItemInt</span>(__pyx_v_vt, 2, __pyx_t_3, sizeof(long), PyInt_FromLong, 0, 0, 1) <code><</code> 0)<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 134; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
</pre><pre class='line' style='background-color: #FFFF1a' onclick='toggleDiv("line135")'> 135:         rot=np.transpose(np.dot(np.transpose(vt), np.transpose(u)))</pre>
<pre id='line135' class='code' style='background-color: #FFFF1a'>
    /* "epitopsy/cython/pdb_cython.pyx":135
 *     if np.linalg.det(rot)<code><</code>0:
 *         vt[2]=-vt[2]
 *         rot=np.transpose(np.dot(np.transpose(vt), np.transpose(u)))             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     tran=av_2-np.dot(av_1, rot)
 *     # transform coord_2
 */
    __pyx_t_3 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s__np);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 135; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
    __pyx_t_2 = __Pyx_<span class='py_c_api'>PyObject_GetAttrStr</span>(__pyx_t_3, __pyx_n_s__transpose);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 135; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
    __pyx_t_3 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s__np);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 135; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
    __pyx_t_7 = __Pyx_<span class='py_c_api'>PyObject_GetAttrStr</span>(__pyx_t_3, __pyx_n_s__dot);<span class='error_goto'> if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 135; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_7);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
    __pyx_t_3 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s__np);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 135; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
    __pyx_t_4 = __Pyx_<span class='py_c_api'>PyObject_GetAttrStr</span>(__pyx_t_3, __pyx_n_s__transpose);<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 135; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_4);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
    __pyx_t_3 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 135; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_vt);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_3, 0, __pyx_v_vt);
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_v_vt);
    __pyx_t_5 = <span class='py_c_api'>PyObject_Call</span>(__pyx_t_4, ((PyObject *)__pyx_t_3), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 135; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_5);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_3)); __pyx_t_3 = 0;
    __pyx_t_3 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s__np);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 135; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
    __pyx_t_4 = __Pyx_<span class='py_c_api'>PyObject_GetAttrStr</span>(__pyx_t_3, __pyx_n_s__transpose);<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 135; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_4);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
    __pyx_t_3 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 135; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_u);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_3, 0, __pyx_v_u);
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_v_u);
    __pyx_t_1 = <span class='py_c_api'>PyObject_Call</span>(__pyx_t_4, ((PyObject *)__pyx_t_3), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 135; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_3)); __pyx_t_3 = 0;
    __pyx_t_3 = <span class='py_c_api'>PyTuple_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 135; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_3, 0, __pyx_t_5);
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_t_5);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_3, 1, __pyx_t_1);
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_t_1);
    __pyx_t_5 = 0;
    __pyx_t_1 = 0;
    __pyx_t_1 = <span class='py_c_api'>PyObject_Call</span>(__pyx_t_7, ((PyObject *)__pyx_t_3), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 135; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_3)); __pyx_t_3 = 0;
    __pyx_t_3 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 135; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_3, 0, __pyx_t_1);
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_t_1);
    __pyx_t_1 = 0;
    __pyx_t_1 = <span class='py_c_api'>PyObject_Call</span>(__pyx_t_2, ((PyObject *)__pyx_t_3), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 135; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_3)); __pyx_t_3 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_v_rot);
    __pyx_v_rot = __pyx_t_1;
    __pyx_t_1 = 0;
    goto __pyx_L5;
  }
  __pyx_L5:;
</pre><pre class='line' style='background-color: #FFFF3f' onclick='toggleDiv("line136")'> 136:     tran=av_2-np.dot(av_1, rot)</pre>
<pre id='line136' class='code' style='background-color: #FFFF3f'>
  /* "epitopsy/cython/pdb_cython.pyx":136
 *         vt[2]=-vt[2]
 *         rot=np.transpose(np.dot(np.transpose(vt), np.transpose(u)))
 *     tran=av_2-np.dot(av_1, rot)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     # transform coord_2
 *     new_coord = np.dot(coords, rot) + tran
 */
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s__np);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 136; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  __pyx_t_3 = __Pyx_<span class='py_c_api'>PyObject_GetAttrStr</span>(__pyx_t_1, __pyx_n_s__dot);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 136; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = <span class='py_c_api'>PyTuple_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 136; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_av_1);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 0, __pyx_v_av_1);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_v_av_1);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_rot);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 1, __pyx_v_rot);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_v_rot);
  __pyx_t_2 = <span class='py_c_api'>PyObject_Call</span>(__pyx_t_3, ((PyObject *)__pyx_t_1), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 136; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;
  __pyx_t_1 = <span class='py_c_api'>PyNumber_Subtract</span>(__pyx_v_av_2, __pyx_t_2);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 136; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_v_tran = __pyx_t_1;
  __pyx_t_1 = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line137")'> 137:     # transform coord_2</pre>
<pre id='line137' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF3f' onclick='toggleDiv("line138")'> 138:     new_coord = np.dot(coords, rot) + tran</pre>
<pre id='line138' class='code' style='background-color: #FFFF3f'>
  /* "epitopsy/cython/pdb_cython.pyx":138
 *     tran=av_2-np.dot(av_1, rot)
 *     # transform coord_2
 *     new_coord = np.dot(coords, rot) + tran             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     rmsd = calculate_rmsd(new_coord, reference_coords)
 *     return {'rmsd' : rmsd, 'rotation' : rot, 'translation' : tran}
 */
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s__np);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 138; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  __pyx_t_2 = __Pyx_<span class='py_c_api'>PyObject_GetAttrStr</span>(__pyx_t_1, __pyx_n_s__dot);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 138; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = <span class='py_c_api'>PyTuple_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 138; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_v_coords));
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 0, ((PyObject *)__pyx_v_coords));
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_v_coords));
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_rot);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 1, __pyx_v_rot);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_v_rot);
  __pyx_t_3 = <span class='py_c_api'>PyObject_Call</span>(__pyx_t_2, ((PyObject *)__pyx_t_1), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 138; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;
  __pyx_t_1 = <span class='py_c_api'>PyNumber_Add</span>(__pyx_t_3, __pyx_v_tran);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 138; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_v_new_coord = __pyx_t_1;
  __pyx_t_1 = 0;
</pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line139")'> 139:     rmsd = calculate_rmsd(new_coord, reference_coords)</pre>
<pre id='line139' class='code' style='background-color: #FFFFd4'>
  /* "epitopsy/cython/pdb_cython.pyx":139
 *     # transform coord_2
 *     new_coord = np.dot(coords, rot) + tran
 *     rmsd = calculate_rmsd(new_coord, reference_coords)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     return {'rmsd' : rmsd, 'rotation' : rot, 'translation' : tran}
 * 
 */
  if (!(likely(((__pyx_v_new_coord) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_v_new_coord, __pyx_ptype_5numpy_ndarray)))))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 139; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_v_rmsd = __pyx_f_8epitopsy_6cython_10pdb_cython_calculate_rmsd(((PyArrayObject *)__pyx_v_new_coord), ((PyArrayObject *)__pyx_v_reference_coords));
</pre><pre class='line' style='background-color: #FFFF24' onclick='toggleDiv("line140")'> 140:     return {'rmsd' : rmsd, 'rotation' : rot, 'translation' : tran}</pre>
<pre id='line140' class='code' style='background-color: #FFFF24'>
  /* "epitopsy/cython/pdb_cython.pyx":140
 *     new_coord = np.dot(coords, rot) + tran
 *     rmsd = calculate_rmsd(new_coord, reference_coords)
 *     return {'rmsd' : rmsd, 'rotation' : rot, 'translation' : tran}             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * cdef np.ndarray calculate_hydrophic_potential(
 */
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
  __pyx_t_1 = <span class='py_c_api'>PyDict_New</span>();<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 140; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(((PyObject *)__pyx_t_1));
  __pyx_t_3 = <span class='py_c_api'>PyFloat_FromDouble</span>(__pyx_v_rmsd);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 140; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_1, ((PyObject *)__pyx_n_s__rmsd), __pyx_t_3) <code><</code> 0)<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 140; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_1, ((PyObject *)__pyx_n_s__rotation), __pyx_v_rot) <code><</code> 0)<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 140; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_1, ((PyObject *)__pyx_n_s__translation), __pyx_v_tran) <code><</code> 0)<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 140; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_r = ((PyObject *)__pyx_t_1);
  __pyx_t_1 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_5);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_7);
  { PyObject *__pyx_type, *__pyx_value, *__pyx_tb;
    <span class='pyx_c_api'>__Pyx_ErrFetch</span>(&__pyx_type, &__pyx_value, &__pyx_tb);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&__pyx_pybuffernd_coords.rcbuffer->pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&__pyx_pybuffernd_reference_coords.rcbuffer->pybuffer);
  <span class='pyx_c_api'>__Pyx_ErrRestore</span>(__pyx_type, __pyx_value, __pyx_tb);}
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("epitopsy.cython.pdb_cython.get_rmsd", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  goto __pyx_L2;
  __pyx_L0:;
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&__pyx_pybuffernd_coords.rcbuffer->pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&__pyx_pybuffernd_reference_coords.rcbuffer->pybuffer);
  __pyx_L2:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_av_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_av_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_coords_n);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_reference_coords_n);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_a);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_u);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_d);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_vt);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_rot);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_tran);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_new_coord);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line141")'> 141: </pre>
<pre id='line141' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF9f' onclick='toggleDiv("line142")'> 142: cdef np.ndarray calculate_hydrophic_potential(</pre>
<pre id='line142' class='code' style='background-color: #FFFF9f'>
/* "epitopsy/cython/pdb_cython.pyx":142
 *     return {'rmsd' : rmsd, 'rotation' : rot, 'translation' : tran}
 * 
 * cdef np.ndarray calculate_hydrophic_potential(             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         np.ndarray[DTYPE_float_t, ndim=3] potential,
 *         np.ndarray[DTYPE_float_t, ndim=2] res_center_list,
 */

static PyArrayObject *__pyx_f_8epitopsy_6cython_10pdb_cython_calculate_hydrophic_potential(PyArrayObject *__pyx_v_potential, PyArrayObject *__pyx_v_res_center_list, PyArrayObject *__pyx_v_res_hydro_list, PyObject *__pyx_v_box_meshsize, PyObject *__pyx_v_box_dim, PyObject *__pyx_v_box_offset) {
  int __pyx_v_xdim;
  int __pyx_v_ydim;
  int __pyx_v_zdim;
  float __pyx_v_local_vec[3];
  float __pyx_v_res_vec[3];
  float __pyx_v_diff_vec[3];
  float __pyx_v_distance;
  int __pyx_v_x;
  int __pyx_v_y;
  int __pyx_v_z;
  int __pyx_v_n;
  int __pyx_v_list_length;
  float __pyx_v_hydro_charge;
  int __pyx_v_vec_length;
  float __pyx_v_meshsize[3];
  float __pyx_v_offset[3];
  int __pyx_v_i;
  int __pyx_v_j;
  int __pyx_v_k;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_potential;
  __Pyx_Buffer __pyx_pybuffer_potential;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_res_center_list;
  __Pyx_Buffer __pyx_pybuffer_res_center_list;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_res_hydro_list;
  __Pyx_Buffer __pyx_pybuffer_res_hydro_list;
  PyArrayObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("calculate_hydrophic_potential", 0);
  __pyx_pybuffer_potential.pybuffer.buf = NULL;
  __pyx_pybuffer_potential.refcount = 0;
  __pyx_pybuffernd_potential.data = NULL;
  __pyx_pybuffernd_potential.rcbuffer = &__pyx_pybuffer_potential;
  __pyx_pybuffer_res_center_list.pybuffer.buf = NULL;
  __pyx_pybuffer_res_center_list.refcount = 0;
  __pyx_pybuffernd_res_center_list.data = NULL;
  __pyx_pybuffernd_res_center_list.rcbuffer = &__pyx_pybuffer_res_center_list;
  __pyx_pybuffer_res_hydro_list.pybuffer.buf = NULL;
  __pyx_pybuffer_res_hydro_list.refcount = 0;
  __pyx_pybuffernd_res_hydro_list.data = NULL;
  __pyx_pybuffernd_res_hydro_list.rcbuffer = &__pyx_pybuffer_res_hydro_list;
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&__pyx_pybuffernd_potential.rcbuffer->pybuffer, (PyObject*)__pyx_v_potential, &__Pyx_TypeInfo_nn___pyx_t_8epitopsy_6cython_10pdb_cython_DTYPE_float_t, PyBUF_FORMAT| PyBUF_STRIDES| PyBUF_WRITABLE, 3, 0, __pyx_stack) == -1))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 142; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  }
  __pyx_pybuffernd_potential.diminfo[0].strides = __pyx_pybuffernd_potential.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_potential.diminfo[0].shape = __pyx_pybuffernd_potential.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_potential.diminfo[1].strides = __pyx_pybuffernd_potential.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_potential.diminfo[1].shape = __pyx_pybuffernd_potential.rcbuffer->pybuffer.shape[1]; __pyx_pybuffernd_potential.diminfo[2].strides = __pyx_pybuffernd_potential.rcbuffer->pybuffer.strides[2]; __pyx_pybuffernd_potential.diminfo[2].shape = __pyx_pybuffernd_potential.rcbuffer->pybuffer.shape[2];
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&__pyx_pybuffernd_res_center_list.rcbuffer->pybuffer, (PyObject*)__pyx_v_res_center_list, &__Pyx_TypeInfo_nn___pyx_t_8epitopsy_6cython_10pdb_cython_DTYPE_float_t, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack) == -1))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 142; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  }
  __pyx_pybuffernd_res_center_list.diminfo[0].strides = __pyx_pybuffernd_res_center_list.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_res_center_list.diminfo[0].shape = __pyx_pybuffernd_res_center_list.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_res_center_list.diminfo[1].strides = __pyx_pybuffernd_res_center_list.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_res_center_list.diminfo[1].shape = __pyx_pybuffernd_res_center_list.rcbuffer->pybuffer.shape[1];
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&__pyx_pybuffernd_res_hydro_list.rcbuffer->pybuffer, (PyObject*)__pyx_v_res_hydro_list, &__Pyx_TypeInfo_nn___pyx_t_8epitopsy_6cython_10pdb_cython_DTYPE_float_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 142; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  }
  __pyx_pybuffernd_res_hydro_list.diminfo[0].strides = __pyx_pybuffernd_res_hydro_list.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_res_hydro_list.diminfo[0].shape = __pyx_pybuffernd_res_hydro_list.rcbuffer->pybuffer.shape[0];
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line143")'> 143:         np.ndarray[DTYPE_float_t, ndim=3] potential,</pre>
<pre id='line143' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line144")'> 144:         np.ndarray[DTYPE_float_t, ndim=2] res_center_list,</pre>
<pre id='line144' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line145")'> 145:         np.ndarray[DTYPE_float_t, ndim=1] res_hydro_list,</pre>
<pre id='line145' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line146")'> 146:         box_meshsize, box_dim, box_offset):</pre>
<pre id='line146' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF6e' onclick='toggleDiv("line147")'> 147:     cdef int xdim = box_dim[0]</pre>
<pre id='line147' class='code' style='background-color: #FFFF6e'>
  /* "epitopsy/cython/pdb_cython.pyx":147
 *         np.ndarray[DTYPE_float_t, ndim=1] res_hydro_list,
 *         box_meshsize, box_dim, box_offset):
 *     cdef int xdim = box_dim[0]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     cdef int ydim = box_dim[1]
 *     cdef int zdim = box_dim[2]
 */
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(__pyx_v_box_dim, 0, sizeof(long), PyInt_FromLong, 0, 0, 1);<span class='error_goto'> if (!__pyx_t_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 147; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  __pyx_t_2 = __Pyx_<span class='py_c_api'>PyInt_AsInt</span>(__pyx_t_1);<span class='error_goto'> if (unlikely((__pyx_t_2 == (int)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 147; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_v_xdim = __pyx_t_2;
</pre><pre class='line' style='background-color: #FFFF6e' onclick='toggleDiv("line148")'> 148:     cdef int ydim = box_dim[1]</pre>
<pre id='line148' class='code' style='background-color: #FFFF6e'>
  /* "epitopsy/cython/pdb_cython.pyx":148
 *         box_meshsize, box_dim, box_offset):
 *     cdef int xdim = box_dim[0]
 *     cdef int ydim = box_dim[1]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     cdef int zdim = box_dim[2]
 *     cdef float local_vec[3]
 */
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(__pyx_v_box_dim, 1, sizeof(long), PyInt_FromLong, 0, 0, 1);<span class='error_goto'> if (!__pyx_t_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 148; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  __pyx_t_2 = __Pyx_<span class='py_c_api'>PyInt_AsInt</span>(__pyx_t_1);<span class='error_goto'> if (unlikely((__pyx_t_2 == (int)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 148; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_v_ydim = __pyx_t_2;
</pre><pre class='line' style='background-color: #FFFF6e' onclick='toggleDiv("line149")'> 149:     cdef int zdim = box_dim[2]</pre>
<pre id='line149' class='code' style='background-color: #FFFF6e'>
  /* "epitopsy/cython/pdb_cython.pyx":149
 *     cdef int xdim = box_dim[0]
 *     cdef int ydim = box_dim[1]
 *     cdef int zdim = box_dim[2]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     cdef float local_vec[3]
 *     cdef float res_vec[3]
 */
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(__pyx_v_box_dim, 2, sizeof(long), PyInt_FromLong, 0, 0, 1);<span class='error_goto'> if (!__pyx_t_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 149; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  __pyx_t_2 = __Pyx_<span class='py_c_api'>PyInt_AsInt</span>(__pyx_t_1);<span class='error_goto'> if (unlikely((__pyx_t_2 == (int)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 149; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_v_zdim = __pyx_t_2;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line150")'> 150:     cdef float local_vec[3]</pre>
<pre id='line150' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line151")'> 151:     cdef float res_vec[3]</pre>
<pre id='line151' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line152")'> 152:     cdef float diff_vec[3]</pre>
<pre id='line152' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line153")'> 153:     cdef float distance</pre>
<pre id='line153' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line154")'> 154:     cdef int x,y,z</pre>
<pre id='line154' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line155")'> 155:     cdef int n</pre>
<pre id='line155' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line156")'> 156:     cdef int list_length = res_center_list.shape[0]</pre>
<pre id='line156' class='code' style='background-color: #FFFFff'>
  /* "epitopsy/cython/pdb_cython.pyx":156
 *     cdef int x,y,z
 *     cdef int n
 *     cdef int list_length = res_center_list.shape[0]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     cdef float hydro_charge
 *     cdef float hydro_potential
 */
  __pyx_v_list_length = (__pyx_v_res_center_list->dimensions[0]);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line157")'> 157:     cdef float hydro_charge</pre>
<pre id='line157' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line158")'> 158:     cdef float hydro_potential</pre>
<pre id='line158' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line159")'> 159:     cdef int vec_length = 3</pre>
<pre id='line159' class='code' style='background-color: #FFFFff'>
  /* "epitopsy/cython/pdb_cython.pyx":159
 *     cdef float hydro_charge
 *     cdef float hydro_potential
 *     cdef int vec_length = 3             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     cdef float meshsize[3]
 *     cdef float offset[3]
 */
  __pyx_v_vec_length = 3;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line160")'> 160:     cdef float meshsize[3]</pre>
<pre id='line160' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line161")'> 161:     cdef float offset[3]</pre>
<pre id='line161' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line162")'> 162:     cdef int dim[3]</pre>
<pre id='line162' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line163")'> 163:     for i in range(vec_length):</pre>
<pre id='line163' class='code' style='background-color: #FFFFff'>
  /* "epitopsy/cython/pdb_cython.pyx":163
 *     cdef float offset[3]
 *     cdef int dim[3]
 *     for i in range(vec_length):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         meshsize[i] = <code><</code>float> box_meshsize[i]
 *         offset[i] = <code><</code>float> box_offset[i]
 */
  __pyx_t_2 = __pyx_v_vec_length;
  for (__pyx_t_3 = 0; __pyx_t_3 <code><</code> __pyx_t_2; __pyx_t_3+=1) {
    __pyx_v_i = __pyx_t_3;
</pre><pre class='line' style='background-color: #FFFF6e' onclick='toggleDiv("line164")'> 164:         meshsize[i] = &lt;float&gt; box_meshsize[i]</pre>
<pre id='line164' class='code' style='background-color: #FFFF6e'>
    /* "epitopsy/cython/pdb_cython.pyx":164
 *     cdef int dim[3]
 *     for i in range(vec_length):
 *         meshsize[i] = <code><</code>float> box_meshsize[i]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         offset[i] = <code><</code>float> box_offset[i]
 * 
 */
    __pyx_t_1 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(__pyx_v_box_meshsize, __pyx_v_i, sizeof(int), PyInt_FromLong, 0, 1, 1);<span class='error_goto'> if (!__pyx_t_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 164; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
    __pyx_t_4 = __pyx_<span class='py_c_api'>PyFloat_AsFloat</span>(__pyx_t_1);<span class='error_goto'> if (unlikely((__pyx_t_4 == (float)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 164; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
    (__pyx_v_meshsize[__pyx_v_i]) = ((float)__pyx_t_4);
</pre><pre class='line' style='background-color: #FFFF6e' onclick='toggleDiv("line165")'> 165:         offset[i] = &lt;float&gt; box_offset[i]</pre>
<pre id='line165' class='code' style='background-color: #FFFF6e'>
    /* "epitopsy/cython/pdb_cython.pyx":165
 *     for i in range(vec_length):
 *         meshsize[i] = <code><</code>float> box_meshsize[i]
 *         offset[i] = <code><</code>float> box_offset[i]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     for n in range(list_length):
 */
    __pyx_t_1 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(__pyx_v_box_offset, __pyx_v_i, sizeof(int), PyInt_FromLong, 0, 1, 1);<span class='error_goto'> if (!__pyx_t_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 165; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
    __pyx_t_4 = __pyx_<span class='py_c_api'>PyFloat_AsFloat</span>(__pyx_t_1);<span class='error_goto'> if (unlikely((__pyx_t_4 == (float)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 165; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
    (__pyx_v_offset[__pyx_v_i]) = ((float)__pyx_t_4);
  }
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line166")'> 166: </pre>
<pre id='line166' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line167")'> 167:     for n in range(list_length):</pre>
<pre id='line167' class='code' style='background-color: #FFFFff'>
  /* "epitopsy/cython/pdb_cython.pyx":167
 *         offset[i] = <code><</code>float> box_offset[i]
 * 
 *     for n in range(list_length):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         hydro_charge = res_hydro_list[n]
 *         for i in range(vec_length):
 */
  __pyx_t_2 = __pyx_v_list_length;
  for (__pyx_t_3 = 0; __pyx_t_3 <code><</code> __pyx_t_2; __pyx_t_3+=1) {
    __pyx_v_n = __pyx_t_3;
</pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line168")'> 168:         hydro_charge = res_hydro_list[n]</pre>
<pre id='line168' class='code' style='background-color: #FFFFd4'>
    /* "epitopsy/cython/pdb_cython.pyx":168
 * 
 *     for n in range(list_length):
 *         hydro_charge = res_hydro_list[n]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         for i in range(vec_length):
 *             res_vec[i] = res_center_list[n,i]
 */
    __pyx_t_5 = __pyx_v_n;
    __pyx_t_6 = -1;
    if (__pyx_t_5 <code><</code> 0) {
      __pyx_t_5 += __pyx_pybuffernd_res_hydro_list.diminfo[0].shape;
      if (unlikely(__pyx_t_5 <code><</code> 0)) __pyx_t_6 = 0;
    } else if (unlikely(__pyx_t_5 >= __pyx_pybuffernd_res_hydro_list.diminfo[0].shape)) __pyx_t_6 = 0;
    if (unlikely(__pyx_t_6 != -1)) {
      <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_6);
     <span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 168; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    }
    __pyx_v_hydro_charge = (*__Pyx_BufPtrStrided1d(__pyx_t_8epitopsy_6cython_10pdb_cython_DTYPE_float_t *, __pyx_pybuffernd_res_hydro_list.rcbuffer->pybuffer.buf, __pyx_t_5, __pyx_pybuffernd_res_hydro_list.diminfo[0].strides));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line169")'> 169:         for i in range(vec_length):</pre>
<pre id='line169' class='code' style='background-color: #FFFFff'>
    /* "epitopsy/cython/pdb_cython.pyx":169
 *     for n in range(list_length):
 *         hydro_charge = res_hydro_list[n]
 *         for i in range(vec_length):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             res_vec[i] = res_center_list[n,i]
 * 
 */
    __pyx_t_6 = __pyx_v_vec_length;
    for (__pyx_t_7 = 0; __pyx_t_7 <code><</code> __pyx_t_6; __pyx_t_7+=1) {
      __pyx_v_i = __pyx_t_7;
</pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line170")'> 170:             res_vec[i] = res_center_list[n,i]</pre>
<pre id='line170' class='code' style='background-color: #FFFFd4'>
      /* "epitopsy/cython/pdb_cython.pyx":170
 *         hydro_charge = res_hydro_list[n]
 *         for i in range(vec_length):
 *             res_vec[i] = res_center_list[n,i]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         for x in range(xdim):
 */
      __pyx_t_8 = __pyx_v_n;
      __pyx_t_9 = __pyx_v_i;
      __pyx_t_10 = -1;
      if (__pyx_t_8 <code><</code> 0) {
        __pyx_t_8 += __pyx_pybuffernd_res_center_list.diminfo[0].shape;
        if (unlikely(__pyx_t_8 <code><</code> 0)) __pyx_t_10 = 0;
      } else if (unlikely(__pyx_t_8 >= __pyx_pybuffernd_res_center_list.diminfo[0].shape)) __pyx_t_10 = 0;
      if (__pyx_t_9 <code><</code> 0) {
        __pyx_t_9 += __pyx_pybuffernd_res_center_list.diminfo[1].shape;
        if (unlikely(__pyx_t_9 <code><</code> 0)) __pyx_t_10 = 1;
      } else if (unlikely(__pyx_t_9 >= __pyx_pybuffernd_res_center_list.diminfo[1].shape)) __pyx_t_10 = 1;
      if (unlikely(__pyx_t_10 != -1)) {
        <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_10);
       <span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 170; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      }
      (__pyx_v_res_vec[__pyx_v_i]) = (*__Pyx_BufPtrStrided2d(__pyx_t_8epitopsy_6cython_10pdb_cython_DTYPE_float_t *, __pyx_pybuffernd_res_center_list.rcbuffer->pybuffer.buf, __pyx_t_8, __pyx_pybuffernd_res_center_list.diminfo[0].strides, __pyx_t_9, __pyx_pybuffernd_res_center_list.diminfo[1].strides));
    }
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line171")'> 171: </pre>
<pre id='line171' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line172")'> 172:         for x in range(xdim):</pre>
<pre id='line172' class='code' style='background-color: #FFFFff'>
    /* "epitopsy/cython/pdb_cython.pyx":172
 *             res_vec[i] = res_center_list[n,i]
 * 
 *         for x in range(xdim):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             for y in range(ydim):
 *                 for z in range(zdim):
 */
    __pyx_t_6 = __pyx_v_xdim;
    for (__pyx_t_7 = 0; __pyx_t_7 <code><</code> __pyx_t_6; __pyx_t_7+=1) {
      __pyx_v_x = __pyx_t_7;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line173")'> 173:             for y in range(ydim):</pre>
<pre id='line173' class='code' style='background-color: #FFFFff'>
      /* "epitopsy/cython/pdb_cython.pyx":173
 * 
 *         for x in range(xdim):
 *             for y in range(ydim):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                 for z in range(zdim):
 *                     local_vec[0] = <code><</code>float> x
 */
      __pyx_t_10 = __pyx_v_ydim;
      for (__pyx_t_11 = 0; __pyx_t_11 <code><</code> __pyx_t_10; __pyx_t_11+=1) {
        __pyx_v_y = __pyx_t_11;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line174")'> 174:                 for z in range(zdim):</pre>
<pre id='line174' class='code' style='background-color: #FFFFff'>
        /* "epitopsy/cython/pdb_cython.pyx":174
 *         for x in range(xdim):
 *             for y in range(ydim):
 *                 for z in range(zdim):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                     local_vec[0] = <code><</code>float> x
 *                     local_vec[1] = <code><</code>float> y
 */
        __pyx_t_12 = __pyx_v_zdim;
        for (__pyx_t_13 = 0; __pyx_t_13 <code><</code> __pyx_t_12; __pyx_t_13+=1) {
          __pyx_v_z = __pyx_t_13;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line175")'> 175:                     local_vec[0] = &lt;float&gt; x</pre>
<pre id='line175' class='code' style='background-color: #FFFFff'>
          /* "epitopsy/cython/pdb_cython.pyx":175
 *             for y in range(ydim):
 *                 for z in range(zdim):
 *                     local_vec[0] = <code><</code>float> x             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                     local_vec[1] = <code><</code>float> y
 *                     local_vec[2] = <code><</code>float> z
 */
          (__pyx_v_local_vec[0]) = ((float)__pyx_v_x);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line176")'> 176:                     local_vec[1] = &lt;float&gt; y</pre>
<pre id='line176' class='code' style='background-color: #FFFFff'>
          /* "epitopsy/cython/pdb_cython.pyx":176
 *                 for z in range(zdim):
 *                     local_vec[0] = <code><</code>float> x
 *                     local_vec[1] = <code><</code>float> y             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                     local_vec[2] = <code><</code>float> z
 *                     # transform to real space
 */
          (__pyx_v_local_vec[1]) = ((float)__pyx_v_y);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line177")'> 177:                     local_vec[2] = &lt;float&gt; z</pre>
<pre id='line177' class='code' style='background-color: #FFFFff'>
          /* "epitopsy/cython/pdb_cython.pyx":177
 *                     local_vec[0] = <code><</code>float> x
 *                     local_vec[1] = <code><</code>float> y
 *                     local_vec[2] = <code><</code>float> z             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                     # transform to real space
 *                     for j in range(vec_length):
 */
          (__pyx_v_local_vec[2]) = ((float)__pyx_v_z);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line178")'> 178:                     # transform to real space</pre>
<pre id='line178' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line179")'> 179:                     for j in range(vec_length):</pre>
<pre id='line179' class='code' style='background-color: #FFFFff'>
          /* "epitopsy/cython/pdb_cython.pyx":179
 *                     local_vec[2] = <code><</code>float> z
 *                     # transform to real space
 *                     for j in range(vec_length):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                         local_vec[j] = local_vec[j] * meshsize[j] + offset[j]
 * 
 */
          __pyx_t_14 = __pyx_v_vec_length;
          for (__pyx_t_15 = 0; __pyx_t_15 <code><</code> __pyx_t_14; __pyx_t_15+=1) {
            __pyx_v_j = __pyx_t_15;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line180")'> 180:                         local_vec[j] = local_vec[j] * meshsize[j] + offset[j]</pre>
<pre id='line180' class='code' style='background-color: #FFFFff'>
            /* "epitopsy/cython/pdb_cython.pyx":180
 *                     # transform to real space
 *                     for j in range(vec_length):
 *                         local_vec[j] = local_vec[j] * meshsize[j] + offset[j]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *                     for k in range(vec_length):
 */
            (__pyx_v_local_vec[__pyx_v_j]) = (((__pyx_v_local_vec[__pyx_v_j]) * (__pyx_v_meshsize[__pyx_v_j])) + (__pyx_v_offset[__pyx_v_j]));
          }
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line181")'> 181: </pre>
<pre id='line181' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line182")'> 182:                     for k in range(vec_length):</pre>
<pre id='line182' class='code' style='background-color: #FFFFff'>
          /* "epitopsy/cython/pdb_cython.pyx":182
 *                         local_vec[j] = local_vec[j] * meshsize[j] + offset[j]
 * 
 *                     for k in range(vec_length):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                         diff_vec[k] = res_vec[k] - local_vec[k]
 *                     distance = sqrt(diff_vec[0] * diff_vec[0]
 */
          __pyx_t_14 = __pyx_v_vec_length;
          for (__pyx_t_15 = 0; __pyx_t_15 <code><</code> __pyx_t_14; __pyx_t_15+=1) {
            __pyx_v_k = __pyx_t_15;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line183")'> 183:                         diff_vec[k] = res_vec[k] - local_vec[k]</pre>
<pre id='line183' class='code' style='background-color: #FFFFff'>
            /* "epitopsy/cython/pdb_cython.pyx":183
 * 
 *                     for k in range(vec_length):
 *                         diff_vec[k] = res_vec[k] - local_vec[k]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                     distance = sqrt(diff_vec[0] * diff_vec[0]
 *                                     + diff_vec[1] * diff_vec[1]
 */
            (__pyx_v_diff_vec[__pyx_v_k]) = ((__pyx_v_res_vec[__pyx_v_k]) - (__pyx_v_local_vec[__pyx_v_k]));
          }
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line184")'> 184:                     distance = sqrt(diff_vec[0] * diff_vec[0]</pre>
<pre id='line184' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line185")'> 185:                                     + diff_vec[1] * diff_vec[1]</pre>
<pre id='line185' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line186")'> 186:                                     + diff_vec[2] * diff_vec[2])</pre>
<pre id='line186' class='code' style='background-color: #FFFFff'>
          /* "epitopsy/cython/pdb_cython.pyx":186
 *                     distance = sqrt(diff_vec[0] * diff_vec[0]
 *                                     + diff_vec[1] * diff_vec[1]
 *                                     + diff_vec[2] * diff_vec[2])             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *                     potential[x,y,z] = potential[x,y,z] + hydro_charge * exp(-distance)
 */
          __pyx_v_distance = sqrt(((((__pyx_v_diff_vec[0]) * (__pyx_v_diff_vec[0])) + ((__pyx_v_diff_vec[1]) * (__pyx_v_diff_vec[1]))) + ((__pyx_v_diff_vec[2]) * (__pyx_v_diff_vec[2]))));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line187")'> 187: </pre>
<pre id='line187' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFb6' onclick='toggleDiv("line188")'> 188:                     potential[x,y,z] = potential[x,y,z] + hydro_charge * exp(-distance)</pre>
<pre id='line188' class='code' style='background-color: #FFFFb6'>
          /* "epitopsy/cython/pdb_cython.pyx":188
 *                                     + diff_vec[2] * diff_vec[2])
 * 
 *                     potential[x,y,z] = potential[x,y,z] + hydro_charge * exp(-distance)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     return potential
 */
          __pyx_t_14 = __pyx_v_x;
          __pyx_t_15 = __pyx_v_y;
          __pyx_t_16 = __pyx_v_z;
          __pyx_t_17 = -1;
          if (__pyx_t_14 <code><</code> 0) {
            __pyx_t_14 += __pyx_pybuffernd_potential.diminfo[0].shape;
            if (unlikely(__pyx_t_14 <code><</code> 0)) __pyx_t_17 = 0;
          } else if (unlikely(__pyx_t_14 >= __pyx_pybuffernd_potential.diminfo[0].shape)) __pyx_t_17 = 0;
          if (__pyx_t_15 <code><</code> 0) {
            __pyx_t_15 += __pyx_pybuffernd_potential.diminfo[1].shape;
            if (unlikely(__pyx_t_15 <code><</code> 0)) __pyx_t_17 = 1;
          } else if (unlikely(__pyx_t_15 >= __pyx_pybuffernd_potential.diminfo[1].shape)) __pyx_t_17 = 1;
          if (__pyx_t_16 <code><</code> 0) {
            __pyx_t_16 += __pyx_pybuffernd_potential.diminfo[2].shape;
            if (unlikely(__pyx_t_16 <code><</code> 0)) __pyx_t_17 = 2;
          } else if (unlikely(__pyx_t_16 >= __pyx_pybuffernd_potential.diminfo[2].shape)) __pyx_t_17 = 2;
          if (unlikely(__pyx_t_17 != -1)) {
            <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_17);
           <span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 188; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
          }
          __pyx_t_17 = __pyx_v_x;
          __pyx_t_18 = __pyx_v_y;
          __pyx_t_19 = __pyx_v_z;
          __pyx_t_20 = -1;
          if (__pyx_t_17 <code><</code> 0) {
            __pyx_t_17 += __pyx_pybuffernd_potential.diminfo[0].shape;
            if (unlikely(__pyx_t_17 <code><</code> 0)) __pyx_t_20 = 0;
          } else if (unlikely(__pyx_t_17 >= __pyx_pybuffernd_potential.diminfo[0].shape)) __pyx_t_20 = 0;
          if (__pyx_t_18 <code><</code> 0) {
            __pyx_t_18 += __pyx_pybuffernd_potential.diminfo[1].shape;
            if (unlikely(__pyx_t_18 <code><</code> 0)) __pyx_t_20 = 1;
          } else if (unlikely(__pyx_t_18 >= __pyx_pybuffernd_potential.diminfo[1].shape)) __pyx_t_20 = 1;
          if (__pyx_t_19 <code><</code> 0) {
            __pyx_t_19 += __pyx_pybuffernd_potential.diminfo[2].shape;
            if (unlikely(__pyx_t_19 <code><</code> 0)) __pyx_t_20 = 2;
          } else if (unlikely(__pyx_t_19 >= __pyx_pybuffernd_potential.diminfo[2].shape)) __pyx_t_20 = 2;
          if (unlikely(__pyx_t_20 != -1)) {
            <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_20);
           <span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 188; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
          }
          *__Pyx_BufPtrStrided3d(__pyx_t_8epitopsy_6cython_10pdb_cython_DTYPE_float_t *, __pyx_pybuffernd_potential.rcbuffer->pybuffer.buf, __pyx_t_17, __pyx_pybuffernd_potential.diminfo[0].strides, __pyx_t_18, __pyx_pybuffernd_potential.diminfo[1].strides, __pyx_t_19, __pyx_pybuffernd_potential.diminfo[2].strides) = ((*__Pyx_BufPtrStrided3d(__pyx_t_8epitopsy_6cython_10pdb_cython_DTYPE_float_t *, __pyx_pybuffernd_potential.rcbuffer->pybuffer.buf, __pyx_t_14, __pyx_pybuffernd_potential.diminfo[0].strides, __pyx_t_15, __pyx_pybuffernd_potential.diminfo[1].strides, __pyx_t_16, __pyx_pybuffernd_potential.diminfo[2].strides)) + (__pyx_v_hydro_charge * exp((-__pyx_v_distance))));
        }
      }
    }
  }
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line189")'> 189: </pre>
<pre id='line189' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF1a' onclick='toggleDiv("line190")'> 190:     return potential</pre>
<pre id='line190' class='code' style='background-color: #FFFF1a'>
  /* "epitopsy/cython/pdb_cython.pyx":190
 *                     potential[x,y,z] = potential[x,y,z] + hydro_charge * exp(-distance)
 * 
 *     return potential             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * def get_hydrophic_potential(np.ndarray[DTYPE_float_t, ndim=2] res_center_list,
 */
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(((PyObject *)__pyx_r));
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_v_potential));
  __pyx_r = ((PyArrayObject *)__pyx_v_potential);
  goto __pyx_L0;

  __pyx_r = ((PyArrayObject *)Py_None); <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  { PyObject *__pyx_type, *__pyx_value, *__pyx_tb;
    <span class='pyx_c_api'>__Pyx_ErrFetch</span>(&__pyx_type, &__pyx_value, &__pyx_tb);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&__pyx_pybuffernd_potential.rcbuffer->pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&__pyx_pybuffernd_res_center_list.rcbuffer->pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&__pyx_pybuffernd_res_hydro_list.rcbuffer->pybuffer);
  <span class='pyx_c_api'>__Pyx_ErrRestore</span>(__pyx_type, __pyx_value, __pyx_tb);}
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("epitopsy.cython.pdb_cython.calculate_hydrophic_potential", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = 0;
  goto __pyx_L2;
  __pyx_L0:;
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&__pyx_pybuffernd_potential.rcbuffer->pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&__pyx_pybuffernd_res_center_list.rcbuffer->pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&__pyx_pybuffernd_res_hydro_list.rcbuffer->pybuffer);
  __pyx_L2:;
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>((PyObject *)__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_8epitopsy_6cython_10pdb_cython_7get_hydrophic_potential(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyMethodDef __pyx_mdef_8epitopsy_6cython_10pdb_cython_7get_hydrophic_potential = {<span class='pyx_macro_api'>__Pyx_NAMESTR</span>("get_hydrophic_potential"), (PyCFunction)__pyx_pw_8epitopsy_6cython_10pdb_cython_7get_hydrophic_potential, METH_VARARGS|METH_KEYWORDS, <span class='pyx_macro_api'>__Pyx_DOCSTR</span>(0)};
static PyObject *__pyx_pw_8epitopsy_6cython_10pdb_cython_7get_hydrophic_potential(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyArrayObject *__pyx_v_res_center_list = 0;
  PyArrayObject *__pyx_v_res_hydro_list = 0;
  PyObject *__pyx_v_box_meshsize = 0;
  PyObject *__pyx_v_box_dim = 0;
  PyObject *__pyx_v_box_offset = 0;
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("get_hydrophic_potential (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__res_center_list,&__pyx_n_s__res_hydro_list,&__pyx_n_s__box_meshsize,&__pyx_n_s__box_dim,&__pyx_n_s__box_offset,0};
    PyObject* values[5] = {0,0,0,0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
      switch (pos_args) {
        case  5: values[4] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 4);
        case  4: values[3] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 3);
        case  3: values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__res_center_list)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        case  1:
        if (likely((values[1] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__res_hydro_list)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("get_hydrophic_potential", 1, 5, 5, 1);<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 192; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
        case  2:
        if (likely((values[2] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__box_meshsize)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("get_hydrophic_potential", 1, 5, 5, 2);<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 192; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
        case  3:
        if (likely((values[3] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__box_dim)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("get_hydrophic_potential", 1, 5, 5, 3);<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 192; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
        case  4:
        if (likely((values[4] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__box_offset)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("get_hydrophic_potential", 1, 5, 5, 4);<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 192; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "get_hydrophic_potential") <code><</code> 0))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 192; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
      }
    } else if (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args) != 5) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
      values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
      values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
      values[3] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 3);
      values[4] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 4);
    }
    __pyx_v_res_center_list = ((PyArrayObject *)values[0]);
    __pyx_v_res_hydro_list = ((PyArrayObject *)values[1]);
    __pyx_v_box_meshsize = values[2];
    __pyx_v_box_dim = values[3];
    __pyx_v_box_offset = values[4];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("get_hydrophic_potential", 1, 5, 5, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args));<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 192; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("epitopsy.cython.pdb_cython.get_hydrophic_potential", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_res_center_list), __pyx_ptype_5numpy_ndarray, 1, "res_center_list", 0)))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 192; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_res_hydro_list), __pyx_ptype_5numpy_ndarray, 1, "res_hydro_list", 0)))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 193; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_r = __pyx_pf_8epitopsy_6cython_10pdb_cython_6get_hydrophic_potential(__pyx_self, __pyx_v_res_center_list, __pyx_v_res_hydro_list, __pyx_v_box_meshsize, __pyx_v_box_dim, __pyx_v_box_offset);
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  goto __pyx_L0;
  __pyx_L1_error:;
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line191")'> 191: </pre>
<pre id='line191' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF55' onclick='toggleDiv("line192")'> 192: def get_hydrophic_potential(np.ndarray[DTYPE_float_t, ndim=2] res_center_list,</pre>
<pre id='line192' class='code' style='background-color: #FFFF55'>
/* "epitopsy/cython/pdb_cython.pyx":192
 *     return potential
 * 
 * def get_hydrophic_potential(np.ndarray[DTYPE_float_t, ndim=2] res_center_list,             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                             np.ndarray[DTYPE_float_t, ndim=1] res_hydro_list,
 *                             box_meshsize, box_dim, box_offset):
 */

static PyObject *__pyx_pf_8epitopsy_6cython_10pdb_cython_6get_hydrophic_potential(CYTHON_UNUSED PyObject *__pyx_self, PyArrayObject *__pyx_v_res_center_list, PyArrayObject *__pyx_v_res_hydro_list, PyObject *__pyx_v_box_meshsize, PyObject *__pyx_v_box_dim, PyObject *__pyx_v_box_offset) {
  PyArrayObject *__pyx_v_potential = 0;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_potential;
  __Pyx_Buffer __pyx_pybuffer_potential;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_res_center_list;
  __Pyx_Buffer __pyx_pybuffer_res_center_list;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_res_hydro_list;
  __Pyx_Buffer __pyx_pybuffer_res_hydro_list;
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("get_hydrophic_potential", 0);
  __pyx_pybuffer_potential.pybuffer.buf = NULL;
  __pyx_pybuffer_potential.refcount = 0;
  __pyx_pybuffernd_potential.data = NULL;
  __pyx_pybuffernd_potential.rcbuffer = &__pyx_pybuffer_potential;
  __pyx_pybuffer_res_center_list.pybuffer.buf = NULL;
  __pyx_pybuffer_res_center_list.refcount = 0;
  __pyx_pybuffernd_res_center_list.data = NULL;
  __pyx_pybuffernd_res_center_list.rcbuffer = &__pyx_pybuffer_res_center_list;
  __pyx_pybuffer_res_hydro_list.pybuffer.buf = NULL;
  __pyx_pybuffer_res_hydro_list.refcount = 0;
  __pyx_pybuffernd_res_hydro_list.data = NULL;
  __pyx_pybuffernd_res_hydro_list.rcbuffer = &__pyx_pybuffer_res_hydro_list;
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&__pyx_pybuffernd_res_center_list.rcbuffer->pybuffer, (PyObject*)__pyx_v_res_center_list, &__Pyx_TypeInfo_nn___pyx_t_8epitopsy_6cython_10pdb_cython_DTYPE_float_t, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack) == -1))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 192; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  }
  __pyx_pybuffernd_res_center_list.diminfo[0].strides = __pyx_pybuffernd_res_center_list.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_res_center_list.diminfo[0].shape = __pyx_pybuffernd_res_center_list.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_res_center_list.diminfo[1].strides = __pyx_pybuffernd_res_center_list.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_res_center_list.diminfo[1].shape = __pyx_pybuffernd_res_center_list.rcbuffer->pybuffer.shape[1];
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&__pyx_pybuffernd_res_hydro_list.rcbuffer->pybuffer, (PyObject*)__pyx_v_res_hydro_list, &__Pyx_TypeInfo_nn___pyx_t_8epitopsy_6cython_10pdb_cython_DTYPE_float_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 192; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  }
  __pyx_pybuffernd_res_hydro_list.diminfo[0].strides = __pyx_pybuffernd_res_hydro_list.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_res_hydro_list.diminfo[0].shape = __pyx_pybuffernd_res_hydro_list.rcbuffer->pybuffer.shape[0];

  /* "epitopsy/cython/pdb_cython.pyx":192
 *     return potential
 * 
 * def get_hydrophic_potential(np.ndarray[DTYPE_float_t, ndim=2] res_center_list,             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                             np.ndarray[DTYPE_float_t, ndim=1] res_hydro_list,
 *                             box_meshsize, box_dim, box_offset):
 */
  __pyx_k_tuple_56 = <span class='py_c_api'>PyTuple_Pack</span>(6, ((PyObject *)__pyx_n_s__res_center_list), ((PyObject *)__pyx_n_s__res_hydro_list), ((PyObject *)__pyx_n_s__box_meshsize), ((PyObject *)__pyx_n_s__box_dim), ((PyObject *)__pyx_n_s__box_offset), ((PyObject *)__pyx_n_s__potential));<span class='error_goto'> if (unlikely(!__pyx_k_tuple_56)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 192; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_k_tuple_56);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_k_tuple_56));

  /* "epitopsy/cython/pdb_cython.pyx":192
 *     return potential
 * 
 * def get_hydrophic_potential(np.ndarray[DTYPE_float_t, ndim=2] res_center_list,             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                             np.ndarray[DTYPE_float_t, ndim=1] res_hydro_list,
 *                             box_meshsize, box_dim, box_offset):
 */
  __pyx_t_2 = PyCFunction_NewEx(&__pyx_mdef_8epitopsy_6cython_10pdb_cython_7get_hydrophic_potential, NULL, __pyx_n_s_51);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 192; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_58, __pyx_t_2) <code><</code> 0)<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 192; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_k_codeobj_57 = (PyObject*)__Pyx_<span class='py_c_api'>PyCode_New</span>(5, 0, 6, 0, 0, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_k_tuple_56, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_50, __pyx_n_s_58, 192, __pyx_empty_bytes);<span class='error_goto'> if (unlikely(!__pyx_k_codeobj_57)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 192; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line193")'> 193:                             np.ndarray[DTYPE_float_t, ndim=1] res_hydro_list,</pre>
<pre id='line193' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line194")'> 194:                             box_meshsize, box_dim, box_offset):</pre>
<pre id='line194' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line195")'> 195: </pre>
<pre id='line195' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF32' onclick='toggleDiv("line196")'> 196:     cdef np.ndarray[DTYPE_float_t, ndim=3] potential = np.zeros(box_dim, dtype = DTYPE_float)</pre>
<pre id='line196' class='code' style='background-color: #FFFF32'>
  /* "epitopsy/cython/pdb_cython.pyx":196
 *                             box_meshsize, box_dim, box_offset):
 * 
 *     cdef np.ndarray[DTYPE_float_t, ndim=3] potential = np.zeros(box_dim, dtype = DTYPE_float)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     potential = calculate_hydrophic_potential(potential,
 */
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s__np);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 196; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  __pyx_t_2 = __Pyx_<span class='py_c_api'>PyObject_GetAttrStr</span>(__pyx_t_1, __pyx_n_s__zeros);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 196; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 196; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_box_dim);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 0, __pyx_v_box_dim);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_v_box_dim);
  __pyx_t_3 = <span class='py_c_api'>PyDict_New</span>();<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 196; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(((PyObject *)__pyx_t_3));
  __pyx_t_4 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s__DTYPE_float);<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 196; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_4);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_3, ((PyObject *)__pyx_n_s__dtype), __pyx_t_4) <code><</code> 0)<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 196; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_t_4 = <span class='py_c_api'>PyObject_Call</span>(__pyx_t_2, ((PyObject *)__pyx_t_1), ((PyObject *)__pyx_t_3));<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 196; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_3)); __pyx_t_3 = 0;
  if (!(likely(((__pyx_t_4) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_4, __pyx_ptype_5numpy_ndarray)))))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 196; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_t_5 = ((PyArrayObject *)__pyx_t_4);
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&__pyx_pybuffernd_potential.rcbuffer->pybuffer, (PyObject*)__pyx_t_5, &__Pyx_TypeInfo_nn___pyx_t_8epitopsy_6cython_10pdb_cython_DTYPE_float_t, PyBUF_FORMAT| PyBUF_STRIDES, 3, 0, __pyx_stack) == -1)) {
      __pyx_v_potential = ((PyArrayObject *)Py_None); <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None); __pyx_pybuffernd_potential.rcbuffer->pybuffer.buf = NULL;
     <span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 196; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    } else {__pyx_pybuffernd_potential.diminfo[0].strides = __pyx_pybuffernd_potential.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_potential.diminfo[0].shape = __pyx_pybuffernd_potential.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_potential.diminfo[1].strides = __pyx_pybuffernd_potential.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_potential.diminfo[1].shape = __pyx_pybuffernd_potential.rcbuffer->pybuffer.shape[1]; __pyx_pybuffernd_potential.diminfo[2].strides = __pyx_pybuffernd_potential.rcbuffer->pybuffer.strides[2]; __pyx_pybuffernd_potential.diminfo[2].shape = __pyx_pybuffernd_potential.rcbuffer->pybuffer.shape[2];
    }
  }
  __pyx_t_5 = 0;
  __pyx_v_potential = ((PyArrayObject *)__pyx_t_4);
  __pyx_t_4 = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line197")'> 197: </pre>
<pre id='line197' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line198")'> 198:     potential = calculate_hydrophic_potential(potential,</pre>
<pre id='line198' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line199")'> 199:             res_center_list, res_hydro_list, box_meshsize, box_dim,</pre>
<pre id='line199' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF57' onclick='toggleDiv("line200")'> 200:             box_offset)</pre>
<pre id='line200' class='code' style='background-color: #FFFF57'>
  /* "epitopsy/cython/pdb_cython.pyx":200
 *     potential = calculate_hydrophic_potential(potential,
 *             res_center_list, res_hydro_list, box_meshsize, box_dim,
 *             box_offset)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     return potential
 */
  __pyx_t_4 = ((PyObject *)__pyx_f_8epitopsy_6cython_10pdb_cython_calculate_hydrophic_potential(((PyArrayObject *)__pyx_v_potential), ((PyArrayObject *)__pyx_v_res_center_list), ((PyArrayObject *)__pyx_v_res_hydro_list), __pyx_v_box_meshsize, __pyx_v_box_dim, __pyx_v_box_offset));<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 198; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_4);
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&__pyx_pybuffernd_potential.rcbuffer->pybuffer);
    __pyx_t_6 = <span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&__pyx_pybuffernd_potential.rcbuffer->pybuffer, (PyObject*)((PyArrayObject *)__pyx_t_4), &__Pyx_TypeInfo_nn___pyx_t_8epitopsy_6cython_10pdb_cython_DTYPE_float_t, PyBUF_FORMAT| PyBUF_STRIDES, 3, 0, __pyx_stack);
    if (unlikely(__pyx_t_6 <code><</code> 0)) {
      <span class='py_c_api'>PyErr_Fetch</span>(&__pyx_t_7, &__pyx_t_8, &__pyx_t_9);
      if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&__pyx_pybuffernd_potential.rcbuffer->pybuffer, (PyObject*)__pyx_v_potential, &__Pyx_TypeInfo_nn___pyx_t_8epitopsy_6cython_10pdb_cython_DTYPE_float_t, PyBUF_FORMAT| PyBUF_STRIDES, 3, 0, __pyx_stack) == -1)) {
        Py_XDECREF(__pyx_t_7); Py_XDECREF(__pyx_t_8); Py_XDECREF(__pyx_t_9);
        <span class='pyx_c_api'>__Pyx_RaiseBufferFallbackError</span>();
      } else {
        <span class='py_c_api'>PyErr_Restore</span>(__pyx_t_7, __pyx_t_8, __pyx_t_9);
      }
    }
    __pyx_pybuffernd_potential.diminfo[0].strides = __pyx_pybuffernd_potential.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_potential.diminfo[0].shape = __pyx_pybuffernd_potential.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_potential.diminfo[1].strides = __pyx_pybuffernd_potential.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_potential.diminfo[1].shape = __pyx_pybuffernd_potential.rcbuffer->pybuffer.shape[1]; __pyx_pybuffernd_potential.diminfo[2].strides = __pyx_pybuffernd_potential.rcbuffer->pybuffer.strides[2]; __pyx_pybuffernd_potential.diminfo[2].shape = __pyx_pybuffernd_potential.rcbuffer->pybuffer.shape[2];
    if (unlikely(__pyx_t_6 <code><</code> 0))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 198; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  }
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_v_potential));
  __pyx_v_potential = ((PyArrayObject *)__pyx_t_4);
  __pyx_t_4 = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line201")'> 201: </pre>
<pre id='line201' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF15' onclick='toggleDiv("line202")'> 202:     return potential</pre>
<pre id='line202' class='code' style='background-color: #FFFF15'>
  /* "epitopsy/cython/pdb_cython.pyx":202
 *             box_offset)
 * 
 *     return potential             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * 
 */
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_v_potential));
  __pyx_r = ((PyObject *)__pyx_v_potential);
  goto __pyx_L0;

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4);
  { PyObject *__pyx_type, *__pyx_value, *__pyx_tb;
    <span class='pyx_c_api'>__Pyx_ErrFetch</span>(&__pyx_type, &__pyx_value, &__pyx_tb);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&__pyx_pybuffernd_potential.rcbuffer->pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&__pyx_pybuffernd_res_center_list.rcbuffer->pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&__pyx_pybuffernd_res_hydro_list.rcbuffer->pybuffer);
  <span class='pyx_c_api'>__Pyx_ErrRestore</span>(__pyx_type, __pyx_value, __pyx_tb);}
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("epitopsy.cython.pdb_cython.get_hydrophic_potential", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  goto __pyx_L2;
  __pyx_L0:;
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&__pyx_pybuffernd_potential.rcbuffer->pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&__pyx_pybuffernd_res_center_list.rcbuffer->pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&__pyx_pybuffernd_res_hydro_list.rcbuffer->pybuffer);
  __pyx_L2:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_potential);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_8epitopsy_6cython_10pdb_cython_9find_clashing_atoms(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyMethodDef __pyx_mdef_8epitopsy_6cython_10pdb_cython_9find_clashing_atoms = {<span class='pyx_macro_api'>__Pyx_NAMESTR</span>("find_clashing_atoms"), (PyCFunction)__pyx_pw_8epitopsy_6cython_10pdb_cython_9find_clashing_atoms, METH_VARARGS|METH_KEYWORDS, <span class='pyx_macro_api'>__Pyx_DOCSTR</span>(0)};
static PyObject *__pyx_pw_8epitopsy_6cython_10pdb_cython_9find_clashing_atoms(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyArrayObject *__pyx_v_coord_1 = 0;
  PyArrayObject *__pyx_v_radii_1 = 0;
  PyArrayObject *__pyx_v_coord_2 = 0;
  PyArrayObject *__pyx_v_radii_2 = 0;
  float __pyx_v_energy_cutoff;
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("find_clashing_atoms (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__coord_1,&__pyx_n_s__radii_1,&__pyx_n_s__coord_2,&__pyx_n_s__radii_2,&__pyx_n_s__energy_cutoff,0};
    PyObject* values[5] = {0,0,0,0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
      switch (pos_args) {
        case  5: values[4] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 4);
        case  4: values[3] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 3);
        case  3: values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__coord_1)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        case  1:
        if (likely((values[1] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__radii_1)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("find_clashing_atoms", 1, 5, 5, 1);<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 205; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
        case  2:
        if (likely((values[2] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__coord_2)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("find_clashing_atoms", 1, 5, 5, 2);<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 205; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
        case  3:
        if (likely((values[3] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__radii_2)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("find_clashing_atoms", 1, 5, 5, 3);<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 205; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
        case  4:
        if (likely((values[4] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__energy_cutoff)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("find_clashing_atoms", 1, 5, 5, 4);<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 205; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "find_clashing_atoms") <code><</code> 0))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 205; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
      }
    } else if (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args) != 5) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
      values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
      values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
      values[3] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 3);
      values[4] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 4);
    }
    __pyx_v_coord_1 = ((PyArrayObject *)values[0]);
    __pyx_v_radii_1 = ((PyArrayObject *)values[1]);
    __pyx_v_coord_2 = ((PyArrayObject *)values[2]);
    __pyx_v_radii_2 = ((PyArrayObject *)values[3]);
    __pyx_v_energy_cutoff = __pyx_<span class='py_c_api'>PyFloat_AsFloat</span>(values[4]);<span class='error_goto'> if (unlikely((__pyx_v_energy_cutoff == (float)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 209; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("find_clashing_atoms", 1, 5, 5, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args));<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 205; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("epitopsy.cython.pdb_cython.find_clashing_atoms", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_coord_1), __pyx_ptype_5numpy_ndarray, 1, "coord_1", 0)))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 205; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_radii_1), __pyx_ptype_5numpy_ndarray, 1, "radii_1", 0)))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 206; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_coord_2), __pyx_ptype_5numpy_ndarray, 1, "coord_2", 0)))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 207; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_radii_2), __pyx_ptype_5numpy_ndarray, 1, "radii_2", 0)))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 208; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_r = __pyx_pf_8epitopsy_6cython_10pdb_cython_8find_clashing_atoms(__pyx_self, __pyx_v_coord_1, __pyx_v_radii_1, __pyx_v_coord_2, __pyx_v_radii_2, __pyx_v_energy_cutoff);
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  goto __pyx_L0;
  __pyx_L1_error:;
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line203")'> 203: </pre>
<pre id='line203' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line204")'> 204: </pre>
<pre id='line204' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF4b' onclick='toggleDiv("line205")'> 205: def find_clashing_atoms(np.ndarray[DTYPE_float_t, ndim=2] coord_1,</pre>
<pre id='line205' class='code' style='background-color: #FFFF4b'>
/* "epitopsy/cython/pdb_cython.pyx":205
 * 
 * 
 * def find_clashing_atoms(np.ndarray[DTYPE_float_t, ndim=2] coord_1,             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         np.ndarray[DTYPE_float_t, ndim=1] radii_1,
 *         np.ndarray[DTYPE_float_t, ndim=2] coord_2,
 */

static PyObject *__pyx_pf_8epitopsy_6cython_10pdb_cython_8find_clashing_atoms(CYTHON_UNUSED PyObject *__pyx_self, PyArrayObject *__pyx_v_coord_1, PyArrayObject *__pyx_v_radii_1, PyArrayObject *__pyx_v_coord_2, PyArrayObject *__pyx_v_radii_2, float __pyx_v_energy_cutoff) {
  __Pyx_LocalBuf_ND __pyx_pybuffernd_coord_1;
  __Pyx_Buffer __pyx_pybuffer_coord_1;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_coord_2;
  __Pyx_Buffer __pyx_pybuffer_coord_2;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_radii_1;
  __Pyx_Buffer __pyx_pybuffer_radii_1;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_radii_2;
  __Pyx_Buffer __pyx_pybuffer_radii_2;
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("find_clashing_atoms", 0);
  __pyx_pybuffer_coord_1.pybuffer.buf = NULL;
  __pyx_pybuffer_coord_1.refcount = 0;
  __pyx_pybuffernd_coord_1.data = NULL;
  __pyx_pybuffernd_coord_1.rcbuffer = &__pyx_pybuffer_coord_1;
  __pyx_pybuffer_radii_1.pybuffer.buf = NULL;
  __pyx_pybuffer_radii_1.refcount = 0;
  __pyx_pybuffernd_radii_1.data = NULL;
  __pyx_pybuffernd_radii_1.rcbuffer = &__pyx_pybuffer_radii_1;
  __pyx_pybuffer_coord_2.pybuffer.buf = NULL;
  __pyx_pybuffer_coord_2.refcount = 0;
  __pyx_pybuffernd_coord_2.data = NULL;
  __pyx_pybuffernd_coord_2.rcbuffer = &__pyx_pybuffer_coord_2;
  __pyx_pybuffer_radii_2.pybuffer.buf = NULL;
  __pyx_pybuffer_radii_2.refcount = 0;
  __pyx_pybuffernd_radii_2.data = NULL;
  __pyx_pybuffernd_radii_2.rcbuffer = &__pyx_pybuffer_radii_2;
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&__pyx_pybuffernd_coord_1.rcbuffer->pybuffer, (PyObject*)__pyx_v_coord_1, &__Pyx_TypeInfo_nn___pyx_t_8epitopsy_6cython_10pdb_cython_DTYPE_float_t, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack) == -1))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 205; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  }
  __pyx_pybuffernd_coord_1.diminfo[0].strides = __pyx_pybuffernd_coord_1.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_coord_1.diminfo[0].shape = __pyx_pybuffernd_coord_1.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_coord_1.diminfo[1].strides = __pyx_pybuffernd_coord_1.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_coord_1.diminfo[1].shape = __pyx_pybuffernd_coord_1.rcbuffer->pybuffer.shape[1];
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&__pyx_pybuffernd_radii_1.rcbuffer->pybuffer, (PyObject*)__pyx_v_radii_1, &__Pyx_TypeInfo_nn___pyx_t_8epitopsy_6cython_10pdb_cython_DTYPE_float_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 205; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  }
  __pyx_pybuffernd_radii_1.diminfo[0].strides = __pyx_pybuffernd_radii_1.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_radii_1.diminfo[0].shape = __pyx_pybuffernd_radii_1.rcbuffer->pybuffer.shape[0];
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&__pyx_pybuffernd_coord_2.rcbuffer->pybuffer, (PyObject*)__pyx_v_coord_2, &__Pyx_TypeInfo_nn___pyx_t_8epitopsy_6cython_10pdb_cython_DTYPE_float_t, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack) == -1))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 205; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  }
  __pyx_pybuffernd_coord_2.diminfo[0].strides = __pyx_pybuffernd_coord_2.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_coord_2.diminfo[0].shape = __pyx_pybuffernd_coord_2.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_coord_2.diminfo[1].strides = __pyx_pybuffernd_coord_2.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_coord_2.diminfo[1].shape = __pyx_pybuffernd_coord_2.rcbuffer->pybuffer.shape[1];
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&__pyx_pybuffernd_radii_2.rcbuffer->pybuffer, (PyObject*)__pyx_v_radii_2, &__Pyx_TypeInfo_nn___pyx_t_8epitopsy_6cython_10pdb_cython_DTYPE_float_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 205; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  }
  __pyx_pybuffernd_radii_2.diminfo[0].strides = __pyx_pybuffernd_radii_2.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_radii_2.diminfo[0].shape = __pyx_pybuffernd_radii_2.rcbuffer->pybuffer.shape[0];

  /* "epitopsy/cython/pdb_cython.pyx":205
 * 
 * 
 * def find_clashing_atoms(np.ndarray[DTYPE_float_t, ndim=2] coord_1,             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         np.ndarray[DTYPE_float_t, ndim=1] radii_1,
 *         np.ndarray[DTYPE_float_t, ndim=2] coord_2,
 */
  __pyx_k_tuple_59 = <span class='py_c_api'>PyTuple_Pack</span>(5, ((PyObject *)__pyx_n_s__coord_1), ((PyObject *)__pyx_n_s__radii_1), ((PyObject *)__pyx_n_s__coord_2), ((PyObject *)__pyx_n_s__radii_2), ((PyObject *)__pyx_n_s__energy_cutoff));<span class='error_goto'> if (unlikely(!__pyx_k_tuple_59)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 205; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_k_tuple_59);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_k_tuple_59));

  /* "epitopsy/cython/pdb_cython.pyx":205
 * 
 * 
 * def find_clashing_atoms(np.ndarray[DTYPE_float_t, ndim=2] coord_1,             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         np.ndarray[DTYPE_float_t, ndim=1] radii_1,
 *         np.ndarray[DTYPE_float_t, ndim=2] coord_2,
 */
  __pyx_t_2 = PyCFunction_NewEx(&__pyx_mdef_8epitopsy_6cython_10pdb_cython_9find_clashing_atoms, NULL, __pyx_n_s_51);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 205; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s__find_clashing_atoms, __pyx_t_2) <code><</code> 0)<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 205; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_k_codeobj_60 = (PyObject*)__Pyx_<span class='py_c_api'>PyCode_New</span>(5, 0, 5, 0, 0, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_k_tuple_59, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_50, __pyx_n_s__find_clashing_atoms, 205, __pyx_empty_bytes);<span class='error_goto'> if (unlikely(!__pyx_k_codeobj_60)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 205; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line206")'> 206:         np.ndarray[DTYPE_float_t, ndim=1] radii_1,</pre>
<pre id='line206' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line207")'> 207:         np.ndarray[DTYPE_float_t, ndim=2] coord_2,</pre>
<pre id='line207' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line208")'> 208:         np.ndarray[DTYPE_float_t, ndim=1] radii_2,</pre>
<pre id='line208' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line209")'> 209:         float energy_cutoff):</pre>
<pre id='line209' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFe7' onclick='toggleDiv("line210")'> 210:     return _find_clashing_atoms(coord_1, radii_1, coord_2, radii_2,</pre>
<pre id='line210' class='code' style='background-color: #FFFFe7'>
  /* "epitopsy/cython/pdb_cython.pyx":210
 *         np.ndarray[DTYPE_float_t, ndim=1] radii_2,
 *         float energy_cutoff):
 *     return _find_clashing_atoms(coord_1, radii_1, coord_2, radii_2,             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             energy_cutoff)
 * 
 */
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
</pre><pre class='line' style='background-color: #FFFF3f' onclick='toggleDiv("line211")'> 211:             energy_cutoff)</pre>
<pre id='line211' class='code' style='background-color: #FFFF3f'>
  /* "epitopsy/cython/pdb_cython.pyx":211
 *         float energy_cutoff):
 *     return _find_clashing_atoms(coord_1, radii_1, coord_2, radii_2,
 *             energy_cutoff)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * cdef int _find_clashing_atoms(np.ndarray[DTYPE_float_t, ndim=2] coord_1,
 */
  __pyx_t_1 = <span class='py_c_api'>PyInt_FromLong</span>(__pyx_f_8epitopsy_6cython_10pdb_cython__find_clashing_atoms(((PyArrayObject *)__pyx_v_coord_1), ((PyArrayObject *)__pyx_v_radii_1), ((PyArrayObject *)__pyx_v_coord_2), ((PyArrayObject *)__pyx_v_radii_2), __pyx_v_energy_cutoff));<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 210; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  { PyObject *__pyx_type, *__pyx_value, *__pyx_tb;
    <span class='pyx_c_api'>__Pyx_ErrFetch</span>(&__pyx_type, &__pyx_value, &__pyx_tb);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&__pyx_pybuffernd_coord_1.rcbuffer->pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&__pyx_pybuffernd_coord_2.rcbuffer->pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&__pyx_pybuffernd_radii_1.rcbuffer->pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&__pyx_pybuffernd_radii_2.rcbuffer->pybuffer);
  <span class='pyx_c_api'>__Pyx_ErrRestore</span>(__pyx_type, __pyx_value, __pyx_tb);}
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("epitopsy.cython.pdb_cython.find_clashing_atoms", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  goto __pyx_L2;
  __pyx_L0:;
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&__pyx_pybuffernd_coord_1.rcbuffer->pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&__pyx_pybuffernd_coord_2.rcbuffer->pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&__pyx_pybuffernd_radii_1.rcbuffer->pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&__pyx_pybuffernd_radii_2.rcbuffer->pybuffer);
  __pyx_L2:;
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line212")'> 212: </pre>
<pre id='line212' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF8d' onclick='toggleDiv("line213")'> 213: cdef int _find_clashing_atoms(np.ndarray[DTYPE_float_t, ndim=2] coord_1,</pre>
<pre id='line213' class='code' style='background-color: #FFFF8d'>
/* "epitopsy/cython/pdb_cython.pyx":213
 *             energy_cutoff)
 * 
 * cdef int _find_clashing_atoms(np.ndarray[DTYPE_float_t, ndim=2] coord_1,             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         np.ndarray[DTYPE_float_t, ndim=1] radii_1,
 *         np.ndarray[DTYPE_float_t, ndim=2] coord_2,
 */

static int __pyx_f_8epitopsy_6cython_10pdb_cython__find_clashing_atoms(PyArrayObject *__pyx_v_coord_1, PyArrayObject *__pyx_v_radii_1, PyArrayObject *__pyx_v_coord_2, PyArrayObject *__pyx_v_radii_2, float __pyx_v_energy_cutoff) {
  int __pyx_v_n_atoms_1;
  int __pyx_v_n_atoms_2;
  float __pyx_v_r_1;
  float __pyx_v_r_2;
  float __pyx_v_r_vdw;
  float __pyx_v_division;
  float __pyx_v_x[3];
  float __pyx_v_u[3];
  float __pyx_v_dist;
  float __pyx_v_energy;
  float __pyx_v_e_const;
  int __pyx_v_i;
  int __pyx_v_j;
  int __pyx_v_k;
  int __pyx_v_atom_clashes;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_coord_1;
  __Pyx_Buffer __pyx_pybuffer_coord_1;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_coord_2;
  __Pyx_Buffer __pyx_pybuffer_coord_2;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_radii_1;
  __Pyx_Buffer __pyx_pybuffer_radii_1;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_radii_2;
  __Pyx_Buffer __pyx_pybuffer_radii_2;
  int __pyx_r;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_find_clashing_atoms", 0);
  __pyx_pybuffer_coord_1.pybuffer.buf = NULL;
  __pyx_pybuffer_coord_1.refcount = 0;
  __pyx_pybuffernd_coord_1.data = NULL;
  __pyx_pybuffernd_coord_1.rcbuffer = &__pyx_pybuffer_coord_1;
  __pyx_pybuffer_radii_1.pybuffer.buf = NULL;
  __pyx_pybuffer_radii_1.refcount = 0;
  __pyx_pybuffernd_radii_1.data = NULL;
  __pyx_pybuffernd_radii_1.rcbuffer = &__pyx_pybuffer_radii_1;
  __pyx_pybuffer_coord_2.pybuffer.buf = NULL;
  __pyx_pybuffer_coord_2.refcount = 0;
  __pyx_pybuffernd_coord_2.data = NULL;
  __pyx_pybuffernd_coord_2.rcbuffer = &__pyx_pybuffer_coord_2;
  __pyx_pybuffer_radii_2.pybuffer.buf = NULL;
  __pyx_pybuffer_radii_2.refcount = 0;
  __pyx_pybuffernd_radii_2.data = NULL;
  __pyx_pybuffernd_radii_2.rcbuffer = &__pyx_pybuffer_radii_2;
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&__pyx_pybuffernd_coord_1.rcbuffer->pybuffer, (PyObject*)__pyx_v_coord_1, &__Pyx_TypeInfo_nn___pyx_t_8epitopsy_6cython_10pdb_cython_DTYPE_float_t, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack) == -1))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 213; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  }
  __pyx_pybuffernd_coord_1.diminfo[0].strides = __pyx_pybuffernd_coord_1.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_coord_1.diminfo[0].shape = __pyx_pybuffernd_coord_1.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_coord_1.diminfo[1].strides = __pyx_pybuffernd_coord_1.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_coord_1.diminfo[1].shape = __pyx_pybuffernd_coord_1.rcbuffer->pybuffer.shape[1];
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&__pyx_pybuffernd_radii_1.rcbuffer->pybuffer, (PyObject*)__pyx_v_radii_1, &__Pyx_TypeInfo_nn___pyx_t_8epitopsy_6cython_10pdb_cython_DTYPE_float_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 213; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  }
  __pyx_pybuffernd_radii_1.diminfo[0].strides = __pyx_pybuffernd_radii_1.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_radii_1.diminfo[0].shape = __pyx_pybuffernd_radii_1.rcbuffer->pybuffer.shape[0];
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&__pyx_pybuffernd_coord_2.rcbuffer->pybuffer, (PyObject*)__pyx_v_coord_2, &__Pyx_TypeInfo_nn___pyx_t_8epitopsy_6cython_10pdb_cython_DTYPE_float_t, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack) == -1))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 213; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  }
  __pyx_pybuffernd_coord_2.diminfo[0].strides = __pyx_pybuffernd_coord_2.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_coord_2.diminfo[0].shape = __pyx_pybuffernd_coord_2.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_coord_2.diminfo[1].strides = __pyx_pybuffernd_coord_2.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_coord_2.diminfo[1].shape = __pyx_pybuffernd_coord_2.rcbuffer->pybuffer.shape[1];
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&__pyx_pybuffernd_radii_2.rcbuffer->pybuffer, (PyObject*)__pyx_v_radii_2, &__Pyx_TypeInfo_nn___pyx_t_8epitopsy_6cython_10pdb_cython_DTYPE_float_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 213; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  }
  __pyx_pybuffernd_radii_2.diminfo[0].strides = __pyx_pybuffernd_radii_2.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_radii_2.diminfo[0].shape = __pyx_pybuffernd_radii_2.rcbuffer->pybuffer.shape[0];
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line214")'> 214:         np.ndarray[DTYPE_float_t, ndim=1] radii_1,</pre>
<pre id='line214' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line215")'> 215:         np.ndarray[DTYPE_float_t, ndim=2] coord_2,</pre>
<pre id='line215' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line216")'> 216:         np.ndarray[DTYPE_float_t, ndim=1] radii_2,</pre>
<pre id='line216' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line217")'> 217:         float energy_cutoff):</pre>
<pre id='line217' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line218")'> 218:     cdef int n_atoms_1 = coord_1.shape[0]</pre>
<pre id='line218' class='code' style='background-color: #FFFFff'>
  /* "epitopsy/cython/pdb_cython.pyx":218
 *         np.ndarray[DTYPE_float_t, ndim=1] radii_2,
 *         float energy_cutoff):
 *     cdef int n_atoms_1 = coord_1.shape[0]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     cdef int n_atoms_2 = coord_2.shape[0]
 * 
 */
  __pyx_v_n_atoms_1 = (__pyx_v_coord_1->dimensions[0]);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line219")'> 219:     cdef int n_atoms_2 = coord_2.shape[0]</pre>
<pre id='line219' class='code' style='background-color: #FFFFff'>
  /* "epitopsy/cython/pdb_cython.pyx":219
 *         float energy_cutoff):
 *     cdef int n_atoms_1 = coord_1.shape[0]
 *     cdef int n_atoms_2 = coord_2.shape[0]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     cdef float r_1, r_2, r_vdw, division
 */
  __pyx_v_n_atoms_2 = (__pyx_v_coord_2->dimensions[0]);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line220")'> 220: </pre>
<pre id='line220' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line221")'> 221:     cdef float r_1, r_2, r_vdw, division</pre>
<pre id='line221' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line222")'> 222:     cdef float x[3],u[3],dist, energy</pre>
<pre id='line222' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line223")'> 223:     cdef float e_const = 1.</pre>
<pre id='line223' class='code' style='background-color: #FFFFff'>
  /* "epitopsy/cython/pdb_cython.pyx":223
 *     cdef float r_1, r_2, r_vdw, division
 *     cdef float x[3],u[3],dist, energy
 *     cdef float e_const = 1.             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     cdef int i,j,k
 * 
 */
  __pyx_v_e_const = 1.;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line224")'> 224:     cdef int i,j,k</pre>
<pre id='line224' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line225")'> 225: </pre>
<pre id='line225' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line226")'> 226:     cdef int atom_clashes = 0</pre>
<pre id='line226' class='code' style='background-color: #FFFFff'>
  /* "epitopsy/cython/pdb_cython.pyx":226
 *     cdef int i,j,k
 * 
 *     cdef int atom_clashes = 0             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     for i in range(n_atoms_1):
 */
  __pyx_v_atom_clashes = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line227")'> 227: </pre>
<pre id='line227' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line228")'> 228:     for i in range(n_atoms_1):</pre>
<pre id='line228' class='code' style='background-color: #FFFFff'>
  /* "epitopsy/cython/pdb_cython.pyx":228
 *     cdef int atom_clashes = 0
 * 
 *     for i in range(n_atoms_1):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         r_1 = radii_1[i]
 *         for k in range(3):
 */
  __pyx_t_1 = __pyx_v_n_atoms_1;
  for (__pyx_t_2 = 0; __pyx_t_2 <code><</code> __pyx_t_1; __pyx_t_2+=1) {
    __pyx_v_i = __pyx_t_2;
</pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line229")'> 229:         r_1 = radii_1[i]</pre>
<pre id='line229' class='code' style='background-color: #FFFFd4'>
    /* "epitopsy/cython/pdb_cython.pyx":229
 * 
 *     for i in range(n_atoms_1):
 *         r_1 = radii_1[i]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         for k in range(3):
 *             x[k] = coord_1[i,k]
 */
    __pyx_t_3 = __pyx_v_i;
    __pyx_t_4 = -1;
    if (__pyx_t_3 <code><</code> 0) {
      __pyx_t_3 += __pyx_pybuffernd_radii_1.diminfo[0].shape;
      if (unlikely(__pyx_t_3 <code><</code> 0)) __pyx_t_4 = 0;
    } else if (unlikely(__pyx_t_3 >= __pyx_pybuffernd_radii_1.diminfo[0].shape)) __pyx_t_4 = 0;
    if (unlikely(__pyx_t_4 != -1)) {
      <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_4);
     <span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 229; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    }
    __pyx_v_r_1 = (*__Pyx_BufPtrStrided1d(__pyx_t_8epitopsy_6cython_10pdb_cython_DTYPE_float_t *, __pyx_pybuffernd_radii_1.rcbuffer->pybuffer.buf, __pyx_t_3, __pyx_pybuffernd_radii_1.diminfo[0].strides));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line230")'> 230:         for k in range(3):</pre>
<pre id='line230' class='code' style='background-color: #FFFFff'>
    /* "epitopsy/cython/pdb_cython.pyx":230
 *     for i in range(n_atoms_1):
 *         r_1 = radii_1[i]
 *         for k in range(3):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             x[k] = coord_1[i,k]
 *         for j in range(n_atoms_2):
 */
    for (__pyx_t_4 = 0; __pyx_t_4 <code><</code> 3; __pyx_t_4+=1) {
      __pyx_v_k = __pyx_t_4;
</pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line231")'> 231:             x[k] = coord_1[i,k]</pre>
<pre id='line231' class='code' style='background-color: #FFFFd4'>
      /* "epitopsy/cython/pdb_cython.pyx":231
 *         r_1 = radii_1[i]
 *         for k in range(3):
 *             x[k] = coord_1[i,k]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         for j in range(n_atoms_2):
 *             r_2 = radii_2[j]
 */
      __pyx_t_5 = __pyx_v_i;
      __pyx_t_6 = __pyx_v_k;
      __pyx_t_7 = -1;
      if (__pyx_t_5 <code><</code> 0) {
        __pyx_t_5 += __pyx_pybuffernd_coord_1.diminfo[0].shape;
        if (unlikely(__pyx_t_5 <code><</code> 0)) __pyx_t_7 = 0;
      } else if (unlikely(__pyx_t_5 >= __pyx_pybuffernd_coord_1.diminfo[0].shape)) __pyx_t_7 = 0;
      if (__pyx_t_6 <code><</code> 0) {
        __pyx_t_6 += __pyx_pybuffernd_coord_1.diminfo[1].shape;
        if (unlikely(__pyx_t_6 <code><</code> 0)) __pyx_t_7 = 1;
      } else if (unlikely(__pyx_t_6 >= __pyx_pybuffernd_coord_1.diminfo[1].shape)) __pyx_t_7 = 1;
      if (unlikely(__pyx_t_7 != -1)) {
        <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_7);
       <span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 231; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      }
      (__pyx_v_x[__pyx_v_k]) = (*__Pyx_BufPtrStrided2d(__pyx_t_8epitopsy_6cython_10pdb_cython_DTYPE_float_t *, __pyx_pybuffernd_coord_1.rcbuffer->pybuffer.buf, __pyx_t_5, __pyx_pybuffernd_coord_1.diminfo[0].strides, __pyx_t_6, __pyx_pybuffernd_coord_1.diminfo[1].strides));
    }
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line232")'> 232:         for j in range(n_atoms_2):</pre>
<pre id='line232' class='code' style='background-color: #FFFFff'>
    /* "epitopsy/cython/pdb_cython.pyx":232
 *         for k in range(3):
 *             x[k] = coord_1[i,k]
 *         for j in range(n_atoms_2):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             r_2 = radii_2[j]
 *             for k in range(3):
 */
    __pyx_t_4 = __pyx_v_n_atoms_2;
    for (__pyx_t_7 = 0; __pyx_t_7 <code><</code> __pyx_t_4; __pyx_t_7+=1) {
      __pyx_v_j = __pyx_t_7;
</pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line233")'> 233:             r_2 = radii_2[j]</pre>
<pre id='line233' class='code' style='background-color: #FFFFd4'>
      /* "epitopsy/cython/pdb_cython.pyx":233
 *             x[k] = coord_1[i,k]
 *         for j in range(n_atoms_2):
 *             r_2 = radii_2[j]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             for k in range(3):
 *                 u[k] = coord_2[j,k]
 */
      __pyx_t_8 = __pyx_v_j;
      __pyx_t_9 = -1;
      if (__pyx_t_8 <code><</code> 0) {
        __pyx_t_8 += __pyx_pybuffernd_radii_2.diminfo[0].shape;
        if (unlikely(__pyx_t_8 <code><</code> 0)) __pyx_t_9 = 0;
      } else if (unlikely(__pyx_t_8 >= __pyx_pybuffernd_radii_2.diminfo[0].shape)) __pyx_t_9 = 0;
      if (unlikely(__pyx_t_9 != -1)) {
        <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_9);
       <span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 233; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      }
      __pyx_v_r_2 = (*__Pyx_BufPtrStrided1d(__pyx_t_8epitopsy_6cython_10pdb_cython_DTYPE_float_t *, __pyx_pybuffernd_radii_2.rcbuffer->pybuffer.buf, __pyx_t_8, __pyx_pybuffernd_radii_2.diminfo[0].strides));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line234")'> 234:             for k in range(3):</pre>
<pre id='line234' class='code' style='background-color: #FFFFff'>
      /* "epitopsy/cython/pdb_cython.pyx":234
 *         for j in range(n_atoms_2):
 *             r_2 = radii_2[j]
 *             for k in range(3):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                 u[k] = coord_2[j,k]
 * 
 */
      for (__pyx_t_9 = 0; __pyx_t_9 <code><</code> 3; __pyx_t_9+=1) {
        __pyx_v_k = __pyx_t_9;
</pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line235")'> 235:                 u[k] = coord_2[j,k]</pre>
<pre id='line235' class='code' style='background-color: #FFFFd4'>
        /* "epitopsy/cython/pdb_cython.pyx":235
 *             r_2 = radii_2[j]
 *             for k in range(3):
 *                 u[k] = coord_2[j,k]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *             # E = e_const * [ (r_vdw_ij / dist_ij)^12 - 2 * (r_vdw_ij / dist_ij)^6] - 0.008175222784000003 * e
 */
        __pyx_t_10 = __pyx_v_j;
        __pyx_t_11 = __pyx_v_k;
        __pyx_t_12 = -1;
        if (__pyx_t_10 <code><</code> 0) {
          __pyx_t_10 += __pyx_pybuffernd_coord_2.diminfo[0].shape;
          if (unlikely(__pyx_t_10 <code><</code> 0)) __pyx_t_12 = 0;
        } else if (unlikely(__pyx_t_10 >= __pyx_pybuffernd_coord_2.diminfo[0].shape)) __pyx_t_12 = 0;
        if (__pyx_t_11 <code><</code> 0) {
          __pyx_t_11 += __pyx_pybuffernd_coord_2.diminfo[1].shape;
          if (unlikely(__pyx_t_11 <code><</code> 0)) __pyx_t_12 = 1;
        } else if (unlikely(__pyx_t_11 >= __pyx_pybuffernd_coord_2.diminfo[1].shape)) __pyx_t_12 = 1;
        if (unlikely(__pyx_t_12 != -1)) {
          <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_12);
         <span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 235; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        }
        (__pyx_v_u[__pyx_v_k]) = (*__Pyx_BufPtrStrided2d(__pyx_t_8epitopsy_6cython_10pdb_cython_DTYPE_float_t *, __pyx_pybuffernd_coord_2.rcbuffer->pybuffer.buf, __pyx_t_10, __pyx_pybuffernd_coord_2.diminfo[0].strides, __pyx_t_11, __pyx_pybuffernd_coord_2.diminfo[1].strides));
      }
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line236")'> 236: </pre>
<pre id='line236' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line237")'> 237:             # E = e_const * [ (r_vdw_ij / dist_ij)^12 - 2 * (r_vdw_ij / dist_ij)^6] - 0.008175222784000003 * e</pre>
<pre id='line237' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line238")'> 238:             # with r_vdw_ij = (r_i / 2.) + (r_j / 2.)</pre>
<pre id='line238' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line239")'> 239:             # and e_const = 1, but can also be included in each ()^x as</pre>
<pre id='line239' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line240")'> 240:             # e* = sqrt(e_i * e_j)</pre>
<pre id='line240' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line241")'> 241:             # cutoff at r_ij &lt; r_c = 2.5 * r_vdw leads to an</pre>
<pre id='line241' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line242")'> 242:             # additional term for the potential, couse otherwise</pre>
<pre id='line242' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line243")'> 243:             # there would be a jump in the potential</pre>
<pre id='line243' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line244")'> 244:             dist = 0</pre>
<pre id='line244' class='code' style='background-color: #FFFFff'>
      /* "epitopsy/cython/pdb_cython.pyx":244
 *             # additional term for the potential, couse otherwise
 *             # there would be a jump in the potential
 *             dist = 0             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             for k in range(3):
 *                 dist = dist + pow((x[k] - u[k]), 2.)
 */
      __pyx_v_dist = 0.0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line245")'> 245:             for k in range(3):</pre>
<pre id='line245' class='code' style='background-color: #FFFFff'>
      /* "epitopsy/cython/pdb_cython.pyx":245
 *             # there would be a jump in the potential
 *             dist = 0
 *             for k in range(3):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                 dist = dist + pow((x[k] - u[k]), 2.)
 *             dist = sqrt(dist)
 */
      for (__pyx_t_9 = 0; __pyx_t_9 <code><</code> 3; __pyx_t_9+=1) {
        __pyx_v_k = __pyx_t_9;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line246")'> 246:                 dist = dist + pow((x[k] - u[k]), 2.)</pre>
<pre id='line246' class='code' style='background-color: #FFFFff'>
        /* "epitopsy/cython/pdb_cython.pyx":246
 *             dist = 0
 *             for k in range(3):
 *                 dist = dist + pow((x[k] - u[k]), 2.)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             dist = sqrt(dist)
 * 
 */
        __pyx_v_dist = (__pyx_v_dist + pow(((__pyx_v_x[__pyx_v_k]) - (__pyx_v_u[__pyx_v_k])), 2.));
      }
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line247")'> 247:             dist = sqrt(dist)</pre>
<pre id='line247' class='code' style='background-color: #FFFFff'>
      /* "epitopsy/cython/pdb_cython.pyx":247
 *             for k in range(3):
 *                 dist = dist + pow((x[k] - u[k]), 2.)
 *             dist = sqrt(dist)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *             r_vdw = r_1 / 2. + r_2 / 2.
 */
      __pyx_v_dist = sqrt(__pyx_v_dist);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line248")'> 248: </pre>
<pre id='line248' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line249")'> 249:             r_vdw = r_1 / 2. + r_2 / 2.</pre>
<pre id='line249' class='code' style='background-color: #FFFFff'>
      /* "epitopsy/cython/pdb_cython.pyx":249
 *             dist = sqrt(dist)
 * 
 *             r_vdw = r_1 / 2. + r_2 / 2.             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *             if dist == 0.:
 */
      __pyx_v_r_vdw = ((__pyx_v_r_1 / 2.) + (__pyx_v_r_2 / 2.));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line250")'> 250: </pre>
<pre id='line250' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line251")'> 251:             if dist == 0.:</pre>
<pre id='line251' class='code' style='background-color: #FFFFff'>
      /* "epitopsy/cython/pdb_cython.pyx":251
 *             r_vdw = r_1 / 2. + r_2 / 2.
 * 
 *             if dist == 0.:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                 atom_clashes += 1
 *                 break
 */
      __pyx_t_13 = ((__pyx_v_dist == 0.) != 0);
      if (__pyx_t_13) {
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line252")'> 252:                 atom_clashes += 1</pre>
<pre id='line252' class='code' style='background-color: #FFFFff'>
        /* "epitopsy/cython/pdb_cython.pyx":252
 * 
 *             if dist == 0.:
 *                 atom_clashes += 1             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                 break
 *             elif dist > 2.5 * r_vdw:
 */
        __pyx_v_atom_clashes = (__pyx_v_atom_clashes + 1);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line253")'> 253:                 break</pre>
<pre id='line253' class='code' style='background-color: #FFFFff'>
        /* "epitopsy/cython/pdb_cython.pyx":253
 *             if dist == 0.:
 *                 atom_clashes += 1
 *                 break             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             elif dist > 2.5 * r_vdw:
 *                 # we are in the land of the cutoff
 */
        goto __pyx_L8_break;
        goto __pyx_L13;
      }
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line254")'> 254:             elif dist &gt; 2.5 * r_vdw:</pre>
<pre id='line254' class='code' style='background-color: #FFFFff'>
      /* "epitopsy/cython/pdb_cython.pyx":254
 *                 atom_clashes += 1
 *                 break
 *             elif dist > 2.5 * r_vdw:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                 # we are in the land of the cutoff
 *                 continue
 */
      __pyx_t_13 = ((__pyx_v_dist > (2.5 * __pyx_v_r_vdw)) != 0);
      if (__pyx_t_13) {
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line255")'> 255:                 # we are in the land of the cutoff</pre>
<pre id='line255' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line256")'> 256:                 continue</pre>
<pre id='line256' class='code' style='background-color: #FFFFff'>
        /* "epitopsy/cython/pdb_cython.pyx":256
 *             elif dist > 2.5 * r_vdw:
 *                 # we are in the land of the cutoff
 *                 continue             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             else:
 *                 division = r_vdw / dist
 */
        goto __pyx_L7_continue;
        goto __pyx_L13;
      }
      /*else*/ {
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line257")'> 257:             else:</pre>
<pre id='line257' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFaa' onclick='toggleDiv("line258")'> 258:                 division = r_vdw / dist</pre>
<pre id='line258' class='code' style='background-color: #FFFFaa'>
        /* "epitopsy/cython/pdb_cython.pyx":258
 *                 continue
 *             else:
 *                 division = r_vdw / dist             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                 energy = e_const * (pow(division, 12.) - 2. * pow(division, 6.)) - 0.008175222784000003 * e_const
 *                 if energy > energy_cutoff:
 */
        if (unlikely(__pyx_v_dist == 0)) {
          #ifdef WITH_THREAD
          PyGILState_STATE __pyx_gilstate_save = PyGILState_Ensure();
          #endif
          <span class='py_c_api'>PyErr_Format</span>(PyExc_ZeroDivisionError, "float division");
          #ifdef WITH_THREAD
          PyGILState_Release(__pyx_gilstate_save);
          #endif
         <span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 258; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        }
        __pyx_v_division = (__pyx_v_r_vdw / __pyx_v_dist);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line259")'> 259:                 energy = e_const * (pow(division, 12.) - 2. * pow(division, 6.)) - 0.008175222784000003 * e_const</pre>
<pre id='line259' class='code' style='background-color: #FFFFff'>
        /* "epitopsy/cython/pdb_cython.pyx":259
 *             else:
 *                 division = r_vdw / dist
 *                 energy = e_const * (pow(division, 12.) - 2. * pow(division, 6.)) - 0.008175222784000003 * e_const             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                 if energy > energy_cutoff:
 *                     atom_clashes += 1
 */
        __pyx_v_energy = ((__pyx_v_e_const * (pow(__pyx_v_division, 12.) - (2. * pow(__pyx_v_division, 6.)))) - (0.008175222784000003 * __pyx_v_e_const));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line260")'> 260:                 if energy &gt; energy_cutoff:</pre>
<pre id='line260' class='code' style='background-color: #FFFFff'>
        /* "epitopsy/cython/pdb_cython.pyx":260
 *                 division = r_vdw / dist
 *                 energy = e_const * (pow(division, 12.) - 2. * pow(division, 6.)) - 0.008175222784000003 * e_const
 *                 if energy > energy_cutoff:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                     atom_clashes += 1
 *                     break
 */
        __pyx_t_13 = ((__pyx_v_energy > __pyx_v_energy_cutoff) != 0);
        if (__pyx_t_13) {
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line261")'> 261:                     atom_clashes += 1</pre>
<pre id='line261' class='code' style='background-color: #FFFFff'>
          /* "epitopsy/cython/pdb_cython.pyx":261
 *                 energy = e_const * (pow(division, 12.) - 2. * pow(division, 6.)) - 0.008175222784000003 * e_const
 *                 if energy > energy_cutoff:
 *                     atom_clashes += 1             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                     break
 * 
 */
          __pyx_v_atom_clashes = (__pyx_v_atom_clashes + 1);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line262")'> 262:                     break</pre>
<pre id='line262' class='code' style='background-color: #FFFFff'>
          /* "epitopsy/cython/pdb_cython.pyx":262
 *                 if energy > energy_cutoff:
 *                     atom_clashes += 1
 *                     break             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     return atom_clashes
 */
          goto __pyx_L8_break;
          goto __pyx_L14;
        }
        __pyx_L14:;
      }
      __pyx_L13:;
      __pyx_L7_continue:;
    }
    __pyx_L8_break:;
  }
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line263")'> 263: </pre>
<pre id='line263' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF4b' onclick='toggleDiv("line264")'> 264:     return atom_clashes</pre>
<pre id='line264' class='code' style='background-color: #FFFF4b'>
  /* "epitopsy/cython/pdb_cython.pyx":264
 *                     break
 * 
 *     return atom_clashes             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 */
  __pyx_r = __pyx_v_atom_clashes;
  goto __pyx_L0;

  __pyx_r = 0;
  goto __pyx_L0;
  __pyx_L1_error:;
  { PyObject *__pyx_type, *__pyx_value, *__pyx_tb;
    <span class='pyx_c_api'>__Pyx_ErrFetch</span>(&__pyx_type, &__pyx_value, &__pyx_tb);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&__pyx_pybuffernd_coord_1.rcbuffer->pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&__pyx_pybuffernd_coord_2.rcbuffer->pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&__pyx_pybuffernd_radii_1.rcbuffer->pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&__pyx_pybuffernd_radii_2.rcbuffer->pybuffer);
  <span class='pyx_c_api'>__Pyx_ErrRestore</span>(__pyx_type, __pyx_value, __pyx_tb);}
  <span class='pyx_c_api'>__Pyx_WriteUnraisable</span>("epitopsy.cython.pdb_cython._find_clashing_atoms", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = 0;
  goto __pyx_L2;
  __pyx_L0:;
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&__pyx_pybuffernd_coord_1.rcbuffer->pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&__pyx_pybuffernd_coord_2.rcbuffer->pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&__pyx_pybuffernd_radii_1.rcbuffer->pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&__pyx_pybuffernd_radii_2.rcbuffer->pybuffer);
  __pyx_L2:;
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}

/* Python wrapper */
static CYTHON_UNUSED int __pyx_pw_5numpy_7ndarray_1__getbuffer__(PyObject *__pyx_v_self, Py_buffer *__pyx_v_info, int __pyx_v_flags); /*proto*/
static CYTHON_UNUSED int __pyx_pw_5numpy_7ndarray_1__getbuffer__(PyObject *__pyx_v_self, Py_buffer *__pyx_v_info, int __pyx_v_flags) {
  int __pyx_r;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("__getbuffer__ (wrapper)", 0);
  __pyx_r = __pyx_pf_5numpy_7ndarray___getbuffer__(((PyArrayObject *)__pyx_v_self), ((Py_buffer *)__pyx_v_info), ((int)__pyx_v_flags));
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line265")'> 265: </pre>
<pre id='line265' class='code' style='background-color: #FFFFff'></pre></body></html>

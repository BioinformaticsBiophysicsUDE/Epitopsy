<!-- Generated by Cython 0.19.1 on Wed Dec 11 17:16:22 2013 -->
<html>

<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<style type="text/css">

body { font-family: courier; font-size: 12; }

.code  { font-size: 9; color: #444444; display: none; margin-left: 20px; }
.py_c_api  { color: red; }
.py_macro_api  { color: #FF7000; }
.pyx_c_api  { color: #FF3000; }
.pyx_macro_api  { color: #FF7000; }
.refnanny  { color: #FFA000; }

.error_goto  { color: #FFA000; }

.tag  {  }

.coerce  { color: #008000; border: 1px dotted #008000 }

.py_attr { color: #FF0000; font-weight: bold; }
.c_attr  { color: #0000FF; }

.py_call { color: #FF0000; font-weight: bold; }
.c_call  { color: #0000FF; }

.line { margin: 0em }

</style>
<script>
function toggleDiv(id) {
    theDiv = document.getElementById(id);
    if (theDiv.style.display == 'none') theDiv.style.display = 'block';
    else theDiv.style.display = 'none';
}
</script>
</head>
        <body>
<p>Generated by Cython 0.19.1 on Wed Dec 11 17:16:22 2013
<p>Raw output: <a href="CalculateInteractionEnergyCython.c">CalculateInteractionEnergyCython.c</a>
<pre class='line' style='background-color: #FFFF79' onclick='toggleDiv("line1")'> 1: """</pre>
<pre id='line1' class='code' style='background-color: #FFFF79'>
  /* "epitopsy/cython/CalculateInteractionEnergyCython.pyx":1
 * """             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * @author: Christoph Wilms
 * """
 */
  __pyx_t_2 = <span class='py_c_api'>PyDict_New</span>();<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(((PyObject *)__pyx_t_2));
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s____test__, ((PyObject *)__pyx_t_2)) <code><</code> 0)<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_2)); __pyx_t_2 = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2")'> 2: @author: Christoph Wilms</pre>
<pre id='line2' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line3")'> 3: """</pre>
<pre id='line3' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF62' onclick='toggleDiv("line4")'> 4: import sys, time</pre>
<pre id='line4' class='code' style='background-color: #FFFF62'>
  /* "epitopsy/cython/CalculateInteractionEnergyCython.pyx":4
 * @author: Christoph Wilms
 * """
 * import sys, time             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * import numpy as np
 * 
 */
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_Import</span>(((PyObject *)__pyx_n_s__sys), 0, -1);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 4; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s__sys, __pyx_t_1) <code><</code> 0)<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 4; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_Import</span>(((PyObject *)__pyx_n_s__time), 0, -1);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 4; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s__time, __pyx_t_1) <code><</code> 0)<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 4; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
</pre><pre class='line' style='background-color: #FFFF8d' onclick='toggleDiv("line5")'> 5: import numpy as np</pre>
<pre id='line5' class='code' style='background-color: #FFFF8d'>
  /* "epitopsy/cython/CalculateInteractionEnergyCython.pyx":5
 * """
 * import sys, time
 * import numpy as np             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * # "cimport" is used to import special compile-time information
 */
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_Import</span>(((PyObject *)__pyx_n_s__numpy), 0, -1);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 5; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s__np, __pyx_t_1) <code><</code> 0)<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 5; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line6")'> 6: </pre>
<pre id='line6' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line7")'> 7: # "cimport" is used to import special compile-time information</pre>
<pre id='line7' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line8")'> 8: # about the numpy module (this is stored in a file numpy.pxd which is</pre>
<pre id='line8' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line9")'> 9: # currently part of the Cython distribution).</pre>
<pre id='line9' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line10")'> 10: cimport numpy as np</pre>
<pre id='line10' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line11")'> 11: cimport cython</pre>
<pre id='line11' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line12")'> 12: </pre>
<pre id='line12' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line13")'> 13: from cython.parallel import prange, parallel</pre>
<pre id='line13' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line14")'> 14: from cpython cimport bool</pre>
<pre id='line14' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line15")'> 15: </pre>
<pre id='line15' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line16")'> 16: from libc.math cimport abs as abs_c, exp, round, sqrt, floor</pre>
<pre id='line16' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line17")'> 17: </pre>
<pre id='line17' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line18")'> 18: from numpy cimport NPY_INT8 as NPY_int8</pre>
<pre id='line18' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line19")'> 19: from numpy cimport NPY_INT16 as NPY_int16</pre>
<pre id='line19' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line20")'> 20: from numpy cimport NPY_INT32 as NPY_int32</pre>
<pre id='line20' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line21")'> 21: from numpy cimport NPY_INT64 as NPY_int64</pre>
<pre id='line21' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line22")'> 22: from numpy cimport NPY_FLOAT16 as NPY_float16</pre>
<pre id='line22' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line23")'> 23: from numpy cimport NPY_FLOAT32 as NPY_float32</pre>
<pre id='line23' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line24")'> 24: from numpy cimport NPY_FLOAT64 as NPY_float64</pre>
<pre id='line24' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line25")'> 25: </pre>
<pre id='line25' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF46' onclick='toggleDiv("line26")'> 26: int8 = np.dtype(np.int8)</pre>
<pre id='line26' class='code' style='background-color: #FFFF46'>
  /* "epitopsy/cython/CalculateInteractionEnergyCython.pyx":26
 * from numpy cimport NPY_FLOAT64 as NPY_float64
 * 
 * int8 = np.dtype(np.int8)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * int16 = np.dtype(np.int16)
 * int32 = np.dtype(np.int32)
 */
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s__np);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 26; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  __pyx_t_2 = __Pyx_<span class='py_c_api'>PyObject_GetAttrStr</span>(__pyx_t_1, __pyx_n_s__int8);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 26; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 26; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 0, __pyx_t_2);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_t_2);
  __pyx_t_2 = 0;
  __pyx_t_2 = <span class='py_c_api'>PyObject_Call</span>(((PyObject *)((PyObject*)__pyx_ptype_5numpy_dtype)), ((PyObject *)__pyx_t_1), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 26; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s__int8, __pyx_t_2) <code><</code> 0)<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 26; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
</pre><pre class='line' style='background-color: #FFFF46' onclick='toggleDiv("line27")'> 27: int16 = np.dtype(np.int16)</pre>
<pre id='line27' class='code' style='background-color: #FFFF46'>
  /* "epitopsy/cython/CalculateInteractionEnergyCython.pyx":27
 * 
 * int8 = np.dtype(np.int8)
 * int16 = np.dtype(np.int16)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * int32 = np.dtype(np.int32)
 * int64 = np.dtype(np.int64)
 */
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s__np);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 27; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  __pyx_t_1 = __Pyx_<span class='py_c_api'>PyObject_GetAttrStr</span>(__pyx_t_2, __pyx_n_s__int16);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 27; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 27; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_2, 0, __pyx_t_1);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_t_1);
  __pyx_t_1 = 0;
  __pyx_t_1 = <span class='py_c_api'>PyObject_Call</span>(((PyObject *)((PyObject*)__pyx_ptype_5numpy_dtype)), ((PyObject *)__pyx_t_2), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 27; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_2)); __pyx_t_2 = 0;
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s__int16, __pyx_t_1) <code><</code> 0)<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 27; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
</pre><pre class='line' style='background-color: #FFFF46' onclick='toggleDiv("line28")'> 28: int32 = np.dtype(np.int32)</pre>
<pre id='line28' class='code' style='background-color: #FFFF46'>
  /* "epitopsy/cython/CalculateInteractionEnergyCython.pyx":28
 * int8 = np.dtype(np.int8)
 * int16 = np.dtype(np.int16)
 * int32 = np.dtype(np.int32)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * int64 = np.dtype(np.int64)
 * float16 = np.dtype(np.float16)
 */
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s__np);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 28; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  __pyx_t_2 = __Pyx_<span class='py_c_api'>PyObject_GetAttrStr</span>(__pyx_t_1, __pyx_n_s__int32);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 28; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 28; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 0, __pyx_t_2);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_t_2);
  __pyx_t_2 = 0;
  __pyx_t_2 = <span class='py_c_api'>PyObject_Call</span>(((PyObject *)((PyObject*)__pyx_ptype_5numpy_dtype)), ((PyObject *)__pyx_t_1), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 28; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s__int32, __pyx_t_2) <code><</code> 0)<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 28; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
</pre><pre class='line' style='background-color: #FFFF46' onclick='toggleDiv("line29")'> 29: int64 = np.dtype(np.int64)</pre>
<pre id='line29' class='code' style='background-color: #FFFF46'>
  /* "epitopsy/cython/CalculateInteractionEnergyCython.pyx":29
 * int16 = np.dtype(np.int16)
 * int32 = np.dtype(np.int32)
 * int64 = np.dtype(np.int64)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * float16 = np.dtype(np.float16)
 * float32 = np.dtype(np.float32)
 */
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s__np);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 29; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  __pyx_t_1 = __Pyx_<span class='py_c_api'>PyObject_GetAttrStr</span>(__pyx_t_2, __pyx_n_s__int64);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 29; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 29; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_2, 0, __pyx_t_1);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_t_1);
  __pyx_t_1 = 0;
  __pyx_t_1 = <span class='py_c_api'>PyObject_Call</span>(((PyObject *)((PyObject*)__pyx_ptype_5numpy_dtype)), ((PyObject *)__pyx_t_2), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 29; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_2)); __pyx_t_2 = 0;
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s__int64, __pyx_t_1) <code><</code> 0)<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 29; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
</pre><pre class='line' style='background-color: #FFFF46' onclick='toggleDiv("line30")'> 30: float16 = np.dtype(np.float16)</pre>
<pre id='line30' class='code' style='background-color: #FFFF46'>
  /* "epitopsy/cython/CalculateInteractionEnergyCython.pyx":30
 * int32 = np.dtype(np.int32)
 * int64 = np.dtype(np.int64)
 * float16 = np.dtype(np.float16)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * float32 = np.dtype(np.float32)
 * float64 = np.dtype(np.float64)
 */
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s__np);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 30; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  __pyx_t_2 = __Pyx_<span class='py_c_api'>PyObject_GetAttrStr</span>(__pyx_t_1, __pyx_n_s__float16);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 30; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 30; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 0, __pyx_t_2);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_t_2);
  __pyx_t_2 = 0;
  __pyx_t_2 = <span class='py_c_api'>PyObject_Call</span>(((PyObject *)((PyObject*)__pyx_ptype_5numpy_dtype)), ((PyObject *)__pyx_t_1), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 30; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s__float16, __pyx_t_2) <code><</code> 0)<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 30; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
</pre><pre class='line' style='background-color: #FFFF46' onclick='toggleDiv("line31")'> 31: float32 = np.dtype(np.float32)</pre>
<pre id='line31' class='code' style='background-color: #FFFF46'>
  /* "epitopsy/cython/CalculateInteractionEnergyCython.pyx":31
 * int64 = np.dtype(np.int64)
 * float16 = np.dtype(np.float16)
 * float32 = np.dtype(np.float32)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * float64 = np.dtype(np.float64)
 * 
 */
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s__np);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 31; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  __pyx_t_1 = __Pyx_<span class='py_c_api'>PyObject_GetAttrStr</span>(__pyx_t_2, __pyx_n_s__float32);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 31; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 31; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_2, 0, __pyx_t_1);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_t_1);
  __pyx_t_1 = 0;
  __pyx_t_1 = <span class='py_c_api'>PyObject_Call</span>(((PyObject *)((PyObject*)__pyx_ptype_5numpy_dtype)), ((PyObject *)__pyx_t_2), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 31; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_2)); __pyx_t_2 = 0;
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s__float32, __pyx_t_1) <code><</code> 0)<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 31; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
</pre><pre class='line' style='background-color: #FFFF46' onclick='toggleDiv("line32")'> 32: float64 = np.dtype(np.float64)</pre>
<pre id='line32' class='code' style='background-color: #FFFF46'>
  /* "epitopsy/cython/CalculateInteractionEnergyCython.pyx":32
 * float16 = np.dtype(np.float16)
 * float32 = np.dtype(np.float32)
 * float64 = np.dtype(np.float64)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * @cython.boundscheck(False)
 */
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s__np);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 32; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  __pyx_t_2 = __Pyx_<span class='py_c_api'>PyObject_GetAttrStr</span>(__pyx_t_1, __pyx_n_s__float64);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 32; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 32; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 0, __pyx_t_2);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_t_2);
  __pyx_t_2 = 0;
  __pyx_t_2 = <span class='py_c_api'>PyObject_Call</span>(((PyObject *)((PyObject*)__pyx_ptype_5numpy_dtype)), ((PyObject *)__pyx_t_1), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 32; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s__float64, __pyx_t_2) <code><</code> 0)<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 32; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line33")'> 33: </pre>
<pre id='line33' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line34")'> 34: @cython.boundscheck(False)</pre>
<pre id='line34' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF8d' onclick='toggleDiv("line35")'> 35: cdef tuple _count_rotations(np.ndarray[np.float64_t, ndim=3] esp_correlation_np,</pre>
<pre id='line35' class='code' style='background-color: #FFFF8d'>
/* "epitopsy/cython/CalculateInteractionEnergyCython.pyx":35
 * 
 * @cython.boundscheck(False)
 * cdef tuple _count_rotations(np.ndarray[np.float64_t, ndim=3] esp_correlation_np,             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         np.ndarray[np.float64_t, ndim=3] shape_correlation_np,
 *         np.ndarray[np.float64_t, ndim=3] counter_matrix_np,
 */

static PyObject *__pyx_f_8epitopsy_6cython_32CalculateInteractionEnergyCython__count_rotations(PyArrayObject *__pyx_v_esp_correlation_np, PyArrayObject *__pyx_v_shape_correlation_np, PyArrayObject *__pyx_v_counter_matrix_np, PyArrayObject *__pyx_v_interaction_energy_np, float __pyx_v_shape_correlation_cutoff) {
  __Pyx_memviewslice __pyx_v_shape_correlation = { 0, 0, { 0 }, { 0 }, { 0 } };
  __Pyx_memviewslice __pyx_v_esp_correlation = { 0, 0, { 0 }, { 0 }, { 0 } };
  __Pyx_memviewslice __pyx_v_counter_matrix = { 0, 0, { 0 }, { 0 }, { 0 } };
  __Pyx_memviewslice __pyx_v_interaction_energy = { 0, 0, { 0 }, { 0 }, { 0 } };
  int __pyx_v_x;
  int __pyx_v_y;
  int __pyx_v_z;
  float __pyx_v_counter_add;
  int __pyx_v_xdim;
  int __pyx_v_ydim;
  int __pyx_v_zdim;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_counter_matrix_np;
  __Pyx_Buffer __pyx_pybuffer_counter_matrix_np;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_esp_correlation_np;
  __Pyx_Buffer __pyx_pybuffer_esp_correlation_np;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_interaction_energy_np;
  __Pyx_Buffer __pyx_pybuffer_interaction_energy_np;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_shape_correlation_np;
  __Pyx_Buffer __pyx_pybuffer_shape_correlation_np;
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_count_rotations", 0);
  __pyx_pybuffer_esp_correlation_np.pybuffer.buf = NULL;
  __pyx_pybuffer_esp_correlation_np.refcount = 0;
  __pyx_pybuffernd_esp_correlation_np.data = NULL;
  __pyx_pybuffernd_esp_correlation_np.rcbuffer = &__pyx_pybuffer_esp_correlation_np;
  __pyx_pybuffer_shape_correlation_np.pybuffer.buf = NULL;
  __pyx_pybuffer_shape_correlation_np.refcount = 0;
  __pyx_pybuffernd_shape_correlation_np.data = NULL;
  __pyx_pybuffernd_shape_correlation_np.rcbuffer = &__pyx_pybuffer_shape_correlation_np;
  __pyx_pybuffer_counter_matrix_np.pybuffer.buf = NULL;
  __pyx_pybuffer_counter_matrix_np.refcount = 0;
  __pyx_pybuffernd_counter_matrix_np.data = NULL;
  __pyx_pybuffernd_counter_matrix_np.rcbuffer = &__pyx_pybuffer_counter_matrix_np;
  __pyx_pybuffer_interaction_energy_np.pybuffer.buf = NULL;
  __pyx_pybuffer_interaction_energy_np.refcount = 0;
  __pyx_pybuffernd_interaction_energy_np.data = NULL;
  __pyx_pybuffernd_interaction_energy_np.rcbuffer = &__pyx_pybuffer_interaction_energy_np;
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&__pyx_pybuffernd_esp_correlation_np.rcbuffer->pybuffer, (PyObject*)__pyx_v_esp_correlation_np, &__Pyx_TypeInfo_nn___pyx_t_5numpy_float64_t, PyBUF_FORMAT| PyBUF_STRIDES, 3, 0, __pyx_stack) == -1))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 35; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  }
  __pyx_pybuffernd_esp_correlation_np.diminfo[0].strides = __pyx_pybuffernd_esp_correlation_np.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_esp_correlation_np.diminfo[0].shape = __pyx_pybuffernd_esp_correlation_np.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_esp_correlation_np.diminfo[1].strides = __pyx_pybuffernd_esp_correlation_np.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_esp_correlation_np.diminfo[1].shape = __pyx_pybuffernd_esp_correlation_np.rcbuffer->pybuffer.shape[1]; __pyx_pybuffernd_esp_correlation_np.diminfo[2].strides = __pyx_pybuffernd_esp_correlation_np.rcbuffer->pybuffer.strides[2]; __pyx_pybuffernd_esp_correlation_np.diminfo[2].shape = __pyx_pybuffernd_esp_correlation_np.rcbuffer->pybuffer.shape[2];
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&__pyx_pybuffernd_shape_correlation_np.rcbuffer->pybuffer, (PyObject*)__pyx_v_shape_correlation_np, &__Pyx_TypeInfo_nn___pyx_t_5numpy_float64_t, PyBUF_FORMAT| PyBUF_STRIDES, 3, 0, __pyx_stack) == -1))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 35; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  }
  __pyx_pybuffernd_shape_correlation_np.diminfo[0].strides = __pyx_pybuffernd_shape_correlation_np.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_shape_correlation_np.diminfo[0].shape = __pyx_pybuffernd_shape_correlation_np.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_shape_correlation_np.diminfo[1].strides = __pyx_pybuffernd_shape_correlation_np.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_shape_correlation_np.diminfo[1].shape = __pyx_pybuffernd_shape_correlation_np.rcbuffer->pybuffer.shape[1]; __pyx_pybuffernd_shape_correlation_np.diminfo[2].strides = __pyx_pybuffernd_shape_correlation_np.rcbuffer->pybuffer.strides[2]; __pyx_pybuffernd_shape_correlation_np.diminfo[2].shape = __pyx_pybuffernd_shape_correlation_np.rcbuffer->pybuffer.shape[2];
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&__pyx_pybuffernd_counter_matrix_np.rcbuffer->pybuffer, (PyObject*)__pyx_v_counter_matrix_np, &__Pyx_TypeInfo_nn___pyx_t_5numpy_float64_t, PyBUF_FORMAT| PyBUF_STRIDES, 3, 0, __pyx_stack) == -1))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 35; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  }
  __pyx_pybuffernd_counter_matrix_np.diminfo[0].strides = __pyx_pybuffernd_counter_matrix_np.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_counter_matrix_np.diminfo[0].shape = __pyx_pybuffernd_counter_matrix_np.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_counter_matrix_np.diminfo[1].strides = __pyx_pybuffernd_counter_matrix_np.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_counter_matrix_np.diminfo[1].shape = __pyx_pybuffernd_counter_matrix_np.rcbuffer->pybuffer.shape[1]; __pyx_pybuffernd_counter_matrix_np.diminfo[2].strides = __pyx_pybuffernd_counter_matrix_np.rcbuffer->pybuffer.strides[2]; __pyx_pybuffernd_counter_matrix_np.diminfo[2].shape = __pyx_pybuffernd_counter_matrix_np.rcbuffer->pybuffer.shape[2];
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&__pyx_pybuffernd_interaction_energy_np.rcbuffer->pybuffer, (PyObject*)__pyx_v_interaction_energy_np, &__Pyx_TypeInfo_nn___pyx_t_5numpy_float64_t, PyBUF_FORMAT| PyBUF_STRIDES, 3, 0, __pyx_stack) == -1))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 35; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  }
  __pyx_pybuffernd_interaction_energy_np.diminfo[0].strides = __pyx_pybuffernd_interaction_energy_np.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_interaction_energy_np.diminfo[0].shape = __pyx_pybuffernd_interaction_energy_np.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_interaction_energy_np.diminfo[1].strides = __pyx_pybuffernd_interaction_energy_np.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_interaction_energy_np.diminfo[1].shape = __pyx_pybuffernd_interaction_energy_np.rcbuffer->pybuffer.shape[1]; __pyx_pybuffernd_interaction_energy_np.diminfo[2].strides = __pyx_pybuffernd_interaction_energy_np.rcbuffer->pybuffer.strides[2]; __pyx_pybuffernd_interaction_energy_np.diminfo[2].shape = __pyx_pybuffernd_interaction_energy_np.rcbuffer->pybuffer.shape[2];
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line36")'> 36:         np.ndarray[np.float64_t, ndim=3] shape_correlation_np,</pre>
<pre id='line36' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line37")'> 37:         np.ndarray[np.float64_t, ndim=3] counter_matrix_np,</pre>
<pre id='line37' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line38")'> 38:         np.ndarray[np.float64_t, ndim=3] interaction_energy_np,</pre>
<pre id='line38' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line39")'> 39:         float shape_correlation_cutoff):</pre>
<pre id='line39' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line40")'> 40:     cdef double[:,:,:] shape_correlation = shape_correlation_np</pre>
<pre id='line40' class='code' style='background-color: #FFFFd4'>
  /* "epitopsy/cython/CalculateInteractionEnergyCython.pyx":40
 *         np.ndarray[np.float64_t, ndim=3] interaction_energy_np,
 *         float shape_correlation_cutoff):
 *     cdef double[:,:,:] shape_correlation = shape_correlation_np             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     cdef double[:,:,:] esp_correlation = esp_correlation_np
 *     cdef double[:,:,:] counter_matrix = counter_matrix_np
 */
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_dsdsds_double</span>(((PyObject *)__pyx_v_shape_correlation_np));
  if (unlikely(!__pyx_t_1.memview))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 40; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_v_shape_correlation = __pyx_t_1;
  __pyx_t_1.memview = NULL;
  __pyx_t_1.data = NULL;
</pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line41")'> 41:     cdef double[:,:,:] esp_correlation = esp_correlation_np</pre>
<pre id='line41' class='code' style='background-color: #FFFFd4'>
  /* "epitopsy/cython/CalculateInteractionEnergyCython.pyx":41
 *         float shape_correlation_cutoff):
 *     cdef double[:,:,:] shape_correlation = shape_correlation_np
 *     cdef double[:,:,:] esp_correlation = esp_correlation_np             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     cdef double[:,:,:] counter_matrix = counter_matrix_np
 *     cdef double[:,:,:] interaction_energy = interaction_energy_np,
 */
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_dsdsds_double</span>(((PyObject *)__pyx_v_esp_correlation_np));
  if (unlikely(!__pyx_t_2.memview))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 41; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_v_esp_correlation = __pyx_t_2;
  __pyx_t_2.memview = NULL;
  __pyx_t_2.data = NULL;
</pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line42")'> 42:     cdef double[:,:,:] counter_matrix = counter_matrix_np</pre>
<pre id='line42' class='code' style='background-color: #FFFFd4'>
  /* "epitopsy/cython/CalculateInteractionEnergyCython.pyx":42
 *     cdef double[:,:,:] shape_correlation = shape_correlation_np
 *     cdef double[:,:,:] esp_correlation = esp_correlation_np
 *     cdef double[:,:,:] counter_matrix = counter_matrix_np             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     cdef double[:,:,:] interaction_energy = interaction_energy_np,
 *     cdef int x,y,z
 */
  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_dsdsds_double</span>(((PyObject *)__pyx_v_counter_matrix_np));
  if (unlikely(!__pyx_t_3.memview))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 42; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_v_counter_matrix = __pyx_t_3;
  __pyx_t_3.memview = NULL;
  __pyx_t_3.data = NULL;
</pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line43")'> 43:     cdef double[:,:,:] interaction_energy = interaction_energy_np,</pre>
<pre id='line43' class='code' style='background-color: #FFFFd4'>
  /* "epitopsy/cython/CalculateInteractionEnergyCython.pyx":43
 *     cdef double[:,:,:] esp_correlation = esp_correlation_np
 *     cdef double[:,:,:] counter_matrix = counter_matrix_np
 *     cdef double[:,:,:] interaction_energy = interaction_energy_np,             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     cdef int x,y,z
 *     cdef float counter_add = 1.
 */
  __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_dsdsds_double</span>(((PyObject *)__pyx_v_interaction_energy_np));
  if (unlikely(!__pyx_t_4.memview))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 43; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_v_interaction_energy = __pyx_t_4;
  __pyx_t_4.memview = NULL;
  __pyx_t_4.data = NULL;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line44")'> 44:     cdef int x,y,z</pre>
<pre id='line44' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line45")'> 45:     cdef float counter_add = 1.</pre>
<pre id='line45' class='code' style='background-color: #FFFFff'>
  /* "epitopsy/cython/CalculateInteractionEnergyCython.pyx":45
 *     cdef double[:,:,:] interaction_energy = interaction_energy_np,
 *     cdef int x,y,z
 *     cdef float counter_add = 1.             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     cdef int xdim = shape_correlation.shape[0]
 *     cdef int ydim = shape_correlation.shape[1]
 */
  __pyx_v_counter_add = 1.;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line46")'> 46:     cdef int xdim = shape_correlation.shape[0]</pre>
<pre id='line46' class='code' style='background-color: #FFFFff'>
  /* "epitopsy/cython/CalculateInteractionEnergyCython.pyx":46
 *     cdef int x,y,z
 *     cdef float counter_add = 1.
 *     cdef int xdim = shape_correlation.shape[0]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     cdef int ydim = shape_correlation.shape[1]
 *     cdef int zdim = shape_correlation.shape[2]
 */
  __pyx_v_xdim = (__pyx_v_shape_correlation.shape[0]);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line47")'> 47:     cdef int ydim = shape_correlation.shape[1]</pre>
<pre id='line47' class='code' style='background-color: #FFFFff'>
  /* "epitopsy/cython/CalculateInteractionEnergyCython.pyx":47
 *     cdef float counter_add = 1.
 *     cdef int xdim = shape_correlation.shape[0]
 *     cdef int ydim = shape_correlation.shape[1]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     cdef int zdim = shape_correlation.shape[2]
 * 
 */
  __pyx_v_ydim = (__pyx_v_shape_correlation.shape[1]);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line48")'> 48:     cdef int zdim = shape_correlation.shape[2]</pre>
<pre id='line48' class='code' style='background-color: #FFFFff'>
  /* "epitopsy/cython/CalculateInteractionEnergyCython.pyx":48
 *     cdef int xdim = shape_correlation.shape[0]
 *     cdef int ydim = shape_correlation.shape[1]
 *     cdef int zdim = shape_correlation.shape[2]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     for x in range(xdim):
 */
  __pyx_v_zdim = (__pyx_v_shape_correlation.shape[2]);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line49")'> 49: </pre>
<pre id='line49' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line50")'> 50:     for x in range(xdim):</pre>
<pre id='line50' class='code' style='background-color: #FFFFff'>
  /* "epitopsy/cython/CalculateInteractionEnergyCython.pyx":50
 *     cdef int zdim = shape_correlation.shape[2]
 * 
 *     for x in range(xdim):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         for y in range(ydim):
 *             for z in range(zdim):
 */
  __pyx_t_5 = __pyx_v_xdim;
  for (__pyx_t_6 = 0; __pyx_t_6 <code><</code> __pyx_t_5; __pyx_t_6+=1) {
    __pyx_v_x = __pyx_t_6;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line51")'> 51:         for y in range(ydim):</pre>
<pre id='line51' class='code' style='background-color: #FFFFff'>
    /* "epitopsy/cython/CalculateInteractionEnergyCython.pyx":51
 * 
 *     for x in range(xdim):
 *         for y in range(ydim):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             for z in range(zdim):
 *                 # use absolute value of shape_corellation, so that it is
 */
    __pyx_t_7 = __pyx_v_ydim;
    for (__pyx_t_8 = 0; __pyx_t_8 <code><</code> __pyx_t_7; __pyx_t_8+=1) {
      __pyx_v_y = __pyx_t_8;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line52")'> 52:             for z in range(zdim):</pre>
<pre id='line52' class='code' style='background-color: #FFFFff'>
      /* "epitopsy/cython/CalculateInteractionEnergyCython.pyx":52
 *     for x in range(xdim):
 *         for y in range(ydim):
 *             for z in range(zdim):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                 # use absolute value of shape_corellation, so that it is
 *                 # in the
 */
      __pyx_t_9 = __pyx_v_zdim;
      for (__pyx_t_10 = 0; __pyx_t_10 <code><</code> __pyx_t_9; __pyx_t_10+=1) {
        __pyx_v_z = __pyx_t_10;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line53")'> 53:                 # use absolute value of shape_corellation, so that it is</pre>
<pre id='line53' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line54")'> 54:                 # in the</pre>
<pre id='line54' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line55")'> 55:                 # range(-shape_correlation_cutoff, shape_correlation_cutoff)</pre>
<pre id='line55' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line56")'> 56:                 if abs_c(shape_correlation[x,y,z]) &lt; shape_correlation_cutoff:</pre>
<pre id='line56' class='code' style='background-color: #FFFFff'>
        /* "epitopsy/cython/CalculateInteractionEnergyCython.pyx":56
 *                 # in the
 *                 # range(-shape_correlation_cutoff, shape_correlation_cutoff)
 *                 if abs_c(shape_correlation[x,y,z]) <code><</code> shape_correlation_cutoff:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                     # increase counter_matrix at the current position
 *                     counter_matrix[x, y, z] = counter_matrix[x, y, z] + counter_add
 */
        __pyx_t_11 = __pyx_v_x;
        __pyx_t_12 = __pyx_v_y;
        __pyx_t_13 = __pyx_v_z;
        if (__pyx_t_11 <code><</code> 0) __pyx_t_11 += __pyx_v_shape_correlation.shape[0];
        if (__pyx_t_12 <code><</code> 0) __pyx_t_12 += __pyx_v_shape_correlation.shape[1];
        if (__pyx_t_13 <code><</code> 0) __pyx_t_13 += __pyx_v_shape_correlation.shape[2];
        __pyx_t_14 = ((fabs((*((double *) ( /* dim=2 */ (( /* dim=1 */ (( /* dim=0 */ (__pyx_v_shape_correlation.data + __pyx_t_11 * __pyx_v_shape_correlation.strides[0]) ) + __pyx_t_12 * __pyx_v_shape_correlation.strides[1]) ) + __pyx_t_13 * __pyx_v_shape_correlation.strides[2]) )))) <code><</code> __pyx_v_shape_correlation_cutoff) != 0);
        if (__pyx_t_14) {
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line57")'> 57:                     # increase counter_matrix at the current position</pre>
<pre id='line57' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line58")'> 58:                     counter_matrix[x, y, z] = counter_matrix[x, y, z] + counter_add</pre>
<pre id='line58' class='code' style='background-color: #FFFFff'>
          /* "epitopsy/cython/CalculateInteractionEnergyCython.pyx":58
 *                 if abs_c(shape_correlation[x,y,z]) <code><</code> shape_correlation_cutoff:
 *                     # increase counter_matrix at the current position
 *                     counter_matrix[x, y, z] = counter_matrix[x, y, z] + counter_add             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                     # get energy if shape correlation is okay
 *                     # calc exp(-energy), it should be faster to do it here
 */
          __pyx_t_15 = __pyx_v_x;
          __pyx_t_16 = __pyx_v_y;
          __pyx_t_17 = __pyx_v_z;
          if (__pyx_t_15 <code><</code> 0) __pyx_t_15 += __pyx_v_counter_matrix.shape[0];
          if (__pyx_t_16 <code><</code> 0) __pyx_t_16 += __pyx_v_counter_matrix.shape[1];
          if (__pyx_t_17 <code><</code> 0) __pyx_t_17 += __pyx_v_counter_matrix.shape[2];
          __pyx_t_18 = __pyx_v_x;
          __pyx_t_19 = __pyx_v_y;
          __pyx_t_20 = __pyx_v_z;
          if (__pyx_t_18 <code><</code> 0) __pyx_t_18 += __pyx_v_counter_matrix.shape[0];
          if (__pyx_t_19 <code><</code> 0) __pyx_t_19 += __pyx_v_counter_matrix.shape[1];
          if (__pyx_t_20 <code><</code> 0) __pyx_t_20 += __pyx_v_counter_matrix.shape[2];
          *((double *) ( /* dim=2 */ (( /* dim=1 */ (( /* dim=0 */ (__pyx_v_counter_matrix.data + __pyx_t_18 * __pyx_v_counter_matrix.strides[0]) ) + __pyx_t_19 * __pyx_v_counter_matrix.strides[1]) ) + __pyx_t_20 * __pyx_v_counter_matrix.strides[2]) )) = ((*((double *) ( /* dim=2 */ (( /* dim=1 */ (( /* dim=0 */ (__pyx_v_counter_matrix.data + __pyx_t_15 * __pyx_v_counter_matrix.strides[0]) ) + __pyx_t_16 * __pyx_v_counter_matrix.strides[1]) ) + __pyx_t_17 * __pyx_v_counter_matrix.strides[2]) ))) + __pyx_v_counter_add);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line59")'> 59:                     # get energy if shape correlation is okay</pre>
<pre id='line59' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line60")'> 60:                     # calc exp(-energy), it should be faster to do it here</pre>
<pre id='line60' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line61")'> 61: #                    interaction_energy[x, y, z] = exp(-esp_correlation[x, y, z])</pre>
<pre id='line61' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line62")'> 62:                     interaction_energy[x, y, z] = esp_correlation[x, y, z]</pre>
<pre id='line62' class='code' style='background-color: #FFFFff'>
          /* "epitopsy/cython/CalculateInteractionEnergyCython.pyx":62
 *                     # calc exp(-energy), it should be faster to do it here
 * #                    interaction_energy[x, y, z] = exp(-esp_correlation[x, y, z])
 *                     interaction_energy[x, y, z] = esp_correlation[x, y, z]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     return interaction_energy_np, counter_matrix_np
 * 
 */
          __pyx_t_21 = __pyx_v_x;
          __pyx_t_22 = __pyx_v_y;
          __pyx_t_23 = __pyx_v_z;
          if (__pyx_t_21 <code><</code> 0) __pyx_t_21 += __pyx_v_esp_correlation.shape[0];
          if (__pyx_t_22 <code><</code> 0) __pyx_t_22 += __pyx_v_esp_correlation.shape[1];
          if (__pyx_t_23 <code><</code> 0) __pyx_t_23 += __pyx_v_esp_correlation.shape[2];
          __pyx_t_24 = __pyx_v_x;
          __pyx_t_25 = __pyx_v_y;
          __pyx_t_26 = __pyx_v_z;
          if (__pyx_t_24 <code><</code> 0) __pyx_t_24 += __pyx_v_interaction_energy.shape[0];
          if (__pyx_t_25 <code><</code> 0) __pyx_t_25 += __pyx_v_interaction_energy.shape[1];
          if (__pyx_t_26 <code><</code> 0) __pyx_t_26 += __pyx_v_interaction_energy.shape[2];
          *((double *) ( /* dim=2 */ (( /* dim=1 */ (( /* dim=0 */ (__pyx_v_interaction_energy.data + __pyx_t_24 * __pyx_v_interaction_energy.strides[0]) ) + __pyx_t_25 * __pyx_v_interaction_energy.strides[1]) ) + __pyx_t_26 * __pyx_v_interaction_energy.strides[2]) )) = (*((double *) ( /* dim=2 */ (( /* dim=1 */ (( /* dim=0 */ (__pyx_v_esp_correlation.data + __pyx_t_21 * __pyx_v_esp_correlation.strides[0]) ) + __pyx_t_22 * __pyx_v_esp_correlation.strides[1]) ) + __pyx_t_23 * __pyx_v_esp_correlation.strides[2]) )));
          goto __pyx_L9;
        }
        __pyx_L9:;
      }
    }
  }
</pre><pre class='line' style='background-color: #FFFF16' onclick='toggleDiv("line63")'> 63:     return interaction_energy_np, counter_matrix_np</pre>
<pre id='line63' class='code' style='background-color: #FFFF16'>
  /* "epitopsy/cython/CalculateInteractionEnergyCython.pyx":63
 * #                    interaction_energy[x, y, z] = exp(-esp_correlation[x, y, z])
 *                     interaction_energy[x, y, z] = esp_correlation[x, y, z]
 *     return interaction_energy_np, counter_matrix_np             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * def count_rotations(np.ndarray[np.float64_t, ndim=3] shape_correlation,
 */
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(((PyObject *)__pyx_r));
  __pyx_t_27 = <span class='py_c_api'>PyTuple_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_27)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 63; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_27);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_v_interaction_energy_np));
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_27, 0, ((PyObject *)__pyx_v_interaction_energy_np));
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_v_interaction_energy_np));
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_v_counter_matrix_np));
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_27, 1, ((PyObject *)__pyx_v_counter_matrix_np));
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_v_counter_matrix_np));
  __pyx_r = ((PyObject*)__pyx_t_27);
  __pyx_t_27 = 0;
  goto __pyx_L0;

  __pyx_r = ((PyObject*)Py_None); <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __PYX_XDEC_MEMVIEW(&__pyx_t_1, 1);
  __PYX_XDEC_MEMVIEW(&__pyx_t_2, 1);
  __PYX_XDEC_MEMVIEW(&__pyx_t_3, 1);
  __PYX_XDEC_MEMVIEW(&__pyx_t_4, 1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_27);
  { PyObject *__pyx_type, *__pyx_value, *__pyx_tb;
    <span class='pyx_c_api'>__Pyx_ErrFetch</span>(&__pyx_type, &__pyx_value, &__pyx_tb);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&__pyx_pybuffernd_counter_matrix_np.rcbuffer->pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&__pyx_pybuffernd_esp_correlation_np.rcbuffer->pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&__pyx_pybuffernd_interaction_energy_np.rcbuffer->pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&__pyx_pybuffernd_shape_correlation_np.rcbuffer->pybuffer);
  <span class='pyx_c_api'>__Pyx_ErrRestore</span>(__pyx_type, __pyx_value, __pyx_tb);}
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("epitopsy.cython.CalculateInteractionEnergyCython._count_rotations", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = 0;
  goto __pyx_L2;
  __pyx_L0:;
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&__pyx_pybuffernd_counter_matrix_np.rcbuffer->pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&__pyx_pybuffernd_esp_correlation_np.rcbuffer->pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&__pyx_pybuffernd_interaction_energy_np.rcbuffer->pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&__pyx_pybuffernd_shape_correlation_np.rcbuffer->pybuffer);
  __pyx_L2:;
  __PYX_XDEC_MEMVIEW(&__pyx_v_shape_correlation, 1);
  __PYX_XDEC_MEMVIEW(&__pyx_v_esp_correlation, 1);
  __PYX_XDEC_MEMVIEW(&__pyx_v_counter_matrix, 1);
  __PYX_XDEC_MEMVIEW(&__pyx_v_interaction_energy, 1);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_8epitopsy_6cython_32CalculateInteractionEnergyCython_1count_rotations(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyMethodDef __pyx_mdef_8epitopsy_6cython_32CalculateInteractionEnergyCython_1count_rotations = {<span class='pyx_macro_api'>__Pyx_NAMESTR</span>("count_rotations"), (PyCFunction)__pyx_pw_8epitopsy_6cython_32CalculateInteractionEnergyCython_1count_rotations, METH_VARARGS|METH_KEYWORDS, <span class='pyx_macro_api'>__Pyx_DOCSTR</span>(0)};
static PyObject *__pyx_pw_8epitopsy_6cython_32CalculateInteractionEnergyCython_1count_rotations(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyArrayObject *__pyx_v_shape_correlation = 0;
  PyArrayObject *__pyx_v_esp_correlation = 0;
  PyArrayObject *__pyx_v_counter_matrix = 0;
  float __pyx_v_shape_correlation_cutoff;
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("count_rotations (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__shape_correlation,&__pyx_n_s__esp_correlation,&__pyx_n_s__counter_matrix,&__pyx_n_s_1,0};
    PyObject* values[4] = {0,0,0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
      switch (pos_args) {
        case  4: values[3] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 3);
        case  3: values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__shape_correlation)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        case  1:
        if (likely((values[1] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__esp_correlation)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("count_rotations", 1, 4, 4, 1);<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 65; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
        case  2:
        if (likely((values[2] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__counter_matrix)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("count_rotations", 1, 4, 4, 2);<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 65; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
        case  3:
        if (likely((values[3] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s_1)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("count_rotations", 1, 4, 4, 3);<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 65; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "count_rotations") <code><</code> 0))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 65; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
      }
    } else if (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args) != 4) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
      values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
      values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
      values[3] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 3);
    }
    __pyx_v_shape_correlation = ((PyArrayObject *)values[0]);
    __pyx_v_esp_correlation = ((PyArrayObject *)values[1]);
    __pyx_v_counter_matrix = ((PyArrayObject *)values[2]);
    __pyx_v_shape_correlation_cutoff = __pyx_<span class='py_c_api'>PyFloat_AsFloat</span>(values[3]);<span class='error_goto'> if (unlikely((__pyx_v_shape_correlation_cutoff == (float)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 68; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("count_rotations", 1, 4, 4, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args));<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 65; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("epitopsy.cython.CalculateInteractionEnergyCython.count_rotations", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_shape_correlation), __pyx_ptype_5numpy_ndarray, 1, "shape_correlation", 0)))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 65; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_esp_correlation), __pyx_ptype_5numpy_ndarray, 1, "esp_correlation", 0)))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 66; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_counter_matrix), __pyx_ptype_5numpy_ndarray, 1, "counter_matrix", 0)))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 67; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_r = __pyx_pf_8epitopsy_6cython_32CalculateInteractionEnergyCython_count_rotations(__pyx_self, __pyx_v_shape_correlation, __pyx_v_esp_correlation, __pyx_v_counter_matrix, __pyx_v_shape_correlation_cutoff);
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  goto __pyx_L0;
  __pyx_L1_error:;
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line64")'> 64: </pre>
<pre id='line64' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF4d' onclick='toggleDiv("line65")'> 65: def count_rotations(np.ndarray[np.float64_t, ndim=3] shape_correlation,</pre>
<pre id='line65' class='code' style='background-color: #FFFF4d'>
/* "epitopsy/cython/CalculateInteractionEnergyCython.pyx":65
 *     return interaction_energy_np, counter_matrix_np
 * 
 * def count_rotations(np.ndarray[np.float64_t, ndim=3] shape_correlation,             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         np.ndarray[np.float64_t, ndim=3] esp_correlation,
 *         np.ndarray[np.float64_t, ndim=3] counter_matrix,
 */

static PyObject *__pyx_pf_8epitopsy_6cython_32CalculateInteractionEnergyCython_count_rotations(CYTHON_UNUSED PyObject *__pyx_self, PyArrayObject *__pyx_v_shape_correlation, PyArrayObject *__pyx_v_esp_correlation, PyArrayObject *__pyx_v_counter_matrix, float __pyx_v_shape_correlation_cutoff) {
  PyObject *__pyx_v_interaction_energy = NULL;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_counter_matrix;
  __Pyx_Buffer __pyx_pybuffer_counter_matrix;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_esp_correlation;
  __Pyx_Buffer __pyx_pybuffer_esp_correlation;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_shape_correlation;
  __Pyx_Buffer __pyx_pybuffer_shape_correlation;
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("count_rotations", 0);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>((PyObject *)__pyx_v_counter_matrix);
  __pyx_pybuffer_shape_correlation.pybuffer.buf = NULL;
  __pyx_pybuffer_shape_correlation.refcount = 0;
  __pyx_pybuffernd_shape_correlation.data = NULL;
  __pyx_pybuffernd_shape_correlation.rcbuffer = &__pyx_pybuffer_shape_correlation;
  __pyx_pybuffer_esp_correlation.pybuffer.buf = NULL;
  __pyx_pybuffer_esp_correlation.refcount = 0;
  __pyx_pybuffernd_esp_correlation.data = NULL;
  __pyx_pybuffernd_esp_correlation.rcbuffer = &__pyx_pybuffer_esp_correlation;
  __pyx_pybuffer_counter_matrix.pybuffer.buf = NULL;
  __pyx_pybuffer_counter_matrix.refcount = 0;
  __pyx_pybuffernd_counter_matrix.data = NULL;
  __pyx_pybuffernd_counter_matrix.rcbuffer = &__pyx_pybuffer_counter_matrix;
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&__pyx_pybuffernd_shape_correlation.rcbuffer->pybuffer, (PyObject*)__pyx_v_shape_correlation, &__Pyx_TypeInfo_nn___pyx_t_5numpy_float64_t, PyBUF_FORMAT| PyBUF_STRIDES, 3, 0, __pyx_stack) == -1))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 65; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  }
  __pyx_pybuffernd_shape_correlation.diminfo[0].strides = __pyx_pybuffernd_shape_correlation.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_shape_correlation.diminfo[0].shape = __pyx_pybuffernd_shape_correlation.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_shape_correlation.diminfo[1].strides = __pyx_pybuffernd_shape_correlation.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_shape_correlation.diminfo[1].shape = __pyx_pybuffernd_shape_correlation.rcbuffer->pybuffer.shape[1]; __pyx_pybuffernd_shape_correlation.diminfo[2].strides = __pyx_pybuffernd_shape_correlation.rcbuffer->pybuffer.strides[2]; __pyx_pybuffernd_shape_correlation.diminfo[2].shape = __pyx_pybuffernd_shape_correlation.rcbuffer->pybuffer.shape[2];
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&__pyx_pybuffernd_esp_correlation.rcbuffer->pybuffer, (PyObject*)__pyx_v_esp_correlation, &__Pyx_TypeInfo_nn___pyx_t_5numpy_float64_t, PyBUF_FORMAT| PyBUF_STRIDES, 3, 0, __pyx_stack) == -1))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 65; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  }
  __pyx_pybuffernd_esp_correlation.diminfo[0].strides = __pyx_pybuffernd_esp_correlation.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_esp_correlation.diminfo[0].shape = __pyx_pybuffernd_esp_correlation.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_esp_correlation.diminfo[1].strides = __pyx_pybuffernd_esp_correlation.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_esp_correlation.diminfo[1].shape = __pyx_pybuffernd_esp_correlation.rcbuffer->pybuffer.shape[1]; __pyx_pybuffernd_esp_correlation.diminfo[2].strides = __pyx_pybuffernd_esp_correlation.rcbuffer->pybuffer.strides[2]; __pyx_pybuffernd_esp_correlation.diminfo[2].shape = __pyx_pybuffernd_esp_correlation.rcbuffer->pybuffer.shape[2];
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&__pyx_pybuffernd_counter_matrix.rcbuffer->pybuffer, (PyObject*)__pyx_v_counter_matrix, &__Pyx_TypeInfo_nn___pyx_t_5numpy_float64_t, PyBUF_FORMAT| PyBUF_STRIDES, 3, 0, __pyx_stack) == -1))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 65; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  }
  __pyx_pybuffernd_counter_matrix.diminfo[0].strides = __pyx_pybuffernd_counter_matrix.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_counter_matrix.diminfo[0].shape = __pyx_pybuffernd_counter_matrix.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_counter_matrix.diminfo[1].strides = __pyx_pybuffernd_counter_matrix.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_counter_matrix.diminfo[1].shape = __pyx_pybuffernd_counter_matrix.rcbuffer->pybuffer.shape[1]; __pyx_pybuffernd_counter_matrix.diminfo[2].strides = __pyx_pybuffernd_counter_matrix.rcbuffer->pybuffer.strides[2]; __pyx_pybuffernd_counter_matrix.diminfo[2].shape = __pyx_pybuffernd_counter_matrix.rcbuffer->pybuffer.shape[2];

  /* "epitopsy/cython/CalculateInteractionEnergyCython.pyx":65
 *     return interaction_energy_np, counter_matrix_np
 * 
 * def count_rotations(np.ndarray[np.float64_t, ndim=3] shape_correlation,             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         np.ndarray[np.float64_t, ndim=3] esp_correlation,
 *         np.ndarray[np.float64_t, ndim=3] counter_matrix,
 */
  __pyx_k_tuple_55 = <span class='py_c_api'>PyTuple_Pack</span>(5, ((PyObject *)__pyx_n_s__shape_correlation), ((PyObject *)__pyx_n_s__esp_correlation), ((PyObject *)__pyx_n_s__counter_matrix), ((PyObject *)__pyx_n_s_1), ((PyObject *)__pyx_n_s__interaction_energy));<span class='error_goto'> if (unlikely(!__pyx_k_tuple_55)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 65; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_k_tuple_55);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_k_tuple_55));

  /* "epitopsy/cython/CalculateInteractionEnergyCython.pyx":65
 *     return interaction_energy_np, counter_matrix_np
 * 
 * def count_rotations(np.ndarray[np.float64_t, ndim=3] shape_correlation,             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         np.ndarray[np.float64_t, ndim=3] esp_correlation,
 *         np.ndarray[np.float64_t, ndim=3] counter_matrix,
 */
  __pyx_t_2 = PyCFunction_NewEx(&__pyx_mdef_8epitopsy_6cython_32CalculateInteractionEnergyCython_1count_rotations, NULL, __pyx_n_s_58);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 65; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s__count_rotations, __pyx_t_2) <code><</code> 0)<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 65; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_k_codeobj_56 = (PyObject*)__Pyx_<span class='py_c_api'>PyCode_New</span>(4, 0, 5, 0, 0, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_k_tuple_55, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_57, __pyx_n_s__count_rotations, 65, __pyx_empty_bytes);<span class='error_goto'> if (unlikely(!__pyx_k_codeobj_56)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 65; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line66")'> 66:         np.ndarray[np.float64_t, ndim=3] esp_correlation,</pre>
<pre id='line66' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line67")'> 67:         np.ndarray[np.float64_t, ndim=3] counter_matrix,</pre>
<pre id='line67' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line68")'> 68:         float shape_correlation_cutoff):</pre>
<pre id='line68' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line69")'> 69: </pre>
<pre id='line69' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF7f' onclick='toggleDiv("line70")'> 70:     interaction_energy = np.zeros([esp_correlation.shape[0],</pre>
<pre id='line70' class='code' style='background-color: #FFFF7f'>
  /* "epitopsy/cython/CalculateInteractionEnergyCython.pyx":70
 *         float shape_correlation_cutoff):
 * 
 *     interaction_energy = np.zeros([esp_correlation.shape[0],             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         esp_correlation.shape[1], esp_correlation.shape[2]])
 *     interaction_energy, counter_matrix = _count_rotations(esp_correlation,
 */
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s__np);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 70; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  __pyx_t_2 = __Pyx_<span class='py_c_api'>PyObject_GetAttrStr</span>(__pyx_t_1, __pyx_n_s__zeros);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 70; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyInt_to_py_Py_intptr_t</span>((__pyx_v_esp_correlation->dimensions[0]));<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 70; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
</pre><pre class='line' style='background-color: #FFFF48' onclick='toggleDiv("line71")'> 71:         esp_correlation.shape[1], esp_correlation.shape[2]])</pre>
<pre id='line71' class='code' style='background-color: #FFFF48'>
  /* "epitopsy/cython/CalculateInteractionEnergyCython.pyx":71
 * 
 *     interaction_energy = np.zeros([esp_correlation.shape[0],
 *         esp_correlation.shape[1], esp_correlation.shape[2]])             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     interaction_energy, counter_matrix = _count_rotations(esp_correlation,
 *         shape_correlation, counter_matrix, interaction_energy,
 */
  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyInt_to_py_Py_intptr_t</span>((__pyx_v_esp_correlation->dimensions[1]));<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 71; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
  __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyInt_to_py_Py_intptr_t</span>((__pyx_v_esp_correlation->dimensions[2]));<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 71; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_4);
  __pyx_t_5 = <span class='py_c_api'>PyList_New</span>(3);<span class='error_goto'> if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 70; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_5);
  <span class='py_macro_api'>PyList_SET_ITEM</span>(__pyx_t_5, 0, __pyx_t_1);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_t_1);
  <span class='py_macro_api'>PyList_SET_ITEM</span>(__pyx_t_5, 1, __pyx_t_3);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_t_3);
  <span class='py_macro_api'>PyList_SET_ITEM</span>(__pyx_t_5, 2, __pyx_t_4);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_t_4);
  __pyx_t_1 = 0;
  __pyx_t_3 = 0;
  __pyx_t_4 = 0;
  __pyx_t_4 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 70; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_4);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_4, 0, ((PyObject *)__pyx_t_5));
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_t_5));
  __pyx_t_5 = 0;
  __pyx_t_5 = <span class='py_c_api'>PyObject_Call</span>(__pyx_t_2, ((PyObject *)__pyx_t_4), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 70; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_5);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_4)); __pyx_t_4 = 0;
  __pyx_v_interaction_energy = __pyx_t_5;
  __pyx_t_5 = 0;
</pre><pre class='line' style='background-color: #FFFF4f' onclick='toggleDiv("line72")'> 72:     interaction_energy, counter_matrix = _count_rotations(esp_correlation,</pre>
<pre id='line72' class='code' style='background-color: #FFFF4f'>
  /* "epitopsy/cython/CalculateInteractionEnergyCython.pyx":72
 *     interaction_energy = np.zeros([esp_correlation.shape[0],
 *         esp_correlation.shape[1], esp_correlation.shape[2]])
 *     interaction_energy, counter_matrix = _count_rotations(esp_correlation,             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         shape_correlation, counter_matrix, interaction_energy,
 *         shape_correlation_cutoff)
 */
  if (!(likely(((__pyx_t_2) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_2, __pyx_ptype_5numpy_ndarray)))))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 72; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_v_interaction_energy);
  __pyx_v_interaction_energy = __pyx_t_4;
  __pyx_t_4 = 0;
  __pyx_t_7 = ((PyArrayObject *)__pyx_t_2);
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&__pyx_pybuffernd_counter_matrix.rcbuffer->pybuffer);
    __pyx_t_8 = <span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&__pyx_pybuffernd_counter_matrix.rcbuffer->pybuffer, (PyObject*)__pyx_t_7, &__Pyx_TypeInfo_nn___pyx_t_5numpy_float64_t, PyBUF_FORMAT| PyBUF_STRIDES, 3, 0, __pyx_stack);
    if (unlikely(__pyx_t_8 <code><</code> 0)) {
      <span class='py_c_api'>PyErr_Fetch</span>(&__pyx_t_9, &__pyx_t_10, &__pyx_t_11);
      if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&__pyx_pybuffernd_counter_matrix.rcbuffer->pybuffer, (PyObject*)__pyx_v_counter_matrix, &__Pyx_TypeInfo_nn___pyx_t_5numpy_float64_t, PyBUF_FORMAT| PyBUF_STRIDES, 3, 0, __pyx_stack) == -1)) {
        Py_XDECREF(__pyx_t_9); Py_XDECREF(__pyx_t_10); Py_XDECREF(__pyx_t_11);
        <span class='pyx_c_api'>__Pyx_RaiseBufferFallbackError</span>();
      } else {
        <span class='py_c_api'>PyErr_Restore</span>(__pyx_t_9, __pyx_t_10, __pyx_t_11);
      }
    }
    __pyx_pybuffernd_counter_matrix.diminfo[0].strides = __pyx_pybuffernd_counter_matrix.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_counter_matrix.diminfo[0].shape = __pyx_pybuffernd_counter_matrix.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_counter_matrix.diminfo[1].strides = __pyx_pybuffernd_counter_matrix.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_counter_matrix.diminfo[1].shape = __pyx_pybuffernd_counter_matrix.rcbuffer->pybuffer.shape[1]; __pyx_pybuffernd_counter_matrix.diminfo[2].strides = __pyx_pybuffernd_counter_matrix.rcbuffer->pybuffer.strides[2]; __pyx_pybuffernd_counter_matrix.diminfo[2].shape = __pyx_pybuffernd_counter_matrix.rcbuffer->pybuffer.shape[2];
    if (unlikely(__pyx_t_8 <code><</code> 0))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 72; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  }
  __pyx_t_7 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_v_counter_matrix));
  __pyx_v_counter_matrix = ((PyArrayObject *)__pyx_t_2);
  __pyx_t_2 = 0;
</pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line73")'> 73:         shape_correlation, counter_matrix, interaction_energy,</pre>
<pre id='line73' class='code' style='background-color: #FFFFd4'>
  /* "epitopsy/cython/CalculateInteractionEnergyCython.pyx":73
 *         esp_correlation.shape[1], esp_correlation.shape[2]])
 *     interaction_energy, counter_matrix = _count_rotations(esp_correlation,
 *         shape_correlation, counter_matrix, interaction_energy,             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         shape_correlation_cutoff)
 *     return interaction_energy, counter_matrix
 */
  if (!(likely(((__pyx_v_interaction_energy) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_v_interaction_energy, __pyx_ptype_5numpy_ndarray)))))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 73; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
</pre><pre class='line' style='background-color: #FFFF36' onclick='toggleDiv("line74")'> 74:         shape_correlation_cutoff)</pre>
<pre id='line74' class='code' style='background-color: #FFFF36'>
  /* "epitopsy/cython/CalculateInteractionEnergyCython.pyx":74
 *     interaction_energy, counter_matrix = _count_rotations(esp_correlation,
 *         shape_correlation, counter_matrix, interaction_energy,
 *         shape_correlation_cutoff)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     return interaction_energy, counter_matrix
 * 
 */
  __pyx_t_5 = ((PyObject *)__pyx_f_8epitopsy_6cython_32CalculateInteractionEnergyCython__count_rotations(((PyArrayObject *)__pyx_v_esp_correlation), ((PyArrayObject *)__pyx_v_shape_correlation), ((PyArrayObject *)__pyx_v_counter_matrix), ((PyArrayObject *)__pyx_v_interaction_energy), __pyx_v_shape_correlation_cutoff));<span class='error_goto'> if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 72; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_5);
  if (likely(<span class='py_c_api'>PyTuple_CheckExact</span>(__pyx_t_5))) {
    PyObject* sequence = __pyx_t_5;
    #if CYTHON_COMPILING_IN_CPYTHON
    Py_ssize_t size = Py_SIZE(sequence);
    #else
    Py_ssize_t size = <span class='py_c_api'>PySequence_Size</span>(sequence);
    #endif
    if (unlikely(size != 2)) {
      if (size > 2) <span class='pyx_c_api'>__Pyx_RaiseTooManyValuesError</span>(2);
      else if (size >= 0) <span class='pyx_c_api'>__Pyx_RaiseNeedMoreValuesError</span>(size);
     <span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 72; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    }
    #if CYTHON_COMPILING_IN_CPYTHON
    __pyx_t_4 = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(sequence, 0); 
    __pyx_t_2 = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(sequence, 1); 
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_4);
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_2);
    #else
    __pyx_t_4 = <span class='py_macro_api'>PySequence_ITEM</span>(sequence, 0);<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 72; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_4);
    __pyx_t_2 = <span class='py_macro_api'>PySequence_ITEM</span>(sequence, 1);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 72; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
    #endif
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
  } else if (1) {
    <span class='pyx_c_api'>__Pyx_RaiseNoneNotIterableError</span>();<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 72; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  } else
  {
    Py_ssize_t index = -1;
    __pyx_t_3 = <span class='py_c_api'>PyObject_GetIter</span>(__pyx_t_5);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 72; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
    __pyx_t_6 = Py_TYPE(__pyx_t_3)->tp_iternext;
    index = 0; __pyx_t_4 = __pyx_t_6(__pyx_t_3); if (unlikely(!__pyx_t_4)) goto __pyx_L3_unpacking_failed;
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_4);
    index = 1; __pyx_t_2 = __pyx_t_6(__pyx_t_3); if (unlikely(!__pyx_t_2)) goto __pyx_L3_unpacking_failed;
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
    if (<span class='pyx_c_api'>__Pyx_IternextUnpackEndCheck</span>(__pyx_t_6(__pyx_t_3), 2) <code><</code> 0)<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 72; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    __pyx_t_6 = NULL;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
    goto __pyx_L4_unpacking_done;
    __pyx_L3_unpacking_failed:;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
    __pyx_t_6 = NULL;
    if (<span class='pyx_c_api'>__Pyx_IterFinish</span>() == 0) <span class='pyx_c_api'>__Pyx_RaiseNeedMoreValuesError</span>(index);
   <span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 72; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    __pyx_L4_unpacking_done:;
  }
</pre><pre class='line' style='background-color: #FFFF36' onclick='toggleDiv("line75")'> 75:     return interaction_energy, counter_matrix</pre>
<pre id='line75' class='code' style='background-color: #FFFF36'>
  /* "epitopsy/cython/CalculateInteractionEnergyCython.pyx":75
 *         shape_correlation, counter_matrix, interaction_energy,
 *         shape_correlation_cutoff)
 *     return interaction_energy, counter_matrix             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * #@cython.boundscheck(False)
 */
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
  __pyx_t_5 = <span class='py_c_api'>PyTuple_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 75; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_5);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_interaction_energy);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_5, 0, __pyx_v_interaction_energy);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_v_interaction_energy);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_v_counter_matrix));
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_5, 1, ((PyObject *)__pyx_v_counter_matrix));
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_v_counter_matrix));
  __pyx_r = ((PyObject *)__pyx_t_5);
  __pyx_t_5 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_5);
  { PyObject *__pyx_type, *__pyx_value, *__pyx_tb;
    <span class='pyx_c_api'>__Pyx_ErrFetch</span>(&__pyx_type, &__pyx_value, &__pyx_tb);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&__pyx_pybuffernd_counter_matrix.rcbuffer->pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&__pyx_pybuffernd_esp_correlation.rcbuffer->pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&__pyx_pybuffernd_shape_correlation.rcbuffer->pybuffer);
  <span class='pyx_c_api'>__Pyx_ErrRestore</span>(__pyx_type, __pyx_value, __pyx_tb);}
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("epitopsy.cython.CalculateInteractionEnergyCython.count_rotations", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  goto __pyx_L2;
  __pyx_L0:;
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&__pyx_pybuffernd_counter_matrix.rcbuffer->pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&__pyx_pybuffernd_esp_correlation.rcbuffer->pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&__pyx_pybuffernd_shape_correlation.rcbuffer->pybuffer);
  __pyx_L2:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_interaction_energy);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_counter_matrix);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line76")'> 76: </pre>
<pre id='line76' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line77")'> 77: #@cython.boundscheck(False)</pre>
<pre id='line77' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line78")'> 78: #cdef tuple calculateEnergy(np.ndarray[np.float64_t, ndim=3] esp_correlation_np,</pre>
<pre id='line78' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line79")'> 79: #        np.ndarray[np.float64_t, ndim=3] shape_correlation_np,</pre>
<pre id='line79' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line80")'> 80: #        np.ndarray[np.float64_t, ndim=3] counter_matrix_np,</pre>
<pre id='line80' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line81")'> 81: #        np.ndarray[np.float64_t, ndim=3] interaction_energy_np,</pre>
<pre id='line81' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line82")'> 82: #        int x_center, int y_center, int z_center, float shape_correlation_cutoff):</pre>
<pre id='line82' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line83")'> 83: #    cdef double[:,:,:] shape_correlation = shape_correlation_np</pre>
<pre id='line83' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line84")'> 84: #    cdef double[:,:,:] esp_correlation = esp_correlation_np</pre>
<pre id='line84' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line85")'> 85: #    cdef double[:,:,:] counter_matrix = counter_matrix_np</pre>
<pre id='line85' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line86")'> 86: #    cdef double[:,:,:] interaction_energy = interaction_energy_np</pre>
<pre id='line86' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line87")'> 87: #    cdef int i,j,k</pre>
<pre id='line87' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line88")'> 88: #    cdef int x,y,z</pre>
<pre id='line88' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line89")'> 89: #    cdef float counter_add = 1.</pre>
<pre id='line89' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line90")'> 90: #    cdef int xdim = shape_correlation.shape[0]</pre>
<pre id='line90' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line91")'> 91: #    cdef int ydim = shape_correlation.shape[1]</pre>
<pre id='line91' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line92")'> 92: #    cdef int zdim = shape_correlation.shape[2]</pre>
<pre id='line92' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line93")'> 93: #</pre>
<pre id='line93' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line94")'> 94: #    for i in range(xdim):</pre>
<pre id='line94' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line95")'> 95: #        for j in range(ydim):</pre>
<pre id='line95' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line96")'> 96: #            for k in range(zdim):</pre>
<pre id='line96' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line97")'> 97: #                """</pre>
<pre id='line97' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line98")'> 98: #                correct for fft freq shift</pre>
<pre id='line98' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line99")'> 99: #                """</pre>
<pre id='line99' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line100")'> 100: #                if i &lt; x_center:</pre>
<pre id='line100' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line101")'> 101: #                    x = i</pre>
<pre id='line101' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line102")'> 102: #                else:</pre>
<pre id='line102' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line103")'> 103: #                    x = i - xdim</pre>
<pre id='line103' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line104")'> 104: #                if j &lt; y_center:</pre>
<pre id='line104' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line105")'> 105: #                    y = j</pre>
<pre id='line105' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line106")'> 106: #                else:</pre>
<pre id='line106' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line107")'> 107: #                    y = j - ydim</pre>
<pre id='line107' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line108")'> 108: #                if k &lt; z_center:</pre>
<pre id='line108' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line109")'> 109: #                    z = k</pre>
<pre id='line109' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line110")'> 110: #                else:</pre>
<pre id='line110' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line111")'> 111: #                    z = k - zdim</pre>
<pre id='line111' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line112")'> 112: #</pre>
<pre id='line112' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line113")'> 113: #                ## all are ints, and xdim is usually uneven, so there is</pre>
<pre id='line113' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line114")'> 114: #                # probably an error here, this would produce an offset, but</pre>
<pre id='line114' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line115")'> 115: #                # just of one or two grid points, so not important for the</pre>
<pre id='line115' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line116")'> 116: #                # moment</pre>
<pre id='line116' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line117")'> 117: #                x = x_center - x - 1</pre>
<pre id='line117' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line118")'> 118: #                y = y_center - y - 1</pre>
<pre id='line118' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line119")'> 119: #                z = z_center - z - 1</pre>
<pre id='line119' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line120")'> 120: #</pre>
<pre id='line120' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line121")'> 121: #                if abs_c(shape_correlation[i,j,k]) &lt; shape_correlation_cutoff:</pre>
<pre id='line121' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line122")'> 122: #                    # increase counter_matrix at the current position</pre>
<pre id='line122' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line123")'> 123: #                    counter_matrix[x, y, z] = counter_matrix[x, y, z] + counter_add</pre>
<pre id='line123' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line124")'> 124: #                    # get energy if shape correlation is okay</pre>
<pre id='line124' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line125")'> 125: #                    interaction_energy[x, y, z] = esp_correlation[i, j, k]</pre>
<pre id='line125' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line126")'> 126: #    return interaction_energy_np, counter_matrix_np</pre>
<pre id='line126' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line127")'> 127: #</pre>
<pre id='line127' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line128")'> 128: #</pre>
<pre id='line128' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line129")'> 129: #</pre>
<pre id='line129' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line130")'> 130: #def speed_up_fft(np.ndarray[np.float64_t, ndim=3] shape_correlation,</pre>
<pre id='line130' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line131")'> 131: #        np.ndarray[np.float64_t, ndim=3] esp_correlation,</pre>
<pre id='line131' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line132")'> 132: #        np.ndarray[np.float64_t, ndim=3] counter_matrix,</pre>
<pre id='line132' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line133")'> 133: #        float shape_correlation_cutoff,</pre>
<pre id='line133' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line134")'> 134: #        center = None):</pre>
<pre id='line134' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line135")'> 135: #    cdef int xdim = shape_correlation.shape[0]</pre>
<pre id='line135' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line136")'> 136: #    cdef int ydim = shape_correlation.shape[1]</pre>
<pre id='line136' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line137")'> 137: #    cdef int zdim = shape_correlation.shape[2]</pre>
<pre id='line137' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line138")'> 138: #</pre>
<pre id='line138' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line139")'> 139: #    if center is None:</pre>
<pre id='line139' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line140")'> 140: #        x_center = &lt;int&gt; round(shape_correlation.shape[0] / 2.)</pre>
<pre id='line140' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line141")'> 141: #        y_center = &lt;int&gt; round(shape_correlation.shape[1] / 2.)</pre>
<pre id='line141' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line142")'> 142: #        z_center = &lt;int&gt; round(shape_correlation.shape[2] / 2.)</pre>
<pre id='line142' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line143")'> 143: #    else:</pre>
<pre id='line143' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line144")'> 144: #        x_center = &lt;int&gt; center[0]</pre>
<pre id='line144' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line145")'> 145: #        y_center = &lt;int&gt; center[1]</pre>
<pre id='line145' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line146")'> 146: #        z_center = &lt;int&gt; center[2]</pre>
<pre id='line146' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line147")'> 147: #</pre>
<pre id='line147' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line148")'> 148: #    interaction_energy = np.zeros([xdim, ydim, zdim])</pre>
<pre id='line148' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line149")'> 149: #    interaction_energy, counter_matrix = calculateEnergy(esp_correlation,</pre>
<pre id='line149' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line150")'> 150: #        shape_correlation, counter_matrix, interaction_energy, x_center,</pre>
<pre id='line150' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line151")'> 151: #        y_center, z_center, shape_correlation_cutoff)</pre>
<pre id='line151' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line152")'> 152: #    return interaction_energy, counter_matrix</pre>
<pre id='line152' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line153")'> 153: </pre>
<pre id='line153' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line154")'> 154: </pre>
<pre id='line154' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line155")'> 155: </pre>
<pre id='line155' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line156")'> 156: # This version should work fine, if one changes something, please comment these</pre>
<pre id='line156' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line157")'> 157: # options</pre>
<pre id='line157' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line158")'> 158: @cython.cdivision(True)</pre>
<pre id='line158' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line159")'> 159: @cython.boundscheck(False)</pre>
<pre id='line159' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line160")'> 160: cdef double[:] transform_box_to_real_space(double[:] grid_coord,</pre>
<pre id='line160' class='code' style='background-color: #FFFFff'>
/* "epitopsy/cython/CalculateInteractionEnergyCython.pyx":160
 * @cython.cdivision(True)
 * @cython.boundscheck(False)
 * cdef double[:] transform_box_to_real_space(double[:] grid_coord,             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         double[:] box_mesh_size,
 *         double[:] box_offset):
 */

static __Pyx_memviewslice __pyx_f_8epitopsy_6cython_32CalculateInteractionEnergyCython_transform_box_to_real_space(__Pyx_memviewslice __pyx_v_grid_coord, __Pyx_memviewslice __pyx_v_box_mesh_size, __Pyx_memviewslice __pyx_v_box_offset) {
  __Pyx_memviewslice __pyx_v_new_grid_coord = { 0, 0, { 0 }, { 0 }, { 0 } };
  int __pyx_v_dim;
  int __pyx_v_i;
  __Pyx_memviewslice __pyx_r = { 0, 0, { 0 }, { 0 }, { 0 } };
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("transform_box_to_real_space", 0);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line161")'> 161:         double[:] box_mesh_size,</pre>
<pre id='line161' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line162")'> 162:         double[:] box_offset):</pre>
<pre id='line162' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF4f' onclick='toggleDiv("line163")'> 163:     cdef double[:] new_grid_coord = np.zeros(3)</pre>
<pre id='line163' class='code' style='background-color: #FFFF4f'>
  /* "epitopsy/cython/CalculateInteractionEnergyCython.pyx":163
 *         double[:] box_mesh_size,
 *         double[:] box_offset):
 *     cdef double[:] new_grid_coord = np.zeros(3)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     cdef int dim = 3
 *     cdef int i
 */
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s__np);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 163; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  __pyx_t_2 = __Pyx_<span class='py_c_api'>PyObject_GetAttrStr</span>(__pyx_t_1, __pyx_n_s__zeros);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 163; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = <span class='py_c_api'>PyObject_Call</span>(__pyx_t_2, ((PyObject *)__pyx_k_tuple_2), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 163; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_double</span>(__pyx_t_1);
  if (unlikely(!__pyx_t_3.memview))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 163; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_v_new_grid_coord = __pyx_t_3;
  __pyx_t_3.memview = NULL;
  __pyx_t_3.data = NULL;

  /* "epitopsy/cython/CalculateInteractionEnergyCython.pyx":163
 *         double[:] box_mesh_size,
 *         double[:] box_offset):
 *     cdef double[:] new_grid_coord = np.zeros(3)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     cdef int dim = 3
 *     cdef int i
 */
  __pyx_k_tuple_2 = <span class='py_c_api'>PyTuple_Pack</span>(1, __pyx_int_3);<span class='error_goto'> if (unlikely(!__pyx_k_tuple_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 163; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_k_tuple_2);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_k_tuple_2));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line164")'> 164:     cdef int dim = 3</pre>
<pre id='line164' class='code' style='background-color: #FFFFff'>
  /* "epitopsy/cython/CalculateInteractionEnergyCython.pyx":164
 *         double[:] box_offset):
 *     cdef double[:] new_grid_coord = np.zeros(3)
 *     cdef int dim = 3             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     cdef int i
 *     for i in range(dim):
 */
  __pyx_v_dim = 3;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line165")'> 165:     cdef int i</pre>
<pre id='line165' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line166")'> 166:     for i in range(dim):</pre>
<pre id='line166' class='code' style='background-color: #FFFFff'>
  /* "epitopsy/cython/CalculateInteractionEnergyCython.pyx":166
 *     cdef int dim = 3
 *     cdef int i
 *     for i in range(dim):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         new_grid_coord[i] = grid_coord[i] * box_mesh_size[i] + box_offset[i]
 * 
 */
  __pyx_t_4 = __pyx_v_dim;
  for (__pyx_t_5 = 0; __pyx_t_5 <code><</code> __pyx_t_4; __pyx_t_5+=1) {
    __pyx_v_i = __pyx_t_5;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line167")'> 167:         new_grid_coord[i] = grid_coord[i] * box_mesh_size[i] + box_offset[i]</pre>
<pre id='line167' class='code' style='background-color: #FFFFff'>
    /* "epitopsy/cython/CalculateInteractionEnergyCython.pyx":167
 *     cdef int i
 *     for i in range(dim):
 *         new_grid_coord[i] = grid_coord[i] * box_mesh_size[i] + box_offset[i]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     return new_grid_coord
 */
    __pyx_t_6 = __pyx_v_i;
    if (__pyx_t_6 <code><</code> 0) __pyx_t_6 += __pyx_v_grid_coord.shape[0];
    __pyx_t_7 = __pyx_v_i;
    if (__pyx_t_7 <code><</code> 0) __pyx_t_7 += __pyx_v_box_mesh_size.shape[0];
    __pyx_t_8 = __pyx_v_i;
    if (__pyx_t_8 <code><</code> 0) __pyx_t_8 += __pyx_v_box_offset.shape[0];
    __pyx_t_9 = __pyx_v_i;
    if (__pyx_t_9 <code><</code> 0) __pyx_t_9 += __pyx_v_new_grid_coord.shape[0];
    *((double *) ( /* dim=0 */ (__pyx_v_new_grid_coord.data + __pyx_t_9 * __pyx_v_new_grid_coord.strides[0]) )) = (((*((double *) ( /* dim=0 */ (__pyx_v_grid_coord.data + __pyx_t_6 * __pyx_v_grid_coord.strides[0]) ))) * (*((double *) ( /* dim=0 */ (__pyx_v_box_mesh_size.data + __pyx_t_7 * __pyx_v_box_mesh_size.strides[0]) )))) + (*((double *) ( /* dim=0 */ (__pyx_v_box_offset.data + __pyx_t_8 * __pyx_v_box_offset.strides[0]) ))));
  }
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line168")'> 168: </pre>
<pre id='line168' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF7f' onclick='toggleDiv("line169")'> 169:     return new_grid_coord</pre>
<pre id='line169' class='code' style='background-color: #FFFF7f'>
  /* "epitopsy/cython/CalculateInteractionEnergyCython.pyx":169
 *         new_grid_coord[i] = grid_coord[i] * box_mesh_size[i] + box_offset[i]
 * 
 *     return new_grid_coord             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * # This version should work fine, if one changes something, please comment these
 */
  __PYX_INC_MEMVIEW(&__pyx_v_new_grid_coord, 0);
  __pyx_r = __pyx_v_new_grid_coord;
  goto __pyx_L0;

  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  __PYX_XDEC_MEMVIEW(&__pyx_t_3, 1);
  __pyx_r.data = NULL;
  __pyx_r.memview = NULL;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("epitopsy.cython.CalculateInteractionEnergyCython.transform_box_to_real_space", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = __pyx_r;
  goto __pyx_L2;
  __pyx_L0:;
  if (unlikely(!__pyx_r.memview)) {
    <span class='py_c_api'>PyErr_SetString</span>(PyExc_TypeError,"Memoryview return value is not initialized");
  }
  __pyx_L2:;
  __PYX_XDEC_MEMVIEW(&__pyx_v_new_grid_coord, 1);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line170")'> 170: </pre>
<pre id='line170' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line171")'> 171: # This version should work fine, if one changes something, please comment these</pre>
<pre id='line171' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line172")'> 172: # options</pre>
<pre id='line172' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line173")'> 173: @cython.cdivision(True)</pre>
<pre id='line173' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line174")'> 174: @cython.boundscheck(False)</pre>
<pre id='line174' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line175")'> 175: cdef long[:] transform_real_to_box_space(double[:] grid_coord,</pre>
<pre id='line175' class='code' style='background-color: #FFFFff'>
/* "epitopsy/cython/CalculateInteractionEnergyCython.pyx":175
 * @cython.cdivision(True)
 * @cython.boundscheck(False)
 * cdef long[:] transform_real_to_box_space(double[:] grid_coord,             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         double[:] box_mesh_size,
 *         double[:] box_offset):
 */

static __Pyx_memviewslice __pyx_f_8epitopsy_6cython_32CalculateInteractionEnergyCython_transform_real_to_box_space(__Pyx_memviewslice __pyx_v_grid_coord, __Pyx_memviewslice __pyx_v_box_mesh_size, __Pyx_memviewslice __pyx_v_box_offset) {
  __Pyx_memviewslice __pyx_v_new_grid_coord = { 0, 0, { 0 }, { 0 }, { 0 } };
  int __pyx_v_dim;
  int __pyx_v_i;
  __Pyx_memviewslice __pyx_r = { 0, 0, { 0 }, { 0 }, { 0 } };
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("transform_real_to_box_space", 0);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line176")'> 176:         double[:] box_mesh_size,</pre>
<pre id='line176' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line177")'> 177:         double[:] box_offset):</pre>
<pre id='line177' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF31' onclick='toggleDiv("line178")'> 178:     cdef long[:] new_grid_coord = np.zeros(3,dtype=np.int)</pre>
<pre id='line178' class='code' style='background-color: #FFFF31'>
  /* "epitopsy/cython/CalculateInteractionEnergyCython.pyx":178
 *         double[:] box_mesh_size,
 *         double[:] box_offset):
 *     cdef long[:] new_grid_coord = np.zeros(3,dtype=np.int)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     cdef int dim = 3
 *     cdef int i
 */
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s__np);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 178; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  __pyx_t_2 = __Pyx_<span class='py_c_api'>PyObject_GetAttrStr</span>(__pyx_t_1, __pyx_n_s__zeros);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 178; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = <span class='py_c_api'>PyDict_New</span>();<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 178; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(((PyObject *)__pyx_t_1));
  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s__np);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 178; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
  __pyx_t_4 = __Pyx_<span class='py_c_api'>PyObject_GetAttrStr</span>(__pyx_t_3, __pyx_n_s__int);<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 178; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_1, ((PyObject *)__pyx_n_s__dtype), __pyx_t_4) <code><</code> 0)<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 178; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_t_4 = <span class='py_c_api'>PyObject_Call</span>(__pyx_t_2, ((PyObject *)__pyx_k_tuple_3), ((PyObject *)__pyx_t_1));<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 178; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;
  __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_long</span>(__pyx_t_4);
  if (unlikely(!__pyx_t_5.memview))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 178; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_v_new_grid_coord = __pyx_t_5;
  __pyx_t_5.memview = NULL;
  __pyx_t_5.data = NULL;

  /* "epitopsy/cython/CalculateInteractionEnergyCython.pyx":178
 *         double[:] box_mesh_size,
 *         double[:] box_offset):
 *     cdef long[:] new_grid_coord = np.zeros(3,dtype=np.int)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     cdef int dim = 3
 *     cdef int i
 */
  __pyx_k_tuple_3 = <span class='py_c_api'>PyTuple_Pack</span>(1, __pyx_int_3);<span class='error_goto'> if (unlikely(!__pyx_k_tuple_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 178; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_k_tuple_3);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_k_tuple_3));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line179")'> 179:     cdef int dim = 3</pre>
<pre id='line179' class='code' style='background-color: #FFFFff'>
  /* "epitopsy/cython/CalculateInteractionEnergyCython.pyx":179
 *         double[:] box_offset):
 *     cdef long[:] new_grid_coord = np.zeros(3,dtype=np.int)
 *     cdef int dim = 3             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     cdef int i
 *     for i in range(dim):
 */
  __pyx_v_dim = 3;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line180")'> 180:     cdef int i</pre>
<pre id='line180' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line181")'> 181:     for i in range(dim):</pre>
<pre id='line181' class='code' style='background-color: #FFFFff'>
  /* "epitopsy/cython/CalculateInteractionEnergyCython.pyx":181
 *     cdef int dim = 3
 *     cdef int i
 *     for i in range(dim):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         new_grid_coord[i] = <code><</code>int> round((grid_coord[i]-box_offset[i]) / box_mesh_size[i])
 * 
 */
  __pyx_t_6 = __pyx_v_dim;
  for (__pyx_t_7 = 0; __pyx_t_7 <code><</code> __pyx_t_6; __pyx_t_7+=1) {
    __pyx_v_i = __pyx_t_7;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line182")'> 182:         new_grid_coord[i] = &lt;int&gt; round((grid_coord[i]-box_offset[i]) / box_mesh_size[i])</pre>
<pre id='line182' class='code' style='background-color: #FFFFff'>
    /* "epitopsy/cython/CalculateInteractionEnergyCython.pyx":182
 *     cdef int i
 *     for i in range(dim):
 *         new_grid_coord[i] = <code><</code>int> round((grid_coord[i]-box_offset[i]) / box_mesh_size[i])             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     return new_grid_coord
 */
    __pyx_t_8 = __pyx_v_i;
    if (__pyx_t_8 <code><</code> 0) __pyx_t_8 += __pyx_v_grid_coord.shape[0];
    __pyx_t_9 = __pyx_v_i;
    if (__pyx_t_9 <code><</code> 0) __pyx_t_9 += __pyx_v_box_offset.shape[0];
    __pyx_t_10 = __pyx_v_i;
    if (__pyx_t_10 <code><</code> 0) __pyx_t_10 += __pyx_v_box_mesh_size.shape[0];
    __pyx_t_11 = __pyx_v_i;
    if (__pyx_t_11 <code><</code> 0) __pyx_t_11 += __pyx_v_new_grid_coord.shape[0];
    *((long *) ( /* dim=0 */ (__pyx_v_new_grid_coord.data + __pyx_t_11 * __pyx_v_new_grid_coord.strides[0]) )) = ((int)round((((*((double *) ( /* dim=0 */ (__pyx_v_grid_coord.data + __pyx_t_8 * __pyx_v_grid_coord.strides[0]) ))) - (*((double *) ( /* dim=0 */ (__pyx_v_box_offset.data + __pyx_t_9 * __pyx_v_box_offset.strides[0]) )))) / (*((double *) ( /* dim=0 */ (__pyx_v_box_mesh_size.data + __pyx_t_10 * __pyx_v_box_mesh_size.strides[0]) ))))));
  }
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line183")'> 183: </pre>
<pre id='line183' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF73' onclick='toggleDiv("line184")'> 184:     return new_grid_coord</pre>
<pre id='line184' class='code' style='background-color: #FFFF73'>
  /* "epitopsy/cython/CalculateInteractionEnergyCython.pyx":184
 *         new_grid_coord[i] = <code><</code>int> round((grid_coord[i]-box_offset[i]) / box_mesh_size[i])
 * 
 *     return new_grid_coord             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * # This version should work fine, if one changes something, please comment these
 */
  __PYX_INC_MEMVIEW(&__pyx_v_new_grid_coord, 0);
  __pyx_r = __pyx_v_new_grid_coord;
  goto __pyx_L0;

  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4);
  __PYX_XDEC_MEMVIEW(&__pyx_t_5, 1);
  __pyx_r.data = NULL;
  __pyx_r.memview = NULL;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("epitopsy.cython.CalculateInteractionEnergyCython.transform_real_to_box_space", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = __pyx_r;
  goto __pyx_L2;
  __pyx_L0:;
  if (unlikely(!__pyx_r.memview)) {
    <span class='py_c_api'>PyErr_SetString</span>(PyExc_TypeError,"Memoryview return value is not initialized");
  }
  __pyx_L2:;
  __PYX_XDEC_MEMVIEW(&__pyx_v_new_grid_coord, 1);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line185")'> 185: </pre>
<pre id='line185' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line186")'> 186: # This version should work fine, if one changes something, please comment these</pre>
<pre id='line186' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line187")'> 187: # options</pre>
<pre id='line187' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line188")'> 188: @cython.cdivision(True)</pre>
<pre id='line188' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line189")'> 189: @cython.boundscheck(False)</pre>
<pre id='line189' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line190")'> 190: cdef bool is_overlapp(double[:,:,:] vdwbox,</pre>
<pre id='line190' class='code' style='background-color: #FFFFff'>
/* "epitopsy/cython/CalculateInteractionEnergyCython.pyx":190
 * @cython.cdivision(True)
 * @cython.boundscheck(False)
 * cdef bool is_overlapp(double[:,:,:] vdwbox,             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         long[:,:] ligand_coords,
 *         long[:] vdw_radii,
 */

static PyBoolObject *__pyx_f_8epitopsy_6cython_32CalculateInteractionEnergyCython_is_overlapp(__Pyx_memviewslice __pyx_v_vdwbox, __Pyx_memviewslice __pyx_v_ligand_coords, __Pyx_memviewslice __pyx_v_vdw_radii, CYTHON_UNUSED double __pyx_v_solvent_score, double __pyx_v_protein_score) {
  int __pyx_v_xdim;
  int __pyx_v_ydim;
  int __pyx_v_zdim;
  int __pyx_v_n_coords;
  int __pyx_v_radius;
  int __pyx_v_i;
  int __pyx_v_j;
  int __pyx_v_k;
  int __pyx_v_l;
  int __pyx_v_nx;
  int __pyx_v_ny;
  int __pyx_v_nz;
  int __pyx_v_x;
  int __pyx_v_y;
  int __pyx_v_z;
  PyBoolObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("is_overlapp", 0);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line191")'> 191:         long[:,:] ligand_coords,</pre>
<pre id='line191' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line192")'> 192:         long[:] vdw_radii,</pre>
<pre id='line192' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line193")'> 193:         double solvent_score,</pre>
<pre id='line193' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line194")'> 194:         double protein_score):</pre>
<pre id='line194' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line195")'> 195:     cdef int xdim = vdwbox.shape[0]</pre>
<pre id='line195' class='code' style='background-color: #FFFFff'>
  /* "epitopsy/cython/CalculateInteractionEnergyCython.pyx":195
 *         double solvent_score,
 *         double protein_score):
 *     cdef int xdim = vdwbox.shape[0]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     cdef int ydim = vdwbox.shape[1]
 *     cdef int zdim = vdwbox.shape[2]
 */
  __pyx_v_xdim = (__pyx_v_vdwbox.shape[0]);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line196")'> 196:     cdef int ydim = vdwbox.shape[1]</pre>
<pre id='line196' class='code' style='background-color: #FFFFff'>
  /* "epitopsy/cython/CalculateInteractionEnergyCython.pyx":196
 *         double protein_score):
 *     cdef int xdim = vdwbox.shape[0]
 *     cdef int ydim = vdwbox.shape[1]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     cdef int zdim = vdwbox.shape[2]
 *     cdef int n_coords = ligand_coords.shape[0]
 */
  __pyx_v_ydim = (__pyx_v_vdwbox.shape[1]);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line197")'> 197:     cdef int zdim = vdwbox.shape[2]</pre>
<pre id='line197' class='code' style='background-color: #FFFFff'>
  /* "epitopsy/cython/CalculateInteractionEnergyCython.pyx":197
 *     cdef int xdim = vdwbox.shape[0]
 *     cdef int ydim = vdwbox.shape[1]
 *     cdef int zdim = vdwbox.shape[2]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     cdef int n_coords = ligand_coords.shape[0]
 *     cdef int radius = 0
 */
  __pyx_v_zdim = (__pyx_v_vdwbox.shape[2]);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line198")'> 198:     cdef int n_coords = ligand_coords.shape[0]</pre>
<pre id='line198' class='code' style='background-color: #FFFFff'>
  /* "epitopsy/cython/CalculateInteractionEnergyCython.pyx":198
 *     cdef int ydim = vdwbox.shape[1]
 *     cdef int zdim = vdwbox.shape[2]
 *     cdef int n_coords = ligand_coords.shape[0]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     cdef int radius = 0
 *     cdef int i,j,k,l,nx,ny,nz,x,y,z
 */
  __pyx_v_n_coords = (__pyx_v_ligand_coords.shape[0]);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line199")'> 199:     cdef int radius = 0</pre>
<pre id='line199' class='code' style='background-color: #FFFFff'>
  /* "epitopsy/cython/CalculateInteractionEnergyCython.pyx":199
 *     cdef int zdim = vdwbox.shape[2]
 *     cdef int n_coords = ligand_coords.shape[0]
 *     cdef int radius = 0             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     cdef int i,j,k,l,nx,ny,nz,x,y,z
 *     for i in range(n_coords):
 */
  __pyx_v_radius = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line200")'> 200:     cdef int i,j,k,l,nx,ny,nz,x,y,z</pre>
<pre id='line200' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line201")'> 201:     for i in range(n_coords):</pre>
<pre id='line201' class='code' style='background-color: #FFFFff'>
  /* "epitopsy/cython/CalculateInteractionEnergyCython.pyx":201
 *     cdef int radius = 0
 *     cdef int i,j,k,l,nx,ny,nz,x,y,z
 *     for i in range(n_coords):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         x = ligand_coords[i,0]
 *         y = ligand_coords[i,1]
 */
  __pyx_t_1 = __pyx_v_n_coords;
  for (__pyx_t_2 = 0; __pyx_t_2 <code><</code> __pyx_t_1; __pyx_t_2+=1) {
    __pyx_v_i = __pyx_t_2;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line202")'> 202:         x = ligand_coords[i,0]</pre>
<pre id='line202' class='code' style='background-color: #FFFFff'>
    /* "epitopsy/cython/CalculateInteractionEnergyCython.pyx":202
 *     cdef int i,j,k,l,nx,ny,nz,x,y,z
 *     for i in range(n_coords):
 *         x = ligand_coords[i,0]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         y = ligand_coords[i,1]
 *         z = ligand_coords[i,2]
 */
    __pyx_t_3 = __pyx_v_i;
    __pyx_t_4 = 0;
    if (__pyx_t_3 <code><</code> 0) __pyx_t_3 += __pyx_v_ligand_coords.shape[0];
    if (__pyx_t_4 <code><</code> 0) __pyx_t_4 += __pyx_v_ligand_coords.shape[1];
    __pyx_v_x = (*((long *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_ligand_coords.data + __pyx_t_3 * __pyx_v_ligand_coords.strides[0]) ) + __pyx_t_4 * __pyx_v_ligand_coords.strides[1]) )));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line203")'> 203:         y = ligand_coords[i,1]</pre>
<pre id='line203' class='code' style='background-color: #FFFFff'>
    /* "epitopsy/cython/CalculateInteractionEnergyCython.pyx":203
 *     for i in range(n_coords):
 *         x = ligand_coords[i,0]
 *         y = ligand_coords[i,1]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         z = ligand_coords[i,2]
 *         radius = vdw_radii[i]
 */
    __pyx_t_5 = __pyx_v_i;
    __pyx_t_6 = 1;
    if (__pyx_t_5 <code><</code> 0) __pyx_t_5 += __pyx_v_ligand_coords.shape[0];
    if (__pyx_t_6 <code><</code> 0) __pyx_t_6 += __pyx_v_ligand_coords.shape[1];
    __pyx_v_y = (*((long *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_ligand_coords.data + __pyx_t_5 * __pyx_v_ligand_coords.strides[0]) ) + __pyx_t_6 * __pyx_v_ligand_coords.strides[1]) )));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line204")'> 204:         z = ligand_coords[i,2]</pre>
<pre id='line204' class='code' style='background-color: #FFFFff'>
    /* "epitopsy/cython/CalculateInteractionEnergyCython.pyx":204
 *         x = ligand_coords[i,0]
 *         y = ligand_coords[i,1]
 *         z = ligand_coords[i,2]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         radius = vdw_radii[i]
 *         for j in range(-radius,radius+1):
 */
    __pyx_t_7 = __pyx_v_i;
    __pyx_t_8 = 2;
    if (__pyx_t_7 <code><</code> 0) __pyx_t_7 += __pyx_v_ligand_coords.shape[0];
    if (__pyx_t_8 <code><</code> 0) __pyx_t_8 += __pyx_v_ligand_coords.shape[1];
    __pyx_v_z = (*((long *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_ligand_coords.data + __pyx_t_7 * __pyx_v_ligand_coords.strides[0]) ) + __pyx_t_8 * __pyx_v_ligand_coords.strides[1]) )));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line205")'> 205:         radius = vdw_radii[i]</pre>
<pre id='line205' class='code' style='background-color: #FFFFff'>
    /* "epitopsy/cython/CalculateInteractionEnergyCython.pyx":205
 *         y = ligand_coords[i,1]
 *         z = ligand_coords[i,2]
 *         radius = vdw_radii[i]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         for j in range(-radius,radius+1):
 *             for k in range(-radius,radius+1):
 */
    __pyx_t_9 = __pyx_v_i;
    if (__pyx_t_9 <code><</code> 0) __pyx_t_9 += __pyx_v_vdw_radii.shape[0];
    __pyx_v_radius = (*((long *) ( /* dim=0 */ (__pyx_v_vdw_radii.data + __pyx_t_9 * __pyx_v_vdw_radii.strides[0]) )));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line206")'> 206:         for j in range(-radius,radius+1):</pre>
<pre id='line206' class='code' style='background-color: #FFFFff'>
    /* "epitopsy/cython/CalculateInteractionEnergyCython.pyx":206
 *         z = ligand_coords[i,2]
 *         radius = vdw_radii[i]
 *         for j in range(-radius,radius+1):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             for k in range(-radius,radius+1):
 *                 for l in range(-radius,radius+1):
 */
    __pyx_t_10 = (__pyx_v_radius + 1);
    for (__pyx_t_11 = (-__pyx_v_radius); __pyx_t_11 <code><</code> __pyx_t_10; __pyx_t_11+=1) {
      __pyx_v_j = __pyx_t_11;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line207")'> 207:             for k in range(-radius,radius+1):</pre>
<pre id='line207' class='code' style='background-color: #FFFFff'>
      /* "epitopsy/cython/CalculateInteractionEnergyCython.pyx":207
 *         radius = vdw_radii[i]
 *         for j in range(-radius,radius+1):
 *             for k in range(-radius,radius+1):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                 for l in range(-radius,radius+1):
 *                     nx = x + j
 */
      __pyx_t_12 = (__pyx_v_radius + 1);
      for (__pyx_t_13 = (-__pyx_v_radius); __pyx_t_13 <code><</code> __pyx_t_12; __pyx_t_13+=1) {
        __pyx_v_k = __pyx_t_13;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line208")'> 208:                 for l in range(-radius,radius+1):</pre>
<pre id='line208' class='code' style='background-color: #FFFFff'>
        /* "epitopsy/cython/CalculateInteractionEnergyCython.pyx":208
 *         for j in range(-radius,radius+1):
 *             for k in range(-radius,radius+1):
 *                 for l in range(-radius,radius+1):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                     nx = x + j
 *                     ny = y + k
 */
        __pyx_t_14 = (__pyx_v_radius + 1);
        for (__pyx_t_15 = (-__pyx_v_radius); __pyx_t_15 <code><</code> __pyx_t_14; __pyx_t_15+=1) {
          __pyx_v_l = __pyx_t_15;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line209")'> 209:                     nx = x + j</pre>
<pre id='line209' class='code' style='background-color: #FFFFff'>
          /* "epitopsy/cython/CalculateInteractionEnergyCython.pyx":209
 *             for k in range(-radius,radius+1):
 *                 for l in range(-radius,radius+1):
 *                     nx = x + j             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                     ny = y + k
 *                     nz = z + l
 */
          __pyx_v_nx = (__pyx_v_x + __pyx_v_j);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line210")'> 210:                     ny = y + k</pre>
<pre id='line210' class='code' style='background-color: #FFFFff'>
          /* "epitopsy/cython/CalculateInteractionEnergyCython.pyx":210
 *                 for l in range(-radius,radius+1):
 *                     nx = x + j
 *                     ny = y + k             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                     nz = z + l
 *                     if floor(sqrt((nx-x)**2+(ny-y)**2+(nz-z)**2)) <code><</code>= radius:
 */
          __pyx_v_ny = (__pyx_v_y + __pyx_v_k);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line211")'> 211:                     nz = z + l</pre>
<pre id='line211' class='code' style='background-color: #FFFFff'>
          /* "epitopsy/cython/CalculateInteractionEnergyCython.pyx":211
 *                     nx = x + j
 *                     ny = y + k
 *                     nz = z + l             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                     if floor(sqrt((nx-x)**2+(ny-y)**2+(nz-z)**2)) <code><</code>= radius:
 *                         if 0 <code><</code>= nx <code><</code> xdim and 0 <code><</code>= ny <code><</code> ydim and 0 <code><</code>= nz <code><</code> zdim:
 */
          __pyx_v_nz = (__pyx_v_z + __pyx_v_l);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line212")'> 212:                     if floor(sqrt((nx-x)**2+(ny-y)**2+(nz-z)**2)) &lt;= radius:</pre>
<pre id='line212' class='code' style='background-color: #FFFFff'>
          /* "epitopsy/cython/CalculateInteractionEnergyCython.pyx":212
 *                     ny = y + k
 *                     nz = z + l
 *                     if floor(sqrt((nx-x)**2+(ny-y)**2+(nz-z)**2)) <code><</code>= radius:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                         if 0 <code><</code>= nx <code><</code> xdim and 0 <code><</code>= ny <code><</code> ydim and 0 <code><</code>= nz <code><</code> zdim:
 *                             if vdwbox[nx,ny,nz] == protein_score:
 */
          __pyx_t_16 = ((floor(sqrt(((__Pyx_pow_long(((long)(__pyx_v_nx - __pyx_v_x)), 2) + __Pyx_pow_long(((long)(__pyx_v_ny - __pyx_v_y)), 2)) + __Pyx_pow_long(((long)(__pyx_v_nz - __pyx_v_z)), 2)))) <code><</code>= __pyx_v_radius) != 0);
          if (__pyx_t_16) {
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line213")'> 213:                         if 0 &lt;= nx &lt; xdim and 0 &lt;= ny &lt; ydim and 0 &lt;= nz &lt; zdim:</pre>
<pre id='line213' class='code' style='background-color: #FFFFff'>
            /* "epitopsy/cython/CalculateInteractionEnergyCython.pyx":213
 *                     nz = z + l
 *                     if floor(sqrt((nx-x)**2+(ny-y)**2+(nz-z)**2)) <code><</code>= radius:
 *                         if 0 <code><</code>= nx <code><</code> xdim and 0 <code><</code>= ny <code><</code> ydim and 0 <code><</code>= nz <code><</code> zdim:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                             if vdwbox[nx,ny,nz] == protein_score:
 *                                 return True
 */
            __pyx_t_16 = (0 <code><</code>= __pyx_v_nx);
            if (__pyx_t_16) {
              __pyx_t_16 = (__pyx_v_nx <code><</code> __pyx_v_xdim);
            }
            if ((__pyx_t_16 != 0)) {
              __pyx_t_17 = (0 <code><</code>= __pyx_v_ny);
              if (__pyx_t_17) {
                __pyx_t_17 = (__pyx_v_ny <code><</code> __pyx_v_ydim);
              }
              if ((__pyx_t_17 != 0)) {
                __pyx_t_18 = (0 <code><</code>= __pyx_v_nz);
                if (__pyx_t_18) {
                  __pyx_t_18 = (__pyx_v_nz <code><</code> __pyx_v_zdim);
                }
                __pyx_t_19 = (__pyx_t_18 != 0);
              } else {
                __pyx_t_19 = (__pyx_t_17 != 0);
              }
              __pyx_t_17 = __pyx_t_19;
            } else {
              __pyx_t_17 = (__pyx_t_16 != 0);
            }
            if (__pyx_t_17) {
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line214")'> 214:                             if vdwbox[nx,ny,nz] == protein_score:</pre>
<pre id='line214' class='code' style='background-color: #FFFFff'>
              /* "epitopsy/cython/CalculateInteractionEnergyCython.pyx":214
 *                     if floor(sqrt((nx-x)**2+(ny-y)**2+(nz-z)**2)) <code><</code>= radius:
 *                         if 0 <code><</code>= nx <code><</code> xdim and 0 <code><</code>= ny <code><</code> ydim and 0 <code><</code>= nz <code><</code> zdim:
 *                             if vdwbox[nx,ny,nz] == protein_score:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                                 return True
 * 
 */
              __pyx_t_20 = __pyx_v_nx;
              __pyx_t_21 = __pyx_v_ny;
              __pyx_t_22 = __pyx_v_nz;
              if (__pyx_t_20 <code><</code> 0) __pyx_t_20 += __pyx_v_vdwbox.shape[0];
              if (__pyx_t_21 <code><</code> 0) __pyx_t_21 += __pyx_v_vdwbox.shape[1];
              if (__pyx_t_22 <code><</code> 0) __pyx_t_22 += __pyx_v_vdwbox.shape[2];
              __pyx_t_17 = (((*((double *) ( /* dim=2 */ (( /* dim=1 */ (( /* dim=0 */ (__pyx_v_vdwbox.data + __pyx_t_20 * __pyx_v_vdwbox.strides[0]) ) + __pyx_t_21 * __pyx_v_vdwbox.strides[1]) ) + __pyx_t_22 * __pyx_v_vdwbox.strides[2]) ))) == __pyx_v_protein_score) != 0);
              if (__pyx_t_17) {
</pre><pre class='line' style='background-color: #FFFF8d' onclick='toggleDiv("line215")'> 215:                                 return True</pre>
<pre id='line215' class='code' style='background-color: #FFFF8d'>
                /* "epitopsy/cython/CalculateInteractionEnergyCython.pyx":215
 *                         if 0 <code><</code>= nx <code><</code> xdim and 0 <code><</code>= ny <code><</code> ydim and 0 <code><</code>= nz <code><</code> zdim:
 *                             if vdwbox[nx,ny,nz] == protein_score:
 *                                 return True             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     return False
 */
                <span class='pyx_macro_api'>__Pyx_XDECREF</span>(((PyObject *)__pyx_r));
                __pyx_t_23 = __Pyx_<span class='py_c_api'>PyBool_FromLong</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_23)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 215; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
                <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_23);
                if (!(likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_23, __pyx_ptype_7cpython_4bool_bool))))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 215; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
                __pyx_r = ((PyBoolObject *)__pyx_t_23);
                __pyx_t_23 = 0;
                goto __pyx_L0;
                goto __pyx_L13;
              }
              __pyx_L13:;
              goto __pyx_L12;
            }
            __pyx_L12:;
            goto __pyx_L11;
          }
          __pyx_L11:;
        }
      }
    }
  }
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line216")'> 216: </pre>
<pre id='line216' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF6e' onclick='toggleDiv("line217")'> 217:     return False</pre>
<pre id='line217' class='code' style='background-color: #FFFF6e'>
  /* "epitopsy/cython/CalculateInteractionEnergyCython.pyx":217
 *                                 return True
 * 
 *     return False             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * # This version should work fine, if one changes something, please comment these
 */
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(((PyObject *)__pyx_r));
  __pyx_t_23 = __Pyx_<span class='py_c_api'>PyBool_FromLong</span>(0);<span class='error_goto'> if (unlikely(!__pyx_t_23)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 217; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_23);
  if (!(likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_23, __pyx_ptype_7cpython_4bool_bool))))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 217; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_r = ((PyBoolObject *)__pyx_t_23);
  __pyx_t_23 = 0;
  goto __pyx_L0;

  __pyx_r = ((PyBoolObject *)Py_None); <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_23);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("epitopsy.cython.CalculateInteractionEnergyCython.is_overlapp", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = 0;
  __pyx_L0:;
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>((PyObject *)__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line218")'> 218: </pre>
<pre id='line218' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line219")'> 219: # This version should work fine, if one changes something, please comment these</pre>
<pre id='line219' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line220")'> 220: # options</pre>
<pre id='line220' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line221")'> 221: @cython.cdivision(True)</pre>
<pre id='line221' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line222")'> 222: @cython.boundscheck(False)</pre>
<pre id='line222' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line223")'> 223: cdef double score_energy(double[:,:,:] potbox,</pre>
<pre id='line223' class='code' style='background-color: #FFFFff'>
/* "epitopsy/cython/CalculateInteractionEnergyCython.pyx":223
 * @cython.cdivision(True)
 * @cython.boundscheck(False)
 * cdef double score_energy(double[:,:,:] potbox,             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         long[:,:] ligand_coords,
 *         double[:] charges):
 */

static double __pyx_f_8epitopsy_6cython_32CalculateInteractionEnergyCython_score_energy(__Pyx_memviewslice __pyx_v_potbox, __Pyx_memviewslice __pyx_v_ligand_coords, __Pyx_memviewslice __pyx_v_charges) {
  int __pyx_v_n_coords;
  double __pyx_v_energy;
  CYTHON_UNUSED double __pyx_v_pot_value;
  long __pyx_v_x;
  long __pyx_v_y;
  long __pyx_v_z;
  int __pyx_v_i;
  double __pyx_r;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("score_energy", 0);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line224")'> 224:         long[:,:] ligand_coords,</pre>
<pre id='line224' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line225")'> 225:         double[:] charges):</pre>
<pre id='line225' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line226")'> 226:     cdef int n_coords = ligand_coords.shape[0]</pre>
<pre id='line226' class='code' style='background-color: #FFFFff'>
  /* "epitopsy/cython/CalculateInteractionEnergyCython.pyx":226
 *         long[:,:] ligand_coords,
 *         double[:] charges):
 *     cdef int n_coords = ligand_coords.shape[0]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     cdef double energy = 0.
 *     cdef double pot_value = 0.
 */
  __pyx_v_n_coords = (__pyx_v_ligand_coords.shape[0]);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line227")'> 227:     cdef double energy = 0.</pre>
<pre id='line227' class='code' style='background-color: #FFFFff'>
  /* "epitopsy/cython/CalculateInteractionEnergyCython.pyx":227
 *         double[:] charges):
 *     cdef int n_coords = ligand_coords.shape[0]
 *     cdef double energy = 0.             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     cdef double pot_value = 0.
 *     cdef long x,y,z
 */
  __pyx_v_energy = 0.;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line228")'> 228:     cdef double pot_value = 0.</pre>
<pre id='line228' class='code' style='background-color: #FFFFff'>
  /* "epitopsy/cython/CalculateInteractionEnergyCython.pyx":228
 *     cdef int n_coords = ligand_coords.shape[0]
 *     cdef double energy = 0.
 *     cdef double pot_value = 0.             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     cdef long x,y,z
 *     cdef int i
 */
  __pyx_v_pot_value = 0.;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line229")'> 229:     cdef long x,y,z</pre>
<pre id='line229' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line230")'> 230:     cdef int i</pre>
<pre id='line230' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line231")'> 231:     for i in range(n_coords):</pre>
<pre id='line231' class='code' style='background-color: #FFFFff'>
  /* "epitopsy/cython/CalculateInteractionEnergyCython.pyx":231
 *     cdef long x,y,z
 *     cdef int i
 *     for i in range(n_coords):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         x = ligand_coords[i,0]
 *         y = ligand_coords[i,1]
 */
  __pyx_t_1 = __pyx_v_n_coords;
  for (__pyx_t_2 = 0; __pyx_t_2 <code><</code> __pyx_t_1; __pyx_t_2+=1) {
    __pyx_v_i = __pyx_t_2;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line232")'> 232:         x = ligand_coords[i,0]</pre>
<pre id='line232' class='code' style='background-color: #FFFFff'>
    /* "epitopsy/cython/CalculateInteractionEnergyCython.pyx":232
 *     cdef int i
 *     for i in range(n_coords):
 *         x = ligand_coords[i,0]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         y = ligand_coords[i,1]
 *         z = ligand_coords[i,2]
 */
    __pyx_t_3 = __pyx_v_i;
    __pyx_t_4 = 0;
    if (__pyx_t_3 <code><</code> 0) __pyx_t_3 += __pyx_v_ligand_coords.shape[0];
    if (__pyx_t_4 <code><</code> 0) __pyx_t_4 += __pyx_v_ligand_coords.shape[1];
    __pyx_v_x = (*((long *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_ligand_coords.data + __pyx_t_3 * __pyx_v_ligand_coords.strides[0]) ) + __pyx_t_4 * __pyx_v_ligand_coords.strides[1]) )));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line233")'> 233:         y = ligand_coords[i,1]</pre>
<pre id='line233' class='code' style='background-color: #FFFFff'>
    /* "epitopsy/cython/CalculateInteractionEnergyCython.pyx":233
 *     for i in range(n_coords):
 *         x = ligand_coords[i,0]
 *         y = ligand_coords[i,1]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         z = ligand_coords[i,2]
 *         energy += potbox[x,y,z] * charges[i]
 */
    __pyx_t_5 = __pyx_v_i;
    __pyx_t_6 = 1;
    if (__pyx_t_5 <code><</code> 0) __pyx_t_5 += __pyx_v_ligand_coords.shape[0];
    if (__pyx_t_6 <code><</code> 0) __pyx_t_6 += __pyx_v_ligand_coords.shape[1];
    __pyx_v_y = (*((long *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_ligand_coords.data + __pyx_t_5 * __pyx_v_ligand_coords.strides[0]) ) + __pyx_t_6 * __pyx_v_ligand_coords.strides[1]) )));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line234")'> 234:         z = ligand_coords[i,2]</pre>
<pre id='line234' class='code' style='background-color: #FFFFff'>
    /* "epitopsy/cython/CalculateInteractionEnergyCython.pyx":234
 *         x = ligand_coords[i,0]
 *         y = ligand_coords[i,1]
 *         z = ligand_coords[i,2]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         energy += potbox[x,y,z] * charges[i]
 * 
 */
    __pyx_t_7 = __pyx_v_i;
    __pyx_t_8 = 2;
    if (__pyx_t_7 <code><</code> 0) __pyx_t_7 += __pyx_v_ligand_coords.shape[0];
    if (__pyx_t_8 <code><</code> 0) __pyx_t_8 += __pyx_v_ligand_coords.shape[1];
    __pyx_v_z = (*((long *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_ligand_coords.data + __pyx_t_7 * __pyx_v_ligand_coords.strides[0]) ) + __pyx_t_8 * __pyx_v_ligand_coords.strides[1]) )));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line235")'> 235:         energy += potbox[x,y,z] * charges[i]</pre>
<pre id='line235' class='code' style='background-color: #FFFFff'>
    /* "epitopsy/cython/CalculateInteractionEnergyCython.pyx":235
 *         y = ligand_coords[i,1]
 *         z = ligand_coords[i,2]
 *         energy += potbox[x,y,z] * charges[i]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     return energy
 */
    __pyx_t_9 = __pyx_v_x;
    __pyx_t_10 = __pyx_v_y;
    __pyx_t_11 = __pyx_v_z;
    if (__pyx_t_9 <code><</code> 0) __pyx_t_9 += __pyx_v_potbox.shape[0];
    if (__pyx_t_10 <code><</code> 0) __pyx_t_10 += __pyx_v_potbox.shape[1];
    if (__pyx_t_11 <code><</code> 0) __pyx_t_11 += __pyx_v_potbox.shape[2];
    __pyx_t_12 = __pyx_v_i;
    if (__pyx_t_12 <code><</code> 0) __pyx_t_12 += __pyx_v_charges.shape[0];
    __pyx_v_energy = (__pyx_v_energy + ((*((double *) ( /* dim=2 */ (( /* dim=1 */ (( /* dim=0 */ (__pyx_v_potbox.data + __pyx_t_9 * __pyx_v_potbox.strides[0]) ) + __pyx_t_10 * __pyx_v_potbox.strides[1]) ) + __pyx_t_11 * __pyx_v_potbox.strides[2]) ))) * (*((double *) ( /* dim=0 */ (__pyx_v_charges.data + __pyx_t_12 * __pyx_v_charges.strides[0]) )))));
  }
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line236")'> 236: </pre>
<pre id='line236' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFe7' onclick='toggleDiv("line237")'> 237:     return energy</pre>
<pre id='line237' class='code' style='background-color: #FFFFe7'>
  /* "epitopsy/cython/CalculateInteractionEnergyCython.pyx":237
 *         energy += potbox[x,y,z] * charges[i]
 * 
 *     return energy             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * # This version should work fine, if one changes something, please comment these
 */
  __pyx_r = __pyx_v_energy;
  goto __pyx_L0;

  __pyx_r = 0;
  __pyx_L0:;
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line238")'> 238: </pre>
<pre id='line238' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line239")'> 239: # This version should work fine, if one changes something, please comment these</pre>
<pre id='line239' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line240")'> 240: # options</pre>
<pre id='line240' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line241")'> 241: @cython.cdivision(True)</pre>
<pre id='line241' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line242")'> 242: @cython.boundscheck(False)</pre>
<pre id='line242' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line243")'> 243: cdef double[:,:] move_ligand(double[:,:] ligand_real_coords,</pre>
<pre id='line243' class='code' style='background-color: #FFFFff'>
/* "epitopsy/cython/CalculateInteractionEnergyCython.pyx":243
 * @cython.cdivision(True)
 * @cython.boundscheck(False)
 * cdef double[:,:] move_ligand(double[:,:] ligand_real_coords,             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         double[:] coords):
 *     cdef double[:] mean = np.zeros(3)
 */

static __Pyx_memviewslice __pyx_f_8epitopsy_6cython_32CalculateInteractionEnergyCython_move_ligand(__Pyx_memviewslice __pyx_v_ligand_real_coords, __Pyx_memviewslice __pyx_v_coords) {
  __Pyx_memviewslice __pyx_v_mean = { 0, 0, { 0 }, { 0 }, { 0 } };
  __Pyx_memviewslice __pyx_v_shift = { 0, 0, { 0 }, { 0 }, { 0 } };
  int __pyx_v_n_coords;
  __Pyx_memviewslice __pyx_v_new_ligand_real_coords = { 0, 0, { 0 }, { 0 }, { 0 } };
  int __pyx_v_i;
  int __pyx_v_j;
  double __pyx_v_n_atoms;
  __Pyx_memviewslice __pyx_r = { 0, 0, { 0 }, { 0 }, { 0 } };
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("move_ligand", 0);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line244")'> 244:         double[:] coords):</pre>
<pre id='line244' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF4f' onclick='toggleDiv("line245")'> 245:     cdef double[:] mean = np.zeros(3)</pre>
<pre id='line245' class='code' style='background-color: #FFFF4f'>
  /* "epitopsy/cython/CalculateInteractionEnergyCython.pyx":245
 * cdef double[:,:] move_ligand(double[:,:] ligand_real_coords,
 *         double[:] coords):
 *     cdef double[:] mean = np.zeros(3)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     cdef double[:] shift = np.zeros(3)
 *     cdef int n_coords = ligand_real_coords.shape[0]
 */
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s__np);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 245; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  __pyx_t_2 = __Pyx_<span class='py_c_api'>PyObject_GetAttrStr</span>(__pyx_t_1, __pyx_n_s__zeros);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 245; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = <span class='py_c_api'>PyObject_Call</span>(__pyx_t_2, ((PyObject *)__pyx_k_tuple_4), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 245; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_double</span>(__pyx_t_1);
  if (unlikely(!__pyx_t_3.memview))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 245; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_v_mean = __pyx_t_3;
  __pyx_t_3.memview = NULL;
  __pyx_t_3.data = NULL;

  /* "epitopsy/cython/CalculateInteractionEnergyCython.pyx":245
 * cdef double[:,:] move_ligand(double[:,:] ligand_real_coords,
 *         double[:] coords):
 *     cdef double[:] mean = np.zeros(3)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     cdef double[:] shift = np.zeros(3)
 *     cdef int n_coords = ligand_real_coords.shape[0]
 */
  __pyx_k_tuple_4 = <span class='py_c_api'>PyTuple_Pack</span>(1, __pyx_int_3);<span class='error_goto'> if (unlikely(!__pyx_k_tuple_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 245; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_k_tuple_4);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_k_tuple_4));
</pre><pre class='line' style='background-color: #FFFF4f' onclick='toggleDiv("line246")'> 246:     cdef double[:] shift = np.zeros(3)</pre>
<pre id='line246' class='code' style='background-color: #FFFF4f'>
  /* "epitopsy/cython/CalculateInteractionEnergyCython.pyx":246
 *         double[:] coords):
 *     cdef double[:] mean = np.zeros(3)
 *     cdef double[:] shift = np.zeros(3)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     cdef int n_coords = ligand_real_coords.shape[0]
 *     cdef double[:,:] new_ligand_real_coords = np.zeros([n_coords,3])
 */
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s__np);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 246; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  __pyx_t_2 = __Pyx_<span class='py_c_api'>PyObject_GetAttrStr</span>(__pyx_t_1, __pyx_n_s__zeros);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 246; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = <span class='py_c_api'>PyObject_Call</span>(__pyx_t_2, ((PyObject *)__pyx_k_tuple_5), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 246; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_double</span>(__pyx_t_1);
  if (unlikely(!__pyx_t_4.memview))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 246; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_v_shift = __pyx_t_4;
  __pyx_t_4.memview = NULL;
  __pyx_t_4.data = NULL;

  /* "epitopsy/cython/CalculateInteractionEnergyCython.pyx":246
 *         double[:] coords):
 *     cdef double[:] mean = np.zeros(3)
 *     cdef double[:] shift = np.zeros(3)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     cdef int n_coords = ligand_real_coords.shape[0]
 *     cdef double[:,:] new_ligand_real_coords = np.zeros([n_coords,3])
 */
  __pyx_k_tuple_5 = <span class='py_c_api'>PyTuple_Pack</span>(1, __pyx_int_3);<span class='error_goto'> if (unlikely(!__pyx_k_tuple_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 246; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_k_tuple_5);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_k_tuple_5));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line247")'> 247:     cdef int n_coords = ligand_real_coords.shape[0]</pre>
<pre id='line247' class='code' style='background-color: #FFFFff'>
  /* "epitopsy/cython/CalculateInteractionEnergyCython.pyx":247
 *     cdef double[:] mean = np.zeros(3)
 *     cdef double[:] shift = np.zeros(3)
 *     cdef int n_coords = ligand_real_coords.shape[0]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     cdef double[:,:] new_ligand_real_coords = np.zeros([n_coords,3])
 *     cdef int i,j
 */
  __pyx_v_n_coords = (__pyx_v_ligand_real_coords.shape[0]);
</pre><pre class='line' style='background-color: #FFFF36' onclick='toggleDiv("line248")'> 248:     cdef double[:,:] new_ligand_real_coords = np.zeros([n_coords,3])</pre>
<pre id='line248' class='code' style='background-color: #FFFF36'>
  /* "epitopsy/cython/CalculateInteractionEnergyCython.pyx":248
 *     cdef double[:] shift = np.zeros(3)
 *     cdef int n_coords = ligand_real_coords.shape[0]
 *     cdef double[:,:] new_ligand_real_coords = np.zeros([n_coords,3])             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     cdef int i,j
 *     for i in range(n_coords):
 */
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s__np);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 248; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  __pyx_t_2 = __Pyx_<span class='py_c_api'>PyObject_GetAttrStr</span>(__pyx_t_1, __pyx_n_s__zeros);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 248; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = <span class='py_c_api'>PyInt_FromLong</span>(__pyx_v_n_coords);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 248; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  __pyx_t_5 = <span class='py_c_api'>PyList_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 248; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_5);
  <span class='py_macro_api'>PyList_SET_ITEM</span>(__pyx_t_5, 0, __pyx_t_1);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_int_3);
  <span class='py_macro_api'>PyList_SET_ITEM</span>(__pyx_t_5, 1, __pyx_int_3);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_int_3);
  __pyx_t_1 = 0;
  __pyx_t_1 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 248; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 0, ((PyObject *)__pyx_t_5));
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_t_5));
  __pyx_t_5 = 0;
  __pyx_t_5 = <span class='py_c_api'>PyObject_Call</span>(__pyx_t_2, ((PyObject *)__pyx_t_1), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 248; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_5);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;
  __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_dsds_double</span>(__pyx_t_5);
  if (unlikely(!__pyx_t_6.memview))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 248; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
  __pyx_v_new_ligand_real_coords = __pyx_t_6;
  __pyx_t_6.memview = NULL;
  __pyx_t_6.data = NULL;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line249")'> 249:     cdef int i,j</pre>
<pre id='line249' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line250")'> 250:     for i in range(n_coords):</pre>
<pre id='line250' class='code' style='background-color: #FFFFff'>
  /* "epitopsy/cython/CalculateInteractionEnergyCython.pyx":250
 *     cdef double[:,:] new_ligand_real_coords = np.zeros([n_coords,3])
 *     cdef int i,j
 *     for i in range(n_coords):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         for j in range(3):
 *             mean[j] += ligand_real_coords[i,j]
 */
  __pyx_t_7 = __pyx_v_n_coords;
  for (__pyx_t_8 = 0; __pyx_t_8 <code><</code> __pyx_t_7; __pyx_t_8+=1) {
    __pyx_v_i = __pyx_t_8;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line251")'> 251:         for j in range(3):</pre>
<pre id='line251' class='code' style='background-color: #FFFFff'>
    /* "epitopsy/cython/CalculateInteractionEnergyCython.pyx":251
 *     cdef int i,j
 *     for i in range(n_coords):
 *         for j in range(3):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             mean[j] += ligand_real_coords[i,j]
 * 
 */
    for (__pyx_t_9 = 0; __pyx_t_9 <code><</code> 3; __pyx_t_9+=1) {
      __pyx_v_j = __pyx_t_9;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line252")'> 252:             mean[j] += ligand_real_coords[i,j]</pre>
<pre id='line252' class='code' style='background-color: #FFFFff'>
      /* "epitopsy/cython/CalculateInteractionEnergyCython.pyx":252
 *     for i in range(n_coords):
 *         for j in range(3):
 *             mean[j] += ligand_real_coords[i,j]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     cdef double n_atoms = <code><</code>double> n_coords
 */
      __pyx_t_10 = __pyx_v_i;
      __pyx_t_11 = __pyx_v_j;
      if (__pyx_t_10 <code><</code> 0) __pyx_t_10 += __pyx_v_ligand_real_coords.shape[0];
      if (__pyx_t_11 <code><</code> 0) __pyx_t_11 += __pyx_v_ligand_real_coords.shape[1];
      __pyx_t_12 = __pyx_v_j;
      if (__pyx_t_12 <code><</code> 0) __pyx_t_12 += __pyx_v_mean.shape[0];
      *((double *) ( /* dim=0 */ (__pyx_v_mean.data + __pyx_t_12 * __pyx_v_mean.strides[0]) )) += (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_ligand_real_coords.data + __pyx_t_10 * __pyx_v_ligand_real_coords.strides[0]) ) + __pyx_t_11 * __pyx_v_ligand_real_coords.strides[1]) )));
    }
  }
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line253")'> 253: </pre>
<pre id='line253' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line254")'> 254:     cdef double n_atoms = &lt;double&gt; n_coords</pre>
<pre id='line254' class='code' style='background-color: #FFFFff'>
  /* "epitopsy/cython/CalculateInteractionEnergyCython.pyx":254
 *             mean[j] += ligand_real_coords[i,j]
 * 
 *     cdef double n_atoms = <code><</code>double> n_coords             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     for i in range(3):
 *         mean[i] = mean[i] / n_atoms
 */
  __pyx_v_n_atoms = ((double)__pyx_v_n_coords);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line255")'> 255:     for i in range(3):</pre>
<pre id='line255' class='code' style='background-color: #FFFFff'>
  /* "epitopsy/cython/CalculateInteractionEnergyCython.pyx":255
 * 
 *     cdef double n_atoms = <code><</code>double> n_coords
 *     for i in range(3):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         mean[i] = mean[i] / n_atoms
 *         shift[i] = coords[i] - mean[i]
 */
  for (__pyx_t_7 = 0; __pyx_t_7 <code><</code> 3; __pyx_t_7+=1) {
    __pyx_v_i = __pyx_t_7;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line256")'> 256:         mean[i] = mean[i] / n_atoms</pre>
<pre id='line256' class='code' style='background-color: #FFFFff'>
    /* "epitopsy/cython/CalculateInteractionEnergyCython.pyx":256
 *     cdef double n_atoms = <code><</code>double> n_coords
 *     for i in range(3):
 *         mean[i] = mean[i] / n_atoms             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         shift[i] = coords[i] - mean[i]
 * 
 */
    __pyx_t_8 = __pyx_v_i;
    if (__pyx_t_8 <code><</code> 0) __pyx_t_8 += __pyx_v_mean.shape[0];
    __pyx_t_9 = __pyx_v_i;
    if (__pyx_t_9 <code><</code> 0) __pyx_t_9 += __pyx_v_mean.shape[0];
    *((double *) ( /* dim=0 */ (__pyx_v_mean.data + __pyx_t_9 * __pyx_v_mean.strides[0]) )) = ((*((double *) ( /* dim=0 */ (__pyx_v_mean.data + __pyx_t_8 * __pyx_v_mean.strides[0]) ))) / __pyx_v_n_atoms);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line257")'> 257:         shift[i] = coords[i] - mean[i]</pre>
<pre id='line257' class='code' style='background-color: #FFFFff'>
    /* "epitopsy/cython/CalculateInteractionEnergyCython.pyx":257
 *     for i in range(3):
 *         mean[i] = mean[i] / n_atoms
 *         shift[i] = coords[i] - mean[i]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     for i in range(n_coords):
 */
    __pyx_t_13 = __pyx_v_i;
    if (__pyx_t_13 <code><</code> 0) __pyx_t_13 += __pyx_v_coords.shape[0];
    __pyx_t_14 = __pyx_v_i;
    if (__pyx_t_14 <code><</code> 0) __pyx_t_14 += __pyx_v_mean.shape[0];
    __pyx_t_15 = __pyx_v_i;
    if (__pyx_t_15 <code><</code> 0) __pyx_t_15 += __pyx_v_shift.shape[0];
    *((double *) ( /* dim=0 */ (__pyx_v_shift.data + __pyx_t_15 * __pyx_v_shift.strides[0]) )) = ((*((double *) ( /* dim=0 */ (__pyx_v_coords.data + __pyx_t_13 * __pyx_v_coords.strides[0]) ))) - (*((double *) ( /* dim=0 */ (__pyx_v_mean.data + __pyx_t_14 * __pyx_v_mean.strides[0]) ))));
  }
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line258")'> 258: </pre>
<pre id='line258' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line259")'> 259:     for i in range(n_coords):</pre>
<pre id='line259' class='code' style='background-color: #FFFFff'>
  /* "epitopsy/cython/CalculateInteractionEnergyCython.pyx":259
 *         shift[i] = coords[i] - mean[i]
 * 
 *     for i in range(n_coords):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         for j in range(3):
 *             new_ligand_real_coords[i,j] = ligand_real_coords[i,j] + shift[j]
 */
  __pyx_t_7 = __pyx_v_n_coords;
  for (__pyx_t_16 = 0; __pyx_t_16 <code><</code> __pyx_t_7; __pyx_t_16+=1) {
    __pyx_v_i = __pyx_t_16;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line260")'> 260:         for j in range(3):</pre>
<pre id='line260' class='code' style='background-color: #FFFFff'>
    /* "epitopsy/cython/CalculateInteractionEnergyCython.pyx":260
 * 
 *     for i in range(n_coords):
 *         for j in range(3):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             new_ligand_real_coords[i,j] = ligand_real_coords[i,j] + shift[j]
 * 
 */
    for (__pyx_t_17 = 0; __pyx_t_17 <code><</code> 3; __pyx_t_17+=1) {
      __pyx_v_j = __pyx_t_17;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line261")'> 261:             new_ligand_real_coords[i,j] = ligand_real_coords[i,j] + shift[j]</pre>
<pre id='line261' class='code' style='background-color: #FFFFff'>
      /* "epitopsy/cython/CalculateInteractionEnergyCython.pyx":261
 *     for i in range(n_coords):
 *         for j in range(3):
 *             new_ligand_real_coords[i,j] = ligand_real_coords[i,j] + shift[j]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     return new_ligand_real_coords
 */
      __pyx_t_18 = __pyx_v_i;
      __pyx_t_19 = __pyx_v_j;
      if (__pyx_t_18 <code><</code> 0) __pyx_t_18 += __pyx_v_ligand_real_coords.shape[0];
      if (__pyx_t_19 <code><</code> 0) __pyx_t_19 += __pyx_v_ligand_real_coords.shape[1];
      __pyx_t_20 = __pyx_v_j;
      if (__pyx_t_20 <code><</code> 0) __pyx_t_20 += __pyx_v_shift.shape[0];
      __pyx_t_21 = __pyx_v_i;
      __pyx_t_22 = __pyx_v_j;
      if (__pyx_t_21 <code><</code> 0) __pyx_t_21 += __pyx_v_new_ligand_real_coords.shape[0];
      if (__pyx_t_22 <code><</code> 0) __pyx_t_22 += __pyx_v_new_ligand_real_coords.shape[1];
      *((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_new_ligand_real_coords.data + __pyx_t_21 * __pyx_v_new_ligand_real_coords.strides[0]) ) + __pyx_t_22 * __pyx_v_new_ligand_real_coords.strides[1]) )) = ((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_ligand_real_coords.data + __pyx_t_18 * __pyx_v_ligand_real_coords.strides[0]) ) + __pyx_t_19 * __pyx_v_ligand_real_coords.strides[1]) ))) + (*((double *) ( /* dim=0 */ (__pyx_v_shift.data + __pyx_t_20 * __pyx_v_shift.strides[0]) ))));
    }
  }
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line262")'> 262: </pre>
<pre id='line262' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF79' onclick='toggleDiv("line263")'> 263:     return new_ligand_real_coords</pre>
<pre id='line263' class='code' style='background-color: #FFFF79'>
  /* "epitopsy/cython/CalculateInteractionEnergyCython.pyx":263
 *             new_ligand_real_coords[i,j] = ligand_real_coords[i,j] + shift[j]
 * 
 *     return new_ligand_real_coords             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * # This version should work fine, if one changes something, please comment these
 */
  __PYX_INC_MEMVIEW(&__pyx_v_new_ligand_real_coords, 0);
  __pyx_r = __pyx_v_new_ligand_real_coords;
  goto __pyx_L0;

  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  __PYX_XDEC_MEMVIEW(&__pyx_t_3, 1);
  __PYX_XDEC_MEMVIEW(&__pyx_t_4, 1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_5);
  __PYX_XDEC_MEMVIEW(&__pyx_t_6, 1);
  __pyx_r.data = NULL;
  __pyx_r.memview = NULL;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("epitopsy.cython.CalculateInteractionEnergyCython.move_ligand", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = __pyx_r;
  goto __pyx_L2;
  __pyx_L0:;
  if (unlikely(!__pyx_r.memview)) {
    <span class='py_c_api'>PyErr_SetString</span>(PyExc_TypeError,"Memoryview return value is not initialized");
  }
  __pyx_L2:;
  __PYX_XDEC_MEMVIEW(&__pyx_v_mean, 1);
  __PYX_XDEC_MEMVIEW(&__pyx_v_shift, 1);
  __PYX_XDEC_MEMVIEW(&__pyx_v_new_ligand_real_coords, 1);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line264")'> 264: </pre>
<pre id='line264' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line265")'> 265: # This version should work fine, if one changes something, please comment these</pre>
<pre id='line265' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line266")'> 266: # options</pre>
<pre id='line266' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line267")'> 267: @cython.cdivision(True)</pre>
<pre id='line267' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line268")'> 268: @cython.boundscheck(False)</pre>
<pre id='line268' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line269")'> 269: cdef long[:,:] transform_ligand_to_box(double[:,:] ligand_real_coords,</pre>
<pre id='line269' class='code' style='background-color: #FFFFff'>
/* "epitopsy/cython/CalculateInteractionEnergyCython.pyx":269
 * @cython.cdivision(True)
 * @cython.boundscheck(False)
 * cdef long[:,:] transform_ligand_to_box(double[:,:] ligand_real_coords,             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         double[:] box_mesh_size,
 *         double[:] box_offset):
 */

static __Pyx_memviewslice __pyx_f_8epitopsy_6cython_32CalculateInteractionEnergyCython_transform_ligand_to_box(__Pyx_memviewslice __pyx_v_ligand_real_coords, __Pyx_memviewslice __pyx_v_box_mesh_size, __Pyx_memviewslice __pyx_v_box_offset) {
  int __pyx_v_n_coords;
  __Pyx_memviewslice __pyx_v_new_ligand_coords = { 0, 0, { 0 }, { 0 }, { 0 } };
  __Pyx_memviewslice __pyx_v_new_coords = { 0, 0, { 0 }, { 0 }, { 0 } };
  __Pyx_memviewslice __pyx_v_old_coords = { 0, 0, { 0 }, { 0 }, { 0 } };
  int __pyx_v_i;
  int __pyx_v_j;
  __Pyx_memviewslice __pyx_r = { 0, 0, { 0 }, { 0 }, { 0 } };
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("transform_ligand_to_box", 0);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line270")'> 270:         double[:] box_mesh_size,</pre>
<pre id='line270' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line271")'> 271:         double[:] box_offset):</pre>
<pre id='line271' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line272")'> 272:     cdef int n_coords = ligand_real_coords.shape[0]</pre>
<pre id='line272' class='code' style='background-color: #FFFFff'>
  /* "epitopsy/cython/CalculateInteractionEnergyCython.pyx":272
 *         double[:] box_mesh_size,
 *         double[:] box_offset):
 *     cdef int n_coords = ligand_real_coords.shape[0]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     cdef long[:,:] new_ligand_coords = np.zeros([n_coords,3],dtype=np.int)
 *     cdef long[:] new_coords = np.zeros(3,dtype=np.int)
 */
  __pyx_v_n_coords = (__pyx_v_ligand_real_coords.shape[0]);
</pre><pre class='line' style='background-color: #FFFF26' onclick='toggleDiv("line273")'> 273:     cdef long[:,:] new_ligand_coords = np.zeros([n_coords,3],dtype=np.int)</pre>
<pre id='line273' class='code' style='background-color: #FFFF26'>
  /* "epitopsy/cython/CalculateInteractionEnergyCython.pyx":273
 *         double[:] box_offset):
 *     cdef int n_coords = ligand_real_coords.shape[0]
 *     cdef long[:,:] new_ligand_coords = np.zeros([n_coords,3],dtype=np.int)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     cdef long[:] new_coords = np.zeros(3,dtype=np.int)
 *     cdef double[:] old_coords = np.zeros(3)
 */
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s__np);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 273; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  __pyx_t_2 = __Pyx_<span class='py_c_api'>PyObject_GetAttrStr</span>(__pyx_t_1, __pyx_n_s__zeros);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 273; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = <span class='py_c_api'>PyInt_FromLong</span>(__pyx_v_n_coords);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 273; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  __pyx_t_3 = <span class='py_c_api'>PyList_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 273; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
  <span class='py_macro_api'>PyList_SET_ITEM</span>(__pyx_t_3, 0, __pyx_t_1);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_int_3);
  <span class='py_macro_api'>PyList_SET_ITEM</span>(__pyx_t_3, 1, __pyx_int_3);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_int_3);
  __pyx_t_1 = 0;
  __pyx_t_1 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 273; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 0, ((PyObject *)__pyx_t_3));
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_t_3));
  __pyx_t_3 = 0;
  __pyx_t_3 = <span class='py_c_api'>PyDict_New</span>();<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 273; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(((PyObject *)__pyx_t_3));
  __pyx_t_4 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s__np);<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 273; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_4);
  __pyx_t_5 = __Pyx_<span class='py_c_api'>PyObject_GetAttrStr</span>(__pyx_t_4, __pyx_n_s__int);<span class='error_goto'> if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 273; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_5);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_3, ((PyObject *)__pyx_n_s__dtype), __pyx_t_5) <code><</code> 0)<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 273; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
  __pyx_t_5 = <span class='py_c_api'>PyObject_Call</span>(__pyx_t_2, ((PyObject *)__pyx_t_1), ((PyObject *)__pyx_t_3));<span class='error_goto'> if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 273; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_5);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_3)); __pyx_t_3 = 0;
  __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_dsds_long</span>(__pyx_t_5);
  if (unlikely(!__pyx_t_6.memview))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 273; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
  __pyx_v_new_ligand_coords = __pyx_t_6;
  __pyx_t_6.memview = NULL;
  __pyx_t_6.data = NULL;
</pre><pre class='line' style='background-color: #FFFF31' onclick='toggleDiv("line274")'> 274:     cdef long[:] new_coords = np.zeros(3,dtype=np.int)</pre>
<pre id='line274' class='code' style='background-color: #FFFF31'>
  /* "epitopsy/cython/CalculateInteractionEnergyCython.pyx":274
 *     cdef int n_coords = ligand_real_coords.shape[0]
 *     cdef long[:,:] new_ligand_coords = np.zeros([n_coords,3],dtype=np.int)
 *     cdef long[:] new_coords = np.zeros(3,dtype=np.int)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     cdef double[:] old_coords = np.zeros(3)
 *     cdef int i,j
 */
  __pyx_t_5 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s__np);<span class='error_goto'> if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 274; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_5);
  __pyx_t_3 = __Pyx_<span class='py_c_api'>PyObject_GetAttrStr</span>(__pyx_t_5, __pyx_n_s__zeros);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 274; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
  __pyx_t_5 = <span class='py_c_api'>PyDict_New</span>();<span class='error_goto'> if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 274; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(((PyObject *)__pyx_t_5));
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s__np);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 274; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  __pyx_t_2 = __Pyx_<span class='py_c_api'>PyObject_GetAttrStr</span>(__pyx_t_1, __pyx_n_s__int);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 274; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_5, ((PyObject *)__pyx_n_s__dtype), __pyx_t_2) <code><</code> 0)<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 274; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = <span class='py_c_api'>PyObject_Call</span>(__pyx_t_3, ((PyObject *)__pyx_k_tuple_6), ((PyObject *)__pyx_t_5));<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 274; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_5)); __pyx_t_5 = 0;
  __pyx_t_7 = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_long</span>(__pyx_t_2);
  if (unlikely(!__pyx_t_7.memview))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 274; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_v_new_coords = __pyx_t_7;
  __pyx_t_7.memview = NULL;
  __pyx_t_7.data = NULL;

  /* "epitopsy/cython/CalculateInteractionEnergyCython.pyx":274
 *     cdef int n_coords = ligand_real_coords.shape[0]
 *     cdef long[:,:] new_ligand_coords = np.zeros([n_coords,3],dtype=np.int)
 *     cdef long[:] new_coords = np.zeros(3,dtype=np.int)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     cdef double[:] old_coords = np.zeros(3)
 *     cdef int i,j
 */
  __pyx_k_tuple_6 = <span class='py_c_api'>PyTuple_Pack</span>(1, __pyx_int_3);<span class='error_goto'> if (unlikely(!__pyx_k_tuple_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 274; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_k_tuple_6);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_k_tuple_6));
</pre><pre class='line' style='background-color: #FFFF4f' onclick='toggleDiv("line275")'> 275:     cdef double[:] old_coords = np.zeros(3)</pre>
<pre id='line275' class='code' style='background-color: #FFFF4f'>
  /* "epitopsy/cython/CalculateInteractionEnergyCython.pyx":275
 *     cdef long[:,:] new_ligand_coords = np.zeros([n_coords,3],dtype=np.int)
 *     cdef long[:] new_coords = np.zeros(3,dtype=np.int)
 *     cdef double[:] old_coords = np.zeros(3)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     cdef int i,j
 * 
 */
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s__np);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 275; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  __pyx_t_5 = __Pyx_<span class='py_c_api'>PyObject_GetAttrStr</span>(__pyx_t_2, __pyx_n_s__zeros);<span class='error_goto'> if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 275; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_5);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = <span class='py_c_api'>PyObject_Call</span>(__pyx_t_5, ((PyObject *)__pyx_k_tuple_7), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 275; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
  __pyx_t_8 = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_double</span>(__pyx_t_2);
  if (unlikely(!__pyx_t_8.memview))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 275; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_v_old_coords = __pyx_t_8;
  __pyx_t_8.memview = NULL;
  __pyx_t_8.data = NULL;

  /* "epitopsy/cython/CalculateInteractionEnergyCython.pyx":275
 *     cdef long[:,:] new_ligand_coords = np.zeros([n_coords,3],dtype=np.int)
 *     cdef long[:] new_coords = np.zeros(3,dtype=np.int)
 *     cdef double[:] old_coords = np.zeros(3)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     cdef int i,j
 * 
 */
  __pyx_k_tuple_7 = <span class='py_c_api'>PyTuple_Pack</span>(1, __pyx_int_3);<span class='error_goto'> if (unlikely(!__pyx_k_tuple_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 275; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_k_tuple_7);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_k_tuple_7));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line276")'> 276:     cdef int i,j</pre>
<pre id='line276' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line277")'> 277: </pre>
<pre id='line277' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line278")'> 278:     for i in range(n_coords):</pre>
<pre id='line278' class='code' style='background-color: #FFFFff'>
  /* "epitopsy/cython/CalculateInteractionEnergyCython.pyx":278
 *     cdef int i,j
 * 
 *     for i in range(n_coords):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         old_coords = ligand_real_coords[i,:]
 *         new_coords = transform_real_to_box_space(old_coords,
 */
  __pyx_t_9 = __pyx_v_n_coords;
  for (__pyx_t_10 = 0; __pyx_t_10 <code><</code> __pyx_t_9; __pyx_t_10+=1) {
    __pyx_v_i = __pyx_t_10;
</pre><pre class='line' style='background-color: #FFFFaa' onclick='toggleDiv("line279")'> 279:         old_coords = ligand_real_coords[i,:]</pre>
<pre id='line279' class='code' style='background-color: #FFFFaa'>
    /* "epitopsy/cython/CalculateInteractionEnergyCython.pyx":279
 * 
 *     for i in range(n_coords):
 *         old_coords = ligand_real_coords[i,:]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         new_coords = transform_real_to_box_space(old_coords,
 *                 box_mesh_size,
 */
    __pyx_t_12 = -1;
    __pyx_t_11.data = __pyx_v_ligand_real_coords.data;
    __pyx_t_11.memview = __pyx_v_ligand_real_coords.memview;
    __PYX_INC_MEMVIEW(&__pyx_t_11, 0);
    {
    Py_ssize_t __pyx_tmp_idx = __pyx_v_i;
    Py_ssize_t __pyx_tmp_shape = __pyx_v_ligand_real_coords.shape[0];
    Py_ssize_t __pyx_tmp_stride = __pyx_v_ligand_real_coords.strides[0];
    if (1 && (__pyx_tmp_idx <code><</code> 0))
        __pyx_tmp_idx += __pyx_tmp_shape;
    if (0 && (__pyx_tmp_idx <code><</code> 0 || __pyx_tmp_idx >= __pyx_tmp_shape)) {
        <span class='py_c_api'>PyErr_SetString</span>(PyExc_IndexError, "Index out of bounds (axis 0)");
       <span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 279; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    }
        __pyx_t_11.data += __pyx_tmp_idx * __pyx_tmp_stride;
}

__pyx_t_11.shape[0] = __pyx_v_ligand_real_coords.shape[1];
__pyx_t_11.strides[0] = __pyx_v_ligand_real_coords.strides[1];
    __pyx_t_11.suboffsets[0] = -1;

__PYX_XDEC_MEMVIEW(&__pyx_v_old_coords, 1);
    __pyx_v_old_coords = __pyx_t_11;
    __pyx_t_11.memview = NULL;
    __pyx_t_11.data = NULL;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line280")'> 280:         new_coords = transform_real_to_box_space(old_coords,</pre>
<pre id='line280' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line281")'> 281:                 box_mesh_size,</pre>
<pre id='line281' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line282")'> 282:                 box_offset)</pre>
<pre id='line282' class='code' style='background-color: #FFFFff'>
    /* "epitopsy/cython/CalculateInteractionEnergyCython.pyx":282
 *         new_coords = transform_real_to_box_space(old_coords,
 *                 box_mesh_size,
 *                 box_offset)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         for j in range(3):
 *             new_ligand_coords[i,j] = new_coords[j]
 */
    __pyx_t_13 = __pyx_f_8epitopsy_6cython_32CalculateInteractionEnergyCython_transform_real_to_box_space(__pyx_v_old_coords, __pyx_v_box_mesh_size, __pyx_v_box_offset);<span class='error_goto'> if (unlikely(!__pyx_t_13.memview)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 280; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    __PYX_XDEC_MEMVIEW(&__pyx_v_new_coords, 1);
    __pyx_v_new_coords = __pyx_t_13;
    __pyx_t_13.memview = NULL;
    __pyx_t_13.data = NULL;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line283")'> 283:         for j in range(3):</pre>
<pre id='line283' class='code' style='background-color: #FFFFff'>
    /* "epitopsy/cython/CalculateInteractionEnergyCython.pyx":283
 *                 box_mesh_size,
 *                 box_offset)
 *         for j in range(3):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             new_ligand_coords[i,j] = new_coords[j]
 * 
 */
    for (__pyx_t_12 = 0; __pyx_t_12 <code><</code> 3; __pyx_t_12+=1) {
      __pyx_v_j = __pyx_t_12;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line284")'> 284:             new_ligand_coords[i,j] = new_coords[j]</pre>
<pre id='line284' class='code' style='background-color: #FFFFff'>
      /* "epitopsy/cython/CalculateInteractionEnergyCython.pyx":284
 *                 box_offset)
 *         for j in range(3):
 *             new_ligand_coords[i,j] = new_coords[j]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     return new_ligand_coords
 */
      __pyx_t_14 = __pyx_v_j;
      if (__pyx_t_14 <code><</code> 0) __pyx_t_14 += __pyx_v_new_coords.shape[0];
      __pyx_t_15 = __pyx_v_i;
      __pyx_t_16 = __pyx_v_j;
      if (__pyx_t_15 <code><</code> 0) __pyx_t_15 += __pyx_v_new_ligand_coords.shape[0];
      if (__pyx_t_16 <code><</code> 0) __pyx_t_16 += __pyx_v_new_ligand_coords.shape[1];
      *((long *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_new_ligand_coords.data + __pyx_t_15 * __pyx_v_new_ligand_coords.strides[0]) ) + __pyx_t_16 * __pyx_v_new_ligand_coords.strides[1]) )) = (*((long *) ( /* dim=0 */ (__pyx_v_new_coords.data + __pyx_t_14 * __pyx_v_new_coords.strides[0]) )));
    }
  }
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line285")'> 285: </pre>
<pre id='line285' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF6e' onclick='toggleDiv("line286")'> 286:     return new_ligand_coords</pre>
<pre id='line286' class='code' style='background-color: #FFFF6e'>
  /* "epitopsy/cython/CalculateInteractionEnergyCython.pyx":286
 *             new_ligand_coords[i,j] = new_coords[j]
 * 
 *     return new_ligand_coords             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * # This version should work fine, if one changes something, please comment these
 */
  __PYX_INC_MEMVIEW(&__pyx_v_new_ligand_coords, 0);
  __pyx_r = __pyx_v_new_ligand_coords;
  goto __pyx_L0;

  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_5);
  __PYX_XDEC_MEMVIEW(&__pyx_t_6, 1);
  __PYX_XDEC_MEMVIEW(&__pyx_t_7, 1);
  __PYX_XDEC_MEMVIEW(&__pyx_t_8, 1);
  __PYX_XDEC_MEMVIEW(&__pyx_t_11, 1);
  __PYX_XDEC_MEMVIEW(&__pyx_t_13, 1);
  __pyx_r.data = NULL;
  __pyx_r.memview = NULL;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("epitopsy.cython.CalculateInteractionEnergyCython.transform_ligand_to_box", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = __pyx_r;
  goto __pyx_L2;
  __pyx_L0:;
  if (unlikely(!__pyx_r.memview)) {
    <span class='py_c_api'>PyErr_SetString</span>(PyExc_TypeError,"Memoryview return value is not initialized");
  }
  __pyx_L2:;
  __PYX_XDEC_MEMVIEW(&__pyx_v_new_ligand_coords, 1);
  __PYX_XDEC_MEMVIEW(&__pyx_v_new_coords, 1);
  __PYX_XDEC_MEMVIEW(&__pyx_v_old_coords, 1);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line287")'> 287: </pre>
<pre id='line287' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line288")'> 288: # This version should work fine, if one changes something, please comment these</pre>
<pre id='line288' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line289")'> 289: # options</pre>
<pre id='line289' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line290")'> 290: @cython.cdivision(True)</pre>
<pre id='line290' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line291")'> 291: @cython.boundscheck(False)</pre>
<pre id='line291' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line292")'> 292: cdef bool out_of_box(long[:,:] ligand_coords, long[:] box_dim):</pre>
<pre id='line292' class='code' style='background-color: #FFFFff'>
/* "epitopsy/cython/CalculateInteractionEnergyCython.pyx":292
 * @cython.cdivision(True)
 * @cython.boundscheck(False)
 * cdef bool out_of_box(long[:,:] ligand_coords, long[:] box_dim):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     cdef int i,j
 *     cdef int n_coords = ligand_coords.shape[0]
 */

static PyBoolObject *__pyx_f_8epitopsy_6cython_32CalculateInteractionEnergyCython_out_of_box(__Pyx_memviewslice __pyx_v_ligand_coords, __Pyx_memviewslice __pyx_v_box_dim) {
  int __pyx_v_i;
  int __pyx_v_j;
  int __pyx_v_n_coords;
  int __pyx_v_x;
  PyBoolObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("out_of_box", 0);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line293")'> 293:     cdef int i,j</pre>
<pre id='line293' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line294")'> 294:     cdef int n_coords = ligand_coords.shape[0]</pre>
<pre id='line294' class='code' style='background-color: #FFFFff'>
  /* "epitopsy/cython/CalculateInteractionEnergyCython.pyx":294
 * cdef bool out_of_box(long[:,:] ligand_coords, long[:] box_dim):
 *     cdef int i,j
 *     cdef int n_coords = ligand_coords.shape[0]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     cdef int x = 0
 * 
 */
  __pyx_v_n_coords = (__pyx_v_ligand_coords.shape[0]);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line295")'> 295:     cdef int x = 0</pre>
<pre id='line295' class='code' style='background-color: #FFFFff'>
  /* "epitopsy/cython/CalculateInteractionEnergyCython.pyx":295
 *     cdef int i,j
 *     cdef int n_coords = ligand_coords.shape[0]
 *     cdef int x = 0             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     for i in range(n_coords):
 */
  __pyx_v_x = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line296")'> 296: </pre>
<pre id='line296' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line297")'> 297:     for i in range(n_coords):</pre>
<pre id='line297' class='code' style='background-color: #FFFFff'>
  /* "epitopsy/cython/CalculateInteractionEnergyCython.pyx":297
 *     cdef int x = 0
 * 
 *     for i in range(n_coords):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         for j in range(3):
 *             x = ligand_coords[i,j]
 */
  __pyx_t_1 = __pyx_v_n_coords;
  for (__pyx_t_2 = 0; __pyx_t_2 <code><</code> __pyx_t_1; __pyx_t_2+=1) {
    __pyx_v_i = __pyx_t_2;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line298")'> 298:         for j in range(3):</pre>
<pre id='line298' class='code' style='background-color: #FFFFff'>
    /* "epitopsy/cython/CalculateInteractionEnergyCython.pyx":298
 * 
 *     for i in range(n_coords):
 *         for j in range(3):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             x = ligand_coords[i,j]
 *             if x <code><</code> 0 or x >= box_dim[j]:
 */
    for (__pyx_t_3 = 0; __pyx_t_3 <code><</code> 3; __pyx_t_3+=1) {
      __pyx_v_j = __pyx_t_3;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line299")'> 299:             x = ligand_coords[i,j]</pre>
<pre id='line299' class='code' style='background-color: #FFFFff'>
      /* "epitopsy/cython/CalculateInteractionEnergyCython.pyx":299
 *     for i in range(n_coords):
 *         for j in range(3):
 *             x = ligand_coords[i,j]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             if x <code><</code> 0 or x >= box_dim[j]:
 *                 return True
 */
      __pyx_t_4 = __pyx_v_i;
      __pyx_t_5 = __pyx_v_j;
      if (__pyx_t_4 <code><</code> 0) __pyx_t_4 += __pyx_v_ligand_coords.shape[0];
      if (__pyx_t_5 <code><</code> 0) __pyx_t_5 += __pyx_v_ligand_coords.shape[1];
      __pyx_v_x = (*((long *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_ligand_coords.data + __pyx_t_4 * __pyx_v_ligand_coords.strides[0]) ) + __pyx_t_5 * __pyx_v_ligand_coords.strides[1]) )));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line300")'> 300:             if x &lt; 0 or x &gt;= box_dim[j]:</pre>
<pre id='line300' class='code' style='background-color: #FFFFff'>
      /* "epitopsy/cython/CalculateInteractionEnergyCython.pyx":300
 *         for j in range(3):
 *             x = ligand_coords[i,j]
 *             if x <code><</code> 0 or x >= box_dim[j]:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                 return True
 * 
 */
      __pyx_t_6 = ((__pyx_v_x <code><</code> 0) != 0);
      if (!__pyx_t_6) {
        __pyx_t_7 = __pyx_v_j;
        if (__pyx_t_7 <code><</code> 0) __pyx_t_7 += __pyx_v_box_dim.shape[0];
        __pyx_t_8 = ((__pyx_v_x >= (*((long *) ( /* dim=0 */ (__pyx_v_box_dim.data + __pyx_t_7 * __pyx_v_box_dim.strides[0]) )))) != 0);
        __pyx_t_9 = __pyx_t_8;
      } else {
        __pyx_t_9 = __pyx_t_6;
      }
      if (__pyx_t_9) {
</pre><pre class='line' style='background-color: #FFFF8d' onclick='toggleDiv("line301")'> 301:                 return True</pre>
<pre id='line301' class='code' style='background-color: #FFFF8d'>
        /* "epitopsy/cython/CalculateInteractionEnergyCython.pyx":301
 *             x = ligand_coords[i,j]
 *             if x <code><</code> 0 or x >= box_dim[j]:
 *                 return True             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     return False
 */
        <span class='pyx_macro_api'>__Pyx_XDECREF</span>(((PyObject *)__pyx_r));
        __pyx_t_10 = __Pyx_<span class='py_c_api'>PyBool_FromLong</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_10)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 301; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_10);
        if (!(likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_10, __pyx_ptype_7cpython_4bool_bool))))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 301; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        __pyx_r = ((PyBoolObject *)__pyx_t_10);
        __pyx_t_10 = 0;
        goto __pyx_L0;
        goto __pyx_L7;
      }
      __pyx_L7:;
    }
  }
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line302")'> 302: </pre>
<pre id='line302' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF20' onclick='toggleDiv("line303")'> 303:     return False</pre>
<pre id='line303' class='code' style='background-color: #FFFF20'>
  /* "epitopsy/cython/CalculateInteractionEnergyCython.pyx":303
 *                 return True
 * 
 *     return False             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * def speed_up_brute_force(ligand_pqr,
 */
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(((PyObject *)__pyx_r));
  __pyx_t_10 = __Pyx_<span class='py_c_api'>PyBool_FromLong</span>(0);<span class='error_goto'> if (unlikely(!__pyx_t_10)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 303; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_10);
  if (!(likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_10, __pyx_ptype_7cpython_4bool_bool))))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 303; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_r = ((PyBoolObject *)__pyx_t_10);
  __pyx_t_10 = 0;
  goto __pyx_L0;

  __pyx_r = ((PyBoolObject *)Py_None); <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_10);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("epitopsy.cython.CalculateInteractionEnergyCython.out_of_box", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = 0;
  __pyx_L0:;
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>((PyObject *)__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_8epitopsy_6cython_32CalculateInteractionEnergyCython_3speed_up_brute_force(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyMethodDef __pyx_mdef_8epitopsy_6cython_32CalculateInteractionEnergyCython_3speed_up_brute_force = {<span class='pyx_macro_api'>__Pyx_NAMESTR</span>("speed_up_brute_force"), (PyCFunction)__pyx_pw_8epitopsy_6cython_32CalculateInteractionEnergyCython_3speed_up_brute_force, METH_VARARGS|METH_KEYWORDS, <span class='pyx_macro_api'>__Pyx_DOCSTR</span>(0)};
static PyObject *__pyx_pw_8epitopsy_6cython_32CalculateInteractionEnergyCython_3speed_up_brute_force(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_ligand_pqr = 0;
  PyArrayObject *__pyx_v_vdwbox_np = 0;
  PyObject *__pyx_v_espbox = 0;
  PyArrayObject *__pyx_v_counter_matrix_np = 0;
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("speed_up_brute_force (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__ligand_pqr,&__pyx_n_s__vdwbox_np,&__pyx_n_s__espbox,&__pyx_n_s__counter_matrix_np,0};
    PyObject* values[4] = {0,0,0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
      switch (pos_args) {
        case  4: values[3] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 3);
        case  3: values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__ligand_pqr)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        case  1:
        if (likely((values[1] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__vdwbox_np)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("speed_up_brute_force", 1, 4, 4, 1);<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 305; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
        case  2:
        if (likely((values[2] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__espbox)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("speed_up_brute_force", 1, 4, 4, 2);<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 305; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
        case  3:
        if (likely((values[3] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__counter_matrix_np)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("speed_up_brute_force", 1, 4, 4, 3);<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 305; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "speed_up_brute_force") <code><</code> 0))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 305; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
      }
    } else if (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args) != 4) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
      values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
      values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
      values[3] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 3);
    }
    __pyx_v_ligand_pqr = values[0];
    __pyx_v_vdwbox_np = ((PyArrayObject *)values[1]);
    __pyx_v_espbox = values[2];
    __pyx_v_counter_matrix_np = ((PyArrayObject *)values[3]);
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("speed_up_brute_force", 1, 4, 4, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args));<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 305; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("epitopsy.cython.CalculateInteractionEnergyCython.speed_up_brute_force", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_vdwbox_np), __pyx_ptype_5numpy_ndarray, 1, "vdwbox_np", 0)))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 306; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_counter_matrix_np), __pyx_ptype_5numpy_ndarray, 1, "counter_matrix_np", 0)))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 308; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_r = __pyx_pf_8epitopsy_6cython_32CalculateInteractionEnergyCython_2speed_up_brute_force(__pyx_self, __pyx_v_ligand_pqr, __pyx_v_vdwbox_np, __pyx_v_espbox, __pyx_v_counter_matrix_np);
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  goto __pyx_L0;
  __pyx_L1_error:;
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line304")'> 304: </pre>
<pre id='line304' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF55' onclick='toggleDiv("line305")'> 305: def speed_up_brute_force(ligand_pqr,</pre>
<pre id='line305' class='code' style='background-color: #FFFF55'>
/* "epitopsy/cython/CalculateInteractionEnergyCython.pyx":305
 *     return False
 * 
 * def speed_up_brute_force(ligand_pqr,             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         np.ndarray[np.float64_t, ndim=3] vdwbox_np,
 *         espbox,
 */

static PyObject *__pyx_pf_8epitopsy_6cython_32CalculateInteractionEnergyCython_2speed_up_brute_force(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_ligand_pqr, PyArrayObject *__pyx_v_vdwbox_np, PyObject *__pyx_v_espbox, PyArrayObject *__pyx_v_counter_matrix_np) {
  int __pyx_v_xdim;
  int __pyx_v_ydim;
  int __pyx_v_zdim;
  int __pyx_v_x;
  int __pyx_v_y;
  int __pyx_v_z;
  double __pyx_v_energy;
  double __pyx_v_solvent_score;
  double __pyx_v_protein_score;
  PyBoolObject *__pyx_v_overlapp = 0;
  PyBoolObject *__pyx_v_left_the_box = 0;
  PyArrayObject *__pyx_v_interaction_energy_np = 0;
  __Pyx_memviewslice __pyx_v_interaction_energy = { 0, 0, { 0 }, { 0 }, { 0 } };
  __Pyx_memviewslice __pyx_v_counter_matrix = { 0, 0, { 0 }, { 0 }, { 0 } };
  __Pyx_memviewslice __pyx_v_vdwbox = { 0, 0, { 0 }, { 0 }, { 0 } };
  __Pyx_memviewslice __pyx_v_box_mesh_size = { 0, 0, { 0 }, { 0 }, { 0 } };
  __Pyx_memviewslice __pyx_v_box_offset = { 0, 0, { 0 }, { 0 }, { 0 } };
  __Pyx_memviewslice __pyx_v_box_dim = { 0, 0, { 0 }, { 0 }, { 0 } };
  __Pyx_memviewslice __pyx_v_potbox = { 0, 0, { 0 }, { 0 }, { 0 } };
  __Pyx_memviewslice __pyx_v_coord = { 0, 0, { 0 }, { 0 }, { 0 } };
  PyObject *__pyx_v_all_atoms = NULL;
  PyObject *__pyx_v_coord_list = NULL;
  PyObject *__pyx_v_charge_list = NULL;
  PyObject *__pyx_v_vdw_list = NULL;
  int __pyx_v_n_atoms;
  PyObject *__pyx_v_atom = NULL;
  __Pyx_memviewslice __pyx_v_ligand_real_coords = { 0, 0, { 0 }, { 0 }, { 0 } };
  __Pyx_memviewslice __pyx_v_ligand_coords = { 0, 0, { 0 }, { 0 }, { 0 } };
  __Pyx_memviewslice __pyx_v_charges = { 0, 0, { 0 }, { 0 }, { 0 } };
  __Pyx_memviewslice __pyx_v_vdw_radii = { 0, 0, { 0 }, { 0 }, { 0 } };
  __Pyx_LocalBuf_ND __pyx_pybuffernd_counter_matrix_np;
  __Pyx_Buffer __pyx_pybuffer_counter_matrix_np;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_interaction_energy_np;
  __Pyx_Buffer __pyx_pybuffer_interaction_energy_np;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_vdwbox_np;
  __Pyx_Buffer __pyx_pybuffer_vdwbox_np;
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("speed_up_brute_force", 0);
  __pyx_pybuffer_interaction_energy_np.pybuffer.buf = NULL;
  __pyx_pybuffer_interaction_energy_np.refcount = 0;
  __pyx_pybuffernd_interaction_energy_np.data = NULL;
  __pyx_pybuffernd_interaction_energy_np.rcbuffer = &__pyx_pybuffer_interaction_energy_np;
  __pyx_pybuffer_vdwbox_np.pybuffer.buf = NULL;
  __pyx_pybuffer_vdwbox_np.refcount = 0;
  __pyx_pybuffernd_vdwbox_np.data = NULL;
  __pyx_pybuffernd_vdwbox_np.rcbuffer = &__pyx_pybuffer_vdwbox_np;
  __pyx_pybuffer_counter_matrix_np.pybuffer.buf = NULL;
  __pyx_pybuffer_counter_matrix_np.refcount = 0;
  __pyx_pybuffernd_counter_matrix_np.data = NULL;
  __pyx_pybuffernd_counter_matrix_np.rcbuffer = &__pyx_pybuffer_counter_matrix_np;
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&__pyx_pybuffernd_vdwbox_np.rcbuffer->pybuffer, (PyObject*)__pyx_v_vdwbox_np, &__Pyx_TypeInfo_nn___pyx_t_5numpy_float64_t, PyBUF_FORMAT| PyBUF_STRIDES, 3, 0, __pyx_stack) == -1))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 305; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  }
  __pyx_pybuffernd_vdwbox_np.diminfo[0].strides = __pyx_pybuffernd_vdwbox_np.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_vdwbox_np.diminfo[0].shape = __pyx_pybuffernd_vdwbox_np.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_vdwbox_np.diminfo[1].strides = __pyx_pybuffernd_vdwbox_np.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_vdwbox_np.diminfo[1].shape = __pyx_pybuffernd_vdwbox_np.rcbuffer->pybuffer.shape[1]; __pyx_pybuffernd_vdwbox_np.diminfo[2].strides = __pyx_pybuffernd_vdwbox_np.rcbuffer->pybuffer.strides[2]; __pyx_pybuffernd_vdwbox_np.diminfo[2].shape = __pyx_pybuffernd_vdwbox_np.rcbuffer->pybuffer.shape[2];
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&__pyx_pybuffernd_counter_matrix_np.rcbuffer->pybuffer, (PyObject*)__pyx_v_counter_matrix_np, &__Pyx_TypeInfo_nn___pyx_t_5numpy_float64_t, PyBUF_FORMAT| PyBUF_STRIDES, 3, 0, __pyx_stack) == -1))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 305; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  }
  __pyx_pybuffernd_counter_matrix_np.diminfo[0].strides = __pyx_pybuffernd_counter_matrix_np.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_counter_matrix_np.diminfo[0].shape = __pyx_pybuffernd_counter_matrix_np.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_counter_matrix_np.diminfo[1].strides = __pyx_pybuffernd_counter_matrix_np.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_counter_matrix_np.diminfo[1].shape = __pyx_pybuffernd_counter_matrix_np.rcbuffer->pybuffer.shape[1]; __pyx_pybuffernd_counter_matrix_np.diminfo[2].strides = __pyx_pybuffernd_counter_matrix_np.rcbuffer->pybuffer.strides[2]; __pyx_pybuffernd_counter_matrix_np.diminfo[2].shape = __pyx_pybuffernd_counter_matrix_np.rcbuffer->pybuffer.shape[2];

  /* "epitopsy/cython/CalculateInteractionEnergyCython.pyx":305
 *     return False
 * 
 * def speed_up_brute_force(ligand_pqr,             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         np.ndarray[np.float64_t, ndim=3] vdwbox_np,
 *         espbox,
 */
  __pyx_k_tuple_60 = <span class='py_c_api'>PyTuple_Pack</span>(34, ((PyObject *)__pyx_n_s__ligand_pqr), ((PyObject *)__pyx_n_s__vdwbox_np), ((PyObject *)__pyx_n_s__espbox), ((PyObject *)__pyx_n_s__counter_matrix_np), ((PyObject *)__pyx_n_s__xdim), ((PyObject *)__pyx_n_s__ydim), ((PyObject *)__pyx_n_s__zdim), ((PyObject *)__pyx_n_s__x), ((PyObject *)__pyx_n_s__y), ((PyObject *)__pyx_n_s__z), ((PyObject *)__pyx_n_s__energy), ((PyObject *)__pyx_n_s__solvent_score), ((PyObject *)__pyx_n_s__protein_score), ((PyObject *)__pyx_n_s__overlapp), ((PyObject *)__pyx_n_s__left_the_box), ((PyObject *)__pyx_n_s_59), ((PyObject *)__pyx_n_s__interaction_energy), ((PyObject *)__pyx_n_s__counter_matrix), ((PyObject *)__pyx_n_s__vdwbox), ((PyObject *)__pyx_n_s__box_mesh_size), ((PyObject *)__pyx_n_s__box_offset), ((PyObject *)__pyx_n_s__box_dim), ((PyObject *)__pyx_n_s__potbox), ((PyObject *)__pyx_n_s__coord), ((PyObject *)__pyx_n_s__all_atoms), ((PyObject *)__pyx_n_s__coord_list), ((PyObject *)__pyx_n_s__charge_list), ((PyObject *)__pyx_n_s__vdw_list), ((PyObject *)__pyx_n_s__n_atoms), ((PyObject *)__pyx_n_s__atom), ((PyObject *)__pyx_n_s__ligand_real_coords), ((PyObject *)__pyx_n_s__ligand_coords), ((PyObject *)__pyx_n_s__charges), ((PyObject *)__pyx_n_s__vdw_radii));<span class='error_goto'> if (unlikely(!__pyx_k_tuple_60)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 305; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_k_tuple_60);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_k_tuple_60));

  /* "epitopsy/cython/CalculateInteractionEnergyCython.pyx":305
 *     return False
 * 
 * def speed_up_brute_force(ligand_pqr,             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         np.ndarray[np.float64_t, ndim=3] vdwbox_np,
 *         espbox,
 */
  __pyx_t_2 = PyCFunction_NewEx(&__pyx_mdef_8epitopsy_6cython_32CalculateInteractionEnergyCython_3speed_up_brute_force, NULL, __pyx_n_s_58);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 305; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_62, __pyx_t_2) <code><</code> 0)<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 305; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_k_codeobj_61 = (PyObject*)__Pyx_<span class='py_c_api'>PyCode_New</span>(4, 0, 34, 0, 0, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_k_tuple_60, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_57, __pyx_n_s_62, 305, __pyx_empty_bytes);<span class='error_goto'> if (unlikely(!__pyx_k_codeobj_61)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 305; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line306")'> 306:         np.ndarray[np.float64_t, ndim=3] vdwbox_np,</pre>
<pre id='line306' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line307")'> 307:         espbox,</pre>
<pre id='line307' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line308")'> 308:         np.ndarray[np.float64_t, ndim=3] counter_matrix_np):</pre>
<pre id='line308' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line309")'> 309:     ## general stuff</pre>
<pre id='line309' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF48' onclick='toggleDiv("line310")'> 310:     cdef int xdim = espbox.box.shape[0]</pre>
<pre id='line310' class='code' style='background-color: #FFFF48'>
  /* "epitopsy/cython/CalculateInteractionEnergyCython.pyx":310
 *         np.ndarray[np.float64_t, ndim=3] counter_matrix_np):
 *     ## general stuff
 *     cdef int xdim = espbox.box.shape[0]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     cdef int ydim = espbox.box.shape[1]
 *     cdef int zdim = espbox.box.shape[2]
 */
  __pyx_t_1 = __Pyx_<span class='py_c_api'>PyObject_GetAttrStr</span>(__pyx_v_espbox, __pyx_n_s__box);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 310; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  __pyx_t_2 = __Pyx_<span class='py_c_api'>PyObject_GetAttrStr</span>(__pyx_t_1, __pyx_n_s__shape);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 310; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(__pyx_t_2, 0, sizeof(long), PyInt_FromLong, 0, 0, 1);<span class='error_goto'> if (!__pyx_t_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 310; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_3 = __Pyx_<span class='py_c_api'>PyInt_AsInt</span>(__pyx_t_1);<span class='error_goto'> if (unlikely((__pyx_t_3 == (int)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 310; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_v_xdim = __pyx_t_3;
</pre><pre class='line' style='background-color: #FFFF48' onclick='toggleDiv("line311")'> 311:     cdef int ydim = espbox.box.shape[1]</pre>
<pre id='line311' class='code' style='background-color: #FFFF48'>
  /* "epitopsy/cython/CalculateInteractionEnergyCython.pyx":311
 *     ## general stuff
 *     cdef int xdim = espbox.box.shape[0]
 *     cdef int ydim = espbox.box.shape[1]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     cdef int zdim = espbox.box.shape[2]
 *     cdef int x,y,z
 */
  __pyx_t_1 = __Pyx_<span class='py_c_api'>PyObject_GetAttrStr</span>(__pyx_v_espbox, __pyx_n_s__box);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 311; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  __pyx_t_2 = __Pyx_<span class='py_c_api'>PyObject_GetAttrStr</span>(__pyx_t_1, __pyx_n_s__shape);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 311; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(__pyx_t_2, 1, sizeof(long), PyInt_FromLong, 0, 0, 1);<span class='error_goto'> if (!__pyx_t_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 311; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_3 = __Pyx_<span class='py_c_api'>PyInt_AsInt</span>(__pyx_t_1);<span class='error_goto'> if (unlikely((__pyx_t_3 == (int)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 311; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_v_ydim = __pyx_t_3;
</pre><pre class='line' style='background-color: #FFFF48' onclick='toggleDiv("line312")'> 312:     cdef int zdim = espbox.box.shape[2]</pre>
<pre id='line312' class='code' style='background-color: #FFFF48'>
  /* "epitopsy/cython/CalculateInteractionEnergyCython.pyx":312
 *     cdef int xdim = espbox.box.shape[0]
 *     cdef int ydim = espbox.box.shape[1]
 *     cdef int zdim = espbox.box.shape[2]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     cdef int x,y,z
 *     cdef double energy = 0.
 */
  __pyx_t_1 = __Pyx_<span class='py_c_api'>PyObject_GetAttrStr</span>(__pyx_v_espbox, __pyx_n_s__box);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 312; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  __pyx_t_2 = __Pyx_<span class='py_c_api'>PyObject_GetAttrStr</span>(__pyx_t_1, __pyx_n_s__shape);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 312; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(__pyx_t_2, 2, sizeof(long), PyInt_FromLong, 0, 0, 1);<span class='error_goto'> if (!__pyx_t_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 312; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_3 = __Pyx_<span class='py_c_api'>PyInt_AsInt</span>(__pyx_t_1);<span class='error_goto'> if (unlikely((__pyx_t_3 == (int)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 312; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_v_zdim = __pyx_t_3;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line313")'> 313:     cdef int x,y,z</pre>
<pre id='line313' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line314")'> 314:     cdef double energy = 0.</pre>
<pre id='line314' class='code' style='background-color: #FFFFff'>
  /* "epitopsy/cython/CalculateInteractionEnergyCython.pyx":314
 *     cdef int zdim = espbox.box.shape[2]
 *     cdef int x,y,z
 *     cdef double energy = 0.             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     cdef double solvent_score = 1.
 *     cdef double protein_score = 0.
 */
  __pyx_v_energy = 0.;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line315")'> 315:     cdef double solvent_score = 1.</pre>
<pre id='line315' class='code' style='background-color: #FFFFff'>
  /* "epitopsy/cython/CalculateInteractionEnergyCython.pyx":315
 *     cdef int x,y,z
 *     cdef double energy = 0.
 *     cdef double solvent_score = 1.             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     cdef double protein_score = 0.
 *     cdef bool overlapp = False
 */
  __pyx_v_solvent_score = 1.;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line316")'> 316:     cdef double protein_score = 0.</pre>
<pre id='line316' class='code' style='background-color: #FFFFff'>
  /* "epitopsy/cython/CalculateInteractionEnergyCython.pyx":316
 *     cdef double energy = 0.
 *     cdef double solvent_score = 1.
 *     cdef double protein_score = 0.             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     cdef bool overlapp = False
 *     cdef bool left_the_box = False
 */
  __pyx_v_protein_score = 0.;
</pre><pre class='line' style='background-color: #FFFF96' onclick='toggleDiv("line317")'> 317:     cdef bool overlapp = False</pre>
<pre id='line317' class='code' style='background-color: #FFFF96'>
  /* "epitopsy/cython/CalculateInteractionEnergyCython.pyx":317
 *     cdef double solvent_score = 1.
 *     cdef double protein_score = 0.
 *     cdef bool overlapp = False             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     cdef bool left_the_box = False
 * 
 */
  __pyx_t_1 = __Pyx_<span class='py_c_api'>PyBool_FromLong</span>(0);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 317; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  if (!(likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_1, __pyx_ptype_7cpython_4bool_bool))))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 317; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_v_overlapp = ((PyBoolObject *)__pyx_t_1);
  __pyx_t_1 = 0;
</pre><pre class='line' style='background-color: #FFFF96' onclick='toggleDiv("line318")'> 318:     cdef bool left_the_box = False</pre>
<pre id='line318' class='code' style='background-color: #FFFF96'>
  /* "epitopsy/cython/CalculateInteractionEnergyCython.pyx":318
 *     cdef double protein_score = 0.
 *     cdef bool overlapp = False
 *     cdef bool left_the_box = False             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     cdef np.ndarray[np.float64_t, ndim=3] interaction_energy_np = np.zeros([xdim,ydim,zdim])
 */
  __pyx_t_1 = __Pyx_<span class='py_c_api'>PyBool_FromLong</span>(0);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 318; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  if (!(likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_1, __pyx_ptype_7cpython_4bool_bool))))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 318; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_v_left_the_box = ((PyBoolObject *)__pyx_t_1);
  __pyx_t_1 = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line319")'> 319: </pre>
<pre id='line319' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF2b' onclick='toggleDiv("line320")'> 320:     cdef np.ndarray[np.float64_t, ndim=3] interaction_energy_np = np.zeros([xdim,ydim,zdim])</pre>
<pre id='line320' class='code' style='background-color: #FFFF2b'>
  /* "epitopsy/cython/CalculateInteractionEnergyCython.pyx":320
 *     cdef bool left_the_box = False
 * 
 *     cdef np.ndarray[np.float64_t, ndim=3] interaction_energy_np = np.zeros([xdim,ydim,zdim])             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     cdef double[:,:,:] interaction_energy = interaction_energy_np
 *     cdef double[:,:,:] counter_matrix = counter_matrix_np
 */
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s__np);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 320; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  __pyx_t_2 = __Pyx_<span class='py_c_api'>PyObject_GetAttrStr</span>(__pyx_t_1, __pyx_n_s__zeros);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 320; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = <span class='py_c_api'>PyInt_FromLong</span>(__pyx_v_xdim);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 320; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  __pyx_t_4 = <span class='py_c_api'>PyInt_FromLong</span>(__pyx_v_ydim);<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 320; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_4);
  __pyx_t_5 = <span class='py_c_api'>PyInt_FromLong</span>(__pyx_v_zdim);<span class='error_goto'> if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 320; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_5);
  __pyx_t_6 = <span class='py_c_api'>PyList_New</span>(3);<span class='error_goto'> if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 320; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_6);
  <span class='py_macro_api'>PyList_SET_ITEM</span>(__pyx_t_6, 0, __pyx_t_1);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_t_1);
  <span class='py_macro_api'>PyList_SET_ITEM</span>(__pyx_t_6, 1, __pyx_t_4);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_t_4);
  <span class='py_macro_api'>PyList_SET_ITEM</span>(__pyx_t_6, 2, __pyx_t_5);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_t_5);
  __pyx_t_1 = 0;
  __pyx_t_4 = 0;
  __pyx_t_5 = 0;
  __pyx_t_5 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 320; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_5);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_5, 0, ((PyObject *)__pyx_t_6));
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_t_6));
  __pyx_t_6 = 0;
  __pyx_t_6 = <span class='py_c_api'>PyObject_Call</span>(__pyx_t_2, ((PyObject *)__pyx_t_5), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 320; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_6);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_5)); __pyx_t_5 = 0;
  if (!(likely(((__pyx_t_6) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_6, __pyx_ptype_5numpy_ndarray)))))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 320; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_t_7 = ((PyArrayObject *)__pyx_t_6);
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&__pyx_pybuffernd_interaction_energy_np.rcbuffer->pybuffer, (PyObject*)__pyx_t_7, &__Pyx_TypeInfo_nn___pyx_t_5numpy_float64_t, PyBUF_FORMAT| PyBUF_STRIDES, 3, 0, __pyx_stack) == -1)) {
      __pyx_v_interaction_energy_np = ((PyArrayObject *)Py_None); <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None); __pyx_pybuffernd_interaction_energy_np.rcbuffer->pybuffer.buf = NULL;
     <span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 320; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    } else {__pyx_pybuffernd_interaction_energy_np.diminfo[0].strides = __pyx_pybuffernd_interaction_energy_np.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_interaction_energy_np.diminfo[0].shape = __pyx_pybuffernd_interaction_energy_np.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_interaction_energy_np.diminfo[1].strides = __pyx_pybuffernd_interaction_energy_np.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_interaction_energy_np.diminfo[1].shape = __pyx_pybuffernd_interaction_energy_np.rcbuffer->pybuffer.shape[1]; __pyx_pybuffernd_interaction_energy_np.diminfo[2].strides = __pyx_pybuffernd_interaction_energy_np.rcbuffer->pybuffer.strides[2]; __pyx_pybuffernd_interaction_energy_np.diminfo[2].shape = __pyx_pybuffernd_interaction_energy_np.rcbuffer->pybuffer.shape[2];
    }
  }
  __pyx_t_7 = 0;
  __pyx_v_interaction_energy_np = ((PyArrayObject *)__pyx_t_6);
  __pyx_t_6 = 0;
</pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line321")'> 321:     cdef double[:,:,:] interaction_energy = interaction_energy_np</pre>
<pre id='line321' class='code' style='background-color: #FFFFd4'>
  /* "epitopsy/cython/CalculateInteractionEnergyCython.pyx":321
 * 
 *     cdef np.ndarray[np.float64_t, ndim=3] interaction_energy_np = np.zeros([xdim,ydim,zdim])
 *     cdef double[:,:,:] interaction_energy = interaction_energy_np             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     cdef double[:,:,:] counter_matrix = counter_matrix_np
 *     cdef double[:,:,:] vdwbox = vdwbox_np
 */
  __pyx_t_8 = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_dsdsds_double</span>(((PyObject *)__pyx_v_interaction_energy_np));
  if (unlikely(!__pyx_t_8.memview))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 321; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_v_interaction_energy = __pyx_t_8;
  __pyx_t_8.memview = NULL;
  __pyx_t_8.data = NULL;
</pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line322")'> 322:     cdef double[:,:,:] counter_matrix = counter_matrix_np</pre>
<pre id='line322' class='code' style='background-color: #FFFFd4'>
  /* "epitopsy/cython/CalculateInteractionEnergyCython.pyx":322
 *     cdef np.ndarray[np.float64_t, ndim=3] interaction_energy_np = np.zeros([xdim,ydim,zdim])
 *     cdef double[:,:,:] interaction_energy = interaction_energy_np
 *     cdef double[:,:,:] counter_matrix = counter_matrix_np             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     cdef double[:,:,:] vdwbox = vdwbox_np
 * 
 */
  __pyx_t_9 = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_dsdsds_double</span>(((PyObject *)__pyx_v_counter_matrix_np));
  if (unlikely(!__pyx_t_9.memview))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 322; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_v_counter_matrix = __pyx_t_9;
  __pyx_t_9.memview = NULL;
  __pyx_t_9.data = NULL;
</pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line323")'> 323:     cdef double[:,:,:] vdwbox = vdwbox_np</pre>
<pre id='line323' class='code' style='background-color: #FFFFd4'>
  /* "epitopsy/cython/CalculateInteractionEnergyCython.pyx":323
 *     cdef double[:,:,:] interaction_energy = interaction_energy_np
 *     cdef double[:,:,:] counter_matrix = counter_matrix_np
 *     cdef double[:,:,:] vdwbox = vdwbox_np             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     ## espbox data
 */
  __pyx_t_10 = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_dsdsds_double</span>(((PyObject *)__pyx_v_vdwbox_np));
  if (unlikely(!__pyx_t_10.memview))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 323; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_v_vdwbox = __pyx_t_10;
  __pyx_t_10.memview = NULL;
  __pyx_t_10.data = NULL;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line324")'> 324: </pre>
<pre id='line324' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line325")'> 325:     ## espbox data</pre>
<pre id='line325' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF41' onclick='toggleDiv("line326")'> 326:     cdef double[:] box_mesh_size = np.array(espbox.box_mesh_size)</pre>
<pre id='line326' class='code' style='background-color: #FFFF41'>
  /* "epitopsy/cython/CalculateInteractionEnergyCython.pyx":326
 * 
 *     ## espbox data
 *     cdef double[:] box_mesh_size = np.array(espbox.box_mesh_size)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     cdef double[:] box_offset = np.array(espbox.box_offset)
 *     cdef long[:] box_dim = np.array(espbox.box_dim)
 */
  __pyx_t_6 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s__np);<span class='error_goto'> if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 326; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_6);
  __pyx_t_5 = __Pyx_<span class='py_c_api'>PyObject_GetAttrStr</span>(__pyx_t_6, __pyx_n_s__array);<span class='error_goto'> if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 326; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_5);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
  __pyx_t_6 = __Pyx_<span class='py_c_api'>PyObject_GetAttrStr</span>(__pyx_v_espbox, __pyx_n_s__box_mesh_size);<span class='error_goto'> if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 326; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_6);
  __pyx_t_2 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 326; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_2, 0, __pyx_t_6);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_t_6);
  __pyx_t_6 = 0;
  __pyx_t_6 = <span class='py_c_api'>PyObject_Call</span>(__pyx_t_5, ((PyObject *)__pyx_t_2), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 326; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_6);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_2)); __pyx_t_2 = 0;
  __pyx_t_11 = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_double</span>(__pyx_t_6);
  if (unlikely(!__pyx_t_11.memview))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 326; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
  __pyx_v_box_mesh_size = __pyx_t_11;
  __pyx_t_11.memview = NULL;
  __pyx_t_11.data = NULL;
</pre><pre class='line' style='background-color: #FFFF41' onclick='toggleDiv("line327")'> 327:     cdef double[:] box_offset = np.array(espbox.box_offset)</pre>
<pre id='line327' class='code' style='background-color: #FFFF41'>
  /* "epitopsy/cython/CalculateInteractionEnergyCython.pyx":327
 *     ## espbox data
 *     cdef double[:] box_mesh_size = np.array(espbox.box_mesh_size)
 *     cdef double[:] box_offset = np.array(espbox.box_offset)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     cdef long[:] box_dim = np.array(espbox.box_dim)
 *     cdef double[:,:,:] potbox = espbox.box
 */
  __pyx_t_6 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s__np);<span class='error_goto'> if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 327; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_6);
  __pyx_t_2 = __Pyx_<span class='py_c_api'>PyObject_GetAttrStr</span>(__pyx_t_6, __pyx_n_s__array);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 327; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
  __pyx_t_6 = __Pyx_<span class='py_c_api'>PyObject_GetAttrStr</span>(__pyx_v_espbox, __pyx_n_s__box_offset);<span class='error_goto'> if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 327; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_6);
  __pyx_t_5 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 327; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_5);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_5, 0, __pyx_t_6);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_t_6);
  __pyx_t_6 = 0;
  __pyx_t_6 = <span class='py_c_api'>PyObject_Call</span>(__pyx_t_2, ((PyObject *)__pyx_t_5), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 327; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_6);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_5)); __pyx_t_5 = 0;
  __pyx_t_12 = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_double</span>(__pyx_t_6);
  if (unlikely(!__pyx_t_12.memview))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 327; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
  __pyx_v_box_offset = __pyx_t_12;
  __pyx_t_12.memview = NULL;
  __pyx_t_12.data = NULL;
</pre><pre class='line' style='background-color: #FFFF41' onclick='toggleDiv("line328")'> 328:     cdef long[:] box_dim = np.array(espbox.box_dim)</pre>
<pre id='line328' class='code' style='background-color: #FFFF41'>
  /* "epitopsy/cython/CalculateInteractionEnergyCython.pyx":328
 *     cdef double[:] box_mesh_size = np.array(espbox.box_mesh_size)
 *     cdef double[:] box_offset = np.array(espbox.box_offset)
 *     cdef long[:] box_dim = np.array(espbox.box_dim)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     cdef double[:,:,:] potbox = espbox.box
 * 
 */
  __pyx_t_6 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s__np);<span class='error_goto'> if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 328; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_6);
  __pyx_t_5 = __Pyx_<span class='py_c_api'>PyObject_GetAttrStr</span>(__pyx_t_6, __pyx_n_s__array);<span class='error_goto'> if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 328; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_5);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
  __pyx_t_6 = __Pyx_<span class='py_c_api'>PyObject_GetAttrStr</span>(__pyx_v_espbox, __pyx_n_s__box_dim);<span class='error_goto'> if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 328; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_6);
  __pyx_t_2 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 328; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_2, 0, __pyx_t_6);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_t_6);
  __pyx_t_6 = 0;
  __pyx_t_6 = <span class='py_c_api'>PyObject_Call</span>(__pyx_t_5, ((PyObject *)__pyx_t_2), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 328; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_6);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_2)); __pyx_t_2 = 0;
  __pyx_t_13 = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_long</span>(__pyx_t_6);
  if (unlikely(!__pyx_t_13.memview))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 328; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
  __pyx_v_box_dim = __pyx_t_13;
  __pyx_t_13.memview = NULL;
  __pyx_t_13.data = NULL;
</pre><pre class='line' style='background-color: #FFFF8d' onclick='toggleDiv("line329")'> 329:     cdef double[:,:,:] potbox = espbox.box</pre>
<pre id='line329' class='code' style='background-color: #FFFF8d'>
  /* "epitopsy/cython/CalculateInteractionEnergyCython.pyx":329
 *     cdef double[:] box_offset = np.array(espbox.box_offset)
 *     cdef long[:] box_dim = np.array(espbox.box_dim)
 *     cdef double[:,:,:] potbox = espbox.box             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     ## coord data
 */
  __pyx_t_6 = __Pyx_<span class='py_c_api'>PyObject_GetAttrStr</span>(__pyx_v_espbox, __pyx_n_s__box);<span class='error_goto'> if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 329; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_6);
  __pyx_t_14 = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_dsdsds_double</span>(__pyx_t_6);
  if (unlikely(!__pyx_t_14.memview))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 329; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
  __pyx_v_potbox = __pyx_t_14;
  __pyx_t_14.memview = NULL;
  __pyx_t_14.data = NULL;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line330")'> 330: </pre>
<pre id='line330' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line331")'> 331:     ## coord data</pre>
<pre id='line331' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF4f' onclick='toggleDiv("line332")'> 332:     cdef double[:] coord = np.zeros(3)</pre>
<pre id='line332' class='code' style='background-color: #FFFF4f'>
  /* "epitopsy/cython/CalculateInteractionEnergyCython.pyx":332
 * 
 *     ## coord data
 *     cdef double[:] coord = np.zeros(3)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     all_atoms = ligand_pqr.get_all_atoms()
 */
  __pyx_t_6 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s__np);<span class='error_goto'> if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 332; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_6);
  __pyx_t_2 = __Pyx_<span class='py_c_api'>PyObject_GetAttrStr</span>(__pyx_t_6, __pyx_n_s__zeros);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 332; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
  __pyx_t_6 = <span class='py_c_api'>PyObject_Call</span>(__pyx_t_2, ((PyObject *)__pyx_k_tuple_8), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 332; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_6);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_15 = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_double</span>(__pyx_t_6);
  if (unlikely(!__pyx_t_15.memview))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 332; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
  __pyx_v_coord = __pyx_t_15;
  __pyx_t_15.memview = NULL;
  __pyx_t_15.data = NULL;

  /* "epitopsy/cython/CalculateInteractionEnergyCython.pyx":332
 * 
 *     ## coord data
 *     cdef double[:] coord = np.zeros(3)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     all_atoms = ligand_pqr.get_all_atoms()
 */
  __pyx_k_tuple_8 = <span class='py_c_api'>PyTuple_Pack</span>(1, __pyx_int_3);<span class='error_goto'> if (unlikely(!__pyx_k_tuple_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 332; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_k_tuple_8);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_k_tuple_8));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line333")'> 333: </pre>
<pre id='line333' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF79' onclick='toggleDiv("line334")'> 334:     all_atoms = ligand_pqr.get_all_atoms()</pre>
<pre id='line334' class='code' style='background-color: #FFFF79'>
  /* "epitopsy/cython/CalculateInteractionEnergyCython.pyx":334
 *     cdef double[:] coord = np.zeros(3)
 * 
 *     all_atoms = ligand_pqr.get_all_atoms()             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     coord_list = []
 *     charge_list = []
 */
  __pyx_t_6 = __Pyx_<span class='py_c_api'>PyObject_GetAttrStr</span>(__pyx_v_ligand_pqr, __pyx_n_s__get_all_atoms);<span class='error_goto'> if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 334; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_6);
  __pyx_t_2 = <span class='py_c_api'>PyObject_Call</span>(__pyx_t_6, ((PyObject *)__pyx_empty_tuple), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 334; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
  __pyx_v_all_atoms = __pyx_t_2;
  __pyx_t_2 = 0;
</pre><pre class='line' style='background-color: #FFFFaa' onclick='toggleDiv("line335")'> 335:     coord_list = []</pre>
<pre id='line335' class='code' style='background-color: #FFFFaa'>
  /* "epitopsy/cython/CalculateInteractionEnergyCython.pyx":335
 * 
 *     all_atoms = ligand_pqr.get_all_atoms()
 *     coord_list = []             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     charge_list = []
 *     vdw_list = []
 */
  __pyx_t_2 = <span class='py_c_api'>PyList_New</span>(0);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 335; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  __pyx_v_coord_list = ((PyObject*)__pyx_t_2);
  __pyx_t_2 = 0;
</pre><pre class='line' style='background-color: #FFFFaa' onclick='toggleDiv("line336")'> 336:     charge_list = []</pre>
<pre id='line336' class='code' style='background-color: #FFFFaa'>
  /* "epitopsy/cython/CalculateInteractionEnergyCython.pyx":336
 *     all_atoms = ligand_pqr.get_all_atoms()
 *     coord_list = []
 *     charge_list = []             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     vdw_list = []
 *     cdef int n_atoms = len(all_atoms)
 */
  __pyx_t_2 = <span class='py_c_api'>PyList_New</span>(0);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 336; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  __pyx_v_charge_list = ((PyObject*)__pyx_t_2);
  __pyx_t_2 = 0;
</pre><pre class='line' style='background-color: #FFFFaa' onclick='toggleDiv("line337")'> 337:     vdw_list = []</pre>
<pre id='line337' class='code' style='background-color: #FFFFaa'>
  /* "epitopsy/cython/CalculateInteractionEnergyCython.pyx":337
 *     coord_list = []
 *     charge_list = []
 *     vdw_list = []             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     cdef int n_atoms = len(all_atoms)
 *     for atom in all_atoms:
 */
  __pyx_t_2 = <span class='py_c_api'>PyList_New</span>(0);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 337; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  __pyx_v_vdw_list = ((PyObject*)__pyx_t_2);
  __pyx_t_2 = 0;
</pre><pre class='line' style='background-color: #FFFFaa' onclick='toggleDiv("line338")'> 338:     cdef int n_atoms = len(all_atoms)</pre>
<pre id='line338' class='code' style='background-color: #FFFFaa'>
  /* "epitopsy/cython/CalculateInteractionEnergyCython.pyx":338
 *     charge_list = []
 *     vdw_list = []
 *     cdef int n_atoms = len(all_atoms)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     for atom in all_atoms:
 *         coord_list.append(atom.get_coord())
 */
  __pyx_t_16 = <span class='py_c_api'>PyObject_Length</span>(__pyx_v_all_atoms);<span class='error_goto'> if (unlikely(__pyx_t_16 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 338; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_v_n_atoms = __pyx_t_16;
</pre><pre class='line' style='background-color: #FFFF2a' onclick='toggleDiv("line339")'> 339:     for atom in all_atoms:</pre>
<pre id='line339' class='code' style='background-color: #FFFF2a'>
  /* "epitopsy/cython/CalculateInteractionEnergyCython.pyx":339
 *     vdw_list = []
 *     cdef int n_atoms = len(all_atoms)
 *     for atom in all_atoms:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         coord_list.append(atom.get_coord())
 *         charge_list.append(atom.get_info_1())
 */
  if (<span class='py_c_api'>PyList_CheckExact</span>(__pyx_v_all_atoms) || <span class='py_c_api'>PyTuple_CheckExact</span>(__pyx_v_all_atoms)) {
    __pyx_t_2 = __pyx_v_all_atoms; <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_2); __pyx_t_16 = 0;
    __pyx_t_17 = NULL;
  } else {
    __pyx_t_16 = -1; __pyx_t_2 = <span class='py_c_api'>PyObject_GetIter</span>(__pyx_v_all_atoms);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 339; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
    __pyx_t_17 = Py_TYPE(__pyx_t_2)->tp_iternext;
  }
  for (;;) {
    if (!__pyx_t_17 && <span class='py_c_api'>PyList_CheckExact</span>(__pyx_t_2)) {
      if (__pyx_t_16 >= <span class='py_macro_api'>PyList_GET_SIZE</span>(__pyx_t_2)) break;
      #if CYTHON_COMPILING_IN_CPYTHON
      __pyx_t_6 = <span class='py_macro_api'>PyList_GET_ITEM</span>(__pyx_t_2, __pyx_t_16); <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_6); __pyx_t_16++;<span class='error_goto'> if (unlikely(0 <code><</code> 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 339; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      #else
      __pyx_t_6 = <span class='py_macro_api'>PySequence_ITEM</span>(__pyx_t_2, __pyx_t_16); __pyx_t_16++;<span class='error_goto'> if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 339; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      #endif
    } else if (!__pyx_t_17 && <span class='py_c_api'>PyTuple_CheckExact</span>(__pyx_t_2)) {
      if (__pyx_t_16 >= <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_t_2)) break;
      #if CYTHON_COMPILING_IN_CPYTHON
      __pyx_t_6 = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_t_2, __pyx_t_16); <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_6); __pyx_t_16++;<span class='error_goto'> if (unlikely(0 <code><</code> 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 339; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      #else
      __pyx_t_6 = <span class='py_macro_api'>PySequence_ITEM</span>(__pyx_t_2, __pyx_t_16); __pyx_t_16++;<span class='error_goto'> if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 339; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      #endif
    } else {
      __pyx_t_6 = __pyx_t_17(__pyx_t_2);
      if (unlikely(!__pyx_t_6)) {
        if (<span class='py_c_api'>PyErr_Occurred</span>()) {
          if (likely(<span class='py_c_api'>PyErr_ExceptionMatches</span>(PyExc_StopIteration))) <span class='py_c_api'>PyErr_Clear</span>();
          else<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 339; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        }
        break;
      }
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_6);
    }
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_atom);
    __pyx_v_atom = __pyx_t_6;
    __pyx_t_6 = 0;
</pre><pre class='line' style='background-color: #FFFF5e' onclick='toggleDiv("line340")'> 340:         coord_list.append(atom.get_coord())</pre>
<pre id='line340' class='code' style='background-color: #FFFF5e'>
    /* "epitopsy/cython/CalculateInteractionEnergyCython.pyx":340
 *     cdef int n_atoms = len(all_atoms)
 *     for atom in all_atoms:
 *         coord_list.append(atom.get_coord())             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         charge_list.append(atom.get_info_1())
 *         vdw_list.append(round(atom.get_info_2() / box_mesh_size[0]))
 */
    __pyx_t_6 = __Pyx_<span class='py_c_api'>PyObject_GetAttrStr</span>(__pyx_v_atom, __pyx_n_s__get_coord);<span class='error_goto'> if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 340; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_6);
    __pyx_t_5 = <span class='py_c_api'>PyObject_Call</span>(__pyx_t_6, ((PyObject *)__pyx_empty_tuple), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 340; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_5);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
    __pyx_t_18 = __Pyx_<span class='py_c_api'>PyList_Append</span>(__pyx_v_coord_list, __pyx_t_5);<span class='error_goto'> if (unlikely(__pyx_t_18 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 340; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
</pre><pre class='line' style='background-color: #FFFF5e' onclick='toggleDiv("line341")'> 341:         charge_list.append(atom.get_info_1())</pre>
<pre id='line341' class='code' style='background-color: #FFFF5e'>
    /* "epitopsy/cython/CalculateInteractionEnergyCython.pyx":341
 *     for atom in all_atoms:
 *         coord_list.append(atom.get_coord())
 *         charge_list.append(atom.get_info_1())             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         vdw_list.append(round(atom.get_info_2() / box_mesh_size[0]))
 * 
 */
    __pyx_t_5 = __Pyx_<span class='py_c_api'>PyObject_GetAttrStr</span>(__pyx_v_atom, __pyx_n_s__get_info_1);<span class='error_goto'> if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 341; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_5);
    __pyx_t_6 = <span class='py_c_api'>PyObject_Call</span>(__pyx_t_5, ((PyObject *)__pyx_empty_tuple), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 341; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_6);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
    __pyx_t_18 = __Pyx_<span class='py_c_api'>PyList_Append</span>(__pyx_v_charge_list, __pyx_t_6);<span class='error_goto'> if (unlikely(__pyx_t_18 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 341; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
</pre><pre class='line' style='background-color: #FFFF2b' onclick='toggleDiv("line342")'> 342:         vdw_list.append(round(atom.get_info_2() / box_mesh_size[0]))</pre>
<pre id='line342' class='code' style='background-color: #FFFF2b'>
    /* "epitopsy/cython/CalculateInteractionEnergyCython.pyx":342
 *         coord_list.append(atom.get_coord())
 *         charge_list.append(atom.get_info_1())
 *         vdw_list.append(round(atom.get_info_2() / box_mesh_size[0]))             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     cdef double[:,:] ligand_real_coords = np.array(coord_list)
 */
    __pyx_t_6 = __Pyx_<span class='py_c_api'>PyObject_GetAttrStr</span>(__pyx_v_atom, __pyx_n_s__get_info_2);<span class='error_goto'> if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 342; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_6);
    __pyx_t_5 = <span class='py_c_api'>PyObject_Call</span>(__pyx_t_6, ((PyObject *)__pyx_empty_tuple), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 342; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_5);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
    __pyx_t_19 = 0;
    __pyx_t_3 = -1;
    if (__pyx_t_19 <code><</code> 0) {
      __pyx_t_19 += __pyx_v_box_mesh_size.shape[0];
      if (unlikely(__pyx_t_19 <code><</code> 0)) __pyx_t_3 = 0;
    } else if (unlikely(__pyx_t_19 >= __pyx_v_box_mesh_size.shape[0])) __pyx_t_3 = 0;
    if (unlikely(__pyx_t_3 != -1)) {
      <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_3);
     <span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 342; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    }
    __pyx_t_6 = <span class='py_c_api'>PyFloat_FromDouble</span>((*((double *) ( /* dim=0 */ (__pyx_v_box_mesh_size.data + __pyx_t_19 * __pyx_v_box_mesh_size.strides[0]) ))));<span class='error_goto'> if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 342; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_6);
    __pyx_t_4 = __Pyx_<span class='py_c_api'>PyNumber_Divide</span>(__pyx_t_5, __pyx_t_6);<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 342; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_4);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
    __pyx_t_20 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(__pyx_t_4);<span class='error_goto'> if (unlikely((__pyx_t_20 == (double)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 342; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
    __pyx_t_4 = <span class='py_c_api'>PyFloat_FromDouble</span>(round(__pyx_t_20));<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 342; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_4);
    __pyx_t_18 = __Pyx_<span class='py_c_api'>PyList_Append</span>(__pyx_v_vdw_list, __pyx_t_4);<span class='error_goto'> if (unlikely(__pyx_t_18 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 342; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
  }
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line343")'> 343: </pre>
<pre id='line343' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF48' onclick='toggleDiv("line344")'> 344:     cdef double[:,:] ligand_real_coords = np.array(coord_list)</pre>
<pre id='line344' class='code' style='background-color: #FFFF48'>
  /* "epitopsy/cython/CalculateInteractionEnergyCython.pyx":344
 *         vdw_list.append(round(atom.get_info_2() / box_mesh_size[0]))
 * 
 *     cdef double[:,:] ligand_real_coords = np.array(coord_list)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     cdef long[:,:] ligand_coords = np.zeros([n_atoms, 3],dtype=np.int)
 *     cdef double[:] charges = np.array(charge_list)
 */
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s__np);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 344; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  __pyx_t_4 = __Pyx_<span class='py_c_api'>PyObject_GetAttrStr</span>(__pyx_t_2, __pyx_n_s__array);<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 344; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 344; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_v_coord_list));
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_2, 0, ((PyObject *)__pyx_v_coord_list));
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_v_coord_list));
  __pyx_t_6 = <span class='py_c_api'>PyObject_Call</span>(__pyx_t_4, ((PyObject *)__pyx_t_2), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 344; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_6);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_2)); __pyx_t_2 = 0;
  __pyx_t_21 = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_dsds_double</span>(__pyx_t_6);
  if (unlikely(!__pyx_t_21.memview))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 344; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
  __pyx_v_ligand_real_coords = __pyx_t_21;
  __pyx_t_21.memview = NULL;
  __pyx_t_21.data = NULL;
</pre><pre class='line' style='background-color: #FFFF26' onclick='toggleDiv("line345")'> 345:     cdef long[:,:] ligand_coords = np.zeros([n_atoms, 3],dtype=np.int)</pre>
<pre id='line345' class='code' style='background-color: #FFFF26'>
  /* "epitopsy/cython/CalculateInteractionEnergyCython.pyx":345
 * 
 *     cdef double[:,:] ligand_real_coords = np.array(coord_list)
 *     cdef long[:,:] ligand_coords = np.zeros([n_atoms, 3],dtype=np.int)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     cdef double[:] charges = np.array(charge_list)
 *     cdef long[:] vdw_radii = np.array(vdw_list,dtype=np.int)
 */
  __pyx_t_6 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s__np);<span class='error_goto'> if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 345; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_6);
  __pyx_t_2 = __Pyx_<span class='py_c_api'>PyObject_GetAttrStr</span>(__pyx_t_6, __pyx_n_s__zeros);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 345; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
  __pyx_t_6 = <span class='py_c_api'>PyInt_FromLong</span>(__pyx_v_n_atoms);<span class='error_goto'> if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 345; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_6);
  __pyx_t_4 = <span class='py_c_api'>PyList_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 345; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_4);
  <span class='py_macro_api'>PyList_SET_ITEM</span>(__pyx_t_4, 0, __pyx_t_6);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_t_6);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_int_3);
  <span class='py_macro_api'>PyList_SET_ITEM</span>(__pyx_t_4, 1, __pyx_int_3);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_int_3);
  __pyx_t_6 = 0;
  __pyx_t_6 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 345; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_6);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_6, 0, ((PyObject *)__pyx_t_4));
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_t_4));
  __pyx_t_4 = 0;
  __pyx_t_4 = <span class='py_c_api'>PyDict_New</span>();<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 345; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(((PyObject *)__pyx_t_4));
  __pyx_t_5 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s__np);<span class='error_goto'> if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 345; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_5);
  __pyx_t_1 = __Pyx_<span class='py_c_api'>PyObject_GetAttrStr</span>(__pyx_t_5, __pyx_n_s__int);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 345; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_4, ((PyObject *)__pyx_n_s__dtype), __pyx_t_1) <code><</code> 0)<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 345; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = <span class='py_c_api'>PyObject_Call</span>(__pyx_t_2, ((PyObject *)__pyx_t_6), ((PyObject *)__pyx_t_4));<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 345; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_6)); __pyx_t_6 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_4)); __pyx_t_4 = 0;
  __pyx_t_22 = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_dsds_long</span>(__pyx_t_1);
  if (unlikely(!__pyx_t_22.memview))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 345; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_v_ligand_coords = __pyx_t_22;
  __pyx_t_22.memview = NULL;
  __pyx_t_22.data = NULL;
</pre><pre class='line' style='background-color: #FFFF48' onclick='toggleDiv("line346")'> 346:     cdef double[:] charges = np.array(charge_list)</pre>
<pre id='line346' class='code' style='background-color: #FFFF48'>
  /* "epitopsy/cython/CalculateInteractionEnergyCython.pyx":346
 *     cdef double[:,:] ligand_real_coords = np.array(coord_list)
 *     cdef long[:,:] ligand_coords = np.zeros([n_atoms, 3],dtype=np.int)
 *     cdef double[:] charges = np.array(charge_list)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     cdef long[:] vdw_radii = np.array(vdw_list,dtype=np.int)
 * 
 */
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s__np);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 346; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  __pyx_t_4 = __Pyx_<span class='py_c_api'>PyObject_GetAttrStr</span>(__pyx_t_1, __pyx_n_s__array);<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 346; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 346; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_v_charge_list));
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 0, ((PyObject *)__pyx_v_charge_list));
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_v_charge_list));
  __pyx_t_6 = <span class='py_c_api'>PyObject_Call</span>(__pyx_t_4, ((PyObject *)__pyx_t_1), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 346; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_6);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;
  __pyx_t_23 = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_double</span>(__pyx_t_6);
  if (unlikely(!__pyx_t_23.memview))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 346; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
  __pyx_v_charges = __pyx_t_23;
  __pyx_t_23.memview = NULL;
  __pyx_t_23.data = NULL;
</pre><pre class='line' style='background-color: #FFFF2e' onclick='toggleDiv("line347")'> 347:     cdef long[:] vdw_radii = np.array(vdw_list,dtype=np.int)</pre>
<pre id='line347' class='code' style='background-color: #FFFF2e'>
  /* "epitopsy/cython/CalculateInteractionEnergyCython.pyx":347
 *     cdef long[:,:] ligand_coords = np.zeros([n_atoms, 3],dtype=np.int)
 *     cdef double[:] charges = np.array(charge_list)
 *     cdef long[:] vdw_radii = np.array(vdw_list,dtype=np.int)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     for x in range(xdim):
 */
  __pyx_t_6 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s__np);<span class='error_goto'> if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 347; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_6);
  __pyx_t_1 = __Pyx_<span class='py_c_api'>PyObject_GetAttrStr</span>(__pyx_t_6, __pyx_n_s__array);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 347; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
  __pyx_t_6 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 347; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_6);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_v_vdw_list));
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_6, 0, ((PyObject *)__pyx_v_vdw_list));
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_v_vdw_list));
  __pyx_t_4 = <span class='py_c_api'>PyDict_New</span>();<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 347; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(((PyObject *)__pyx_t_4));
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s__np);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 347; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  __pyx_t_5 = __Pyx_<span class='py_c_api'>PyObject_GetAttrStr</span>(__pyx_t_2, __pyx_n_s__int);<span class='error_goto'> if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 347; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_5);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_4, ((PyObject *)__pyx_n_s__dtype), __pyx_t_5) <code><</code> 0)<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 347; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
  __pyx_t_5 = <span class='py_c_api'>PyObject_Call</span>(__pyx_t_1, ((PyObject *)__pyx_t_6), ((PyObject *)__pyx_t_4));<span class='error_goto'> if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 347; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_5);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_6)); __pyx_t_6 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_4)); __pyx_t_4 = 0;
  __pyx_t_24 = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_long</span>(__pyx_t_5);
  if (unlikely(!__pyx_t_24.memview))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 347; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
  __pyx_v_vdw_radii = __pyx_t_24;
  __pyx_t_24.memview = NULL;
  __pyx_t_24.data = NULL;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line348")'> 348: </pre>
<pre id='line348' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line349")'> 349:     for x in range(xdim):</pre>
<pre id='line349' class='code' style='background-color: #FFFFff'>
  /* "epitopsy/cython/CalculateInteractionEnergyCython.pyx":349
 *     cdef long[:] vdw_radii = np.array(vdw_list,dtype=np.int)
 * 
 *     for x in range(xdim):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         for y in range(ydim):
 *             for z in range(zdim):
 */
  __pyx_t_3 = __pyx_v_xdim;
  for (__pyx_t_25 = 0; __pyx_t_25 <code><</code> __pyx_t_3; __pyx_t_25+=1) {
    __pyx_v_x = __pyx_t_25;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line350")'> 350:         for y in range(ydim):</pre>
<pre id='line350' class='code' style='background-color: #FFFFff'>
    /* "epitopsy/cython/CalculateInteractionEnergyCython.pyx":350
 * 
 *     for x in range(xdim):
 *         for y in range(ydim):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             for z in range(zdim):
 *                 # not inside the protein
 */
    __pyx_t_26 = __pyx_v_ydim;
    for (__pyx_t_27 = 0; __pyx_t_27 <code><</code> __pyx_t_26; __pyx_t_27+=1) {
      __pyx_v_y = __pyx_t_27;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line351")'> 351:             for z in range(zdim):</pre>
<pre id='line351' class='code' style='background-color: #FFFFff'>
      /* "epitopsy/cython/CalculateInteractionEnergyCython.pyx":351
 *     for x in range(xdim):
 *         for y in range(ydim):
 *             for z in range(zdim):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                 # not inside the protein
 *                 if vdwbox[x, y, z] == solvent_score:
 */
      __pyx_t_28 = __pyx_v_zdim;
      for (__pyx_t_29 = 0; __pyx_t_29 <code><</code> __pyx_t_28; __pyx_t_29+=1) {
        __pyx_v_z = __pyx_t_29;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line352")'> 352:                 # not inside the protein</pre>
<pre id='line352' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line353")'> 353:                 if vdwbox[x, y, z] == solvent_score:</pre>
<pre id='line353' class='code' style='background-color: #FFFFd4'>
        /* "epitopsy/cython/CalculateInteractionEnergyCython.pyx":353
 *             for z in range(zdim):
 *                 # not inside the protein
 *                 if vdwbox[x, y, z] == solvent_score:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                     # transform box to real space coordinates
 *                     coord[0] = <code><</code>double> x
 */
        __pyx_t_30 = __pyx_v_x;
        __pyx_t_31 = __pyx_v_y;
        __pyx_t_32 = __pyx_v_z;
        __pyx_t_33 = -1;
        if (__pyx_t_30 <code><</code> 0) {
          __pyx_t_30 += __pyx_v_vdwbox.shape[0];
          if (unlikely(__pyx_t_30 <code><</code> 0)) __pyx_t_33 = 0;
        } else if (unlikely(__pyx_t_30 >= __pyx_v_vdwbox.shape[0])) __pyx_t_33 = 0;
        if (__pyx_t_31 <code><</code> 0) {
          __pyx_t_31 += __pyx_v_vdwbox.shape[1];
          if (unlikely(__pyx_t_31 <code><</code> 0)) __pyx_t_33 = 1;
        } else if (unlikely(__pyx_t_31 >= __pyx_v_vdwbox.shape[1])) __pyx_t_33 = 1;
        if (__pyx_t_32 <code><</code> 0) {
          __pyx_t_32 += __pyx_v_vdwbox.shape[2];
          if (unlikely(__pyx_t_32 <code><</code> 0)) __pyx_t_33 = 2;
        } else if (unlikely(__pyx_t_32 >= __pyx_v_vdwbox.shape[2])) __pyx_t_33 = 2;
        if (unlikely(__pyx_t_33 != -1)) {
          <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_33);
         <span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 353; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        }
        __pyx_t_34 = (((*((double *) ( /* dim=2 */ (( /* dim=1 */ (( /* dim=0 */ (__pyx_v_vdwbox.data + __pyx_t_30 * __pyx_v_vdwbox.strides[0]) ) + __pyx_t_31 * __pyx_v_vdwbox.strides[1]) ) + __pyx_t_32 * __pyx_v_vdwbox.strides[2]) ))) == __pyx_v_solvent_score) != 0);
        if (__pyx_t_34) {
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line354")'> 354:                     # transform box to real space coordinates</pre>
<pre id='line354' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line355")'> 355:                     coord[0] = &lt;double&gt; x</pre>
<pre id='line355' class='code' style='background-color: #FFFFd4'>
          /* "epitopsy/cython/CalculateInteractionEnergyCython.pyx":355
 *                 if vdwbox[x, y, z] == solvent_score:
 *                     # transform box to real space coordinates
 *                     coord[0] = <code><</code>double> x             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                     coord[1] = <code><</code>double> y
 *                     coord[2] = <code><</code>double> z
 */
          __pyx_t_16 = 0;
          __pyx_t_33 = -1;
          if (__pyx_t_16 <code><</code> 0) {
            __pyx_t_16 += __pyx_v_coord.shape[0];
            if (unlikely(__pyx_t_16 <code><</code> 0)) __pyx_t_33 = 0;
          } else if (unlikely(__pyx_t_16 >= __pyx_v_coord.shape[0])) __pyx_t_33 = 0;
          if (unlikely(__pyx_t_33 != -1)) {
            <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_33);
           <span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 355; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
          }
          *((double *) ( /* dim=0 */ (__pyx_v_coord.data + __pyx_t_16 * __pyx_v_coord.strides[0]) )) = ((double)__pyx_v_x);
</pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line356")'> 356:                     coord[1] = &lt;double&gt; y</pre>
<pre id='line356' class='code' style='background-color: #FFFFd4'>
          /* "epitopsy/cython/CalculateInteractionEnergyCython.pyx":356
 *                     # transform box to real space coordinates
 *                     coord[0] = <code><</code>double> x
 *                     coord[1] = <code><</code>double> y             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                     coord[2] = <code><</code>double> z
 * 
 */
          __pyx_t_35 = 1;
          __pyx_t_33 = -1;
          if (__pyx_t_35 <code><</code> 0) {
            __pyx_t_35 += __pyx_v_coord.shape[0];
            if (unlikely(__pyx_t_35 <code><</code> 0)) __pyx_t_33 = 0;
          } else if (unlikely(__pyx_t_35 >= __pyx_v_coord.shape[0])) __pyx_t_33 = 0;
          if (unlikely(__pyx_t_33 != -1)) {
            <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_33);
           <span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 356; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
          }
          *((double *) ( /* dim=0 */ (__pyx_v_coord.data + __pyx_t_35 * __pyx_v_coord.strides[0]) )) = ((double)__pyx_v_y);
</pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line357")'> 357:                     coord[2] = &lt;double&gt; z</pre>
<pre id='line357' class='code' style='background-color: #FFFFd4'>
          /* "epitopsy/cython/CalculateInteractionEnergyCython.pyx":357
 *                     coord[0] = <code><</code>double> x
 *                     coord[1] = <code><</code>double> y
 *                     coord[2] = <code><</code>double> z             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *                     coord = transform_box_to_real_space(coord,
 */
          __pyx_t_36 = 2;
          __pyx_t_33 = -1;
          if (__pyx_t_36 <code><</code> 0) {
            __pyx_t_36 += __pyx_v_coord.shape[0];
            if (unlikely(__pyx_t_36 <code><</code> 0)) __pyx_t_33 = 0;
          } else if (unlikely(__pyx_t_36 >= __pyx_v_coord.shape[0])) __pyx_t_33 = 0;
          if (unlikely(__pyx_t_33 != -1)) {
            <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_33);
           <span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 357; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
          }
          *((double *) ( /* dim=0 */ (__pyx_v_coord.data + __pyx_t_36 * __pyx_v_coord.strides[0]) )) = ((double)__pyx_v_z);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line358")'> 358: </pre>
<pre id='line358' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line359")'> 359:                     coord = transform_box_to_real_space(coord,</pre>
<pre id='line359' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line360")'> 360:                             box_mesh_size,</pre>
<pre id='line360' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line361")'> 361:                             box_offset)</pre>
<pre id='line361' class='code' style='background-color: #FFFFff'>
          /* "epitopsy/cython/CalculateInteractionEnergyCython.pyx":361
 *                     coord = transform_box_to_real_space(coord,
 *                             box_mesh_size,
 *                             box_offset)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *                     # move the ligand
 */
          __pyx_t_37 = __pyx_f_8epitopsy_6cython_32CalculateInteractionEnergyCython_transform_box_to_real_space(__pyx_v_coord, __pyx_v_box_mesh_size, __pyx_v_box_offset);<span class='error_goto'> if (unlikely(!__pyx_t_37.memview)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 359; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
          __PYX_XDEC_MEMVIEW(&__pyx_v_coord, 1);
          __pyx_v_coord = __pyx_t_37;
          __pyx_t_37.memview = NULL;
          __pyx_t_37.data = NULL;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line362")'> 362: </pre>
<pre id='line362' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line363")'> 363:                     # move the ligand</pre>
<pre id='line363' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line364")'> 364:                     ligand_real_coords = move_ligand(ligand_real_coords,</pre>
<pre id='line364' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line365")'> 365:                             coord)</pre>
<pre id='line365' class='code' style='background-color: #FFFFff'>
          /* "epitopsy/cython/CalculateInteractionEnergyCython.pyx":365
 *                     # move the ligand
 *                     ligand_real_coords = move_ligand(ligand_real_coords,
 *                             coord)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *                     # transform ligand coordinates
 */
          __pyx_t_38 = __pyx_f_8epitopsy_6cython_32CalculateInteractionEnergyCython_move_ligand(__pyx_v_ligand_real_coords, __pyx_v_coord);<span class='error_goto'> if (unlikely(!__pyx_t_38.memview)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 364; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
          __PYX_XDEC_MEMVIEW(&__pyx_v_ligand_real_coords, 1);
          __pyx_v_ligand_real_coords = __pyx_t_38;
          __pyx_t_38.memview = NULL;
          __pyx_t_38.data = NULL;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line366")'> 366: </pre>
<pre id='line366' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line367")'> 367:                     # transform ligand coordinates</pre>
<pre id='line367' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line368")'> 368:                     ligand_coords = transform_ligand_to_box(ligand_real_coords,</pre>
<pre id='line368' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line369")'> 369:                             box_mesh_size,</pre>
<pre id='line369' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line370")'> 370:                             box_offset)</pre>
<pre id='line370' class='code' style='background-color: #FFFFff'>
          /* "epitopsy/cython/CalculateInteractionEnergyCython.pyx":370
 *                     ligand_coords = transform_ligand_to_box(ligand_real_coords,
 *                             box_mesh_size,
 *                             box_offset)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * 
 */
          __pyx_t_39 = __pyx_f_8epitopsy_6cython_32CalculateInteractionEnergyCython_transform_ligand_to_box(__pyx_v_ligand_real_coords, __pyx_v_box_mesh_size, __pyx_v_box_offset);<span class='error_goto'> if (unlikely(!__pyx_t_39.memview)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 368; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
          __PYX_XDEC_MEMVIEW(&__pyx_v_ligand_coords, 1);
          __pyx_v_ligand_coords = __pyx_t_39;
          __pyx_t_39.memview = NULL;
          __pyx_t_39.data = NULL;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line371")'> 371: </pre>
<pre id='line371' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line372")'> 372: </pre>
<pre id='line372' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line373")'> 373:                     # check if it left the box</pre>
<pre id='line373' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFe7' onclick='toggleDiv("line374")'> 374:                     left_the_box = out_of_box(ligand_coords, box_dim)</pre>
<pre id='line374' class='code' style='background-color: #FFFFe7'>
          /* "epitopsy/cython/CalculateInteractionEnergyCython.pyx":374
 * 
 *                     # check if it left the box
 *                     left_the_box = out_of_box(ligand_coords, box_dim)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *                     if not left_the_box:
 */
          __pyx_t_5 = ((PyObject *)__pyx_f_8epitopsy_6cython_32CalculateInteractionEnergyCython_out_of_box(__pyx_v_ligand_coords, __pyx_v_box_dim));<span class='error_goto'> if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 374; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
          <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_5);
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_v_left_the_box));
          __pyx_v_left_the_box = ((PyBoolObject *)__pyx_t_5);
          __pyx_t_5 = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line375")'> 375: </pre>
<pre id='line375' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFaa' onclick='toggleDiv("line376")'> 376:                     if not left_the_box:</pre>
<pre id='line376' class='code' style='background-color: #FFFFaa'>
          /* "epitopsy/cython/CalculateInteractionEnergyCython.pyx":376
 *                     left_the_box = out_of_box(ligand_coords, box_dim)
 * 
 *                     if not left_the_box:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                         # check for overlapps
 *                         overlapp = is_overlapp(vdwbox,
 */
          __pyx_t_34 = __Pyx_<span class='py_c_api'>PyObject_IsTrue</span>(((PyObject *)__pyx_v_left_the_box));<span class='error_goto'> if (unlikely(__pyx_t_34 <code><</code> 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 376; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
          __pyx_t_40 = ((!__pyx_t_34) != 0);
          if (__pyx_t_40) {
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line377")'> 377:                         # check for overlapps</pre>
<pre id='line377' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line378")'> 378:                         overlapp = is_overlapp(vdwbox,</pre>
<pre id='line378' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line379")'> 379:                                 ligand_coords,</pre>
<pre id='line379' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line380")'> 380:                                 vdw_radii,</pre>
<pre id='line380' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line381")'> 381:                                 solvent_score,</pre>
<pre id='line381' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFe7' onclick='toggleDiv("line382")'> 382:                                 protein_score)</pre>
<pre id='line382' class='code' style='background-color: #FFFFe7'>
            /* "epitopsy/cython/CalculateInteractionEnergyCython.pyx":382
 *                                 vdw_radii,
 *                                 solvent_score,
 *                                 protein_score)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *                         # no overlapp
 */
            __pyx_t_5 = ((PyObject *)__pyx_f_8epitopsy_6cython_32CalculateInteractionEnergyCython_is_overlapp(__pyx_v_vdwbox, __pyx_v_ligand_coords, __pyx_v_vdw_radii, __pyx_v_solvent_score, __pyx_v_protein_score));<span class='error_goto'> if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 378; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
            <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_5);
            <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_v_overlapp));
            __pyx_v_overlapp = ((PyBoolObject *)__pyx_t_5);
            __pyx_t_5 = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line383")'> 383: </pre>
<pre id='line383' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line384")'> 384:                         # no overlapp</pre>
<pre id='line384' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFaa' onclick='toggleDiv("line385")'> 385:                         if not overlapp:</pre>
<pre id='line385' class='code' style='background-color: #FFFFaa'>
            /* "epitopsy/cython/CalculateInteractionEnergyCython.pyx":385
 * 
 *                         # no overlapp
 *                         if not overlapp:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                             energy = score_energy(potbox, ligand_coords, charges)
 *                             # increase counter in counter_matrix
 */
            __pyx_t_40 = __Pyx_<span class='py_c_api'>PyObject_IsTrue</span>(((PyObject *)__pyx_v_overlapp));<span class='error_goto'> if (unlikely(__pyx_t_40 <code><</code> 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 385; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
            __pyx_t_34 = ((!__pyx_t_40) != 0);
            if (__pyx_t_34) {
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line386")'> 386:                             energy = score_energy(potbox, ligand_coords, charges)</pre>
<pre id='line386' class='code' style='background-color: #FFFFff'>
              /* "epitopsy/cython/CalculateInteractionEnergyCython.pyx":386
 *                         # no overlapp
 *                         if not overlapp:
 *                             energy = score_energy(potbox, ligand_coords, charges)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                             # increase counter in counter_matrix
 *                             interaction_energy[x, y, z] = energy
 */
              __pyx_v_energy = __pyx_f_8epitopsy_6cython_32CalculateInteractionEnergyCython_score_energy(__pyx_v_potbox, __pyx_v_ligand_coords, __pyx_v_charges);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line387")'> 387:                             # increase counter in counter_matrix</pre>
<pre id='line387' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line388")'> 388:                             interaction_energy[x, y, z] = energy</pre>
<pre id='line388' class='code' style='background-color: #FFFFd4'>
              /* "epitopsy/cython/CalculateInteractionEnergyCython.pyx":388
 *                             energy = score_energy(potbox, ligand_coords, charges)
 *                             # increase counter in counter_matrix
 *                             interaction_energy[x, y, z] = energy             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                             counter_matrix[x, y, z] += 1.
 *     return interaction_energy_np, counter_matrix_np
 */
              __pyx_t_33 = __pyx_v_x;
              __pyx_t_41 = __pyx_v_y;
              __pyx_t_42 = __pyx_v_z;
              __pyx_t_43 = -1;
              if (__pyx_t_33 <code><</code> 0) {
                __pyx_t_33 += __pyx_v_interaction_energy.shape[0];
                if (unlikely(__pyx_t_33 <code><</code> 0)) __pyx_t_43 = 0;
              } else if (unlikely(__pyx_t_33 >= __pyx_v_interaction_energy.shape[0])) __pyx_t_43 = 0;
              if (__pyx_t_41 <code><</code> 0) {
                __pyx_t_41 += __pyx_v_interaction_energy.shape[1];
                if (unlikely(__pyx_t_41 <code><</code> 0)) __pyx_t_43 = 1;
              } else if (unlikely(__pyx_t_41 >= __pyx_v_interaction_energy.shape[1])) __pyx_t_43 = 1;
              if (__pyx_t_42 <code><</code> 0) {
                __pyx_t_42 += __pyx_v_interaction_energy.shape[2];
                if (unlikely(__pyx_t_42 <code><</code> 0)) __pyx_t_43 = 2;
              } else if (unlikely(__pyx_t_42 >= __pyx_v_interaction_energy.shape[2])) __pyx_t_43 = 2;
              if (unlikely(__pyx_t_43 != -1)) {
                <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_43);
               <span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 388; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
              }
              *((double *) ( /* dim=2 */ (( /* dim=1 */ (( /* dim=0 */ (__pyx_v_interaction_energy.data + __pyx_t_33 * __pyx_v_interaction_energy.strides[0]) ) + __pyx_t_41 * __pyx_v_interaction_energy.strides[1]) ) + __pyx_t_42 * __pyx_v_interaction_energy.strides[2]) )) = __pyx_v_energy;
</pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line389")'> 389:                             counter_matrix[x, y, z] += 1.</pre>
<pre id='line389' class='code' style='background-color: #FFFFd4'>
              /* "epitopsy/cython/CalculateInteractionEnergyCython.pyx":389
 *                             # increase counter in counter_matrix
 *                             interaction_energy[x, y, z] = energy
 *                             counter_matrix[x, y, z] += 1.             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     return interaction_energy_np, counter_matrix_np
 * 
 */
              __pyx_t_43 = __pyx_v_x;
              __pyx_t_44 = __pyx_v_y;
              __pyx_t_45 = __pyx_v_z;
              __pyx_t_46 = -1;
              if (__pyx_t_43 <code><</code> 0) {
                __pyx_t_43 += __pyx_v_counter_matrix.shape[0];
                if (unlikely(__pyx_t_43 <code><</code> 0)) __pyx_t_46 = 0;
              } else if (unlikely(__pyx_t_43 >= __pyx_v_counter_matrix.shape[0])) __pyx_t_46 = 0;
              if (__pyx_t_44 <code><</code> 0) {
                __pyx_t_44 += __pyx_v_counter_matrix.shape[1];
                if (unlikely(__pyx_t_44 <code><</code> 0)) __pyx_t_46 = 1;
              } else if (unlikely(__pyx_t_44 >= __pyx_v_counter_matrix.shape[1])) __pyx_t_46 = 1;
              if (__pyx_t_45 <code><</code> 0) {
                __pyx_t_45 += __pyx_v_counter_matrix.shape[2];
                if (unlikely(__pyx_t_45 <code><</code> 0)) __pyx_t_46 = 2;
              } else if (unlikely(__pyx_t_45 >= __pyx_v_counter_matrix.shape[2])) __pyx_t_46 = 2;
              if (unlikely(__pyx_t_46 != -1)) {
                <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_46);
               <span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 389; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
              }
              *((double *) ( /* dim=2 */ (( /* dim=1 */ (( /* dim=0 */ (__pyx_v_counter_matrix.data + __pyx_t_43 * __pyx_v_counter_matrix.strides[0]) ) + __pyx_t_44 * __pyx_v_counter_matrix.strides[1]) ) + __pyx_t_45 * __pyx_v_counter_matrix.strides[2]) )) += 1.;
              goto __pyx_L13;
            }
            __pyx_L13:;
            goto __pyx_L12;
          }
          __pyx_L12:;
          goto __pyx_L11;
        }
        __pyx_L11:;
      }
    }
  }
</pre><pre class='line' style='background-color: #FFFF2f' onclick='toggleDiv("line390")'> 390:     return interaction_energy_np, counter_matrix_np</pre>
<pre id='line390' class='code' style='background-color: #FFFF2f'>
  /* "epitopsy/cython/CalculateInteractionEnergyCython.pyx":390
 *                             interaction_energy[x, y, z] = energy
 *                             counter_matrix[x, y, z] += 1.
 *     return interaction_energy_np, counter_matrix_np             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 */
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
  __pyx_t_5 = <span class='py_c_api'>PyTuple_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 390; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_5);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_v_interaction_energy_np));
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_5, 0, ((PyObject *)__pyx_v_interaction_energy_np));
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_v_interaction_energy_np));
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_v_counter_matrix_np));
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_5, 1, ((PyObject *)__pyx_v_counter_matrix_np));
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_v_counter_matrix_np));
  __pyx_r = ((PyObject *)__pyx_t_5);
  __pyx_t_5 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_5);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_6);
  __PYX_XDEC_MEMVIEW(&__pyx_t_8, 1);
  __PYX_XDEC_MEMVIEW(&__pyx_t_9, 1);
  __PYX_XDEC_MEMVIEW(&__pyx_t_10, 1);
  __PYX_XDEC_MEMVIEW(&__pyx_t_11, 1);
  __PYX_XDEC_MEMVIEW(&__pyx_t_12, 1);
  __PYX_XDEC_MEMVIEW(&__pyx_t_13, 1);
  __PYX_XDEC_MEMVIEW(&__pyx_t_14, 1);
  __PYX_XDEC_MEMVIEW(&__pyx_t_15, 1);
  __PYX_XDEC_MEMVIEW(&__pyx_t_21, 1);
  __PYX_XDEC_MEMVIEW(&__pyx_t_22, 1);
  __PYX_XDEC_MEMVIEW(&__pyx_t_23, 1);
  __PYX_XDEC_MEMVIEW(&__pyx_t_24, 1);
  __PYX_XDEC_MEMVIEW(&__pyx_t_37, 1);
  __PYX_XDEC_MEMVIEW(&__pyx_t_38, 1);
  __PYX_XDEC_MEMVIEW(&__pyx_t_39, 1);
  { PyObject *__pyx_type, *__pyx_value, *__pyx_tb;
    <span class='pyx_c_api'>__Pyx_ErrFetch</span>(&__pyx_type, &__pyx_value, &__pyx_tb);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&__pyx_pybuffernd_counter_matrix_np.rcbuffer->pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&__pyx_pybuffernd_interaction_energy_np.rcbuffer->pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&__pyx_pybuffernd_vdwbox_np.rcbuffer->pybuffer);
  <span class='pyx_c_api'>__Pyx_ErrRestore</span>(__pyx_type, __pyx_value, __pyx_tb);}
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("epitopsy.cython.CalculateInteractionEnergyCython.speed_up_brute_force", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  goto __pyx_L2;
  __pyx_L0:;
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&__pyx_pybuffernd_counter_matrix_np.rcbuffer->pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&__pyx_pybuffernd_interaction_energy_np.rcbuffer->pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&__pyx_pybuffernd_vdwbox_np.rcbuffer->pybuffer);
  __pyx_L2:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_overlapp);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_left_the_box);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_interaction_energy_np);
  __PYX_XDEC_MEMVIEW(&__pyx_v_interaction_energy, 1);
  __PYX_XDEC_MEMVIEW(&__pyx_v_counter_matrix, 1);
  __PYX_XDEC_MEMVIEW(&__pyx_v_vdwbox, 1);
  __PYX_XDEC_MEMVIEW(&__pyx_v_box_mesh_size, 1);
  __PYX_XDEC_MEMVIEW(&__pyx_v_box_offset, 1);
  __PYX_XDEC_MEMVIEW(&__pyx_v_box_dim, 1);
  __PYX_XDEC_MEMVIEW(&__pyx_v_potbox, 1);
  __PYX_XDEC_MEMVIEW(&__pyx_v_coord, 1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_all_atoms);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_coord_list);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_charge_list);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_vdw_list);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_atom);
  __PYX_XDEC_MEMVIEW(&__pyx_v_ligand_real_coords, 1);
  __PYX_XDEC_MEMVIEW(&__pyx_v_ligand_coords, 1);
  __PYX_XDEC_MEMVIEW(&__pyx_v_charges, 1);
  __PYX_XDEC_MEMVIEW(&__pyx_v_vdw_radii, 1);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}

/* Python wrapper */
static CYTHON_UNUSED int __pyx_pw_5numpy_7ndarray_1__getbuffer__(PyObject *__pyx_v_self, Py_buffer *__pyx_v_info, int __pyx_v_flags); /*proto*/
static CYTHON_UNUSED int __pyx_pw_5numpy_7ndarray_1__getbuffer__(PyObject *__pyx_v_self, Py_buffer *__pyx_v_info, int __pyx_v_flags) {
  int __pyx_r;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("__getbuffer__ (wrapper)", 0);
  __pyx_r = __pyx_pf_5numpy_7ndarray___getbuffer__(((PyArrayObject *)__pyx_v_self), ((Py_buffer *)__pyx_v_info), ((int)__pyx_v_flags));
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line391")'> 391: </pre>
<pre id='line391' class='code' style='background-color: #FFFFff'></pre></body></html>

<!DOCTYPE html>
<!-- Generated by Cython 0.20.1 on Sun Mar  9 10:36:03 2014 -->
<html>

<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<style type="text/css">

body { font-family: courier; font-size: 12; }

.code  { font-size: 9; color: #444444; display: none; margin-left: 20px; }
.py_c_api  { color: red; }
.py_macro_api  { color: #FF7000; }
.pyx_c_api  { color: #FF3000; }
.pyx_macro_api  { color: #FF7000; }
.refnanny  { color: #FFA000; }

.error_goto  { color: #FFA000; }

.tag  {  }

.coerce  { color: #008000; border: 1px dotted #008000 }

.py_attr { color: #FF0000; font-weight: bold; }
.c_attr  { color: #0000FF; }

.py_call { color: #FF0000; font-weight: bold; }
.c_call  { color: #0000FF; }

.line { margin: 0em }

</style>
<script>
function toggleDiv(id) {
    theDiv = document.getElementById(id);
    if (theDiv.style.display != 'block') theDiv.style.display = 'block';
    else theDiv.style.display = 'none';
}
</script>
</head>
        <body>
<p>Generated by Cython 0.20.1 on Sun Mar  9 10:36:03 2014
<p>Raw output: <a href="optimize_dca.c">optimize_dca.c</a>
<pre class='line' style='background-color: #FFFF79' onclick='toggleDiv("line1")'> 1: """</pre>
<pre id='line1' class='code' style='background-color: #FFFF79'>  __pyx_t_1 = <span class='py_c_api'>PyDict_New</span>();<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_test, __pyx_t_1) &lt; 0) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2")'> 2: @author: Christoph Wilms</pre>
<pre id='line2' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line3")'> 3: """</pre>
<pre id='line3' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF8d' onclick='toggleDiv("line4")'> 4: import numpy as np</pre>
<pre id='line4' class='code' style='background-color: #FFFF8d'>  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_Import</span>(__pyx_n_s_numpy, 0, -1);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 4; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_np, __pyx_t_1) &lt; 0) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 4; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line5")'> 5: </pre>
<pre id='line5' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line6")'> 6: # "cimport" is used to import special compile-time information</pre>
<pre id='line6' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line7")'> 7: # about the numpy module (this is stored in a file numpy.pxd which is</pre>
<pre id='line7' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line8")'> 8: # currently part of the Cython distribution).</pre>
<pre id='line8' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line9")'> 9: cimport numpy as np</pre>
<pre id='line9' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line10")'> 10: cimport cython</pre>
<pre id='line10' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line11")'> 11: </pre>
<pre id='line11' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line12")'> 12: from cython.parallel import prange, parallel</pre>
<pre id='line12' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line13")'> 13: </pre>
<pre id='line13' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line14")'> 14: from libc.math cimport exp, log</pre>
<pre id='line14' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line15")'> 15: </pre>
<pre id='line15' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line16")'> 16: # We now need to fix a datatype for our arrays. I've used the variable</pre>
<pre id='line16' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line17")'> 17: # DTYPE for this, which is assigned to the usual NumPy runtime</pre>
<pre id='line17' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line18")'> 18: # type info object.</pre>
<pre id='line18' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF79' onclick='toggleDiv("line19")'> 19: DTYPE_int = np.int</pre>
<pre id='line19' class='code' style='background-color: #FFFF79'>  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 19; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_1, __pyx_n_s_int);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 19; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_DTYPE_int, __pyx_t_2) &lt; 0) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 19; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
</pre><pre class='line' style='background-color: #FFFF79' onclick='toggleDiv("line20")'> 20: DTYPE_float = np.float</pre>
<pre id='line20' class='code' style='background-color: #FFFF79'>  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 20; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_2, __pyx_n_s_float);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 20; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_DTYPE_float, __pyx_t_1) &lt; 0) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 20; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
</pre><pre class='line' style='background-color: #FFFF79' onclick='toggleDiv("line21")'> 21: DTYPE_cmplx = np.complex</pre>
<pre id='line21' class='code' style='background-color: #FFFF79'>  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 21; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_1, __pyx_n_s_complex);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 21; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_DTYPE_cmplx, __pyx_t_2) &lt; 0) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 21; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line22")'> 22: </pre>
<pre id='line22' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line23")'> 23: # "ctypedef" assigns a corresponding compile-time type to DTYPE_t. For</pre>
<pre id='line23' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line24")'> 24: # every type in the numpy module there's a corresponding compile-time</pre>
<pre id='line24' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line25")'> 25: # type with a _t-suffix.</pre>
<pre id='line25' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line26")'> 26: ctypedef np.int_t DTYPE_int_t</pre>
<pre id='line26' class='code' style='background-color: #FFFFff'>typedef __pyx_t_5numpy_int_t __pyx_t_8epitopsy_6cython_12optimize_dca_DTYPE_int_t;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line27")'> 27: ctypedef np.float_t DTYPE_float_t</pre>
<pre id='line27' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line28")'> 28: ctypedef np.complex_t DTYPE_cmplx_t</pre>
<pre id='line28' class='code' style='background-color: #FFFFff'>typedef __pyx_t_5numpy_complex_t __pyx_t_8epitopsy_6cython_12optimize_dca_DTYPE_cmplx_t;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line29")'> 29: </pre>
<pre id='line29' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line30")'> 30: </pre>
<pre id='line30' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line31")'> 31: ## special imports</pre>
<pre id='line31' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF8d' onclick='toggleDiv("line32")'> 32: import time</pre>
<pre id='line32' class='code' style='background-color: #FFFF8d'>  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_Import</span>(__pyx_n_s_time, 0, -1);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 32; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_time, __pyx_t_2) &lt; 0) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 32; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
</pre><pre class='line' style='background-color: #FFFF8d' onclick='toggleDiv("line33")'> 33: import sys</pre>
<pre id='line33' class='code' style='background-color: #FFFF8d'>  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_Import</span>(__pyx_n_s_sys, 0, -1);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 33; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_sys, __pyx_t_2) &lt; 0) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 33; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
</pre><pre class='line' style='background-color: #FFFF8d' onclick='toggleDiv("line34")'> 34: import gzip</pre>
<pre id='line34' class='code' style='background-color: #FFFF8d'>  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_Import</span>(__pyx_n_s_gzip, 0, -1);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 34; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_gzip, __pyx_t_2) &lt; 0) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 34; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
</pre><pre class='line' style='background-color: #FFFF8d' onclick='toggleDiv("line35")'> 35: import multiprocessing</pre>
<pre id='line35' class='code' style='background-color: #FFFF8d'>  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_Import</span>(__pyx_n_s_multiprocessing, 0, -1);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 35; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_multiprocessing, __pyx_t_2) &lt; 0) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 35; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line36")'> 36: </pre>
<pre id='line36' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF57' onclick='toggleDiv("line37")'> 37: from Bio import AlignIO</pre>
<pre id='line37' class='code' style='background-color: #FFFF57'>  __pyx_t_2 = <span class='py_c_api'>PyList_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 37; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_n_s_AlignIO);
  <span class='py_macro_api'>PyList_SET_ITEM</span>(__pyx_t_2, 0, __pyx_n_s_AlignIO);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_n_s_AlignIO);
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_Import</span>(__pyx_n_s_Bio, __pyx_t_2, -1);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 37; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_ImportFrom</span>(__pyx_t_1, __pyx_n_s_AlignIO);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 37; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_AlignIO, __pyx_t_2) &lt; 0) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 37; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line38")'> 38: </pre>
<pre id='line38' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF37' onclick='toggleDiv("line39")'> 39: def dca(Z, W, outputfile, pseudocount_weight = 0.5,</pre>
<pre id='line39' class='code' style='background-color: #FFFF37'>/* Python wrapper */
static PyObject *__pyx_pw_8epitopsy_6cython_12optimize_dca_1dca(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_8epitopsy_6cython_12optimize_dca_dca[] = "\n    Direct Coupling Analysis (DCA)\n    \n    Args:\n        Z -&gt; numpy array containing the alignment translated to [0,...,q]\n        W -&gt; \n        outputfile -&gt; file containing N(N-1)/2 rows and 4 columns:\n            residue i (column 1)\n            residue j (column 2)\n            MI(i,j) (Mutual Information between i and j)\n            DI(i,j) (Direct Information between i and j)\n        pseudocount_weight -&gt; relative weight of pseudo count\n            i.e. lambda = pseudocount_weight * Meff\n        theta -&gt; threshold for sequence id in reweighting\n\n    F Morcos, A Pagnani, B Lunt, A Bertolino, DS Marks, C Sander, \n    R Zecchina, JN Onuchic, T Hwa, M Weigt (2011), Direct-coupling\n    analysis of residue co-evolution captures native contacts across \n    many protein families, Proc. Natl. Acad. Sci. 108:E1293-1301.\n    ";
static PyMethodDef __pyx_mdef_8epitopsy_6cython_12optimize_dca_1dca = {<span class='pyx_macro_api'>__Pyx_NAMESTR</span>("dca"), (PyCFunction)__pyx_pw_8epitopsy_6cython_12optimize_dca_1dca, METH_VARARGS|METH_KEYWORDS, <span class='pyx_macro_api'>__Pyx_DOCSTR</span>(__pyx_doc_8epitopsy_6cython_12optimize_dca_dca)};
static PyObject *__pyx_pw_8epitopsy_6cython_12optimize_dca_1dca(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_Z = 0;
  PyObject *__pyx_v_W = 0;
  PyObject *__pyx_v_outputfile = 0;
  PyObject *__pyx_v_pseudocount_weight = 0;
  PyObject *__pyx_v_num_threads = 0;
  PyObject *__pyx_v_q = 0;
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("dca (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&amp;__pyx_n_s_Z,&amp;__pyx_n_s_W,&amp;__pyx_n_s_outputfile,&amp;__pyx_n_s_pseudocount_weight,&amp;__pyx_n_s_num_threads,&amp;__pyx_n_s_q,0};
    PyObject* values[6] = {0,0,0,0,0,0};
    values[3] = ((PyObject *)__pyx_float_0_5);
/* … */
  /* function exit code */
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

static PyObject *__pyx_pf_8epitopsy_6cython_12optimize_dca_dca(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_Z, PyObject *__pyx_v_W, PyObject *__pyx_v_outputfile, PyObject *__pyx_v_pseudocount_weight, PyObject *__pyx_v_num_threads, PyObject *__pyx_v_q) {
  CYTHON_UNUSED PyObject *__pyx_v_start_time = NULL;
  PyObject *__pyx_v_N = NULL;
  PyObject *__pyx_v_M = NULL;
  PyObject *__pyx_v_Pij_true = NULL;
  PyObject *__pyx_v_Pi_true = NULL;
  PyObject *__pyx_v_Meff = NULL;
  PyObject *__pyx_v_header_string = NULL;
  PyObject *__pyx_v_Pij = NULL;
  PyObject *__pyx_v_Pi = NULL;
  PyArrayObject *__pyx_v_C = NULL;
  PyObject *__pyx_v_invC = NULL;
  CYTHON_UNUSED PyObject *__pyx_v_end_time = NULL;
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("dca", 0);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_num_threads);
/* … */
  /* function exit code */
  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_9);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_10);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("epitopsy.cython.optimize_dca.dca", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_start_time);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_N);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_M);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_Pij_true);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_Pi_true);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_Meff);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_header_string);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_Pij);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_Pi);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_C);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_invC);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_end_time);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_num_threads);
  <span class='refnanny'>__Pyx_XGIVEREF</span>(__pyx_r);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
/* … */
  __pyx_tuple__31 = <span class='py_c_api'>PyTuple_Pack</span>(18, __pyx_n_s_Z, __pyx_n_s_W, __pyx_n_s_outputfile, __pyx_n_s_pseudocount_weight, __pyx_n_s_num_threads, __pyx_n_s_q, __pyx_n_s_start_time, __pyx_n_s_N, __pyx_n_s_M, __pyx_n_s_Pij_true, __pyx_n_s_Pi_true, __pyx_n_s_Meff, __pyx_n_s_header_string, __pyx_n_s_Pij, __pyx_n_s_Pi, __pyx_n_s_C, __pyx_n_s_invC, __pyx_n_s_end_time);<span class='error_goto'> if (unlikely(!__pyx_tuple__31)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 39; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_tuple__31);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_tuple__31);
/* … */
  __pyx_t_1 = PyCFunction_NewEx(&amp;__pyx_mdef_8epitopsy_6cython_12optimize_dca_1dca, NULL, __pyx_n_s_epitopsy_cython_optimize_dca);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 39; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_dca, __pyx_t_1) &lt; 0) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 39; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_codeobj__32 = (PyObject*)<span class='pyx_c_api'>__Pyx_PyCode_New</span>(6, 0, 18, 0, 0, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__31, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_home_chris_workspace_epitopsy_e, __pyx_n_s_dca, 39, __pyx_empty_bytes);<span class='error_goto'> if (unlikely(!__pyx_codeobj__32)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 39; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
</pre><pre class='line' style='background-color: #FFFF24' onclick='toggleDiv("line40")'> 40:         num_threads=None, q=21.):</pre>
<pre id='line40' class='code' style='background-color: #FFFF24'>    values[4] = ((PyObject *)Py_None);
    values[5] = ((PyObject *)__pyx_float_21_);
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
      switch (pos_args) {
        case  6: values[5] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 5);
        case  5: values[4] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 4);
        case  4: values[3] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 3);
        case  3: values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s_Z)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        case  1:
        if (likely((values[1] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s_W)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("dca", 0, 3, 6, 1); <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 39; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
        case  2:
        if (likely((values[2] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s_outputfile)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("dca", 0, 3, 6, 2); <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 39; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
        case  3:
        if (kw_args &gt; 0) {
          PyObject* value = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s_pseudocount_weight);
          if (value) { values[3] = value; kw_args--; }
        }
        case  4:
        if (kw_args &gt; 0) {
          PyObject* value = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s_num_threads);
          if (value) { values[4] = value; kw_args--; }
        }
        case  5:
        if (kw_args &gt; 0) {
          PyObject* value = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s_q);
          if (value) { values[5] = value; kw_args--; }
        }
      }
      if (unlikely(kw_args &gt; 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "dca") &lt; 0)) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 39; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
      }
    } else {
      switch (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)) {
        case  6: values[5] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 5);
        case  5: values[4] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 4);
        case  4: values[3] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 3);
        case  3: values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
        values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        break;
        default: goto __pyx_L5_argtuple_error;
      }
    }
    __pyx_v_Z = values[0];
    __pyx_v_W = values[1];
    __pyx_v_outputfile = values[2];
    __pyx_v_pseudocount_weight = values[3];
    __pyx_v_num_threads = values[4];
    __pyx_v_q = values[5];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("dca", 0, 3, 6, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)); <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 39; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("epitopsy.cython.optimize_dca.dca", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_8epitopsy_6cython_12optimize_dca_dca(__pyx_self, __pyx_v_Z, __pyx_v_W, __pyx_v_outputfile, __pyx_v_pseudocount_weight, __pyx_v_num_threads, __pyx_v_q);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line41")'> 41:     '''</pre>
<pre id='line41' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line42")'> 42:     Direct Coupling Analysis (DCA)</pre>
<pre id='line42' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line43")'> 43: </pre>
<pre id='line43' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line44")'> 44:     Args:</pre>
<pre id='line44' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line45")'> 45:         Z -&gt; numpy array containing the alignment translated to [0,...,q]</pre>
<pre id='line45' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line46")'> 46:         W -&gt;</pre>
<pre id='line46' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line47")'> 47:         outputfile -&gt; file containing N(N-1)/2 rows and 4 columns:</pre>
<pre id='line47' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line48")'> 48:             residue i (column 1)</pre>
<pre id='line48' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line49")'> 49:             residue j (column 2)</pre>
<pre id='line49' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line50")'> 50:             MI(i,j) (Mutual Information between i and j)</pre>
<pre id='line50' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line51")'> 51:             DI(i,j) (Direct Information between i and j)</pre>
<pre id='line51' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line52")'> 52:         pseudocount_weight -&gt; relative weight of pseudo count</pre>
<pre id='line52' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line53")'> 53:             i.e. lambda = pseudocount_weight * Meff</pre>
<pre id='line53' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line54")'> 54:         theta -&gt; threshold for sequence id in reweighting</pre>
<pre id='line54' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line55")'> 55: </pre>
<pre id='line55' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line56")'> 56:     F Morcos, A Pagnani, B Lunt, A Bertolino, DS Marks, C Sander,</pre>
<pre id='line56' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line57")'> 57:     R Zecchina, JN Onuchic, T Hwa, M Weigt (2011), Direct-coupling</pre>
<pre id='line57' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line58")'> 58:     analysis of residue co-evolution captures native contacts across</pre>
<pre id='line58' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line59")'> 59:     many protein families, Proc. Natl. Acad. Sci. 108:E1293-1301.</pre>
<pre id='line59' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line60")'> 60:     '''</pre>
<pre id='line60' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF8d' onclick='toggleDiv("line61")'> 61:     start_time = time.time()</pre>
<pre id='line61' class='code' style='background-color: #FFFF8d'>  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s_time);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 61; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_1, __pyx_n_s_time);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 61; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_2, __pyx_empty_tuple, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 61; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_v_start_time = __pyx_t_1;
  __pyx_t_1 = 0;
</pre><pre class='line' style='background-color: #FFFFaa' onclick='toggleDiv("line62")'> 62:     N = Z.shape[1]</pre>
<pre id='line62' class='code' style='background-color: #FFFFaa'>  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_Z, __pyx_n_s_shape);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 62; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(__pyx_t_1, 1, long, 1, __Pyx_PyInt_From_long, 0, 0, 1);<span class='error_goto'> if (unlikely(__pyx_t_2 == NULL)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 62; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>;
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_v_N = __pyx_t_2;
  __pyx_t_2 = 0;
</pre><pre class='line' style='background-color: #FFFFaa' onclick='toggleDiv("line63")'> 63:     M = Z.shape[0]</pre>
<pre id='line63' class='code' style='background-color: #FFFFaa'>  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_Z, __pyx_n_s_shape);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 63; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(__pyx_t_2, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1);<span class='error_goto'> if (unlikely(__pyx_t_1 == NULL)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 63; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>;
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_v_M = __pyx_t_1;
  __pyx_t_1 = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line64")'> 64:     if num_threads is None:</pre>
<pre id='line64' class='code' style='background-color: #FFFFff'>  __pyx_t_3 = (__pyx_v_num_threads == Py_None);
  __pyx_t_4 = (__pyx_t_3 != 0);
  if (__pyx_t_4) {
</pre><pre class='line' style='background-color: #FFFF86' onclick='toggleDiv("line65")'> 65:         num_threads = multiprocessing.cpu_count()</pre>
<pre id='line65' class='code' style='background-color: #FFFF86'>    __pyx_t_1 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s_multiprocessing);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 65; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
    __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_1, __pyx_n_s_cpu_count);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 65; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_2, __pyx_empty_tuple, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 65; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_v_num_threads, __pyx_t_1);
    __pyx_t_1 = 0;
    goto __pyx_L3;
  }
</pre><pre class='line' style='background-color: #FFFF5e' onclick='toggleDiv("line66")'> 66:     elif num_threads &gt; multiprocessing.cpu_count():</pre>
<pre id='line66' class='code' style='background-color: #FFFF5e'>  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s_multiprocessing);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 66; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_1, __pyx_n_s_cpu_count);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 66; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_2, __pyx_empty_tuple, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 66; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = <span class='py_c_api'>PyObject_RichCompare</span>(__pyx_v_num_threads, __pyx_t_1, Py_GT); <span class='refnanny'>__Pyx_XGOTREF</span>(__pyx_t_2);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 66; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyObject_IsTrue</span>(__pyx_t_2);<span class='error_goto'> if (unlikely(__pyx_t_4 &lt; 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 66; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  if (__pyx_t_4) {
</pre><pre class='line' style='background-color: #FFFF86' onclick='toggleDiv("line67")'> 67:         num_threads = multiprocessing.cpu_count()</pre>
<pre id='line67' class='code' style='background-color: #FFFF86'>    __pyx_t_2 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s_multiprocessing);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 67; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
    __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_2, __pyx_n_s_cpu_count);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 67; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_1, __pyx_empty_tuple, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 67; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_v_num_threads, __pyx_t_2);
    __pyx_t_2 = 0;
    goto __pyx_L3;
  }
  __pyx_L3:;
</pre><pre class='line' style='background-color: #FFFF3b' onclick='toggleDiv("line68")'> 68:     [Pij_true, Pi_true, Meff] = Compute_True_Frequencies(Z,W,M,N,q,num_threads)</pre>
<pre id='line68' class='code' style='background-color: #FFFF3b'>  if (!(likely(((__pyx_v_Z) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_v_Z, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 68; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  if (!(likely(((__pyx_v_W) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_v_W, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 68; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyInt_As_int</span>(__pyx_v_M);<span class='error_goto'> if (unlikely((__pyx_t_5 == (int)-1) &amp;&amp; PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 68; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyInt_As_int</span>(__pyx_v_N);<span class='error_goto'> if (unlikely((__pyx_t_6 == (int)-1) &amp;&amp; PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 68; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_t_7 = <span class='pyx_c_api'>__Pyx_PyInt_As_int</span>(__pyx_v_q);<span class='error_goto'> if (unlikely((__pyx_t_7 == (int)-1) &amp;&amp; PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 68; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_t_8 = <span class='pyx_c_api'>__Pyx_PyInt_As_int</span>(__pyx_v_num_threads);<span class='error_goto'> if (unlikely((__pyx_t_8 == (int)-1) &amp;&amp; PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 68; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_t_2 = __pyx_f_8epitopsy_6cython_12optimize_dca_Compute_True_Frequencies(((PyArrayObject *)__pyx_v_Z), ((PyArrayObject *)__pyx_v_W), __pyx_t_5, __pyx_t_6, __pyx_t_7, __pyx_t_8);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 68; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  if (likely(__pyx_t_2 != Py_None)) {
    PyObject* sequence = __pyx_t_2;
    #if CYTHON_COMPILING_IN_CPYTHON
    Py_ssize_t size = Py_SIZE(sequence);
    #else
    Py_ssize_t size = <span class='py_c_api'>PySequence_Size</span>(sequence);
    #endif
    if (unlikely(size != 3)) {
      if (size &gt; 3) <span class='pyx_c_api'>__Pyx_RaiseTooManyValuesError</span>(3);
      else if (size &gt;= 0) <span class='pyx_c_api'>__Pyx_RaiseNeedMoreValuesError</span>(size);
      <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 68; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    }
    #if CYTHON_COMPILING_IN_CPYTHON
    __pyx_t_1 = <span class='py_macro_api'>PyList_GET_ITEM</span>(sequence, 0); 
    __pyx_t_9 = <span class='py_macro_api'>PyList_GET_ITEM</span>(sequence, 1); 
    __pyx_t_10 = <span class='py_macro_api'>PyList_GET_ITEM</span>(sequence, 2); 
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_1);
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_9);
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_10);
    #else
    __pyx_t_1 = <span class='py_macro_api'>PySequence_ITEM</span>(sequence, 0);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 68; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
    __pyx_t_9 = <span class='py_macro_api'>PySequence_ITEM</span>(sequence, 1);<span class='error_goto'> if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 68; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_9);
    __pyx_t_10 = <span class='py_macro_api'>PySequence_ITEM</span>(sequence, 2);<span class='error_goto'> if (unlikely(!__pyx_t_10)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 68; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_10);
    #endif
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  } else {
    <span class='pyx_c_api'>__Pyx_RaiseNoneNotIterableError</span>(); <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 68; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  }
  __pyx_v_Pij_true = __pyx_t_1;
  __pyx_t_1 = 0;
  __pyx_v_Pi_true = __pyx_t_9;
  __pyx_t_9 = 0;
  __pyx_v_Meff = __pyx_t_10;
  __pyx_t_10 = 0;
</pre><pre class='line' style='background-color: #FFFF52' onclick='toggleDiv("line69")'> 69:     header_string = "#### optimize DCA N={0} M={1} Meff={2} q={3} pseudo_weight={4}".format(N,M,Meff,q, pseudocount_weight)</pre>
<pre id='line69' class='code' style='background-color: #FFFF52'>  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_kp_s_optimize_DCA_N_0_M_1_Meff_2_q_3, __pyx_n_s_format);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 69; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  __pyx_t_10 = <span class='py_c_api'>PyTuple_New</span>(5);<span class='error_goto'> if (unlikely(!__pyx_t_10)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 69; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_10);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_N);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_10, 0, __pyx_v_N);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_v_N);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_M);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_10, 1, __pyx_v_M);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_v_M);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_Meff);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_10, 2, __pyx_v_Meff);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_v_Meff);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_q);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_10, 3, __pyx_v_q);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_v_q);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_pseudocount_weight);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_10, 4, __pyx_v_pseudocount_weight);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_v_pseudocount_weight);
  __pyx_t_9 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_2, __pyx_t_10, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 69; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_9);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_10); __pyx_t_10 = 0;
  __pyx_v_header_string = __pyx_t_9;
  __pyx_t_9 = 0;
</pre><pre class='line' style='background-color: #FFFF3e' onclick='toggleDiv("line70")'> 70:     [Pij, Pi] = with_pc(Pij_true,Pi_true,pseudocount_weight,N,q)</pre>
<pre id='line70' class='code' style='background-color: #FFFF3e'>  if (!(likely(((__pyx_v_Pij_true) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_v_Pij_true, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 70; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  if (!(likely(((__pyx_v_Pi_true) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_v_Pi_true, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 70; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_t_11 = __pyx_<span class='py_c_api'>PyFloat_AsFloat</span>(__pyx_v_pseudocount_weight);<span class='error_goto'> if (unlikely((__pyx_t_11 == (float)-1) &amp;&amp; PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 70; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_t_8 = <span class='pyx_c_api'>__Pyx_PyInt_As_int</span>(__pyx_v_N);<span class='error_goto'> if (unlikely((__pyx_t_8 == (int)-1) &amp;&amp; PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 70; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_t_7 = <span class='pyx_c_api'>__Pyx_PyInt_As_int</span>(__pyx_v_q);<span class='error_goto'> if (unlikely((__pyx_t_7 == (int)-1) &amp;&amp; PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 70; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_t_9 = __pyx_f_8epitopsy_6cython_12optimize_dca_with_pc(((PyArrayObject *)__pyx_v_Pij_true), ((PyArrayObject *)__pyx_v_Pi_true), __pyx_t_11, __pyx_t_8, __pyx_t_7);<span class='error_goto'> if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 70; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_9);
  if (likely(__pyx_t_9 != Py_None)) {
    PyObject* sequence = __pyx_t_9;
    #if CYTHON_COMPILING_IN_CPYTHON
    Py_ssize_t size = Py_SIZE(sequence);
    #else
    Py_ssize_t size = <span class='py_c_api'>PySequence_Size</span>(sequence);
    #endif
    if (unlikely(size != 2)) {
      if (size &gt; 2) <span class='pyx_c_api'>__Pyx_RaiseTooManyValuesError</span>(2);
      else if (size &gt;= 0) <span class='pyx_c_api'>__Pyx_RaiseNeedMoreValuesError</span>(size);
      <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 70; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    }
    #if CYTHON_COMPILING_IN_CPYTHON
    __pyx_t_10 = <span class='py_macro_api'>PyList_GET_ITEM</span>(sequence, 0); 
    __pyx_t_2 = <span class='py_macro_api'>PyList_GET_ITEM</span>(sequence, 1); 
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_10);
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_2);
    #else
    __pyx_t_10 = <span class='py_macro_api'>PySequence_ITEM</span>(sequence, 0);<span class='error_goto'> if (unlikely(!__pyx_t_10)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 70; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_10);
    __pyx_t_2 = <span class='py_macro_api'>PySequence_ITEM</span>(sequence, 1);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 70; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
    #endif
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_9); __pyx_t_9 = 0;
  } else {
    <span class='pyx_c_api'>__Pyx_RaiseNoneNotIterableError</span>(); <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 70; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  }
  __pyx_v_Pij = __pyx_t_10;
  __pyx_t_10 = 0;
  __pyx_v_Pi = __pyx_t_2;
  __pyx_t_2 = 0;
</pre><pre class='line' style='background-color: #FFFF8d' onclick='toggleDiv("line71")'> 71:     C = Compute_C(Pij,Pi,N,q)</pre>
<pre id='line71' class='code' style='background-color: #FFFF8d'>  if (!(likely(((__pyx_v_Pij) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_v_Pij, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 71; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  if (!(likely(((__pyx_v_Pi) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_v_Pi, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 71; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_t_7 = <span class='pyx_c_api'>__Pyx_PyInt_As_int</span>(__pyx_v_N);<span class='error_goto'> if (unlikely((__pyx_t_7 == (int)-1) &amp;&amp; PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 71; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_t_8 = <span class='pyx_c_api'>__Pyx_PyInt_As_int</span>(__pyx_v_q);<span class='error_goto'> if (unlikely((__pyx_t_8 == (int)-1) &amp;&amp; PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 71; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_t_9 = ((PyObject *)__pyx_f_8epitopsy_6cython_12optimize_dca_Compute_C(((PyArrayObject *)__pyx_v_Pij), ((PyArrayObject *)__pyx_v_Pi), __pyx_t_7, __pyx_t_8));<span class='error_goto'> if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 71; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_9);
  __pyx_v_C = ((PyArrayObject *)__pyx_t_9);
  __pyx_t_9 = 0;
</pre><pre class='line' style='background-color: #FFFF57' onclick='toggleDiv("line72")'> 72:     invC = np.linalg.inv(C)</pre>
<pre id='line72' class='code' style='background-color: #FFFF57'>  __pyx_t_9 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 72; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_9);
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_9, __pyx_n_s_linalg);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 72; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_9); __pyx_t_9 = 0;
  __pyx_t_9 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_2, __pyx_n_s_inv);<span class='error_goto'> if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 72; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_9);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 72; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_v_C));
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_2, 0, ((PyObject *)__pyx_v_C));
  <span class='refnanny'>__Pyx_GIVEREF</span>(((PyObject *)__pyx_v_C));
  __pyx_t_10 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_9, __pyx_t_2, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_10)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 72; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_10);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_9); __pyx_t_9 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_v_invC = __pyx_t_10;
  __pyx_t_10 = 0;
</pre><pre class='line' style='background-color: #FFFF57' onclick='toggleDiv("line73")'> 73:     Compute_Results(Pij, Pi,Pij_true, Pi_true, invC, N, q, outputfile, header_string)</pre>
<pre id='line73' class='code' style='background-color: #FFFF57'>  if (!(likely(((__pyx_v_Pij) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_v_Pij, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 73; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  if (!(likely(((__pyx_v_Pi) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_v_Pi, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 73; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  if (!(likely(((__pyx_v_Pij_true) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_v_Pij_true, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 73; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  if (!(likely(((__pyx_v_Pi_true) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_v_Pi_true, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 73; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  if (!(likely(((__pyx_v_invC) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_v_invC, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 73; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_t_8 = <span class='pyx_c_api'>__Pyx_PyInt_As_int</span>(__pyx_v_N);<span class='error_goto'> if (unlikely((__pyx_t_8 == (int)-1) &amp;&amp; PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 73; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_t_7 = <span class='pyx_c_api'>__Pyx_PyInt_As_int</span>(__pyx_v_q);<span class='error_goto'> if (unlikely((__pyx_t_7 == (int)-1) &amp;&amp; PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 73; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_t_12 = <span class='pyx_c_api'>__Pyx_PyObject_AsString</span>(__pyx_v_outputfile);<span class='error_goto'> if (unlikely((!__pyx_t_12) &amp;&amp; PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 73; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_t_13 = <span class='pyx_c_api'>__Pyx_PyObject_AsString</span>(__pyx_v_header_string);<span class='error_goto'> if (unlikely((!__pyx_t_13) &amp;&amp; PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 73; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_t_10 = __pyx_f_8epitopsy_6cython_12optimize_dca_Compute_Results(((PyArrayObject *)__pyx_v_Pij), ((PyArrayObject *)__pyx_v_Pi), ((PyArrayObject *)__pyx_v_Pij_true), ((PyArrayObject *)__pyx_v_Pi_true), ((PyArrayObject *)__pyx_v_invC), __pyx_t_8, __pyx_t_7, __pyx_t_12, __pyx_t_13);<span class='error_goto'> if (unlikely(!__pyx_t_10)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 73; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_10);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_10); __pyx_t_10 = 0;
</pre><pre class='line' style='background-color: #FFFF8d' onclick='toggleDiv("line74")'> 74:     end_time = time.time()</pre>
<pre id='line74' class='code' style='background-color: #FFFF8d'>  __pyx_t_10 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s_time);<span class='error_goto'> if (unlikely(!__pyx_t_10)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 74; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_10);
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_10, __pyx_n_s_time);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 74; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_10); __pyx_t_10 = 0;
  __pyx_t_10 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_2, __pyx_empty_tuple, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_10)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 74; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_10);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_v_end_time = __pyx_t_10;
  __pyx_t_10 = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line75")'> 75: </pre>
<pre id='line75' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line76")'> 76: </pre>
<pre id='line76' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line77")'> 77: #def get_entropies(inputfile, pseudocount_weight = 0.5, theta = 0,</pre>
<pre id='line77' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line78")'> 78: #        num_threads=None):</pre>
<pre id='line78' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line79")'> 79: #    '''</pre>
<pre id='line79' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line80")'> 80: #</pre>
<pre id='line80' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line81")'> 81: #    '''</pre>
<pre id='line81' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line82")'> 82: #    cdef int M,N</pre>
<pre id='line82' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line83")'> 83: #    dca_version = 'new' # -&gt; dca identifier = 1</pre>
<pre id='line83' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line84")'> 84: #    dca_identifier = 1</pre>
<pre id='line84' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line85")'> 85: #    if num_threads is None:</pre>
<pre id='line85' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line86")'> 86: #        num_threads = multiprocessing.cpu_count()</pre>
<pre id='line86' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line87")'> 87: #    elif num_threads &gt; multiprocessing.cpu_count():</pre>
<pre id='line87' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line88")'> 88: #        num_threads = multiprocessing.cpu_count()</pre>
<pre id='line88' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line89")'> 89: #    start_time = time.time()</pre>
<pre id='line89' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line90")'> 90: #    print('read alignment ...')</pre>
<pre id='line90' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line91")'> 91: #    [N, M, q, Z] = return_alignment(inputfile)</pre>
<pre id='line91' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line92")'> 92: #    print('compute entropies ...')</pre>
<pre id='line92' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line93")'> 93: #    entropy = Compute_Entropies(Z, M, N, q, theta, dca_identifier, num_threads)</pre>
<pre id='line93' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line94")'> 94: #    return entropy</pre>
<pre id='line94' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line95")'> 95: </pre>
<pre id='line95' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line96")'> 96: </pre>
<pre id='line96' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line97")'> 97: </pre>
<pre id='line97' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line98")'> 98: # This version should work fine, if one changes something, please comment these</pre>
<pre id='line98' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line99")'> 99: # options</pre>
<pre id='line99' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line100")'> 100: @cython.boundscheck(False)</pre>
<pre id='line100' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF3c' onclick='toggleDiv("line101")'> 101: cdef np.ndarray Compute_Entropies(np.ndarray[DTYPE_int_t, ndim=2] Z,</pre>
<pre id='line101' class='code' style='background-color: #FFFF3c'>static PyArrayObject *__pyx_f_8epitopsy_6cython_12optimize_dca_Compute_Entropies(PyArrayObject *__pyx_v_Z, PyArrayObject *__pyx_v_W, int __pyx_v_M, int __pyx_v_N, int __pyx_v_q, CYTHON_UNUSED int __pyx_v_num_threads) {
  int __pyx_v_i;
  int __pyx_v_j;
  int __pyx_v_alpha;
  CYTHON_UNUSED __Pyx_memviewslice __pyx_v_Z_view = { 0, 0, { 0 }, { 0 }, { 0 } };
  float __pyx_v_Meff;
  PyArrayObject *__pyx_v_Pi_true_np = 0;
  PyArrayObject *__pyx_v_entropy_np = 0;
  __Pyx_memviewslice __pyx_v_Pi_true = { 0, 0, { 0 }, { 0 }, { 0 } };
  __Pyx_memviewslice __pyx_v_entropy = { 0, 0, { 0 }, { 0 }, { 0 } };
  int __pyx_v_z_ind;
  float __pyx_v_s;
  float __pyx_v_freq;
  float __pyx_v_q_float;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_Pi_true_np;
  __Pyx_Buffer __pyx_pybuffer_Pi_true_np;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_W;
  __Pyx_Buffer __pyx_pybuffer_W;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_Z;
  __Pyx_Buffer __pyx_pybuffer_Z;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_entropy_np;
  __Pyx_Buffer __pyx_pybuffer_entropy_np;
  PyArrayObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("Compute_Entropies", 0);
  __pyx_pybuffer_Pi_true_np.pybuffer.buf = NULL;
  __pyx_pybuffer_Pi_true_np.refcount = 0;
  __pyx_pybuffernd_Pi_true_np.data = NULL;
  __pyx_pybuffernd_Pi_true_np.rcbuffer = &amp;__pyx_pybuffer_Pi_true_np;
  __pyx_pybuffer_entropy_np.pybuffer.buf = NULL;
  __pyx_pybuffer_entropy_np.refcount = 0;
  __pyx_pybuffernd_entropy_np.data = NULL;
  __pyx_pybuffernd_entropy_np.rcbuffer = &amp;__pyx_pybuffer_entropy_np;
  __pyx_pybuffer_Z.pybuffer.buf = NULL;
  __pyx_pybuffer_Z.refcount = 0;
  __pyx_pybuffernd_Z.data = NULL;
  __pyx_pybuffernd_Z.rcbuffer = &amp;__pyx_pybuffer_Z;
  __pyx_pybuffer_W.pybuffer.buf = NULL;
  __pyx_pybuffer_W.refcount = 0;
  __pyx_pybuffernd_W.data = NULL;
  __pyx_pybuffernd_W.rcbuffer = &amp;__pyx_pybuffer_W;
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_Z.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_v_Z, &amp;__Pyx_TypeInfo_nn___pyx_t_8epitopsy_6cython_12optimize_dca_DTYPE_int_t, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack) == -1)) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 101; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  }
  __pyx_pybuffernd_Z.diminfo[0].strides = __pyx_pybuffernd_Z.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_Z.diminfo[0].shape = __pyx_pybuffernd_Z.rcbuffer-&gt;pybuffer.shape[0]; __pyx_pybuffernd_Z.diminfo[1].strides = __pyx_pybuffernd_Z.rcbuffer-&gt;pybuffer.strides[1]; __pyx_pybuffernd_Z.diminfo[1].shape = __pyx_pybuffernd_Z.rcbuffer-&gt;pybuffer.shape[1];
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_W.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_v_W, &amp;__Pyx_TypeInfo_nn___pyx_t_8epitopsy_6cython_12optimize_dca_DTYPE_float_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 101; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  }
  __pyx_pybuffernd_W.diminfo[0].strides = __pyx_pybuffernd_W.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_W.diminfo[0].shape = __pyx_pybuffernd_W.rcbuffer-&gt;pybuffer.shape[0];
/* … */
  /* function exit code */
  __pyx_L1_error:;
  __PYX_XDEC_MEMVIEW(&amp;__pyx_t_1, 1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_6);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_t_9, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_t_10, 1);
  { PyObject *__pyx_type, *__pyx_value, *__pyx_tb;
    <span class='pyx_c_api'>__Pyx_ErrFetch</span>(&amp;__pyx_type, &amp;__pyx_value, &amp;__pyx_tb);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_Pi_true_np.rcbuffer-&gt;pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_W.rcbuffer-&gt;pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_Z.rcbuffer-&gt;pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_entropy_np.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_ErrRestore</span>(__pyx_type, __pyx_value, __pyx_tb);}
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("epitopsy.cython.optimize_dca.Compute_Entropies", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = 0;
  goto __pyx_L2;
  __pyx_L0:;
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_Pi_true_np.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_W.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_Z.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_entropy_np.rcbuffer-&gt;pybuffer);
  __pyx_L2:;
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_Z_view, 1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_Pi_true_np);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_entropy_np);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_Pi_true, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_entropy, 1);
  <span class='refnanny'>__Pyx_XGIVEREF</span>((PyObject *)__pyx_r);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line102")'> 102:         np.ndarray[DTYPE_float_t, ndim=1] W, int M,</pre>
<pre id='line102' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line103")'> 103:         int N, int q, int num_threads):</pre>
<pre id='line103' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line104")'> 104:     '''</pre>
<pre id='line104' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line105")'> 105:     Compute the real unmodified frequencies for the MI calculation.</pre>
<pre id='line105' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line106")'> 106:     '''</pre>
<pre id='line106' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line107")'> 107:     cdef int i,j,l,k,alpha,beta</pre>
<pre id='line107' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line108")'> 108:     cdef long[:,:] Z_view = Z</pre>
<pre id='line108' class='code' style='background-color: #FFFFd4'>  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_dsds_long</span>(((PyObject *)__pyx_v_Z));
  if (unlikely(!__pyx_t_1.memview)) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 108; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_v_Z_view = __pyx_t_1;
  __pyx_t_1.memview = NULL;
  __pyx_t_1.data = NULL;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line109")'> 109: </pre>
<pre id='line109' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF4f' onclick='toggleDiv("line110")'> 110:     cdef float Meff = np.sum(W)</pre>
<pre id='line110' class='code' style='background-color: #FFFF4f'>  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 110; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_2, __pyx_n_s_sum);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 110; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 110; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_v_W));
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_2, 0, ((PyObject *)__pyx_v_W));
  <span class='refnanny'>__Pyx_GIVEREF</span>(((PyObject *)__pyx_v_W));
  __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_3, __pyx_t_2, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 110; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_5 = __pyx_<span class='py_c_api'>PyFloat_AsFloat</span>(__pyx_t_4);<span class='error_goto'> if (unlikely((__pyx_t_5 == (float)-1) &amp;&amp; PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 110; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_v_Meff = __pyx_t_5;
</pre><pre class='line' style='background-color: #FFFF3e' onclick='toggleDiv("line111")'> 111:     cdef np.ndarray[DTYPE_float_t, ndim=2] Pi_true_np = np.zeros([N,q])</pre>
<pre id='line111' class='code' style='background-color: #FFFF3e'>  __pyx_t_4 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 111; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_4, __pyx_n_s_zeros);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 111; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_N);<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 111; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_q);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 111; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  __pyx_t_6 = <span class='py_c_api'>PyList_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 111; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
  <span class='py_macro_api'>PyList_SET_ITEM</span>(__pyx_t_6, 0, __pyx_t_4);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_4);
  <span class='py_macro_api'>PyList_SET_ITEM</span>(__pyx_t_6, 1, __pyx_t_3);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_3);
  __pyx_t_4 = 0;
  __pyx_t_3 = 0;
  __pyx_t_3 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 111; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_3, 0, __pyx_t_6);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_6);
  __pyx_t_6 = 0;
  __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_2, __pyx_t_3, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 111; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  if (!(likely(((__pyx_t_6) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_6, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 111; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_t_7 = ((PyArrayObject *)__pyx_t_6);
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_Pi_true_np.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_t_7, &amp;__Pyx_TypeInfo_nn___pyx_t_8epitopsy_6cython_12optimize_dca_DTYPE_float_t, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack) == -1)) {
      __pyx_v_Pi_true_np = ((PyArrayObject *)Py_None); <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None); __pyx_pybuffernd_Pi_true_np.rcbuffer-&gt;pybuffer.buf = NULL;
      <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 111; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    } else {__pyx_pybuffernd_Pi_true_np.diminfo[0].strides = __pyx_pybuffernd_Pi_true_np.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_Pi_true_np.diminfo[0].shape = __pyx_pybuffernd_Pi_true_np.rcbuffer-&gt;pybuffer.shape[0]; __pyx_pybuffernd_Pi_true_np.diminfo[1].strides = __pyx_pybuffernd_Pi_true_np.rcbuffer-&gt;pybuffer.strides[1]; __pyx_pybuffernd_Pi_true_np.diminfo[1].shape = __pyx_pybuffernd_Pi_true_np.rcbuffer-&gt;pybuffer.shape[1];
    }
  }
  __pyx_t_7 = 0;
  __pyx_v_Pi_true_np = ((PyArrayObject *)__pyx_t_6);
  __pyx_t_6 = 0;
</pre><pre class='line' style='background-color: #FFFF4f' onclick='toggleDiv("line112")'> 112:     cdef np.ndarray[DTYPE_float_t, ndim=1] entropy_np = np.zeros(N)</pre>
<pre id='line112' class='code' style='background-color: #FFFF4f'>  __pyx_t_6 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 112; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_6, __pyx_n_s_zeros);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 112; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
  __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_N);<span class='error_goto'> if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 112; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
  __pyx_t_2 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 112; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_2, 0, __pyx_t_6);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_6);
  __pyx_t_6 = 0;
  __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_3, __pyx_t_2, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 112; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  if (!(likely(((__pyx_t_6) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_6, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 112; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_t_8 = ((PyArrayObject *)__pyx_t_6);
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_entropy_np.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_t_8, &amp;__Pyx_TypeInfo_nn___pyx_t_8epitopsy_6cython_12optimize_dca_DTYPE_float_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) {
      __pyx_v_entropy_np = ((PyArrayObject *)Py_None); <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None); __pyx_pybuffernd_entropy_np.rcbuffer-&gt;pybuffer.buf = NULL;
      <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 112; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    } else {__pyx_pybuffernd_entropy_np.diminfo[0].strides = __pyx_pybuffernd_entropy_np.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_entropy_np.diminfo[0].shape = __pyx_pybuffernd_entropy_np.rcbuffer-&gt;pybuffer.shape[0];
    }
  }
  __pyx_t_8 = 0;
  __pyx_v_entropy_np = ((PyArrayObject *)__pyx_t_6);
  __pyx_t_6 = 0;
</pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line113")'> 113:     cdef double [:,:] Pi_true = Pi_true_np</pre>
<pre id='line113' class='code' style='background-color: #FFFFd4'>  __pyx_t_9 = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_dsds_double</span>(((PyObject *)__pyx_v_Pi_true_np));
  if (unlikely(!__pyx_t_9.memview)) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 113; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_v_Pi_true = __pyx_t_9;
  __pyx_t_9.memview = NULL;
  __pyx_t_9.data = NULL;
</pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line114")'> 114:     cdef double [:] entropy = entropy_np</pre>
<pre id='line114' class='code' style='background-color: #FFFFd4'>  __pyx_t_10 = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_double</span>(((PyObject *)__pyx_v_entropy_np));
  if (unlikely(!__pyx_t_10.memview)) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 114; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_v_entropy = __pyx_t_10;
  __pyx_t_10.memview = NULL;
  __pyx_t_10.data = NULL;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line115")'> 115:     cdef int z_ind</pre>
<pre id='line115' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line116")'> 116: </pre>
<pre id='line116' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line117")'> 117:     for j in range(M):</pre>
<pre id='line117' class='code' style='background-color: #FFFFff'>  __pyx_t_11 = __pyx_v_M;
  for (__pyx_t_12 = 0; __pyx_t_12 &lt; __pyx_t_11; __pyx_t_12+=1) {
    __pyx_v_j = __pyx_t_12;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line118")'> 118:         for i in range(N):</pre>
<pre id='line118' class='code' style='background-color: #FFFFff'>    __pyx_t_13 = __pyx_v_N;
    for (__pyx_t_14 = 0; __pyx_t_14 &lt; __pyx_t_13; __pyx_t_14+=1) {
      __pyx_v_i = __pyx_t_14;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line119")'> 119:             z_ind = (Z[j,i] - 1)</pre>
<pre id='line119' class='code' style='background-color: #FFFFff'>      __pyx_t_15 = __pyx_v_j;
      __pyx_t_16 = __pyx_v_i;
      if (__pyx_t_15 &lt; 0) __pyx_t_15 += __pyx_pybuffernd_Z.diminfo[0].shape;
      if (__pyx_t_16 &lt; 0) __pyx_t_16 += __pyx_pybuffernd_Z.diminfo[1].shape;
      __pyx_v_z_ind = ((*__Pyx_BufPtrStrided2d(__pyx_t_8epitopsy_6cython_12optimize_dca_DTYPE_int_t *, __pyx_pybuffernd_Z.rcbuffer-&gt;pybuffer.buf, __pyx_t_15, __pyx_pybuffernd_Z.diminfo[0].strides, __pyx_t_16, __pyx_pybuffernd_Z.diminfo[1].strides)) - 1);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line120")'> 120:             Pi_true[i, z_ind] = Pi_true[i, z_ind] + W[j]</pre>
<pre id='line120' class='code' style='background-color: #FFFFff'>      __pyx_t_17 = __pyx_v_i;
      __pyx_t_18 = __pyx_v_z_ind;
      if (__pyx_t_17 &lt; 0) __pyx_t_17 += __pyx_v_Pi_true.shape[0];
      if (__pyx_t_18 &lt; 0) __pyx_t_18 += __pyx_v_Pi_true.shape[1];
      __pyx_t_19 = __pyx_v_j;
      if (__pyx_t_19 &lt; 0) __pyx_t_19 += __pyx_pybuffernd_W.diminfo[0].shape;
      __pyx_t_20 = __pyx_v_i;
      __pyx_t_21 = __pyx_v_z_ind;
      if (__pyx_t_20 &lt; 0) __pyx_t_20 += __pyx_v_Pi_true.shape[0];
      if (__pyx_t_21 &lt; 0) __pyx_t_21 += __pyx_v_Pi_true.shape[1];
      *((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_Pi_true.data + __pyx_t_20 * __pyx_v_Pi_true.strides[0]) ) + __pyx_t_21 * __pyx_v_Pi_true.strides[1]) )) = ((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_Pi_true.data + __pyx_t_17 * __pyx_v_Pi_true.strides[0]) ) + __pyx_t_18 * __pyx_v_Pi_true.strides[1]) ))) + (*__Pyx_BufPtrStrided1d(__pyx_t_8epitopsy_6cython_12optimize_dca_DTYPE_float_t *, __pyx_pybuffernd_W.rcbuffer-&gt;pybuffer.buf, __pyx_t_19, __pyx_pybuffernd_W.diminfo[0].strides)));
    }
  }
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line121")'> 121: </pre>
<pre id='line121' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line122")'> 122:     # make frequencies or probabilities</pre>
<pre id='line122' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line123")'> 123:     for i in range(N):</pre>
<pre id='line123' class='code' style='background-color: #FFFFff'>  __pyx_t_11 = __pyx_v_N;
  for (__pyx_t_12 = 0; __pyx_t_12 &lt; __pyx_t_11; __pyx_t_12+=1) {
    __pyx_v_i = __pyx_t_12;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line124")'> 124:         for alpha in range(q):</pre>
<pre id='line124' class='code' style='background-color: #FFFFff'>    __pyx_t_13 = __pyx_v_q;
    for (__pyx_t_14 = 0; __pyx_t_14 &lt; __pyx_t_13; __pyx_t_14+=1) {
      __pyx_v_alpha = __pyx_t_14;
</pre><pre class='line' style='background-color: #FFFFaa' onclick='toggleDiv("line125")'> 125:             Pi_true[i,alpha] = Pi_true[i,alpha] / Meff</pre>
<pre id='line125' class='code' style='background-color: #FFFFaa'>      __pyx_t_22 = __pyx_v_i;
      __pyx_t_23 = __pyx_v_alpha;
      if (__pyx_t_22 &lt; 0) __pyx_t_22 += __pyx_v_Pi_true.shape[0];
      if (__pyx_t_23 &lt; 0) __pyx_t_23 += __pyx_v_Pi_true.shape[1];
      __pyx_t_24 = (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_Pi_true.data + __pyx_t_22 * __pyx_v_Pi_true.strides[0]) ) + __pyx_t_23 * __pyx_v_Pi_true.strides[1]) )));
      if (unlikely(__pyx_v_Meff == 0)) {
        #ifdef WITH_THREAD
        PyGILState_STATE __pyx_gilstate_save = PyGILState_Ensure();
        #endif
        <span class='py_c_api'>PyErr_SetString</span>(PyExc_ZeroDivisionError, "float division");
        #ifdef WITH_THREAD
        PyGILState_Release(__pyx_gilstate_save);
        #endif
        <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 125; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      }
      __pyx_t_25 = __pyx_v_i;
      __pyx_t_26 = __pyx_v_alpha;
      if (__pyx_t_25 &lt; 0) __pyx_t_25 += __pyx_v_Pi_true.shape[0];
      if (__pyx_t_26 &lt; 0) __pyx_t_26 += __pyx_v_Pi_true.shape[1];
      *((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_Pi_true.data + __pyx_t_25 * __pyx_v_Pi_true.strides[0]) ) + __pyx_t_26 * __pyx_v_Pi_true.strides[1]) )) = (__pyx_t_24 / __pyx_v_Meff);
    }
  }
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line126")'> 126: </pre>
<pre id='line126' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line127")'> 127:     # make entropies</pre>
<pre id='line127' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line128")'> 128:     cdef float s = 0</pre>
<pre id='line128' class='code' style='background-color: #FFFFff'>  __pyx_v_s = 0.0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line129")'> 129:     cdef float freq = 0</pre>
<pre id='line129' class='code' style='background-color: #FFFFff'>  __pyx_v_freq = 0.0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line130")'> 130:     cdef float q_float = &lt;float&gt; q</pre>
<pre id='line130' class='code' style='background-color: #FFFFff'>  __pyx_v_q_float = ((float)__pyx_v_q);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line131")'> 131:     for i in range(N):</pre>
<pre id='line131' class='code' style='background-color: #FFFFff'>  __pyx_t_11 = __pyx_v_N;
  for (__pyx_t_12 = 0; __pyx_t_12 &lt; __pyx_t_11; __pyx_t_12+=1) {
    __pyx_v_i = __pyx_t_12;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line132")'> 132:         s = 0</pre>
<pre id='line132' class='code' style='background-color: #FFFFff'>    __pyx_v_s = 0.0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line133")'> 133:         for alpha in range(q):</pre>
<pre id='line133' class='code' style='background-color: #FFFFff'>    __pyx_t_13 = __pyx_v_q;
    for (__pyx_t_14 = 0; __pyx_t_14 &lt; __pyx_t_13; __pyx_t_14+=1) {
      __pyx_v_alpha = __pyx_t_14;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line134")'> 134:             freq = Pi_true[i, alpha]</pre>
<pre id='line134' class='code' style='background-color: #FFFFff'>      __pyx_t_27 = __pyx_v_i;
      __pyx_t_28 = __pyx_v_alpha;
      if (__pyx_t_27 &lt; 0) __pyx_t_27 += __pyx_v_Pi_true.shape[0];
      if (__pyx_t_28 &lt; 0) __pyx_t_28 += __pyx_v_Pi_true.shape[1];
      __pyx_v_freq = (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_Pi_true.data + __pyx_t_27 * __pyx_v_Pi_true.strides[0]) ) + __pyx_t_28 * __pyx_v_Pi_true.strides[1]) )));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line135")'> 135:             if freq != 0:</pre>
<pre id='line135' class='code' style='background-color: #FFFFff'>      __pyx_t_29 = ((__pyx_v_freq != 0.0) != 0);
      if (__pyx_t_29) {
</pre><pre class='line' style='background-color: #FFFFaa' onclick='toggleDiv("line136")'> 136:                 s = s - freq * log(freq)/log(q_float)</pre>
<pre id='line136' class='code' style='background-color: #FFFFaa'>        __pyx_t_24 = (__pyx_v_freq * log(__pyx_v_freq));
        __pyx_t_30 = log(__pyx_v_q_float);
        if (unlikely(__pyx_t_30 == 0)) {
          #ifdef WITH_THREAD
          PyGILState_STATE __pyx_gilstate_save = PyGILState_Ensure();
          #endif
          <span class='py_c_api'>PyErr_SetString</span>(PyExc_ZeroDivisionError, "float division");
          #ifdef WITH_THREAD
          PyGILState_Release(__pyx_gilstate_save);
          #endif
          <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 136; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        }
        __pyx_v_s = (__pyx_v_s - (__pyx_t_24 / __pyx_t_30));
        goto __pyx_L15;
      }
      __pyx_L15:;
    }
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line137")'> 137:         entropy[i] = s</pre>
<pre id='line137' class='code' style='background-color: #FFFFff'>    __pyx_t_13 = __pyx_v_i;
    if (__pyx_t_13 &lt; 0) __pyx_t_13 += __pyx_v_entropy.shape[0];
    *((double *) ( /* dim=0 */ (__pyx_v_entropy.data + __pyx_t_13 * __pyx_v_entropy.strides[0]) )) = __pyx_v_s;
  }
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line138")'> 138: </pre>
<pre id='line138' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line139")'> 139:     return entropy_np</pre>
<pre id='line139' class='code' style='background-color: #FFFFd4'>  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(((PyObject *)__pyx_r));
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_v_entropy_np));
  __pyx_r = ((PyArrayObject *)__pyx_v_entropy_np);
  goto __pyx_L0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line140")'> 140: </pre>
<pre id='line140' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line141")'> 141: </pre>
<pre id='line141' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line142")'> 142: # This version should work fine, if one changes something, please comment these</pre>
<pre id='line142' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line143")'> 143: # options</pre>
<pre id='line143' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line144")'> 144: @cython.boundscheck(False)</pre>
<pre id='line144' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF34' onclick='toggleDiv("line145")'> 145: cdef list Compute_True_Frequencies(np.ndarray[DTYPE_int_t, ndim=2] Z,</pre>
<pre id='line145' class='code' style='background-color: #FFFF34'>static PyObject *__pyx_f_8epitopsy_6cython_12optimize_dca_Compute_True_Frequencies(PyArrayObject *__pyx_v_Z, PyArrayObject *__pyx_v_W, int __pyx_v_M, int __pyx_v_N, int __pyx_v_q, CYTHON_UNUSED int __pyx_v_num_threads) {
  int __pyx_v_i;
  int __pyx_v_j;
  int __pyx_v_l;
  int __pyx_v_alpha;
  int __pyx_v_beta;
  CYTHON_UNUSED __Pyx_memviewslice __pyx_v_Z_view = { 0, 0, { 0 }, { 0 }, { 0 } };
  float __pyx_v_Meff;
  PyArrayObject *__pyx_v_Pij_true_np = 0;
  __Pyx_memviewslice __pyx_v_Pij_true = { 0, 0, { 0 }, { 0 }, { 0 } };
  PyArrayObject *__pyx_v_Pi_true_np = 0;
  __Pyx_memviewslice __pyx_v_Pi_true = { 0, 0, { 0 }, { 0 }, { 0 } };
  int __pyx_v_z_ind;
  int __pyx_v_z_ind_i;
  int __pyx_v_z_ind_j;
  PyArrayObject *__pyx_v_scra_np = 0;
  __Pyx_memviewslice __pyx_v_scra = { 0, 0, { 0 }, { 0 }, { 0 } };
  __Pyx_LocalBuf_ND __pyx_pybuffernd_Pi_true_np;
  __Pyx_Buffer __pyx_pybuffer_Pi_true_np;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_Pij_true_np;
  __Pyx_Buffer __pyx_pybuffer_Pij_true_np;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_W;
  __Pyx_Buffer __pyx_pybuffer_W;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_Z;
  __Pyx_Buffer __pyx_pybuffer_Z;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_scra_np;
  __Pyx_Buffer __pyx_pybuffer_scra_np;
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("Compute_True_Frequencies", 0);
  __pyx_pybuffer_Pij_true_np.pybuffer.buf = NULL;
  __pyx_pybuffer_Pij_true_np.refcount = 0;
  __pyx_pybuffernd_Pij_true_np.data = NULL;
  __pyx_pybuffernd_Pij_true_np.rcbuffer = &amp;__pyx_pybuffer_Pij_true_np;
  __pyx_pybuffer_Pi_true_np.pybuffer.buf = NULL;
  __pyx_pybuffer_Pi_true_np.refcount = 0;
  __pyx_pybuffernd_Pi_true_np.data = NULL;
  __pyx_pybuffernd_Pi_true_np.rcbuffer = &amp;__pyx_pybuffer_Pi_true_np;
  __pyx_pybuffer_scra_np.pybuffer.buf = NULL;
  __pyx_pybuffer_scra_np.refcount = 0;
  __pyx_pybuffernd_scra_np.data = NULL;
  __pyx_pybuffernd_scra_np.rcbuffer = &amp;__pyx_pybuffer_scra_np;
  __pyx_pybuffer_Z.pybuffer.buf = NULL;
  __pyx_pybuffer_Z.refcount = 0;
  __pyx_pybuffernd_Z.data = NULL;
  __pyx_pybuffernd_Z.rcbuffer = &amp;__pyx_pybuffer_Z;
  __pyx_pybuffer_W.pybuffer.buf = NULL;
  __pyx_pybuffer_W.refcount = 0;
  __pyx_pybuffernd_W.data = NULL;
  __pyx_pybuffernd_W.rcbuffer = &amp;__pyx_pybuffer_W;
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_Z.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_v_Z, &amp;__Pyx_TypeInfo_nn___pyx_t_8epitopsy_6cython_12optimize_dca_DTYPE_int_t, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack) == -1)) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 145; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  }
  __pyx_pybuffernd_Z.diminfo[0].strides = __pyx_pybuffernd_Z.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_Z.diminfo[0].shape = __pyx_pybuffernd_Z.rcbuffer-&gt;pybuffer.shape[0]; __pyx_pybuffernd_Z.diminfo[1].strides = __pyx_pybuffernd_Z.rcbuffer-&gt;pybuffer.strides[1]; __pyx_pybuffernd_Z.diminfo[1].shape = __pyx_pybuffernd_Z.rcbuffer-&gt;pybuffer.shape[1];
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_W.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_v_W, &amp;__Pyx_TypeInfo_nn___pyx_t_8epitopsy_6cython_12optimize_dca_DTYPE_float_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 145; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  }
  __pyx_pybuffernd_W.diminfo[0].strides = __pyx_pybuffernd_W.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_W.diminfo[0].shape = __pyx_pybuffernd_W.rcbuffer-&gt;pybuffer.shape[0];
/* … */
  /* function exit code */
  __pyx_L1_error:;
  __PYX_XDEC_MEMVIEW(&amp;__pyx_t_1, 1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_6);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_7);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_8);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_t_10, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_t_12, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_t_60, 1);
  { PyObject *__pyx_type, *__pyx_value, *__pyx_tb;
    <span class='pyx_c_api'>__Pyx_ErrFetch</span>(&amp;__pyx_type, &amp;__pyx_value, &amp;__pyx_tb);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_Pi_true_np.rcbuffer-&gt;pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_Pij_true_np.rcbuffer-&gt;pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_W.rcbuffer-&gt;pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_Z.rcbuffer-&gt;pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_scra_np.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_ErrRestore</span>(__pyx_type, __pyx_value, __pyx_tb);}
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("epitopsy.cython.optimize_dca.Compute_True_Frequencies", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = 0;
  goto __pyx_L2;
  __pyx_L0:;
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_Pi_true_np.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_Pij_true_np.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_W.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_Z.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_scra_np.rcbuffer-&gt;pybuffer);
  __pyx_L2:;
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_Z_view, 1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_Pij_true_np);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_Pij_true, 1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_Pi_true_np);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_Pi_true, 1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_scra_np);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_scra, 1);
  <span class='refnanny'>__Pyx_XGIVEREF</span>(__pyx_r);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line146")'> 146:         np.ndarray[DTYPE_float_t, ndim=1] W, int M,</pre>
<pre id='line146' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line147")'> 147:         int N, int q, int num_threads):</pre>
<pre id='line147' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line148")'> 148:     cdef int i,j,l,k,alpha,beta</pre>
<pre id='line148' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line149")'> 149:     cdef long[:,:] Z_view = Z</pre>
<pre id='line149' class='code' style='background-color: #FFFFd4'>  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_dsds_long</span>(((PyObject *)__pyx_v_Z));
  if (unlikely(!__pyx_t_1.memview)) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 149; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_v_Z_view = __pyx_t_1;
  __pyx_t_1.memview = NULL;
  __pyx_t_1.data = NULL;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line150")'> 150: </pre>
<pre id='line150' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF4f' onclick='toggleDiv("line151")'> 151:     cdef float Meff = np.sum(W)</pre>
<pre id='line151' class='code' style='background-color: #FFFF4f'>  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 151; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_2, __pyx_n_s_sum);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 151; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 151; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_v_W));
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_2, 0, ((PyObject *)__pyx_v_W));
  <span class='refnanny'>__Pyx_GIVEREF</span>(((PyObject *)__pyx_v_W));
  __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_3, __pyx_t_2, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 151; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_5 = __pyx_<span class='py_c_api'>PyFloat_AsFloat</span>(__pyx_t_4);<span class='error_goto'> if (unlikely((__pyx_t_5 == (float)-1) &amp;&amp; PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 151; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_v_Meff = __pyx_t_5;
</pre><pre class='line' style='background-color: #FFFF36' onclick='toggleDiv("line152")'> 152:     cdef np.ndarray[DTYPE_float_t, ndim=4] Pij_true_np = np.zeros([N,N,q,q])</pre>
<pre id='line152' class='code' style='background-color: #FFFF36'>  __pyx_t_4 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 152; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_4, __pyx_n_s_zeros);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 152; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_N);<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 152; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_N);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 152; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_q);<span class='error_goto'> if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 152; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
  __pyx_t_7 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_q);<span class='error_goto'> if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 152; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
  __pyx_t_8 = <span class='py_c_api'>PyList_New</span>(4);<span class='error_goto'> if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 152; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
  <span class='py_macro_api'>PyList_SET_ITEM</span>(__pyx_t_8, 0, __pyx_t_4);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_4);
  <span class='py_macro_api'>PyList_SET_ITEM</span>(__pyx_t_8, 1, __pyx_t_3);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_3);
  <span class='py_macro_api'>PyList_SET_ITEM</span>(__pyx_t_8, 2, __pyx_t_6);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_6);
  <span class='py_macro_api'>PyList_SET_ITEM</span>(__pyx_t_8, 3, __pyx_t_7);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_7);
  __pyx_t_4 = 0;
  __pyx_t_3 = 0;
  __pyx_t_6 = 0;
  __pyx_t_7 = 0;
  __pyx_t_7 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 152; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_7, 0, __pyx_t_8);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_8);
  __pyx_t_8 = 0;
  __pyx_t_8 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_2, __pyx_t_7, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 152; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
  if (!(likely(((__pyx_t_8) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_8, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 152; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_t_9 = ((PyArrayObject *)__pyx_t_8);
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_Pij_true_np.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_t_9, &amp;__Pyx_TypeInfo_nn___pyx_t_8epitopsy_6cython_12optimize_dca_DTYPE_float_t, PyBUF_FORMAT| PyBUF_STRIDES, 4, 0, __pyx_stack) == -1)) {
      __pyx_v_Pij_true_np = ((PyArrayObject *)Py_None); <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None); __pyx_pybuffernd_Pij_true_np.rcbuffer-&gt;pybuffer.buf = NULL;
      <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 152; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    } else {__pyx_pybuffernd_Pij_true_np.diminfo[0].strides = __pyx_pybuffernd_Pij_true_np.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_Pij_true_np.diminfo[0].shape = __pyx_pybuffernd_Pij_true_np.rcbuffer-&gt;pybuffer.shape[0]; __pyx_pybuffernd_Pij_true_np.diminfo[1].strides = __pyx_pybuffernd_Pij_true_np.rcbuffer-&gt;pybuffer.strides[1]; __pyx_pybuffernd_Pij_true_np.diminfo[1].shape = __pyx_pybuffernd_Pij_true_np.rcbuffer-&gt;pybuffer.shape[1]; __pyx_pybuffernd_Pij_true_np.diminfo[2].strides = __pyx_pybuffernd_Pij_true_np.rcbuffer-&gt;pybuffer.strides[2]; __pyx_pybuffernd_Pij_true_np.diminfo[2].shape = __pyx_pybuffernd_Pij_true_np.rcbuffer-&gt;pybuffer.shape[2]; __pyx_pybuffernd_Pij_true_np.diminfo[3].strides = __pyx_pybuffernd_Pij_true_np.rcbuffer-&gt;pybuffer.strides[3]; __pyx_pybuffernd_Pij_true_np.diminfo[3].shape = __pyx_pybuffernd_Pij_true_np.rcbuffer-&gt;pybuffer.shape[3];
    }
  }
  __pyx_t_9 = 0;
  __pyx_v_Pij_true_np = ((PyArrayObject *)__pyx_t_8);
  __pyx_t_8 = 0;
</pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line153")'> 153:     cdef double [:,:,:,:] Pij_true = Pij_true_np</pre>
<pre id='line153' class='code' style='background-color: #FFFFd4'>  __pyx_t_10 = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_dsdsdsds_double</span>(((PyObject *)__pyx_v_Pij_true_np));
  if (unlikely(!__pyx_t_10.memview)) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 153; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_v_Pij_true = __pyx_t_10;
  __pyx_t_10.memview = NULL;
  __pyx_t_10.data = NULL;
</pre><pre class='line' style='background-color: #FFFF3e' onclick='toggleDiv("line154")'> 154:     cdef np.ndarray[DTYPE_float_t, ndim=2] Pi_true_np = np.zeros([N,q])</pre>
<pre id='line154' class='code' style='background-color: #FFFF3e'>  __pyx_t_8 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 154; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
  __pyx_t_7 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_8, __pyx_n_s_zeros);<span class='error_goto'> if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 154; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
  __pyx_t_8 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_N);<span class='error_goto'> if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 154; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_q);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 154; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  __pyx_t_6 = <span class='py_c_api'>PyList_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 154; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
  <span class='py_macro_api'>PyList_SET_ITEM</span>(__pyx_t_6, 0, __pyx_t_8);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_8);
  <span class='py_macro_api'>PyList_SET_ITEM</span>(__pyx_t_6, 1, __pyx_t_2);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_2);
  __pyx_t_8 = 0;
  __pyx_t_2 = 0;
  __pyx_t_2 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 154; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_2, 0, __pyx_t_6);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_6);
  __pyx_t_6 = 0;
  __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_7, __pyx_t_2, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 154; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  if (!(likely(((__pyx_t_6) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_6, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 154; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_t_11 = ((PyArrayObject *)__pyx_t_6);
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_Pi_true_np.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_t_11, &amp;__Pyx_TypeInfo_nn___pyx_t_8epitopsy_6cython_12optimize_dca_DTYPE_float_t, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack) == -1)) {
      __pyx_v_Pi_true_np = ((PyArrayObject *)Py_None); <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None); __pyx_pybuffernd_Pi_true_np.rcbuffer-&gt;pybuffer.buf = NULL;
      <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 154; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    } else {__pyx_pybuffernd_Pi_true_np.diminfo[0].strides = __pyx_pybuffernd_Pi_true_np.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_Pi_true_np.diminfo[0].shape = __pyx_pybuffernd_Pi_true_np.rcbuffer-&gt;pybuffer.shape[0]; __pyx_pybuffernd_Pi_true_np.diminfo[1].strides = __pyx_pybuffernd_Pi_true_np.rcbuffer-&gt;pybuffer.strides[1]; __pyx_pybuffernd_Pi_true_np.diminfo[1].shape = __pyx_pybuffernd_Pi_true_np.rcbuffer-&gt;pybuffer.shape[1];
    }
  }
  __pyx_t_11 = 0;
  __pyx_v_Pi_true_np = ((PyArrayObject *)__pyx_t_6);
  __pyx_t_6 = 0;
</pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line155")'> 155:     cdef double [:,:] Pi_true = Pi_true_np</pre>
<pre id='line155' class='code' style='background-color: #FFFFd4'>  __pyx_t_12 = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_dsds_double</span>(((PyObject *)__pyx_v_Pi_true_np));
  if (unlikely(!__pyx_t_12.memview)) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 155; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_v_Pi_true = __pyx_t_12;
  __pyx_t_12.memview = NULL;
  __pyx_t_12.data = NULL;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line156")'> 156:     cdef int z_ind</pre>
<pre id='line156' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line157")'> 157: </pre>
<pre id='line157' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line158")'> 158:     for j in range(M):</pre>
<pre id='line158' class='code' style='background-color: #FFFFff'>  __pyx_t_13 = __pyx_v_M;
  for (__pyx_t_14 = 0; __pyx_t_14 &lt; __pyx_t_13; __pyx_t_14+=1) {
    __pyx_v_j = __pyx_t_14;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line159")'> 159:         for i in range(N):</pre>
<pre id='line159' class='code' style='background-color: #FFFFff'>    __pyx_t_15 = __pyx_v_N;
    for (__pyx_t_16 = 0; __pyx_t_16 &lt; __pyx_t_15; __pyx_t_16+=1) {
      __pyx_v_i = __pyx_t_16;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line160")'> 160:             z_ind = (Z[j,i] - 1)</pre>
<pre id='line160' class='code' style='background-color: #FFFFff'>      __pyx_t_17 = __pyx_v_j;
      __pyx_t_18 = __pyx_v_i;
      if (__pyx_t_17 &lt; 0) __pyx_t_17 += __pyx_pybuffernd_Z.diminfo[0].shape;
      if (__pyx_t_18 &lt; 0) __pyx_t_18 += __pyx_pybuffernd_Z.diminfo[1].shape;
      __pyx_v_z_ind = ((*__Pyx_BufPtrStrided2d(__pyx_t_8epitopsy_6cython_12optimize_dca_DTYPE_int_t *, __pyx_pybuffernd_Z.rcbuffer-&gt;pybuffer.buf, __pyx_t_17, __pyx_pybuffernd_Z.diminfo[0].strides, __pyx_t_18, __pyx_pybuffernd_Z.diminfo[1].strides)) - 1);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line161")'> 161:             Pi_true[i, z_ind] = Pi_true[i, z_ind] + W[j]</pre>
<pre id='line161' class='code' style='background-color: #FFFFff'>      __pyx_t_19 = __pyx_v_i;
      __pyx_t_20 = __pyx_v_z_ind;
      if (__pyx_t_19 &lt; 0) __pyx_t_19 += __pyx_v_Pi_true.shape[0];
      if (__pyx_t_20 &lt; 0) __pyx_t_20 += __pyx_v_Pi_true.shape[1];
      __pyx_t_21 = __pyx_v_j;
      if (__pyx_t_21 &lt; 0) __pyx_t_21 += __pyx_pybuffernd_W.diminfo[0].shape;
      __pyx_t_22 = __pyx_v_i;
      __pyx_t_23 = __pyx_v_z_ind;
      if (__pyx_t_22 &lt; 0) __pyx_t_22 += __pyx_v_Pi_true.shape[0];
      if (__pyx_t_23 &lt; 0) __pyx_t_23 += __pyx_v_Pi_true.shape[1];
      *((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_Pi_true.data + __pyx_t_22 * __pyx_v_Pi_true.strides[0]) ) + __pyx_t_23 * __pyx_v_Pi_true.strides[1]) )) = ((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_Pi_true.data + __pyx_t_19 * __pyx_v_Pi_true.strides[0]) ) + __pyx_t_20 * __pyx_v_Pi_true.strides[1]) ))) + (*__Pyx_BufPtrStrided1d(__pyx_t_8epitopsy_6cython_12optimize_dca_DTYPE_float_t *, __pyx_pybuffernd_W.rcbuffer-&gt;pybuffer.buf, __pyx_t_21, __pyx_pybuffernd_W.diminfo[0].strides)));
    }
  }
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line162")'> 162: </pre>
<pre id='line162' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line163")'> 163: </pre>
<pre id='line163' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line164")'> 164:     cdef int z_ind_i, z_ind_j</pre>
<pre id='line164' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line165")'> 165: </pre>
<pre id='line165' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line166")'> 166:     for l in range(M):</pre>
<pre id='line166' class='code' style='background-color: #FFFFff'>  __pyx_t_13 = __pyx_v_M;
  for (__pyx_t_14 = 0; __pyx_t_14 &lt; __pyx_t_13; __pyx_t_14+=1) {
    __pyx_v_l = __pyx_t_14;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line167")'> 167:         for i in range(N-1):</pre>
<pre id='line167' class='code' style='background-color: #FFFFff'>    __pyx_t_24 = (__pyx_v_N - 1);
    for (__pyx_t_15 = 0; __pyx_t_15 &lt; __pyx_t_24; __pyx_t_15+=1) {
      __pyx_v_i = __pyx_t_15;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line168")'> 168:             z_ind_i = Z[l,i] - 1 # python index</pre>
<pre id='line168' class='code' style='background-color: #FFFFff'>      __pyx_t_16 = __pyx_v_l;
      __pyx_t_25 = __pyx_v_i;
      if (__pyx_t_16 &lt; 0) __pyx_t_16 += __pyx_pybuffernd_Z.diminfo[0].shape;
      if (__pyx_t_25 &lt; 0) __pyx_t_25 += __pyx_pybuffernd_Z.diminfo[1].shape;
      __pyx_v_z_ind_i = ((*__Pyx_BufPtrStrided2d(__pyx_t_8epitopsy_6cython_12optimize_dca_DTYPE_int_t *, __pyx_pybuffernd_Z.rcbuffer-&gt;pybuffer.buf, __pyx_t_16, __pyx_pybuffernd_Z.diminfo[0].strides, __pyx_t_25, __pyx_pybuffernd_Z.diminfo[1].strides)) - 1);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line169")'> 169:             for j in range(i+1,N):</pre>
<pre id='line169' class='code' style='background-color: #FFFFff'>      __pyx_t_26 = __pyx_v_N;
      for (__pyx_t_27 = (__pyx_v_i + 1); __pyx_t_27 &lt; __pyx_t_26; __pyx_t_27+=1) {
        __pyx_v_j = __pyx_t_27;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line170")'> 170:                 z_ind_j = Z[l,j] - 1 # python index</pre>
<pre id='line170' class='code' style='background-color: #FFFFff'>        __pyx_t_28 = __pyx_v_l;
        __pyx_t_29 = __pyx_v_j;
        if (__pyx_t_28 &lt; 0) __pyx_t_28 += __pyx_pybuffernd_Z.diminfo[0].shape;
        if (__pyx_t_29 &lt; 0) __pyx_t_29 += __pyx_pybuffernd_Z.diminfo[1].shape;
        __pyx_v_z_ind_j = ((*__Pyx_BufPtrStrided2d(__pyx_t_8epitopsy_6cython_12optimize_dca_DTYPE_int_t *, __pyx_pybuffernd_Z.rcbuffer-&gt;pybuffer.buf, __pyx_t_28, __pyx_pybuffernd_Z.diminfo[0].strides, __pyx_t_29, __pyx_pybuffernd_Z.diminfo[1].strides)) - 1);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line171")'> 171:                 Pij_true[i,j,z_ind_i, z_ind_j] += W[l]</pre>
<pre id='line171' class='code' style='background-color: #FFFFff'>        __pyx_t_30 = __pyx_v_l;
        if (__pyx_t_30 &lt; 0) __pyx_t_30 += __pyx_pybuffernd_W.diminfo[0].shape;
        __pyx_t_31 = __pyx_v_i;
        __pyx_t_32 = __pyx_v_j;
        __pyx_t_33 = __pyx_v_z_ind_i;
        __pyx_t_34 = __pyx_v_z_ind_j;
        if (__pyx_t_31 &lt; 0) __pyx_t_31 += __pyx_v_Pij_true.shape[0];
        if (__pyx_t_32 &lt; 0) __pyx_t_32 += __pyx_v_Pij_true.shape[1];
        if (__pyx_t_33 &lt; 0) __pyx_t_33 += __pyx_v_Pij_true.shape[2];
        if (__pyx_t_34 &lt; 0) __pyx_t_34 += __pyx_v_Pij_true.shape[3];
        *((double *) ( /* dim=3 */ (( /* dim=2 */ (( /* dim=1 */ (( /* dim=0 */ (__pyx_v_Pij_true.data + __pyx_t_31 * __pyx_v_Pij_true.strides[0]) ) + __pyx_t_32 * __pyx_v_Pij_true.strides[1]) ) + __pyx_t_33 * __pyx_v_Pij_true.strides[2]) ) + __pyx_t_34 * __pyx_v_Pij_true.strides[3]) )) += (*__Pyx_BufPtrStrided1d(__pyx_t_8epitopsy_6cython_12optimize_dca_DTYPE_float_t *, __pyx_pybuffernd_W.rcbuffer-&gt;pybuffer.buf, __pyx_t_30, __pyx_pybuffernd_W.diminfo[0].strides));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line172")'> 172:                 Pij_true[j,i,z_ind_j,z_ind_i] = Pij_true[i,j,z_ind_i,z_ind_j]</pre>
<pre id='line172' class='code' style='background-color: #FFFFff'>        __pyx_t_35 = __pyx_v_i;
        __pyx_t_36 = __pyx_v_j;
        __pyx_t_37 = __pyx_v_z_ind_i;
        __pyx_t_38 = __pyx_v_z_ind_j;
        if (__pyx_t_35 &lt; 0) __pyx_t_35 += __pyx_v_Pij_true.shape[0];
        if (__pyx_t_36 &lt; 0) __pyx_t_36 += __pyx_v_Pij_true.shape[1];
        if (__pyx_t_37 &lt; 0) __pyx_t_37 += __pyx_v_Pij_true.shape[2];
        if (__pyx_t_38 &lt; 0) __pyx_t_38 += __pyx_v_Pij_true.shape[3];
        __pyx_t_39 = __pyx_v_j;
        __pyx_t_40 = __pyx_v_i;
        __pyx_t_41 = __pyx_v_z_ind_j;
        __pyx_t_42 = __pyx_v_z_ind_i;
        if (__pyx_t_39 &lt; 0) __pyx_t_39 += __pyx_v_Pij_true.shape[0];
        if (__pyx_t_40 &lt; 0) __pyx_t_40 += __pyx_v_Pij_true.shape[1];
        if (__pyx_t_41 &lt; 0) __pyx_t_41 += __pyx_v_Pij_true.shape[2];
        if (__pyx_t_42 &lt; 0) __pyx_t_42 += __pyx_v_Pij_true.shape[3];
        *((double *) ( /* dim=3 */ (( /* dim=2 */ (( /* dim=1 */ (( /* dim=0 */ (__pyx_v_Pij_true.data + __pyx_t_39 * __pyx_v_Pij_true.strides[0]) ) + __pyx_t_40 * __pyx_v_Pij_true.strides[1]) ) + __pyx_t_41 * __pyx_v_Pij_true.strides[2]) ) + __pyx_t_42 * __pyx_v_Pij_true.strides[3]) )) = (*((double *) ( /* dim=3 */ (( /* dim=2 */ (( /* dim=1 */ (( /* dim=0 */ (__pyx_v_Pij_true.data + __pyx_t_35 * __pyx_v_Pij_true.strides[0]) ) + __pyx_t_36 * __pyx_v_Pij_true.strides[1]) ) + __pyx_t_37 * __pyx_v_Pij_true.strides[2]) ) + __pyx_t_38 * __pyx_v_Pij_true.strides[3]) )));
      }
    }
  }
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line173")'> 173: </pre>
<pre id='line173' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line174")'> 174:     for i in range(N):</pre>
<pre id='line174' class='code' style='background-color: #FFFFff'>  __pyx_t_13 = __pyx_v_N;
  for (__pyx_t_14 = 0; __pyx_t_14 &lt; __pyx_t_13; __pyx_t_14+=1) {
    __pyx_v_i = __pyx_t_14;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line175")'> 175:         for alpha in range(q):</pre>
<pre id='line175' class='code' style='background-color: #FFFFff'>    __pyx_t_15 = __pyx_v_q;
    for (__pyx_t_26 = 0; __pyx_t_26 &lt; __pyx_t_15; __pyx_t_26+=1) {
      __pyx_v_alpha = __pyx_t_26;
</pre><pre class='line' style='background-color: #FFFFaa' onclick='toggleDiv("line176")'> 176:             Pi_true[i,alpha] = Pi_true[i,alpha] / Meff</pre>
<pre id='line176' class='code' style='background-color: #FFFFaa'>      __pyx_t_27 = __pyx_v_i;
      __pyx_t_43 = __pyx_v_alpha;
      if (__pyx_t_27 &lt; 0) __pyx_t_27 += __pyx_v_Pi_true.shape[0];
      if (__pyx_t_43 &lt; 0) __pyx_t_43 += __pyx_v_Pi_true.shape[1];
      __pyx_t_44 = (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_Pi_true.data + __pyx_t_27 * __pyx_v_Pi_true.strides[0]) ) + __pyx_t_43 * __pyx_v_Pi_true.strides[1]) )));
      if (unlikely(__pyx_v_Meff == 0)) {
        #ifdef WITH_THREAD
        PyGILState_STATE __pyx_gilstate_save = PyGILState_Ensure();
        #endif
        <span class='py_c_api'>PyErr_SetString</span>(PyExc_ZeroDivisionError, "float division");
        #ifdef WITH_THREAD
        PyGILState_Release(__pyx_gilstate_save);
        #endif
        <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 176; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      }
      __pyx_t_45 = __pyx_v_i;
      __pyx_t_46 = __pyx_v_alpha;
      if (__pyx_t_45 &lt; 0) __pyx_t_45 += __pyx_v_Pi_true.shape[0];
      if (__pyx_t_46 &lt; 0) __pyx_t_46 += __pyx_v_Pi_true.shape[1];
      *((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_Pi_true.data + __pyx_t_45 * __pyx_v_Pi_true.strides[0]) ) + __pyx_t_46 * __pyx_v_Pi_true.strides[1]) )) = (__pyx_t_44 / __pyx_v_Meff);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line177")'> 177:             for j in range(N):</pre>
<pre id='line177' class='code' style='background-color: #FFFFff'>      __pyx_t_47 = __pyx_v_N;
      for (__pyx_t_48 = 0; __pyx_t_48 &lt; __pyx_t_47; __pyx_t_48+=1) {
        __pyx_v_j = __pyx_t_48;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line178")'> 178:                 for beta in range(q):</pre>
<pre id='line178' class='code' style='background-color: #FFFFff'>        __pyx_t_49 = __pyx_v_q;
        for (__pyx_t_50 = 0; __pyx_t_50 &lt; __pyx_t_49; __pyx_t_50+=1) {
          __pyx_v_beta = __pyx_t_50;
</pre><pre class='line' style='background-color: #FFFFaa' onclick='toggleDiv("line179")'> 179:                     Pij_true[i,j,alpha,beta] = Pij_true[i,j,alpha,beta] / Meff</pre>
<pre id='line179' class='code' style='background-color: #FFFFaa'>          __pyx_t_51 = __pyx_v_i;
          __pyx_t_52 = __pyx_v_j;
          __pyx_t_53 = __pyx_v_alpha;
          __pyx_t_54 = __pyx_v_beta;
          if (__pyx_t_51 &lt; 0) __pyx_t_51 += __pyx_v_Pij_true.shape[0];
          if (__pyx_t_52 &lt; 0) __pyx_t_52 += __pyx_v_Pij_true.shape[1];
          if (__pyx_t_53 &lt; 0) __pyx_t_53 += __pyx_v_Pij_true.shape[2];
          if (__pyx_t_54 &lt; 0) __pyx_t_54 += __pyx_v_Pij_true.shape[3];
          __pyx_t_44 = (*((double *) ( /* dim=3 */ (( /* dim=2 */ (( /* dim=1 */ (( /* dim=0 */ (__pyx_v_Pij_true.data + __pyx_t_51 * __pyx_v_Pij_true.strides[0]) ) + __pyx_t_52 * __pyx_v_Pij_true.strides[1]) ) + __pyx_t_53 * __pyx_v_Pij_true.strides[2]) ) + __pyx_t_54 * __pyx_v_Pij_true.strides[3]) )));
          if (unlikely(__pyx_v_Meff == 0)) {
            #ifdef WITH_THREAD
            PyGILState_STATE __pyx_gilstate_save = PyGILState_Ensure();
            #endif
            <span class='py_c_api'>PyErr_SetString</span>(PyExc_ZeroDivisionError, "float division");
            #ifdef WITH_THREAD
            PyGILState_Release(__pyx_gilstate_save);
            #endif
            <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 179; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
          }
          __pyx_t_55 = __pyx_v_i;
          __pyx_t_56 = __pyx_v_j;
          __pyx_t_57 = __pyx_v_alpha;
          __pyx_t_58 = __pyx_v_beta;
          if (__pyx_t_55 &lt; 0) __pyx_t_55 += __pyx_v_Pij_true.shape[0];
          if (__pyx_t_56 &lt; 0) __pyx_t_56 += __pyx_v_Pij_true.shape[1];
          if (__pyx_t_57 &lt; 0) __pyx_t_57 += __pyx_v_Pij_true.shape[2];
          if (__pyx_t_58 &lt; 0) __pyx_t_58 += __pyx_v_Pij_true.shape[3];
          *((double *) ( /* dim=3 */ (( /* dim=2 */ (( /* dim=1 */ (( /* dim=0 */ (__pyx_v_Pij_true.data + __pyx_t_55 * __pyx_v_Pij_true.strides[0]) ) + __pyx_t_56 * __pyx_v_Pij_true.strides[1]) ) + __pyx_t_57 * __pyx_v_Pij_true.strides[2]) ) + __pyx_t_58 * __pyx_v_Pij_true.strides[3]) )) = (__pyx_t_44 / __pyx_v_Meff);
        }
      }
    }
  }
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line180")'> 180: </pre>
<pre id='line180' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF4f' onclick='toggleDiv("line181")'> 181:     cdef np.ndarray[DTYPE_float_t, ndim=2] scra_np = np.eye(q)</pre>
<pre id='line181' class='code' style='background-color: #FFFF4f'>  __pyx_t_6 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 181; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_6, __pyx_n_s_eye);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 181; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
  __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_q);<span class='error_goto'> if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 181; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
  __pyx_t_7 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 181; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_7, 0, __pyx_t_6);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_6);
  __pyx_t_6 = 0;
  __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_2, __pyx_t_7, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 181; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
  if (!(likely(((__pyx_t_6) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_6, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 181; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_t_59 = ((PyArrayObject *)__pyx_t_6);
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_scra_np.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_t_59, &amp;__Pyx_TypeInfo_nn___pyx_t_8epitopsy_6cython_12optimize_dca_DTYPE_float_t, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack) == -1)) {
      __pyx_v_scra_np = ((PyArrayObject *)Py_None); <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None); __pyx_pybuffernd_scra_np.rcbuffer-&gt;pybuffer.buf = NULL;
      <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 181; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    } else {__pyx_pybuffernd_scra_np.diminfo[0].strides = __pyx_pybuffernd_scra_np.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_scra_np.diminfo[0].shape = __pyx_pybuffernd_scra_np.rcbuffer-&gt;pybuffer.shape[0]; __pyx_pybuffernd_scra_np.diminfo[1].strides = __pyx_pybuffernd_scra_np.rcbuffer-&gt;pybuffer.strides[1]; __pyx_pybuffernd_scra_np.diminfo[1].shape = __pyx_pybuffernd_scra_np.rcbuffer-&gt;pybuffer.shape[1];
    }
  }
  __pyx_t_59 = 0;
  __pyx_v_scra_np = ((PyArrayObject *)__pyx_t_6);
  __pyx_t_6 = 0;
</pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line182")'> 182:     cdef double[:,:] scra = scra_np</pre>
<pre id='line182' class='code' style='background-color: #FFFFd4'>  __pyx_t_60 = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_dsds_double</span>(((PyObject *)__pyx_v_scra_np));
  if (unlikely(!__pyx_t_60.memview)) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 182; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_v_scra = __pyx_t_60;
  __pyx_t_60.memview = NULL;
  __pyx_t_60.data = NULL;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line183")'> 183:     for i in range(N):</pre>
<pre id='line183' class='code' style='background-color: #FFFFff'>  __pyx_t_13 = __pyx_v_N;
  for (__pyx_t_14 = 0; __pyx_t_14 &lt; __pyx_t_13; __pyx_t_14+=1) {
    __pyx_v_i = __pyx_t_14;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line184")'> 184:         for alpha in range(q):</pre>
<pre id='line184' class='code' style='background-color: #FFFFff'>    __pyx_t_15 = __pyx_v_q;
    for (__pyx_t_26 = 0; __pyx_t_26 &lt; __pyx_t_15; __pyx_t_26+=1) {
      __pyx_v_alpha = __pyx_t_26;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line185")'> 185:             for beta in range(q):</pre>
<pre id='line185' class='code' style='background-color: #FFFFff'>      __pyx_t_47 = __pyx_v_q;
      for (__pyx_t_48 = 0; __pyx_t_48 &lt; __pyx_t_47; __pyx_t_48+=1) {
        __pyx_v_beta = __pyx_t_48;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line186")'> 186:                 Pij_true[i,i,alpha,beta] = Pi_true[i,alpha] * scra[alpha,beta]</pre>
<pre id='line186' class='code' style='background-color: #FFFFff'>        __pyx_t_49 = __pyx_v_i;
        __pyx_t_50 = __pyx_v_alpha;
        if (__pyx_t_49 &lt; 0) __pyx_t_49 += __pyx_v_Pi_true.shape[0];
        if (__pyx_t_50 &lt; 0) __pyx_t_50 += __pyx_v_Pi_true.shape[1];
        __pyx_t_61 = __pyx_v_alpha;
        __pyx_t_62 = __pyx_v_beta;
        if (__pyx_t_61 &lt; 0) __pyx_t_61 += __pyx_v_scra.shape[0];
        if (__pyx_t_62 &lt; 0) __pyx_t_62 += __pyx_v_scra.shape[1];
        __pyx_t_63 = __pyx_v_i;
        __pyx_t_64 = __pyx_v_i;
        __pyx_t_65 = __pyx_v_alpha;
        __pyx_t_66 = __pyx_v_beta;
        if (__pyx_t_63 &lt; 0) __pyx_t_63 += __pyx_v_Pij_true.shape[0];
        if (__pyx_t_64 &lt; 0) __pyx_t_64 += __pyx_v_Pij_true.shape[1];
        if (__pyx_t_65 &lt; 0) __pyx_t_65 += __pyx_v_Pij_true.shape[2];
        if (__pyx_t_66 &lt; 0) __pyx_t_66 += __pyx_v_Pij_true.shape[3];
        *((double *) ( /* dim=3 */ (( /* dim=2 */ (( /* dim=1 */ (( /* dim=0 */ (__pyx_v_Pij_true.data + __pyx_t_63 * __pyx_v_Pij_true.strides[0]) ) + __pyx_t_64 * __pyx_v_Pij_true.strides[1]) ) + __pyx_t_65 * __pyx_v_Pij_true.strides[2]) ) + __pyx_t_66 * __pyx_v_Pij_true.strides[3]) )) = ((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_Pi_true.data + __pyx_t_49 * __pyx_v_Pi_true.strides[0]) ) + __pyx_t_50 * __pyx_v_Pi_true.strides[1]) ))) * (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_scra.data + __pyx_t_61 * __pyx_v_scra.strides[0]) ) + __pyx_t_62 * __pyx_v_scra.strides[1]) ))));
      }
    }
  }
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line187")'> 187: </pre>
<pre id='line187' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF62' onclick='toggleDiv("line188")'> 188:     return [Pij_true_np, Pi_true_np, Meff]</pre>
<pre id='line188' class='code' style='background-color: #FFFF62'>  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
  __pyx_t_6 = <span class='py_c_api'>PyFloat_FromDouble</span>(__pyx_v_Meff);<span class='error_goto'> if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 188; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
  __pyx_t_7 = <span class='py_c_api'>PyList_New</span>(3);<span class='error_goto'> if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 188; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_v_Pij_true_np));
  <span class='py_macro_api'>PyList_SET_ITEM</span>(__pyx_t_7, 0, ((PyObject *)__pyx_v_Pij_true_np));
  <span class='refnanny'>__Pyx_GIVEREF</span>(((PyObject *)__pyx_v_Pij_true_np));
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_v_Pi_true_np));
  <span class='py_macro_api'>PyList_SET_ITEM</span>(__pyx_t_7, 1, ((PyObject *)__pyx_v_Pi_true_np));
  <span class='refnanny'>__Pyx_GIVEREF</span>(((PyObject *)__pyx_v_Pi_true_np));
  <span class='py_macro_api'>PyList_SET_ITEM</span>(__pyx_t_7, 2, __pyx_t_6);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_6);
  __pyx_t_6 = 0;
  __pyx_r = ((PyObject*)__pyx_t_7);
  __pyx_t_7 = 0;
  goto __pyx_L0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line189")'> 189: </pre>
<pre id='line189' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line190")'> 190: # This version should work fine, if one changes something, please comment these</pre>
<pre id='line190' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line191")'> 191: # options</pre>
<pre id='line191' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line192")'> 192: @cython.boundscheck(False)</pre>
<pre id='line192' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF32' onclick='toggleDiv("line193")'> 193: cdef list with_pc(np.ndarray[DTYPE_float_t, ndim=4] Pij_true_np, np.ndarray[DTYPE_float_t, ndim=2] Pi_true_np, float pseudocount_weight, int N, int q):</pre>
<pre id='line193' class='code' style='background-color: #FFFF32'>static PyObject *__pyx_f_8epitopsy_6cython_12optimize_dca_with_pc(PyArrayObject *__pyx_v_Pij_true_np, PyArrayObject *__pyx_v_Pi_true_np, float __pyx_v_pseudocount_weight, int __pyx_v_N, int __pyx_v_q) {
  float __pyx_v_q_float;
  PyArrayObject *__pyx_v_Pij_np = 0;
  PyArrayObject *__pyx_v_Pi_np = 0;
  PyArrayObject *__pyx_v_scra_np = 0;
  int __pyx_v_i;
  int __pyx_v_alpha;
  int __pyx_v_beta;
  __Pyx_memviewslice __pyx_v_Pij_true = { 0, 0, { 0 }, { 0 }, { 0 } };
  __Pyx_memviewslice __pyx_v_Pij = { 0, 0, { 0 }, { 0 }, { 0 } };
  CYTHON_UNUSED __Pyx_memviewslice __pyx_v_Pi_true = { 0, 0, { 0 }, { 0 }, { 0 } };
  CYTHON_UNUSED __Pyx_memviewslice __pyx_v_Pi = { 0, 0, { 0 }, { 0 }, { 0 } };
  __Pyx_memviewslice __pyx_v_scra = { 0, 0, { 0 }, { 0 }, { 0 } };
  __Pyx_LocalBuf_ND __pyx_pybuffernd_Pi_np;
  __Pyx_Buffer __pyx_pybuffer_Pi_np;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_Pi_true_np;
  __Pyx_Buffer __pyx_pybuffer_Pi_true_np;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_Pij_np;
  __Pyx_Buffer __pyx_pybuffer_Pij_np;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_Pij_true_np;
  __Pyx_Buffer __pyx_pybuffer_Pij_true_np;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_scra_np;
  __Pyx_Buffer __pyx_pybuffer_scra_np;
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("with_pc", 0);
  __pyx_pybuffer_Pij_np.pybuffer.buf = NULL;
  __pyx_pybuffer_Pij_np.refcount = 0;
  __pyx_pybuffernd_Pij_np.data = NULL;
  __pyx_pybuffernd_Pij_np.rcbuffer = &amp;__pyx_pybuffer_Pij_np;
  __pyx_pybuffer_Pi_np.pybuffer.buf = NULL;
  __pyx_pybuffer_Pi_np.refcount = 0;
  __pyx_pybuffernd_Pi_np.data = NULL;
  __pyx_pybuffernd_Pi_np.rcbuffer = &amp;__pyx_pybuffer_Pi_np;
  __pyx_pybuffer_scra_np.pybuffer.buf = NULL;
  __pyx_pybuffer_scra_np.refcount = 0;
  __pyx_pybuffernd_scra_np.data = NULL;
  __pyx_pybuffernd_scra_np.rcbuffer = &amp;__pyx_pybuffer_scra_np;
  __pyx_pybuffer_Pij_true_np.pybuffer.buf = NULL;
  __pyx_pybuffer_Pij_true_np.refcount = 0;
  __pyx_pybuffernd_Pij_true_np.data = NULL;
  __pyx_pybuffernd_Pij_true_np.rcbuffer = &amp;__pyx_pybuffer_Pij_true_np;
  __pyx_pybuffer_Pi_true_np.pybuffer.buf = NULL;
  __pyx_pybuffer_Pi_true_np.refcount = 0;
  __pyx_pybuffernd_Pi_true_np.data = NULL;
  __pyx_pybuffernd_Pi_true_np.rcbuffer = &amp;__pyx_pybuffer_Pi_true_np;
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_Pij_true_np.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_v_Pij_true_np, &amp;__Pyx_TypeInfo_nn___pyx_t_8epitopsy_6cython_12optimize_dca_DTYPE_float_t, PyBUF_FORMAT| PyBUF_STRIDES, 4, 0, __pyx_stack) == -1)) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 193; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  }
  __pyx_pybuffernd_Pij_true_np.diminfo[0].strides = __pyx_pybuffernd_Pij_true_np.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_Pij_true_np.diminfo[0].shape = __pyx_pybuffernd_Pij_true_np.rcbuffer-&gt;pybuffer.shape[0]; __pyx_pybuffernd_Pij_true_np.diminfo[1].strides = __pyx_pybuffernd_Pij_true_np.rcbuffer-&gt;pybuffer.strides[1]; __pyx_pybuffernd_Pij_true_np.diminfo[1].shape = __pyx_pybuffernd_Pij_true_np.rcbuffer-&gt;pybuffer.shape[1]; __pyx_pybuffernd_Pij_true_np.diminfo[2].strides = __pyx_pybuffernd_Pij_true_np.rcbuffer-&gt;pybuffer.strides[2]; __pyx_pybuffernd_Pij_true_np.diminfo[2].shape = __pyx_pybuffernd_Pij_true_np.rcbuffer-&gt;pybuffer.shape[2]; __pyx_pybuffernd_Pij_true_np.diminfo[3].strides = __pyx_pybuffernd_Pij_true_np.rcbuffer-&gt;pybuffer.strides[3]; __pyx_pybuffernd_Pij_true_np.diminfo[3].shape = __pyx_pybuffernd_Pij_true_np.rcbuffer-&gt;pybuffer.shape[3];
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_Pi_true_np.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_v_Pi_true_np, &amp;__Pyx_TypeInfo_nn___pyx_t_8epitopsy_6cython_12optimize_dca_DTYPE_float_t, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack) == -1)) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 193; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  }
  __pyx_pybuffernd_Pi_true_np.diminfo[0].strides = __pyx_pybuffernd_Pi_true_np.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_Pi_true_np.diminfo[0].shape = __pyx_pybuffernd_Pi_true_np.rcbuffer-&gt;pybuffer.shape[0]; __pyx_pybuffernd_Pi_true_np.diminfo[1].strides = __pyx_pybuffernd_Pi_true_np.rcbuffer-&gt;pybuffer.strides[1]; __pyx_pybuffernd_Pi_true_np.diminfo[1].shape = __pyx_pybuffernd_Pi_true_np.rcbuffer-&gt;pybuffer.shape[1];
/* … */
  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_5);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_6);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_7);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_8);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_9);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_t_13, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_t_14, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_t_15, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_t_16, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_t_17, 1);
  { PyObject *__pyx_type, *__pyx_value, *__pyx_tb;
    <span class='pyx_c_api'>__Pyx_ErrFetch</span>(&amp;__pyx_type, &amp;__pyx_value, &amp;__pyx_tb);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_Pi_np.rcbuffer-&gt;pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_Pi_true_np.rcbuffer-&gt;pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_Pij_np.rcbuffer-&gt;pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_Pij_true_np.rcbuffer-&gt;pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_scra_np.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_ErrRestore</span>(__pyx_type, __pyx_value, __pyx_tb);}
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("epitopsy.cython.optimize_dca.with_pc", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = 0;
  goto __pyx_L2;
  __pyx_L0:;
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_Pi_np.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_Pi_true_np.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_Pij_np.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_Pij_true_np.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_scra_np.rcbuffer-&gt;pybuffer);
  __pyx_L2:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_Pij_np);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_Pi_np);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_scra_np);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_Pij_true, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_Pij, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_Pi_true, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_Pi, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_scra, 1);
  <span class='refnanny'>__Pyx_XGIVEREF</span>(__pyx_r);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line194")'> 194:     cdef float q_float = &lt;float&gt; q</pre>
<pre id='line194' class='code' style='background-color: #FFFFff'>  __pyx_v_q_float = ((float)__pyx_v_q);
</pre><pre class='line' style='background-color: #FFFF1d' onclick='toggleDiv("line195")'> 195:     cdef np.ndarray[DTYPE_float_t, ndim=4] Pij_np = (1. - pseudocount_weight)*Pij_true_np + pseudocount_weight/q_float/q_float * np.ones([N,N,q,q])</pre>
<pre id='line195' class='code' style='background-color: #FFFF1d'>  __pyx_t_1 = <span class='py_c_api'>PyFloat_FromDouble</span>((1. - __pyx_v_pseudocount_weight));<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 195; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_t_2 = <span class='py_c_api'>PyNumber_Multiply</span>(__pyx_t_1, ((PyObject *)__pyx_v_Pij_true_np));<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 195; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  if (unlikely(__pyx_v_q_float == 0)) {
    #ifdef WITH_THREAD
    PyGILState_STATE __pyx_gilstate_save = PyGILState_Ensure();
    #endif
    <span class='py_c_api'>PyErr_SetString</span>(PyExc_ZeroDivisionError, "float division");
    #ifdef WITH_THREAD
    PyGILState_Release(__pyx_gilstate_save);
    #endif
    <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 195; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  }
  __pyx_t_3 = (__pyx_v_pseudocount_weight / __pyx_v_q_float);
  if (unlikely(__pyx_v_q_float == 0)) {
    #ifdef WITH_THREAD
    PyGILState_STATE __pyx_gilstate_save = PyGILState_Ensure();
    #endif
    <span class='py_c_api'>PyErr_SetString</span>(PyExc_ZeroDivisionError, "float division");
    #ifdef WITH_THREAD
    PyGILState_Release(__pyx_gilstate_save);
    #endif
    <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 195; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  }
  __pyx_t_1 = <span class='py_c_api'>PyFloat_FromDouble</span>((__pyx_t_3 / __pyx_v_q_float));<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 195; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_t_4 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 195; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_4, __pyx_n_s_ones);<span class='error_goto'> if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 195; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_N);<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 195; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_N);<span class='error_goto'> if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 195; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
  __pyx_t_7 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_q);<span class='error_goto'> if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 195; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
  __pyx_t_8 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_q);<span class='error_goto'> if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 195; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
  __pyx_t_9 = <span class='py_c_api'>PyList_New</span>(4);<span class='error_goto'> if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 195; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_9);
  <span class='py_macro_api'>PyList_SET_ITEM</span>(__pyx_t_9, 0, __pyx_t_4);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_4);
  <span class='py_macro_api'>PyList_SET_ITEM</span>(__pyx_t_9, 1, __pyx_t_6);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_6);
  <span class='py_macro_api'>PyList_SET_ITEM</span>(__pyx_t_9, 2, __pyx_t_7);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_7);
  <span class='py_macro_api'>PyList_SET_ITEM</span>(__pyx_t_9, 3, __pyx_t_8);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_8);
  __pyx_t_4 = 0;
  __pyx_t_6 = 0;
  __pyx_t_7 = 0;
  __pyx_t_8 = 0;
  __pyx_t_8 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 195; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_8, 0, __pyx_t_9);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_9);
  __pyx_t_9 = 0;
  __pyx_t_9 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_5, __pyx_t_8, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 195; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_9);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
  __pyx_t_8 = <span class='py_c_api'>PyNumber_Multiply</span>(__pyx_t_1, __pyx_t_9);<span class='error_goto'> if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 195; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_9); __pyx_t_9 = 0;
  __pyx_t_9 = <span class='py_c_api'>PyNumber_Add</span>(__pyx_t_2, __pyx_t_8);<span class='error_goto'> if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 195; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_9);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
  if (!(likely(((__pyx_t_9) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_9, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 195; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_t_10 = ((PyArrayObject *)__pyx_t_9);
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_Pij_np.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_t_10, &amp;__Pyx_TypeInfo_nn___pyx_t_8epitopsy_6cython_12optimize_dca_DTYPE_float_t, PyBUF_FORMAT| PyBUF_STRIDES, 4, 0, __pyx_stack) == -1)) {
      __pyx_v_Pij_np = ((PyArrayObject *)Py_None); <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None); __pyx_pybuffernd_Pij_np.rcbuffer-&gt;pybuffer.buf = NULL;
      <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 195; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    } else {__pyx_pybuffernd_Pij_np.diminfo[0].strides = __pyx_pybuffernd_Pij_np.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_Pij_np.diminfo[0].shape = __pyx_pybuffernd_Pij_np.rcbuffer-&gt;pybuffer.shape[0]; __pyx_pybuffernd_Pij_np.diminfo[1].strides = __pyx_pybuffernd_Pij_np.rcbuffer-&gt;pybuffer.strides[1]; __pyx_pybuffernd_Pij_np.diminfo[1].shape = __pyx_pybuffernd_Pij_np.rcbuffer-&gt;pybuffer.shape[1]; __pyx_pybuffernd_Pij_np.diminfo[2].strides = __pyx_pybuffernd_Pij_np.rcbuffer-&gt;pybuffer.strides[2]; __pyx_pybuffernd_Pij_np.diminfo[2].shape = __pyx_pybuffernd_Pij_np.rcbuffer-&gt;pybuffer.shape[2]; __pyx_pybuffernd_Pij_np.diminfo[3].strides = __pyx_pybuffernd_Pij_np.rcbuffer-&gt;pybuffer.strides[3]; __pyx_pybuffernd_Pij_np.diminfo[3].shape = __pyx_pybuffernd_Pij_np.rcbuffer-&gt;pybuffer.shape[3];
    }
  }
  __pyx_t_10 = 0;
  __pyx_v_Pij_np = ((PyArrayObject *)__pyx_t_9);
  __pyx_t_9 = 0;
</pre><pre class='line' style='background-color: #FFFF21' onclick='toggleDiv("line196")'> 196:     cdef np.ndarray[DTYPE_float_t, ndim=2] Pi_np = (1. - pseudocount_weight)*Pi_true_np + pseudocount_weight/q_float * np.ones([N,q])</pre>
<pre id='line196' class='code' style='background-color: #FFFF21'>  __pyx_t_9 = <span class='py_c_api'>PyFloat_FromDouble</span>((1. - __pyx_v_pseudocount_weight));<span class='error_goto'> if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 196; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_9);
  __pyx_t_8 = <span class='py_c_api'>PyNumber_Multiply</span>(__pyx_t_9, ((PyObject *)__pyx_v_Pi_true_np));<span class='error_goto'> if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 196; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_9); __pyx_t_9 = 0;
  if (unlikely(__pyx_v_q_float == 0)) {
    #ifdef WITH_THREAD
    PyGILState_STATE __pyx_gilstate_save = PyGILState_Ensure();
    #endif
    <span class='py_c_api'>PyErr_SetString</span>(PyExc_ZeroDivisionError, "float division");
    #ifdef WITH_THREAD
    PyGILState_Release(__pyx_gilstate_save);
    #endif
    <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 196; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  }
  __pyx_t_9 = <span class='py_c_api'>PyFloat_FromDouble</span>((__pyx_v_pseudocount_weight / __pyx_v_q_float));<span class='error_goto'> if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 196; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_9);
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 196; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_2, __pyx_n_s_ones);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 196; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_N);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 196; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_q);<span class='error_goto'> if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 196; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
  __pyx_t_7 = <span class='py_c_api'>PyList_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 196; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
  <span class='py_macro_api'>PyList_SET_ITEM</span>(__pyx_t_7, 0, __pyx_t_2);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_2);
  <span class='py_macro_api'>PyList_SET_ITEM</span>(__pyx_t_7, 1, __pyx_t_5);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_5);
  __pyx_t_2 = 0;
  __pyx_t_5 = 0;
  __pyx_t_5 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 196; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_5, 0, __pyx_t_7);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_7);
  __pyx_t_7 = 0;
  __pyx_t_7 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_1, __pyx_t_5, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 196; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
  __pyx_t_5 = <span class='py_c_api'>PyNumber_Multiply</span>(__pyx_t_9, __pyx_t_7);<span class='error_goto'> if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 196; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_9); __pyx_t_9 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
  __pyx_t_7 = <span class='py_c_api'>PyNumber_Add</span>(__pyx_t_8, __pyx_t_5);<span class='error_goto'> if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 196; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
  if (!(likely(((__pyx_t_7) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_7, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 196; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_t_11 = ((PyArrayObject *)__pyx_t_7);
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_Pi_np.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_t_11, &amp;__Pyx_TypeInfo_nn___pyx_t_8epitopsy_6cython_12optimize_dca_DTYPE_float_t, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack) == -1)) {
      __pyx_v_Pi_np = ((PyArrayObject *)Py_None); <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None); __pyx_pybuffernd_Pi_np.rcbuffer-&gt;pybuffer.buf = NULL;
      <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 196; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    } else {__pyx_pybuffernd_Pi_np.diminfo[0].strides = __pyx_pybuffernd_Pi_np.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_Pi_np.diminfo[0].shape = __pyx_pybuffernd_Pi_np.rcbuffer-&gt;pybuffer.shape[0]; __pyx_pybuffernd_Pi_np.diminfo[1].strides = __pyx_pybuffernd_Pi_np.rcbuffer-&gt;pybuffer.strides[1]; __pyx_pybuffernd_Pi_np.diminfo[1].shape = __pyx_pybuffernd_Pi_np.rcbuffer-&gt;pybuffer.shape[1];
    }
  }
  __pyx_t_11 = 0;
  __pyx_v_Pi_np = ((PyArrayObject *)__pyx_t_7);
  __pyx_t_7 = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line197")'> 197: </pre>
<pre id='line197' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF4f' onclick='toggleDiv("line198")'> 198:     cdef np.ndarray[DTYPE_float_t, ndim=2] scra_np = np.eye(q)</pre>
<pre id='line198' class='code' style='background-color: #FFFF4f'>  __pyx_t_7 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 198; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
  __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_7, __pyx_n_s_eye);<span class='error_goto'> if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 198; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
  __pyx_t_7 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_q);<span class='error_goto'> if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 198; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
  __pyx_t_8 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 198; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_8, 0, __pyx_t_7);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_7);
  __pyx_t_7 = 0;
  __pyx_t_7 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_5, __pyx_t_8, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 198; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
  if (!(likely(((__pyx_t_7) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_7, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 198; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_t_12 = ((PyArrayObject *)__pyx_t_7);
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_scra_np.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_t_12, &amp;__Pyx_TypeInfo_nn___pyx_t_8epitopsy_6cython_12optimize_dca_DTYPE_float_t, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack) == -1)) {
      __pyx_v_scra_np = ((PyArrayObject *)Py_None); <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None); __pyx_pybuffernd_scra_np.rcbuffer-&gt;pybuffer.buf = NULL;
      <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 198; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    } else {__pyx_pybuffernd_scra_np.diminfo[0].strides = __pyx_pybuffernd_scra_np.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_scra_np.diminfo[0].shape = __pyx_pybuffernd_scra_np.rcbuffer-&gt;pybuffer.shape[0]; __pyx_pybuffernd_scra_np.diminfo[1].strides = __pyx_pybuffernd_scra_np.rcbuffer-&gt;pybuffer.strides[1]; __pyx_pybuffernd_scra_np.diminfo[1].shape = __pyx_pybuffernd_scra_np.rcbuffer-&gt;pybuffer.shape[1];
    }
  }
  __pyx_t_12 = 0;
  __pyx_v_scra_np = ((PyArrayObject *)__pyx_t_7);
  __pyx_t_7 = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line199")'> 199:     cdef int i, alpha, beta</pre>
<pre id='line199' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line200")'> 200: </pre>
<pre id='line200' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line201")'> 201:     # memory views for efficient indexing</pre>
<pre id='line201' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line202")'> 202:     cdef double [:,:,:,:] Pij_true = Pij_true_np</pre>
<pre id='line202' class='code' style='background-color: #FFFFd4'>  __pyx_t_13 = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_dsdsdsds_double</span>(((PyObject *)__pyx_v_Pij_true_np));
  if (unlikely(!__pyx_t_13.memview)) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 202; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_v_Pij_true = __pyx_t_13;
  __pyx_t_13.memview = NULL;
  __pyx_t_13.data = NULL;
</pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line203")'> 203:     cdef double [:,:,:,:] Pij = Pij_np</pre>
<pre id='line203' class='code' style='background-color: #FFFFd4'>  __pyx_t_14 = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_dsdsdsds_double</span>(((PyObject *)__pyx_v_Pij_np));
  if (unlikely(!__pyx_t_14.memview)) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 203; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_v_Pij = __pyx_t_14;
  __pyx_t_14.memview = NULL;
  __pyx_t_14.data = NULL;
</pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line204")'> 204:     cdef double [:,:] Pi_true = Pi_true_np</pre>
<pre id='line204' class='code' style='background-color: #FFFFd4'>  __pyx_t_15 = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_dsds_double</span>(((PyObject *)__pyx_v_Pi_true_np));
  if (unlikely(!__pyx_t_15.memview)) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 204; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_v_Pi_true = __pyx_t_15;
  __pyx_t_15.memview = NULL;
  __pyx_t_15.data = NULL;
</pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line205")'> 205:     cdef double [:,:] Pi = Pi_np</pre>
<pre id='line205' class='code' style='background-color: #FFFFd4'>  __pyx_t_16 = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_dsds_double</span>(((PyObject *)__pyx_v_Pi_np));
  if (unlikely(!__pyx_t_16.memview)) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 205; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_v_Pi = __pyx_t_16;
  __pyx_t_16.memview = NULL;
  __pyx_t_16.data = NULL;
</pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line206")'> 206:     cdef double [:,:] scra = scra_np</pre>
<pre id='line206' class='code' style='background-color: #FFFFd4'>  __pyx_t_17 = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_dsds_double</span>(((PyObject *)__pyx_v_scra_np));
  if (unlikely(!__pyx_t_17.memview)) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 206; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_v_scra = __pyx_t_17;
  __pyx_t_17.memview = NULL;
  __pyx_t_17.data = NULL;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line207")'> 207:     for i in range(N):</pre>
<pre id='line207' class='code' style='background-color: #FFFFff'>  __pyx_t_18 = __pyx_v_N;
  for (__pyx_t_19 = 0; __pyx_t_19 &lt; __pyx_t_18; __pyx_t_19+=1) {
    __pyx_v_i = __pyx_t_19;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line208")'> 208:         for alpha in range(q):</pre>
<pre id='line208' class='code' style='background-color: #FFFFff'>    __pyx_t_20 = __pyx_v_q;
    for (__pyx_t_21 = 0; __pyx_t_21 &lt; __pyx_t_20; __pyx_t_21+=1) {
      __pyx_v_alpha = __pyx_t_21;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line209")'> 209:             for beta in range(q):</pre>
<pre id='line209' class='code' style='background-color: #FFFFff'>      __pyx_t_22 = __pyx_v_q;
      for (__pyx_t_23 = 0; __pyx_t_23 &lt; __pyx_t_22; __pyx_t_23+=1) {
        __pyx_v_beta = __pyx_t_23;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line210")'> 210:                 Pij[i,i,alpha,beta] = ((1.-pseudocount_weight)*Pij_true[i,i,alpha,beta]</pre>
<pre id='line210' class='code' style='background-color: #FFFFff'>        __pyx_t_24 = __pyx_v_i;
        __pyx_t_25 = __pyx_v_i;
        __pyx_t_26 = __pyx_v_alpha;
        __pyx_t_27 = __pyx_v_beta;
        if (__pyx_t_24 &lt; 0) __pyx_t_24 += __pyx_v_Pij_true.shape[0];
        if (__pyx_t_25 &lt; 0) __pyx_t_25 += __pyx_v_Pij_true.shape[1];
        if (__pyx_t_26 &lt; 0) __pyx_t_26 += __pyx_v_Pij_true.shape[2];
        if (__pyx_t_27 &lt; 0) __pyx_t_27 += __pyx_v_Pij_true.shape[3];
/* … */
        __pyx_t_30 = __pyx_v_i;
        __pyx_t_31 = __pyx_v_i;
        __pyx_t_32 = __pyx_v_alpha;
        __pyx_t_33 = __pyx_v_beta;
        if (__pyx_t_30 &lt; 0) __pyx_t_30 += __pyx_v_Pij.shape[0];
        if (__pyx_t_31 &lt; 0) __pyx_t_31 += __pyx_v_Pij.shape[1];
        if (__pyx_t_32 &lt; 0) __pyx_t_32 += __pyx_v_Pij.shape[2];
        if (__pyx_t_33 &lt; 0) __pyx_t_33 += __pyx_v_Pij.shape[3];
        *((double *) ( /* dim=3 */ (( /* dim=2 */ (( /* dim=1 */ (( /* dim=0 */ (__pyx_v_Pij.data + __pyx_t_30 * __pyx_v_Pij.strides[0]) ) + __pyx_t_31 * __pyx_v_Pij.strides[1]) ) + __pyx_t_32 * __pyx_v_Pij.strides[2]) ) + __pyx_t_33 * __pyx_v_Pij.strides[3]) )) = (((1. - __pyx_v_pseudocount_weight) * (*((double *) ( /* dim=3 */ (( /* dim=2 */ (( /* dim=1 */ (( /* dim=0 */ (__pyx_v_Pij_true.data + __pyx_t_24 * __pyx_v_Pij_true.strides[0]) ) + __pyx_t_25 * __pyx_v_Pij_true.strides[1]) ) + __pyx_t_26 * __pyx_v_Pij_true.strides[2]) ) + __pyx_t_27 * __pyx_v_Pij_true.strides[3]) )))) + ((__pyx_v_pseudocount_weight / __pyx_v_q_float) * (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_scra.data + __pyx_t_28 * __pyx_v_scra.strides[0]) ) + __pyx_t_29 * __pyx_v_scra.strides[1]) )))));
      }
    }
  }
</pre><pre class='line' style='background-color: #FFFFaa' onclick='toggleDiv("line211")'> 211:                         + pseudocount_weight/q_float*scra[alpha,beta])</pre>
<pre id='line211' class='code' style='background-color: #FFFFaa'>        if (unlikely(__pyx_v_q_float == 0)) {
          #ifdef WITH_THREAD
          PyGILState_STATE __pyx_gilstate_save = PyGILState_Ensure();
          #endif
          <span class='py_c_api'>PyErr_SetString</span>(PyExc_ZeroDivisionError, "float division");
          #ifdef WITH_THREAD
          PyGILState_Release(__pyx_gilstate_save);
          #endif
          <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 211; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        }
        __pyx_t_28 = __pyx_v_alpha;
        __pyx_t_29 = __pyx_v_beta;
        if (__pyx_t_28 &lt; 0) __pyx_t_28 += __pyx_v_scra.shape[0];
        if (__pyx_t_29 &lt; 0) __pyx_t_29 += __pyx_v_scra.shape[1];
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line212")'> 212: </pre>
<pre id='line212' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF7f' onclick='toggleDiv("line213")'> 213:     return [Pij_np, Pi_np]</pre>
<pre id='line213' class='code' style='background-color: #FFFF7f'>  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
  __pyx_t_7 = <span class='py_c_api'>PyList_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 213; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_v_Pij_np));
  <span class='py_macro_api'>PyList_SET_ITEM</span>(__pyx_t_7, 0, ((PyObject *)__pyx_v_Pij_np));
  <span class='refnanny'>__Pyx_GIVEREF</span>(((PyObject *)__pyx_v_Pij_np));
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_v_Pi_np));
  <span class='py_macro_api'>PyList_SET_ITEM</span>(__pyx_t_7, 1, ((PyObject *)__pyx_v_Pi_np));
  <span class='refnanny'>__Pyx_GIVEREF</span>(((PyObject *)__pyx_v_Pi_np));
  __pyx_r = ((PyObject*)__pyx_t_7);
  __pyx_t_7 = 0;
  goto __pyx_L0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line214")'> 214: </pre>
<pre id='line214' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line215")'> 215: # This version should work fine, if one changes something, please comment these</pre>
<pre id='line215' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line216")'> 216: # options</pre>
<pre id='line216' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line217")'> 217: @cython.boundscheck(False)</pre>
<pre id='line217' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line218")'> 218: cdef int mapkey(int i, int alpha, int q):</pre>
<pre id='line218' class='code' style='background-color: #FFFFff'>static int __pyx_f_8epitopsy_6cython_12optimize_dca_mapkey(int __pyx_v_i, int __pyx_v_alpha, int __pyx_v_q) {
  int __pyx_r;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("mapkey", 0);
/* … */
  /* function exit code */
  __pyx_L0:;
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line219")'> 219:     return ((q-1)*(i-1) + alpha)</pre>
<pre id='line219' class='code' style='background-color: #FFFFff'>  __pyx_r = (((__pyx_v_q - 1) * (__pyx_v_i - 1)) + __pyx_v_alpha);
  goto __pyx_L0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line220")'> 220: </pre>
<pre id='line220' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line221")'> 221: # This version should work fine, if one changes something, please comment these</pre>
<pre id='line221' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line222")'> 222: # options</pre>
<pre id='line222' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line223")'> 223: @cython.boundscheck(False)</pre>
<pre id='line223' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF44' onclick='toggleDiv("line224")'> 224: cdef np.ndarray Compute_C(np.ndarray[DTYPE_float_t, ndim=4] Pij_np,</pre>
<pre id='line224' class='code' style='background-color: #FFFF44'>static PyArrayObject *__pyx_f_8epitopsy_6cython_12optimize_dca_Compute_C(PyArrayObject *__pyx_v_Pij_np, PyArrayObject *__pyx_v_Pi_np, int __pyx_v_N, int __pyx_v_q) {
  int __pyx_v_qm;
  PyArrayObject *__pyx_v_C_np = 0;
  __Pyx_memviewslice __pyx_v_C = { 0, 0, { 0 }, { 0 }, { 0 } };
  __Pyx_memviewslice __pyx_v_Pij = { 0, 0, { 0 }, { 0 }, { 0 } };
  __Pyx_memviewslice __pyx_v_Pi = { 0, 0, { 0 }, { 0 }, { 0 } };
  int __pyx_v_i;
  int __pyx_v_j;
  int __pyx_v_alpha;
  int __pyx_v_beta;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_C_np;
  __Pyx_Buffer __pyx_pybuffer_C_np;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_Pi_np;
  __Pyx_Buffer __pyx_pybuffer_Pi_np;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_Pij_np;
  __Pyx_Buffer __pyx_pybuffer_Pij_np;
  PyArrayObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("Compute_C", 0);
  __pyx_pybuffer_C_np.pybuffer.buf = NULL;
  __pyx_pybuffer_C_np.refcount = 0;
  __pyx_pybuffernd_C_np.data = NULL;
  __pyx_pybuffernd_C_np.rcbuffer = &amp;__pyx_pybuffer_C_np;
  __pyx_pybuffer_Pij_np.pybuffer.buf = NULL;
  __pyx_pybuffer_Pij_np.refcount = 0;
  __pyx_pybuffernd_Pij_np.data = NULL;
  __pyx_pybuffernd_Pij_np.rcbuffer = &amp;__pyx_pybuffer_Pij_np;
  __pyx_pybuffer_Pi_np.pybuffer.buf = NULL;
  __pyx_pybuffer_Pi_np.refcount = 0;
  __pyx_pybuffernd_Pi_np.data = NULL;
  __pyx_pybuffernd_Pi_np.rcbuffer = &amp;__pyx_pybuffer_Pi_np;
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_Pij_np.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_v_Pij_np, &amp;__Pyx_TypeInfo_nn___pyx_t_8epitopsy_6cython_12optimize_dca_DTYPE_float_t, PyBUF_FORMAT| PyBUF_STRIDES, 4, 0, __pyx_stack) == -1)) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 224; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  }
  __pyx_pybuffernd_Pij_np.diminfo[0].strides = __pyx_pybuffernd_Pij_np.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_Pij_np.diminfo[0].shape = __pyx_pybuffernd_Pij_np.rcbuffer-&gt;pybuffer.shape[0]; __pyx_pybuffernd_Pij_np.diminfo[1].strides = __pyx_pybuffernd_Pij_np.rcbuffer-&gt;pybuffer.strides[1]; __pyx_pybuffernd_Pij_np.diminfo[1].shape = __pyx_pybuffernd_Pij_np.rcbuffer-&gt;pybuffer.shape[1]; __pyx_pybuffernd_Pij_np.diminfo[2].strides = __pyx_pybuffernd_Pij_np.rcbuffer-&gt;pybuffer.strides[2]; __pyx_pybuffernd_Pij_np.diminfo[2].shape = __pyx_pybuffernd_Pij_np.rcbuffer-&gt;pybuffer.shape[2]; __pyx_pybuffernd_Pij_np.diminfo[3].strides = __pyx_pybuffernd_Pij_np.rcbuffer-&gt;pybuffer.strides[3]; __pyx_pybuffernd_Pij_np.diminfo[3].shape = __pyx_pybuffernd_Pij_np.rcbuffer-&gt;pybuffer.shape[3];
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_Pi_np.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_v_Pi_np, &amp;__Pyx_TypeInfo_nn___pyx_t_8epitopsy_6cython_12optimize_dca_DTYPE_float_t, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack) == -1)) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 224; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  }
  __pyx_pybuffernd_Pi_np.diminfo[0].strides = __pyx_pybuffernd_Pi_np.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_Pi_np.diminfo[0].shape = __pyx_pybuffernd_Pi_np.rcbuffer-&gt;pybuffer.shape[0]; __pyx_pybuffernd_Pi_np.diminfo[1].strides = __pyx_pybuffernd_Pi_np.rcbuffer-&gt;pybuffer.strides[1]; __pyx_pybuffernd_Pi_np.diminfo[1].shape = __pyx_pybuffernd_Pi_np.rcbuffer-&gt;pybuffer.shape[1];
/* … */
  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_t_6, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_t_7, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_t_8, 1);
  { PyObject *__pyx_type, *__pyx_value, *__pyx_tb;
    <span class='pyx_c_api'>__Pyx_ErrFetch</span>(&amp;__pyx_type, &amp;__pyx_value, &amp;__pyx_tb);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_C_np.rcbuffer-&gt;pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_Pi_np.rcbuffer-&gt;pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_Pij_np.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_ErrRestore</span>(__pyx_type, __pyx_value, __pyx_tb);}
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("epitopsy.cython.optimize_dca.Compute_C", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = 0;
  goto __pyx_L2;
  __pyx_L0:;
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_C_np.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_Pi_np.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_Pij_np.rcbuffer-&gt;pybuffer);
  __pyx_L2:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_C_np);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_C, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_Pij, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_Pi, 1);
  <span class='refnanny'>__Pyx_XGIVEREF</span>((PyObject *)__pyx_r);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line225")'> 225:         np.ndarray[DTYPE_float_t, ndim=2] Pi_np, int N, int q):</pre>
<pre id='line225' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line226")'> 226:     cdef int qm = q-1</pre>
<pre id='line226' class='code' style='background-color: #FFFFff'>  __pyx_v_qm = (__pyx_v_q - 1);
</pre><pre class='line' style='background-color: #FFFF3e' onclick='toggleDiv("line227")'> 227:     cdef np.ndarray[DTYPE_float_t, ndim=2] C_np = np.zeros([N*(q-1),N*qm])</pre>
<pre id='line227' class='code' style='background-color: #FFFF3e'>  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 227; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_1, __pyx_n_s_zeros);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 227; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyInt_From_long</span>((__pyx_v_N * (__pyx_v_q - 1)));<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 227; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>((__pyx_v_N * __pyx_v_qm));<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 227; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  __pyx_t_4 = <span class='py_c_api'>PyList_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 227; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  <span class='py_macro_api'>PyList_SET_ITEM</span>(__pyx_t_4, 0, __pyx_t_1);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_1);
  <span class='py_macro_api'>PyList_SET_ITEM</span>(__pyx_t_4, 1, __pyx_t_3);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_3);
  __pyx_t_1 = 0;
  __pyx_t_3 = 0;
  __pyx_t_3 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 227; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_3, 0, __pyx_t_4);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_4);
  __pyx_t_4 = 0;
  __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_2, __pyx_t_3, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 227; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  if (!(likely(((__pyx_t_4) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_4, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 227; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_t_5 = ((PyArrayObject *)__pyx_t_4);
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_C_np.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_t_5, &amp;__Pyx_TypeInfo_nn___pyx_t_8epitopsy_6cython_12optimize_dca_DTYPE_float_t, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack) == -1)) {
      __pyx_v_C_np = ((PyArrayObject *)Py_None); <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None); __pyx_pybuffernd_C_np.rcbuffer-&gt;pybuffer.buf = NULL;
      <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 227; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    } else {__pyx_pybuffernd_C_np.diminfo[0].strides = __pyx_pybuffernd_C_np.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_C_np.diminfo[0].shape = __pyx_pybuffernd_C_np.rcbuffer-&gt;pybuffer.shape[0]; __pyx_pybuffernd_C_np.diminfo[1].strides = __pyx_pybuffernd_C_np.rcbuffer-&gt;pybuffer.strides[1]; __pyx_pybuffernd_C_np.diminfo[1].shape = __pyx_pybuffernd_C_np.rcbuffer-&gt;pybuffer.shape[1];
    }
  }
  __pyx_t_5 = 0;
  __pyx_v_C_np = ((PyArrayObject *)__pyx_t_4);
  __pyx_t_4 = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line228")'> 228: </pre>
<pre id='line228' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line229")'> 229:     # memory views for efficient indexing</pre>
<pre id='line229' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line230")'> 230:     cdef double[:,:] C = C_np</pre>
<pre id='line230' class='code' style='background-color: #FFFFd4'>  __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_dsds_double</span>(((PyObject *)__pyx_v_C_np));
  if (unlikely(!__pyx_t_6.memview)) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 230; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_v_C = __pyx_t_6;
  __pyx_t_6.memview = NULL;
  __pyx_t_6.data = NULL;
</pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line231")'> 231:     cdef double [:,:,:,:] Pij = Pij_np</pre>
<pre id='line231' class='code' style='background-color: #FFFFd4'>  __pyx_t_7 = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_dsdsdsds_double</span>(((PyObject *)__pyx_v_Pij_np));
  if (unlikely(!__pyx_t_7.memview)) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 231; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_v_Pij = __pyx_t_7;
  __pyx_t_7.memview = NULL;
  __pyx_t_7.data = NULL;
</pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line232")'> 232:     cdef double [:,:] Pi = Pi_np</pre>
<pre id='line232' class='code' style='background-color: #FFFFd4'>  __pyx_t_8 = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_dsds_double</span>(((PyObject *)__pyx_v_Pi_np));
  if (unlikely(!__pyx_t_8.memview)) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 232; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_v_Pi = __pyx_t_8;
  __pyx_t_8.memview = NULL;
  __pyx_t_8.data = NULL;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line233")'> 233: </pre>
<pre id='line233' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line234")'> 234:     cdef int i,j,alpha,beta</pre>
<pre id='line234' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line235")'> 235: </pre>
<pre id='line235' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line236")'> 236:     for i in range(N):</pre>
<pre id='line236' class='code' style='background-color: #FFFFff'>  __pyx_t_9 = __pyx_v_N;
  for (__pyx_t_10 = 0; __pyx_t_10 &lt; __pyx_t_9; __pyx_t_10+=1) {
    __pyx_v_i = __pyx_t_10;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line237")'> 237:         for j in range(N):</pre>
<pre id='line237' class='code' style='background-color: #FFFFff'>    __pyx_t_11 = __pyx_v_N;
    for (__pyx_t_12 = 0; __pyx_t_12 &lt; __pyx_t_11; __pyx_t_12+=1) {
      __pyx_v_j = __pyx_t_12;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line238")'> 238:             for alpha in range(qm):</pre>
<pre id='line238' class='code' style='background-color: #FFFFff'>      __pyx_t_13 = __pyx_v_qm;
      for (__pyx_t_14 = 0; __pyx_t_14 &lt; __pyx_t_13; __pyx_t_14+=1) {
        __pyx_v_alpha = __pyx_t_14;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line239")'> 239:                 for beta in range(qm):</pre>
<pre id='line239' class='code' style='background-color: #FFFFff'>        __pyx_t_15 = __pyx_v_qm;
        for (__pyx_t_16 = 0; __pyx_t_16 &lt; __pyx_t_15; __pyx_t_16+=1) {
          __pyx_v_beta = __pyx_t_16;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line240")'> 240:                     C[mapkey(i,alpha,q),mapkey(j,beta,q)] = (Pij[i,j,alpha,beta]</pre>
<pre id='line240' class='code' style='background-color: #FFFFff'>          __pyx_t_17 = __pyx_v_i;
          __pyx_t_18 = __pyx_v_j;
          __pyx_t_19 = __pyx_v_alpha;
          __pyx_t_20 = __pyx_v_beta;
          if (__pyx_t_17 &lt; 0) __pyx_t_17 += __pyx_v_Pij.shape[0];
          if (__pyx_t_18 &lt; 0) __pyx_t_18 += __pyx_v_Pij.shape[1];
          if (__pyx_t_19 &lt; 0) __pyx_t_19 += __pyx_v_Pij.shape[2];
          if (__pyx_t_20 &lt; 0) __pyx_t_20 += __pyx_v_Pij.shape[3];
/* … */
          __pyx_t_25 = __pyx_f_8epitopsy_6cython_12optimize_dca_mapkey(__pyx_v_i, __pyx_v_alpha, __pyx_v_q);
          __pyx_t_26 = __pyx_f_8epitopsy_6cython_12optimize_dca_mapkey(__pyx_v_j, __pyx_v_beta, __pyx_v_q);
          if (__pyx_t_25 &lt; 0) __pyx_t_25 += __pyx_v_C.shape[0];
          if (__pyx_t_26 &lt; 0) __pyx_t_26 += __pyx_v_C.shape[1];
          *((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_C.data + __pyx_t_25 * __pyx_v_C.strides[0]) ) + __pyx_t_26 * __pyx_v_C.strides[1]) )) = ((*((double *) ( /* dim=3 */ (( /* dim=2 */ (( /* dim=1 */ (( /* dim=0 */ (__pyx_v_Pij.data + __pyx_t_17 * __pyx_v_Pij.strides[0]) ) + __pyx_t_18 * __pyx_v_Pij.strides[1]) ) + __pyx_t_19 * __pyx_v_Pij.strides[2]) ) + __pyx_t_20 * __pyx_v_Pij.strides[3]) ))) - ((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_Pi.data + __pyx_t_21 * __pyx_v_Pi.strides[0]) ) + __pyx_t_22 * __pyx_v_Pi.strides[1]) ))) * (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_Pi.data + __pyx_t_23 * __pyx_v_Pi.strides[0]) ) + __pyx_t_24 * __pyx_v_Pi.strides[1]) )))));
        }
      }
    }
  }
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line241")'> 241:                             - Pi[i,alpha] * Pi[j, beta])</pre>
<pre id='line241' class='code' style='background-color: #FFFFff'>          __pyx_t_21 = __pyx_v_i;
          __pyx_t_22 = __pyx_v_alpha;
          if (__pyx_t_21 &lt; 0) __pyx_t_21 += __pyx_v_Pi.shape[0];
          if (__pyx_t_22 &lt; 0) __pyx_t_22 += __pyx_v_Pi.shape[1];
          __pyx_t_23 = __pyx_v_j;
          __pyx_t_24 = __pyx_v_beta;
          if (__pyx_t_23 &lt; 0) __pyx_t_23 += __pyx_v_Pi.shape[0];
          if (__pyx_t_24 &lt; 0) __pyx_t_24 += __pyx_v_Pi.shape[1];
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line242")'> 242: </pre>
<pre id='line242' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line243")'> 243:     return C_np</pre>
<pre id='line243' class='code' style='background-color: #FFFFd4'>  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(((PyObject *)__pyx_r));
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_v_C_np));
  __pyx_r = ((PyArrayObject *)__pyx_v_C_np);
  goto __pyx_L0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line244")'> 244: </pre>
<pre id='line244' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line245")'> 245: </pre>
<pre id='line245' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line246")'> 246: </pre>
<pre id='line246' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line247")'> 247: </pre>
<pre id='line247' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF2c' onclick='toggleDiv("line248")'> 248: cdef Compute_Results(np.ndarray[DTYPE_float_t, ndim=4] Pij,</pre>
<pre id='line248' class='code' style='background-color: #FFFF2c'>static PyObject *__pyx_f_8epitopsy_6cython_12optimize_dca_Compute_Results(CYTHON_UNUSED PyArrayObject *__pyx_v_Pij, PyArrayObject *__pyx_v_Pi, PyArrayObject *__pyx_v_Pij_true, PyArrayObject *__pyx_v_Pi_true, PyArrayObject *__pyx_v_invC, int __pyx_v_N, int __pyx_v_q, char *__pyx_v_outputfile, char *__pyx_v_header_string) {
  PyObject *__pyx_v_output_list = NULL;
  int __pyx_v_i;
  int __pyx_v_j;
  PyObject *__pyx_v_MI_true = NULL;
  CYTHON_UNUSED PyObject *__pyx_v_si_true = NULL;
  CYTHON_UNUSED PyObject *__pyx_v_sj_true = NULL;
  PyArrayObject *__pyx_v_W_mf = NULL;
  PyObject *__pyx_v_DI_mf_pc = NULL;
  PyObject *__pyx_v_f = NULL;
  PyObject *__pyx_v_item = NULL;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_Pi;
  __Pyx_Buffer __pyx_pybuffer_Pi;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_Pi_true;
  __Pyx_Buffer __pyx_pybuffer_Pi_true;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_Pij;
  __Pyx_Buffer __pyx_pybuffer_Pij;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_Pij_true;
  __Pyx_Buffer __pyx_pybuffer_Pij_true;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_invC;
  __Pyx_Buffer __pyx_pybuffer_invC;
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("Compute_Results", 0);
  __pyx_pybuffer_Pij.pybuffer.buf = NULL;
  __pyx_pybuffer_Pij.refcount = 0;
  __pyx_pybuffernd_Pij.data = NULL;
  __pyx_pybuffernd_Pij.rcbuffer = &amp;__pyx_pybuffer_Pij;
  __pyx_pybuffer_Pi.pybuffer.buf = NULL;
  __pyx_pybuffer_Pi.refcount = 0;
  __pyx_pybuffernd_Pi.data = NULL;
  __pyx_pybuffernd_Pi.rcbuffer = &amp;__pyx_pybuffer_Pi;
  __pyx_pybuffer_Pij_true.pybuffer.buf = NULL;
  __pyx_pybuffer_Pij_true.refcount = 0;
  __pyx_pybuffernd_Pij_true.data = NULL;
  __pyx_pybuffernd_Pij_true.rcbuffer = &amp;__pyx_pybuffer_Pij_true;
  __pyx_pybuffer_Pi_true.pybuffer.buf = NULL;
  __pyx_pybuffer_Pi_true.refcount = 0;
  __pyx_pybuffernd_Pi_true.data = NULL;
  __pyx_pybuffernd_Pi_true.rcbuffer = &amp;__pyx_pybuffer_Pi_true;
  __pyx_pybuffer_invC.pybuffer.buf = NULL;
  __pyx_pybuffer_invC.refcount = 0;
  __pyx_pybuffernd_invC.data = NULL;
  __pyx_pybuffernd_invC.rcbuffer = &amp;__pyx_pybuffer_invC;
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_Pij.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_v_Pij, &amp;__Pyx_TypeInfo_nn___pyx_t_8epitopsy_6cython_12optimize_dca_DTYPE_float_t, PyBUF_FORMAT| PyBUF_STRIDES, 4, 0, __pyx_stack) == -1)) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 248; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  }
  __pyx_pybuffernd_Pij.diminfo[0].strides = __pyx_pybuffernd_Pij.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_Pij.diminfo[0].shape = __pyx_pybuffernd_Pij.rcbuffer-&gt;pybuffer.shape[0]; __pyx_pybuffernd_Pij.diminfo[1].strides = __pyx_pybuffernd_Pij.rcbuffer-&gt;pybuffer.strides[1]; __pyx_pybuffernd_Pij.diminfo[1].shape = __pyx_pybuffernd_Pij.rcbuffer-&gt;pybuffer.shape[1]; __pyx_pybuffernd_Pij.diminfo[2].strides = __pyx_pybuffernd_Pij.rcbuffer-&gt;pybuffer.strides[2]; __pyx_pybuffernd_Pij.diminfo[2].shape = __pyx_pybuffernd_Pij.rcbuffer-&gt;pybuffer.shape[2]; __pyx_pybuffernd_Pij.diminfo[3].strides = __pyx_pybuffernd_Pij.rcbuffer-&gt;pybuffer.strides[3]; __pyx_pybuffernd_Pij.diminfo[3].shape = __pyx_pybuffernd_Pij.rcbuffer-&gt;pybuffer.shape[3];
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_Pi.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_v_Pi, &amp;__Pyx_TypeInfo_nn___pyx_t_8epitopsy_6cython_12optimize_dca_DTYPE_float_t, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack) == -1)) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 248; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  }
  __pyx_pybuffernd_Pi.diminfo[0].strides = __pyx_pybuffernd_Pi.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_Pi.diminfo[0].shape = __pyx_pybuffernd_Pi.rcbuffer-&gt;pybuffer.shape[0]; __pyx_pybuffernd_Pi.diminfo[1].strides = __pyx_pybuffernd_Pi.rcbuffer-&gt;pybuffer.strides[1]; __pyx_pybuffernd_Pi.diminfo[1].shape = __pyx_pybuffernd_Pi.rcbuffer-&gt;pybuffer.shape[1];
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_Pij_true.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_v_Pij_true, &amp;__Pyx_TypeInfo_nn___pyx_t_8epitopsy_6cython_12optimize_dca_DTYPE_float_t, PyBUF_FORMAT| PyBUF_STRIDES, 4, 0, __pyx_stack) == -1)) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 248; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  }
  __pyx_pybuffernd_Pij_true.diminfo[0].strides = __pyx_pybuffernd_Pij_true.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_Pij_true.diminfo[0].shape = __pyx_pybuffernd_Pij_true.rcbuffer-&gt;pybuffer.shape[0]; __pyx_pybuffernd_Pij_true.diminfo[1].strides = __pyx_pybuffernd_Pij_true.rcbuffer-&gt;pybuffer.strides[1]; __pyx_pybuffernd_Pij_true.diminfo[1].shape = __pyx_pybuffernd_Pij_true.rcbuffer-&gt;pybuffer.shape[1]; __pyx_pybuffernd_Pij_true.diminfo[2].strides = __pyx_pybuffernd_Pij_true.rcbuffer-&gt;pybuffer.strides[2]; __pyx_pybuffernd_Pij_true.diminfo[2].shape = __pyx_pybuffernd_Pij_true.rcbuffer-&gt;pybuffer.shape[2]; __pyx_pybuffernd_Pij_true.diminfo[3].strides = __pyx_pybuffernd_Pij_true.rcbuffer-&gt;pybuffer.strides[3]; __pyx_pybuffernd_Pij_true.diminfo[3].shape = __pyx_pybuffernd_Pij_true.rcbuffer-&gt;pybuffer.shape[3];
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_Pi_true.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_v_Pi_true, &amp;__Pyx_TypeInfo_nn___pyx_t_8epitopsy_6cython_12optimize_dca_DTYPE_float_t, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack) == -1)) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 248; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  }
  __pyx_pybuffernd_Pi_true.diminfo[0].strides = __pyx_pybuffernd_Pi_true.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_Pi_true.diminfo[0].shape = __pyx_pybuffernd_Pi_true.rcbuffer-&gt;pybuffer.shape[0]; __pyx_pybuffernd_Pi_true.diminfo[1].strides = __pyx_pybuffernd_Pi_true.rcbuffer-&gt;pybuffer.strides[1]; __pyx_pybuffernd_Pi_true.diminfo[1].shape = __pyx_pybuffernd_Pi_true.rcbuffer-&gt;pybuffer.shape[1];
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_invC.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_v_invC, &amp;__Pyx_TypeInfo_nn___pyx_t_8epitopsy_6cython_12optimize_dca_DTYPE_float_t, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack) == -1)) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 248; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  }
  __pyx_pybuffernd_invC.diminfo[0].strides = __pyx_pybuffernd_invC.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_invC.diminfo[0].shape = __pyx_pybuffernd_invC.rcbuffer-&gt;pybuffer.shape[0]; __pyx_pybuffernd_invC.diminfo[1].strides = __pyx_pybuffernd_invC.rcbuffer-&gt;pybuffer.strides[1]; __pyx_pybuffernd_invC.diminfo[1].shape = __pyx_pybuffernd_invC.rcbuffer-&gt;pybuffer.shape[1];
/* … */
  /* function exit code */
  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_6);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_7);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_8);
  { PyObject *__pyx_type, *__pyx_value, *__pyx_tb;
    <span class='pyx_c_api'>__Pyx_ErrFetch</span>(&amp;__pyx_type, &amp;__pyx_value, &amp;__pyx_tb);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_Pi.rcbuffer-&gt;pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_Pi_true.rcbuffer-&gt;pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_Pij.rcbuffer-&gt;pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_Pij_true.rcbuffer-&gt;pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_invC.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_ErrRestore</span>(__pyx_type, __pyx_value, __pyx_tb);}
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("epitopsy.cython.optimize_dca.Compute_Results", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = 0;
  goto __pyx_L2;
  __pyx_L0:;
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_Pi.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_Pi_true.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_Pij_true.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_invC.rcbuffer-&gt;pybuffer);
  __pyx_L2:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_output_list);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_MI_true);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_si_true);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_sj_true);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_W_mf);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_DI_mf_pc);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_f);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_item);
  <span class='refnanny'>__Pyx_XGIVEREF</span>(__pyx_r);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line249")'> 249:         np.ndarray[DTYPE_float_t, ndim=2] Pi,</pre>
<pre id='line249' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line250")'> 250:         np.ndarray[DTYPE_float_t, ndim=4] Pij_true,</pre>
<pre id='line250' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line251")'> 251:         np.ndarray[DTYPE_float_t, ndim=2] Pi_true,</pre>
<pre id='line251' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line252")'> 252:         np.ndarray[DTYPE_float_t, ndim=2] invC, int N, int q,</pre>
<pre id='line252' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line253")'> 253:         char* outputfile,</pre>
<pre id='line253' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line254")'> 254:         char* header_string):</pre>
<pre id='line254' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFaa' onclick='toggleDiv("line255")'> 255:     output_list = []</pre>
<pre id='line255' class='code' style='background-color: #FFFFaa'>  __pyx_t_1 = <span class='py_c_api'>PyList_New</span>(0);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 255; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_v_output_list = ((PyObject*)__pyx_t_1);
  __pyx_t_1 = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line256")'> 256: </pre>
<pre id='line256' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line257")'> 257:     cdef int i,j</pre>
<pre id='line257' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line258")'> 258: </pre>
<pre id='line258' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line259")'> 259:     for i in range(N-1):</pre>
<pre id='line259' class='code' style='background-color: #FFFFff'>  __pyx_t_2 = (__pyx_v_N - 1);
  for (__pyx_t_3 = 0; __pyx_t_3 &lt; __pyx_t_2; __pyx_t_3+=1) {
    __pyx_v_i = __pyx_t_3;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line260")'> 260:         for j in range(i+1, N):</pre>
<pre id='line260' class='code' style='background-color: #FFFFff'>    __pyx_t_4 = __pyx_v_N;
    for (__pyx_t_5 = (__pyx_v_i + 1); __pyx_t_5 &lt; __pyx_t_4; __pyx_t_5+=1) {
      __pyx_v_j = __pyx_t_5;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line261")'> 261:             ## mutual information</pre>
<pre id='line261' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF4b' onclick='toggleDiv("line262")'> 262:             MI_true, si_true, sj_true = calculate_mi(i,j,Pij_true, Pi_true, q)</pre>
<pre id='line262' class='code' style='background-color: #FFFF4b'>      __pyx_t_1 = __pyx_f_8epitopsy_6cython_12optimize_dca_calculate_mi(__pyx_v_i, __pyx_v_j, ((PyArrayObject *)__pyx_v_Pij_true), ((PyArrayObject *)__pyx_v_Pi_true), __pyx_v_q);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 262; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
      if (likely(__pyx_t_1 != Py_None)) {
        PyObject* sequence = __pyx_t_1;
        #if CYTHON_COMPILING_IN_CPYTHON
        Py_ssize_t size = Py_SIZE(sequence);
        #else
        Py_ssize_t size = <span class='py_c_api'>PySequence_Size</span>(sequence);
        #endif
        if (unlikely(size != 3)) {
          if (size &gt; 3) <span class='pyx_c_api'>__Pyx_RaiseTooManyValuesError</span>(3);
          else if (size &gt;= 0) <span class='pyx_c_api'>__Pyx_RaiseNeedMoreValuesError</span>(size);
          <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 262; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        }
        #if CYTHON_COMPILING_IN_CPYTHON
        __pyx_t_6 = <span class='py_macro_api'>PyList_GET_ITEM</span>(sequence, 0); 
        __pyx_t_7 = <span class='py_macro_api'>PyList_GET_ITEM</span>(sequence, 1); 
        __pyx_t_8 = <span class='py_macro_api'>PyList_GET_ITEM</span>(sequence, 2); 
        <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_6);
        <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_7);
        <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_8);
        #else
        __pyx_t_6 = <span class='py_macro_api'>PySequence_ITEM</span>(sequence, 0);<span class='error_goto'> if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 262; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
        __pyx_t_7 = <span class='py_macro_api'>PySequence_ITEM</span>(sequence, 1);<span class='error_goto'> if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 262; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
        __pyx_t_8 = <span class='py_macro_api'>PySequence_ITEM</span>(sequence, 2);<span class='error_goto'> if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 262; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
        #endif
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
      } else {
        <span class='pyx_c_api'>__Pyx_RaiseNoneNotIterableError</span>(); <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 262; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      }
      <span class='pyx_macro_api'>__Pyx_XDECREF_SET</span>(__pyx_v_MI_true, __pyx_t_6);
      __pyx_t_6 = 0;
      <span class='pyx_macro_api'>__Pyx_XDECREF_SET</span>(__pyx_v_si_true, __pyx_t_7);
      __pyx_t_7 = 0;
      <span class='pyx_macro_api'>__Pyx_XDECREF_SET</span>(__pyx_v_sj_true, __pyx_t_8);
      __pyx_t_8 = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line263")'> 263: </pre>
<pre id='line263' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line264")'> 264:             ## direct information</pre>
<pre id='line264' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFe7' onclick='toggleDiv("line265")'> 265:             W_mf = ReturnW(invC, i, j, q)</pre>
<pre id='line265' class='code' style='background-color: #FFFFe7'>      __pyx_t_1 = ((PyObject *)__pyx_f_8epitopsy_6cython_12optimize_dca_ReturnW(((PyArrayObject *)__pyx_v_invC), __pyx_v_i, __pyx_v_j, __pyx_v_q));<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 265; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
      <span class='pyx_macro_api'>__Pyx_XDECREF_SET</span>(__pyx_v_W_mf, ((PyArrayObject *)__pyx_t_1));
      __pyx_t_1 = 0;
</pre><pre class='line' style='background-color: #FFFF9f' onclick='toggleDiv("line266")'> 266:             DI_mf_pc = bp_link(i,j,W_mf,Pi,q)</pre>
<pre id='line266' class='code' style='background-color: #FFFF9f'>      __pyx_t_1 = <span class='py_c_api'>PyFloat_FromDouble</span>(__pyx_f_8epitopsy_6cython_12optimize_dca_bp_link(__pyx_v_i, __pyx_v_j, ((PyArrayObject *)__pyx_v_W_mf), ((PyArrayObject *)__pyx_v_Pi), __pyx_v_q));<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 266; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
      <span class='pyx_macro_api'>__Pyx_XDECREF_SET</span>(__pyx_v_DI_mf_pc, __pyx_t_1);
      __pyx_t_1 = 0;
</pre><pre class='line' style='background-color: #FFFF4b' onclick='toggleDiv("line267")'> 267:             output_list.append("{0} {1} {2} {3}\n".format(i+1,j+1, MI_true, DI_mf_pc)) # python arrays ...</pre>
<pre id='line267' class='code' style='background-color: #FFFF4b'>      __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_kp_s_0_1_2_3, __pyx_n_s_format);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 267; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
      __pyx_t_8 = <span class='pyx_c_api'>__Pyx_PyInt_From_long</span>((__pyx_v_i + 1));<span class='error_goto'> if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 267; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
      __pyx_t_7 = <span class='pyx_c_api'>__Pyx_PyInt_From_long</span>((__pyx_v_j + 1));<span class='error_goto'> if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 267; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
      __pyx_t_6 = <span class='py_c_api'>PyTuple_New</span>(4);<span class='error_goto'> if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 267; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
      <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_6, 0, __pyx_t_8);
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_8);
      <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_6, 1, __pyx_t_7);
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_7);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_MI_true);
      <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_6, 2, __pyx_v_MI_true);
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_v_MI_true);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_DI_mf_pc);
      <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_6, 3, __pyx_v_DI_mf_pc);
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_v_DI_mf_pc);
      __pyx_t_8 = 0;
      __pyx_t_7 = 0;
      __pyx_t_7 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_1, __pyx_t_6, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 267; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
      __pyx_t_9 = <span class='pyx_c_api'>__Pyx_PyList_Append</span>(__pyx_v_output_list, __pyx_t_7);<span class='error_goto'> if (unlikely(__pyx_t_9 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 267; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
    }
  }
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line268")'> 268: </pre>
<pre id='line268' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFaa' onclick='toggleDiv("line269")'> 269:     if outputfile.endswith('.gz'):</pre>
<pre id='line269' class='code' style='background-color: #FFFFaa'>  __pyx_t_7 = <span class='pyx_c_api'>__Pyx_PyBytes_FromString</span>(__pyx_v_outputfile);<span class='error_goto'> if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 269; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
  __pyx_t_10 = <span class='pyx_c_api'>__Pyx_PyBytes_Tailmatch</span>(__pyx_t_7, __pyx_kp_s_gz, 0, PY_SSIZE_T_MAX, 1);<span class='error_goto'> if (unlikely(__pyx_t_10 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 269; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
  if ((__pyx_t_10 != 0)) {
</pre><pre class='line' style='background-color: #FFFF57' onclick='toggleDiv("line270")'> 270:         f = gzip.open(outputfile, 'w')</pre>
<pre id='line270' class='code' style='background-color: #FFFF57'>    __pyx_t_7 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s_gzip);<span class='error_goto'> if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 270; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
    __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_7, __pyx_n_s_open);<span class='error_goto'> if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 270; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
    __pyx_t_7 = <span class='pyx_c_api'>__Pyx_PyBytes_FromString</span>(__pyx_v_outputfile);<span class='error_goto'> if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 270; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
    __pyx_t_1 = <span class='py_c_api'>PyTuple_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 270; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 0, __pyx_t_7);
    <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_7);
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_n_s_w);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 1, __pyx_n_s_w);
    <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_n_s_w);
    __pyx_t_7 = 0;
    __pyx_t_7 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_6, __pyx_t_1, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 270; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_v_f = __pyx_t_7;
    __pyx_t_7 = 0;
</pre><pre class='line' style='background-color: #FFFF52' onclick='toggleDiv("line271")'> 271:         f.write(header_string + "\n")</pre>
<pre id='line271' class='code' style='background-color: #FFFF52'>    __pyx_t_7 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_f, __pyx_n_s_write);<span class='error_goto'> if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 271; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
    __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyBytes_FromString</span>(__pyx_v_header_string);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 271; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
    __pyx_t_6 = <span class='py_c_api'>PyNumber_Add</span>(__pyx_t_1, __pyx_kp_s_);<span class='error_goto'> if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 271; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_1 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 271; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 0, __pyx_t_6);
    <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_6);
    __pyx_t_6 = 0;
    __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_7, __pyx_t_1, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 271; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
</pre><pre class='line' style='background-color: #FFFF79' onclick='toggleDiv("line272")'> 272:         f.write("i j mi di\n")</pre>
<pre id='line272' class='code' style='background-color: #FFFF79'>    __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_f, __pyx_n_s_write);<span class='error_goto'> if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 272; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
    __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_6, __pyx_tuple__2, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 272; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
/* … */
  __pyx_tuple__2 = <span class='py_c_api'>PyTuple_Pack</span>(1, __pyx_kp_s_i_j_mi_di);<span class='error_goto'> if (unlikely(!__pyx_tuple__2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 272; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_tuple__2);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_tuple__2);
</pre><pre class='line' style='background-color: #FFFF9f' onclick='toggleDiv("line273")'> 273:         for item in output_list:</pre>
<pre id='line273' class='code' style='background-color: #FFFF9f'>    __pyx_t_1 = __pyx_v_output_list; <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_1); __pyx_t_11 = 0;
    for (;;) {
      if (__pyx_t_11 &gt;= <span class='py_macro_api'>PyList_GET_SIZE</span>(__pyx_t_1)) break;
      #if CYTHON_COMPILING_IN_CPYTHON
      __pyx_t_6 = <span class='py_macro_api'>PyList_GET_ITEM</span>(__pyx_t_1, __pyx_t_11); <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_6); __pyx_t_11++;<span class='error_goto'> if (unlikely(0 &lt; 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 273; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      #else
      __pyx_t_6 = <span class='py_macro_api'>PySequence_ITEM</span>(__pyx_t_1, __pyx_t_11); __pyx_t_11++;<span class='error_goto'> if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 273; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      #endif
      <span class='pyx_macro_api'>__Pyx_XDECREF_SET</span>(__pyx_v_item, __pyx_t_6);
      __pyx_t_6 = 0;
</pre><pre class='line' style='background-color: #FFFF66' onclick='toggleDiv("line274")'> 274:             f.write(item)</pre>
<pre id='line274' class='code' style='background-color: #FFFF66'>      __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_f, __pyx_n_s_write);<span class='error_goto'> if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 274; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
      __pyx_t_7 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 274; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_item);
      <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_7, 0, __pyx_v_item);
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_v_item);
      __pyx_t_8 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_6, __pyx_t_7, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 274; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
    }
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
</pre><pre class='line' style='background-color: #FFFF9f' onclick='toggleDiv("line275")'> 275:         f.close()</pre>
<pre id='line275' class='code' style='background-color: #FFFF9f'>    __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_f, __pyx_n_s_close);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 275; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
    __pyx_t_8 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_1, __pyx_empty_tuple, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 275; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
    goto __pyx_L7;
  }
  /*else*/ {
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line276")'> 276:     else:</pre>
<pre id='line276' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF6e' onclick='toggleDiv("line277")'> 277:         f = open(outputfile, 'w')</pre>
<pre id='line277' class='code' style='background-color: #FFFF6e'>    __pyx_t_8 = <span class='pyx_c_api'>__Pyx_PyBytes_FromString</span>(__pyx_v_outputfile);<span class='error_goto'> if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 277; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
    __pyx_t_1 = <span class='py_c_api'>PyTuple_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 277; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 0, __pyx_t_8);
    <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_8);
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_n_s_w);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 1, __pyx_n_s_w);
    <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_n_s_w);
    __pyx_t_8 = 0;
    __pyx_t_8 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_builtin_open, __pyx_t_1, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 277; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_v_f = __pyx_t_8;
    __pyx_t_8 = 0;
</pre><pre class='line' style='background-color: #FFFF52' onclick='toggleDiv("line278")'> 278:         f.write(header_string + "\n")</pre>
<pre id='line278' class='code' style='background-color: #FFFF52'>    __pyx_t_8 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_f, __pyx_n_s_write);<span class='error_goto'> if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 278; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
    __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyBytes_FromString</span>(__pyx_v_header_string);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 278; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
    __pyx_t_7 = <span class='py_c_api'>PyNumber_Add</span>(__pyx_t_1, __pyx_kp_s_);<span class='error_goto'> if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 278; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_1 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 278; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 0, __pyx_t_7);
    <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_7);
    __pyx_t_7 = 0;
    __pyx_t_7 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_8, __pyx_t_1, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 278; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
</pre><pre class='line' style='background-color: #FFFF79' onclick='toggleDiv("line279")'> 279:         f.write("i j mi di\n")</pre>
<pre id='line279' class='code' style='background-color: #FFFF79'>    __pyx_t_7 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_f, __pyx_n_s_write);<span class='error_goto'> if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 279; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
    __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_7, __pyx_tuple__3, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 279; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
/* … */
  __pyx_tuple__3 = <span class='py_c_api'>PyTuple_Pack</span>(1, __pyx_kp_s_i_j_mi_di);<span class='error_goto'> if (unlikely(!__pyx_tuple__3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 279; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_tuple__3);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_tuple__3);
</pre><pre class='line' style='background-color: #FFFF9f' onclick='toggleDiv("line280")'> 280:         for item in output_list:</pre>
<pre id='line280' class='code' style='background-color: #FFFF9f'>    __pyx_t_1 = __pyx_v_output_list; <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_1); __pyx_t_11 = 0;
    for (;;) {
      if (__pyx_t_11 &gt;= <span class='py_macro_api'>PyList_GET_SIZE</span>(__pyx_t_1)) break;
      #if CYTHON_COMPILING_IN_CPYTHON
      __pyx_t_7 = <span class='py_macro_api'>PyList_GET_ITEM</span>(__pyx_t_1, __pyx_t_11); <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_7); __pyx_t_11++;<span class='error_goto'> if (unlikely(0 &lt; 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 280; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      #else
      __pyx_t_7 = <span class='py_macro_api'>PySequence_ITEM</span>(__pyx_t_1, __pyx_t_11); __pyx_t_11++;<span class='error_goto'> if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 280; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      #endif
      <span class='pyx_macro_api'>__Pyx_XDECREF_SET</span>(__pyx_v_item, __pyx_t_7);
      __pyx_t_7 = 0;
</pre><pre class='line' style='background-color: #FFFF66' onclick='toggleDiv("line281")'> 281:             f.write(item)</pre>
<pre id='line281' class='code' style='background-color: #FFFF66'>      __pyx_t_7 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_f, __pyx_n_s_write);<span class='error_goto'> if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 281; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
      __pyx_t_8 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 281; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_item);
      <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_8, 0, __pyx_v_item);
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_v_item);
      __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_7, __pyx_t_8, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 281; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
    }
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
</pre><pre class='line' style='background-color: #FFFF9f' onclick='toggleDiv("line282")'> 282:         f.close()</pre>
<pre id='line282' class='code' style='background-color: #FFFF9f'>    __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_f, __pyx_n_s_close);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 282; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
    __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_1, __pyx_empty_tuple, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 282; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
  }
  __pyx_L7:;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line283")'> 283: </pre>
<pre id='line283' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line284")'> 284: </pre>
<pre id='line284' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF52' onclick='toggleDiv("line285")'> 285: cdef np.ndarray ReturnW(np.ndarray[DTYPE_float_t, ndim=2] invC_np, int i,</pre>
<pre id='line285' class='code' style='background-color: #FFFF52'>static PyArrayObject *__pyx_f_8epitopsy_6cython_12optimize_dca_ReturnW(PyArrayObject *__pyx_v_invC_np, int __pyx_v_i, int __pyx_v_j, int __pyx_v_q) {
  PyArrayObject *__pyx_v_W_np = 0;
  __Pyx_memviewslice __pyx_v_W = { 0, 0, { 0 }, { 0 }, { 0 } };
  __Pyx_memviewslice __pyx_v_invC = { 0, 0, { 0 }, { 0 }, { 0 } };
  int __pyx_v_qm;
  int __pyx_v_qmi;
  int __pyx_v_qmj;
  int __pyx_v_qmia;
  int __pyx_v_alpha;
  int __pyx_v_beta;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_W_np;
  __Pyx_Buffer __pyx_pybuffer_W_np;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_invC_np;
  __Pyx_Buffer __pyx_pybuffer_invC_np;
  PyArrayObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("ReturnW", 0);
  __pyx_pybuffer_W_np.pybuffer.buf = NULL;
  __pyx_pybuffer_W_np.refcount = 0;
  __pyx_pybuffernd_W_np.data = NULL;
  __pyx_pybuffernd_W_np.rcbuffer = &amp;__pyx_pybuffer_W_np;
  __pyx_pybuffer_invC_np.pybuffer.buf = NULL;
  __pyx_pybuffer_invC_np.refcount = 0;
  __pyx_pybuffernd_invC_np.data = NULL;
  __pyx_pybuffernd_invC_np.rcbuffer = &amp;__pyx_pybuffer_invC_np;
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_invC_np.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_v_invC_np, &amp;__Pyx_TypeInfo_nn___pyx_t_8epitopsy_6cython_12optimize_dca_DTYPE_float_t, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack) == -1)) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 285; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  }
  __pyx_pybuffernd_invC_np.diminfo[0].strides = __pyx_pybuffernd_invC_np.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_invC_np.diminfo[0].shape = __pyx_pybuffernd_invC_np.rcbuffer-&gt;pybuffer.shape[0]; __pyx_pybuffernd_invC_np.diminfo[1].strides = __pyx_pybuffernd_invC_np.rcbuffer-&gt;pybuffer.strides[1]; __pyx_pybuffernd_invC_np.diminfo[1].shape = __pyx_pybuffernd_invC_np.rcbuffer-&gt;pybuffer.shape[1];
/* … */
  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_t_6, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_t_7, 1);
  { PyObject *__pyx_type, *__pyx_value, *__pyx_tb;
    <span class='pyx_c_api'>__Pyx_ErrFetch</span>(&amp;__pyx_type, &amp;__pyx_value, &amp;__pyx_tb);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_W_np.rcbuffer-&gt;pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_invC_np.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_ErrRestore</span>(__pyx_type, __pyx_value, __pyx_tb);}
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("epitopsy.cython.optimize_dca.ReturnW", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = 0;
  goto __pyx_L2;
  __pyx_L0:;
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_W_np.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_invC_np.rcbuffer-&gt;pybuffer);
  __pyx_L2:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_W_np);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_W, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_invC, 1);
  <span class='refnanny'>__Pyx_XGIVEREF</span>((PyObject *)__pyx_r);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line286")'> 286:         int j, int q):</pre>
<pre id='line286' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF3e' onclick='toggleDiv("line287")'> 287:     cdef np.ndarray[DTYPE_float_t, ndim=2] W_np = np.ones([q,q])</pre>
<pre id='line287' class='code' style='background-color: #FFFF3e'>  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 287; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_1, __pyx_n_s_ones);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 287; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_q);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 287; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_q);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 287; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  __pyx_t_4 = <span class='py_c_api'>PyList_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 287; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  <span class='py_macro_api'>PyList_SET_ITEM</span>(__pyx_t_4, 0, __pyx_t_1);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_1);
  <span class='py_macro_api'>PyList_SET_ITEM</span>(__pyx_t_4, 1, __pyx_t_3);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_3);
  __pyx_t_1 = 0;
  __pyx_t_3 = 0;
  __pyx_t_3 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 287; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_3, 0, __pyx_t_4);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_4);
  __pyx_t_4 = 0;
  __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_2, __pyx_t_3, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 287; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  if (!(likely(((__pyx_t_4) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_4, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 287; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_t_5 = ((PyArrayObject *)__pyx_t_4);
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_W_np.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_t_5, &amp;__Pyx_TypeInfo_nn___pyx_t_8epitopsy_6cython_12optimize_dca_DTYPE_float_t, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack) == -1)) {
      __pyx_v_W_np = ((PyArrayObject *)Py_None); <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None); __pyx_pybuffernd_W_np.rcbuffer-&gt;pybuffer.buf = NULL;
      <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 287; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    } else {__pyx_pybuffernd_W_np.diminfo[0].strides = __pyx_pybuffernd_W_np.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_W_np.diminfo[0].shape = __pyx_pybuffernd_W_np.rcbuffer-&gt;pybuffer.shape[0]; __pyx_pybuffernd_W_np.diminfo[1].strides = __pyx_pybuffernd_W_np.rcbuffer-&gt;pybuffer.strides[1]; __pyx_pybuffernd_W_np.diminfo[1].shape = __pyx_pybuffernd_W_np.rcbuffer-&gt;pybuffer.shape[1];
    }
  }
  __pyx_t_5 = 0;
  __pyx_v_W_np = ((PyArrayObject *)__pyx_t_4);
  __pyx_t_4 = 0;
</pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line288")'> 288:     cdef double[:,:] W = W_np</pre>
<pre id='line288' class='code' style='background-color: #FFFFd4'>  __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_dsds_double</span>(((PyObject *)__pyx_v_W_np));
  if (unlikely(!__pyx_t_6.memview)) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 288; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_v_W = __pyx_t_6;
  __pyx_t_6.memview = NULL;
  __pyx_t_6.data = NULL;
</pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line289")'> 289:     cdef double[:,:] invC = invC_np</pre>
<pre id='line289' class='code' style='background-color: #FFFFd4'>  __pyx_t_7 = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_dsds_double</span>(((PyObject *)__pyx_v_invC_np));
  if (unlikely(!__pyx_t_7.memview)) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 289; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_v_invC = __pyx_t_7;
  __pyx_t_7.memview = NULL;
  __pyx_t_7.data = NULL;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line290")'> 290:     cdef int qm = q-1</pre>
<pre id='line290' class='code' style='background-color: #FFFFff'>  __pyx_v_qm = (__pyx_v_q - 1);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line291")'> 291:     cdef int qmi = qm * (i-1)</pre>
<pre id='line291' class='code' style='background-color: #FFFFff'>  __pyx_v_qmi = (__pyx_v_qm * (__pyx_v_i - 1));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line292")'> 292:     cdef int qmj = qm * (j-1)</pre>
<pre id='line292' class='code' style='background-color: #FFFFff'>  __pyx_v_qmj = (__pyx_v_qm * (__pyx_v_j - 1));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line293")'> 293:     cdef int qmia</pre>
<pre id='line293' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line294")'> 294: </pre>
<pre id='line294' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line295")'> 295:     cdef int alpha,beta</pre>
<pre id='line295' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line296")'> 296: </pre>
<pre id='line296' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line297")'> 297:     for alpha in range(qm):</pre>
<pre id='line297' class='code' style='background-color: #FFFFff'>  __pyx_t_8 = __pyx_v_qm;
  for (__pyx_t_9 = 0; __pyx_t_9 &lt; __pyx_t_8; __pyx_t_9+=1) {
    __pyx_v_alpha = __pyx_t_9;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line298")'> 298:         qmia = qmi + alpha</pre>
<pre id='line298' class='code' style='background-color: #FFFFff'>    __pyx_v_qmia = (__pyx_v_qmi + __pyx_v_alpha);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line299")'> 299:         for beta in range(qm):</pre>
<pre id='line299' class='code' style='background-color: #FFFFff'>    __pyx_t_10 = __pyx_v_qm;
    for (__pyx_t_11 = 0; __pyx_t_11 &lt; __pyx_t_10; __pyx_t_11+=1) {
      __pyx_v_beta = __pyx_t_11;
</pre><pre class='line' style='background-color: #FFFFb6' onclick='toggleDiv("line300")'> 300:             W[alpha, beta] = exp(-invC[qmia, qmj+beta])</pre>
<pre id='line300' class='code' style='background-color: #FFFFb6'>      __pyx_t_12 = __pyx_v_qmia;
      __pyx_t_13 = (__pyx_v_qmj + __pyx_v_beta);
      __pyx_t_14 = -1;
      if (__pyx_t_12 &lt; 0) {
        __pyx_t_12 += __pyx_v_invC.shape[0];
        if (unlikely(__pyx_t_12 &lt; 0)) __pyx_t_14 = 0;
      } else if (unlikely(__pyx_t_12 &gt;= __pyx_v_invC.shape[0])) __pyx_t_14 = 0;
      if (__pyx_t_13 &lt; 0) {
        __pyx_t_13 += __pyx_v_invC.shape[1];
        if (unlikely(__pyx_t_13 &lt; 0)) __pyx_t_14 = 1;
      } else if (unlikely(__pyx_t_13 &gt;= __pyx_v_invC.shape[1])) __pyx_t_14 = 1;
      if (unlikely(__pyx_t_14 != -1)) {
        <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_14);
        <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 300; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      }
      __pyx_t_14 = __pyx_v_alpha;
      __pyx_t_15 = __pyx_v_beta;
      __pyx_t_16 = -1;
      if (__pyx_t_14 &lt; 0) {
        __pyx_t_14 += __pyx_v_W.shape[0];
        if (unlikely(__pyx_t_14 &lt; 0)) __pyx_t_16 = 0;
      } else if (unlikely(__pyx_t_14 &gt;= __pyx_v_W.shape[0])) __pyx_t_16 = 0;
      if (__pyx_t_15 &lt; 0) {
        __pyx_t_15 += __pyx_v_W.shape[1];
        if (unlikely(__pyx_t_15 &lt; 0)) __pyx_t_16 = 1;
      } else if (unlikely(__pyx_t_15 &gt;= __pyx_v_W.shape[1])) __pyx_t_16 = 1;
      if (unlikely(__pyx_t_16 != -1)) {
        <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_16);
        <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 300; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      }
      *((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_W.data + __pyx_t_14 * __pyx_v_W.strides[0]) ) + __pyx_t_15 * __pyx_v_W.strides[1]) )) = exp((-(*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_invC.data + __pyx_t_12 * __pyx_v_invC.strides[0]) ) + __pyx_t_13 * __pyx_v_invC.strides[1]) )))));
    }
  }
</pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line301")'> 301:     return W_np</pre>
<pre id='line301' class='code' style='background-color: #FFFFd4'>  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(((PyObject *)__pyx_r));
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_v_W_np));
  __pyx_r = ((PyArrayObject *)__pyx_v_W_np);
  goto __pyx_L0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line302")'> 302: </pre>
<pre id='line302' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF4b' onclick='toggleDiv("line303")'> 303: cdef float bp_link(int i,int j, np.ndarray[DTYPE_float_t, ndim=2] W_mf,</pre>
<pre id='line303' class='code' style='background-color: #FFFF4b'>static float __pyx_f_8epitopsy_6cython_12optimize_dca_bp_link(int __pyx_v_i, int __pyx_v_j, PyArrayObject *__pyx_v_W_mf, PyArrayObject *__pyx_v_Pi, int __pyx_v_q) {
  PyObject *__pyx_v_mu1 = NULL;
  PyObject *__pyx_v_mu2 = NULL;
  PyObject *__pyx_v_DI = NULL;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_Pi;
  __Pyx_Buffer __pyx_pybuffer_Pi;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_W_mf;
  __Pyx_Buffer __pyx_pybuffer_W_mf;
  float __pyx_r;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("bp_link", 0);
  __pyx_pybuffer_W_mf.pybuffer.buf = NULL;
  __pyx_pybuffer_W_mf.refcount = 0;
  __pyx_pybuffernd_W_mf.data = NULL;
  __pyx_pybuffernd_W_mf.rcbuffer = &amp;__pyx_pybuffer_W_mf;
  __pyx_pybuffer_Pi.pybuffer.buf = NULL;
  __pyx_pybuffer_Pi.refcount = 0;
  __pyx_pybuffernd_Pi.data = NULL;
  __pyx_pybuffernd_Pi.rcbuffer = &amp;__pyx_pybuffer_Pi;
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_W_mf.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_v_W_mf, &amp;__Pyx_TypeInfo_nn___pyx_t_8epitopsy_6cython_12optimize_dca_DTYPE_float_t, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack) == -1)) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 303; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  }
  __pyx_pybuffernd_W_mf.diminfo[0].strides = __pyx_pybuffernd_W_mf.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_W_mf.diminfo[0].shape = __pyx_pybuffernd_W_mf.rcbuffer-&gt;pybuffer.shape[0]; __pyx_pybuffernd_W_mf.diminfo[1].strides = __pyx_pybuffernd_W_mf.rcbuffer-&gt;pybuffer.strides[1]; __pyx_pybuffernd_W_mf.diminfo[1].shape = __pyx_pybuffernd_W_mf.rcbuffer-&gt;pybuffer.shape[1];
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_Pi.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_v_Pi, &amp;__Pyx_TypeInfo_nn___pyx_t_8epitopsy_6cython_12optimize_dca_DTYPE_float_t, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack) == -1)) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 303; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  }
  __pyx_pybuffernd_Pi.diminfo[0].strides = __pyx_pybuffernd_Pi.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_Pi.diminfo[0].shape = __pyx_pybuffernd_Pi.rcbuffer-&gt;pybuffer.shape[0]; __pyx_pybuffernd_Pi.diminfo[1].strides = __pyx_pybuffernd_Pi.rcbuffer-&gt;pybuffer.strides[1]; __pyx_pybuffernd_Pi.diminfo[1].shape = __pyx_pybuffernd_Pi.rcbuffer-&gt;pybuffer.shape[1];
/* … */
  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  { PyObject *__pyx_type, *__pyx_value, *__pyx_tb;
    <span class='pyx_c_api'>__Pyx_ErrFetch</span>(&amp;__pyx_type, &amp;__pyx_value, &amp;__pyx_tb);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_Pi.rcbuffer-&gt;pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_W_mf.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_ErrRestore</span>(__pyx_type, __pyx_value, __pyx_tb);}
  <span class='pyx_c_api'>__Pyx_WriteUnraisable</span>("epitopsy.cython.optimize_dca.bp_link", __pyx_clineno, __pyx_lineno, __pyx_filename, 0);
  __pyx_r = 0;
  goto __pyx_L2;
  __pyx_L0:;
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_Pi.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_W_mf.rcbuffer-&gt;pybuffer);
  __pyx_L2:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_mu1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_mu2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_DI);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line304")'> 304:         np.ndarray[DTYPE_float_t, ndim=2] Pi, int q):</pre>
<pre id='line304' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF5b' onclick='toggleDiv("line305")'> 305:     [mu1, mu2] = compute_mu(i,j,W_mf,Pi,q)</pre>
<pre id='line305' class='code' style='background-color: #FFFF5b'>  __pyx_t_1 = __pyx_f_8epitopsy_6cython_12optimize_dca_compute_mu(__pyx_v_i, __pyx_v_j, ((PyArrayObject *)__pyx_v_W_mf), ((PyArrayObject *)__pyx_v_Pi), __pyx_v_q);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 305; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  if (likely(__pyx_t_1 != Py_None)) {
    PyObject* sequence = __pyx_t_1;
    #if CYTHON_COMPILING_IN_CPYTHON
    Py_ssize_t size = Py_SIZE(sequence);
    #else
    Py_ssize_t size = <span class='py_c_api'>PySequence_Size</span>(sequence);
    #endif
    if (unlikely(size != 2)) {
      if (size &gt; 2) <span class='pyx_c_api'>__Pyx_RaiseTooManyValuesError</span>(2);
      else if (size &gt;= 0) <span class='pyx_c_api'>__Pyx_RaiseNeedMoreValuesError</span>(size);
      <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 305; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    }
    #if CYTHON_COMPILING_IN_CPYTHON
    __pyx_t_2 = <span class='py_macro_api'>PyList_GET_ITEM</span>(sequence, 0); 
    __pyx_t_3 = <span class='py_macro_api'>PyList_GET_ITEM</span>(sequence, 1); 
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_2);
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_3);
    #else
    __pyx_t_2 = <span class='py_macro_api'>PySequence_ITEM</span>(sequence, 0);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 305; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
    __pyx_t_3 = <span class='py_macro_api'>PySequence_ITEM</span>(sequence, 1);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 305; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
    #endif
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  } else {
    <span class='pyx_c_api'>__Pyx_RaiseNoneNotIterableError</span>(); <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 305; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  }
  __pyx_v_mu1 = __pyx_t_2;
  __pyx_t_2 = 0;
  __pyx_v_mu2 = __pyx_t_3;
  __pyx_t_3 = 0;
</pre><pre class='line' style='background-color: #FFFF86' onclick='toggleDiv("line306")'> 306:     DI = compute_di(i,j,W_mf, mu1,mu2,Pi)</pre>
<pre id='line306' class='code' style='background-color: #FFFF86'>  if (!(likely(((__pyx_v_mu1) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_v_mu1, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 306; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  if (!(likely(((__pyx_v_mu2) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_v_mu2, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 306; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_t_1 = <span class='py_c_api'>PyFloat_FromDouble</span>(__pyx_f_8epitopsy_6cython_12optimize_dca_compute_di(__pyx_v_i, __pyx_v_j, ((PyArrayObject *)__pyx_v_W_mf), ((PyArrayObject *)__pyx_v_mu1), ((PyArrayObject *)__pyx_v_mu2), ((PyArrayObject *)__pyx_v_Pi)));<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 306; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_v_DI = __pyx_t_1;
  __pyx_t_1 = 0;
</pre><pre class='line' style='background-color: #FFFFaa' onclick='toggleDiv("line307")'> 307:     return DI</pre>
<pre id='line307' class='code' style='background-color: #FFFFaa'>  __pyx_t_4 = __pyx_<span class='py_c_api'>PyFloat_AsFloat</span>(__pyx_v_DI);<span class='error_goto'> if (unlikely((__pyx_t_4 == (float)-1) &amp;&amp; PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 307; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_r = __pyx_t_4;
  goto __pyx_L0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line308")'> 308: </pre>
<pre id='line308' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF22' onclick='toggleDiv("line309")'> 309: cdef list compute_mu(int i, int j, np.ndarray[DTYPE_float_t, ndim=2] W,</pre>
<pre id='line309' class='code' style='background-color: #FFFF22'>static PyObject *__pyx_f_8epitopsy_6cython_12optimize_dca_compute_mu(int __pyx_v_i, int __pyx_v_j, PyArrayObject *__pyx_v_W, PyArrayObject *__pyx_v_Pi, int __pyx_v_q) {
  float __pyx_v_epsilon;
  float __pyx_v_diff;
  float __pyx_v_q_float;
  PyArrayObject *__pyx_v_mu1 = 0;
  PyArrayObject *__pyx_v_mu2 = 0;
  PyArrayObject *__pyx_v_pi = 0;
  PyArrayObject *__pyx_v_pj = 0;
  PyArrayObject *__pyx_v_new1 = 0;
  PyArrayObject *__pyx_v_new2 = 0;
  PyArrayObject *__pyx_v_scra1 = 0;
  PyArrayObject *__pyx_v_scra2 = 0;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_Pi;
  __Pyx_Buffer __pyx_pybuffer_Pi;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_W;
  __Pyx_Buffer __pyx_pybuffer_W;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_mu1;
  __Pyx_Buffer __pyx_pybuffer_mu1;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_mu2;
  __Pyx_Buffer __pyx_pybuffer_mu2;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_new1;
  __Pyx_Buffer __pyx_pybuffer_new1;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_new2;
  __Pyx_Buffer __pyx_pybuffer_new2;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_pi;
  __Pyx_Buffer __pyx_pybuffer_pi;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_pj;
  __Pyx_Buffer __pyx_pybuffer_pj;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_scra1;
  __Pyx_Buffer __pyx_pybuffer_scra1;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_scra2;
  __Pyx_Buffer __pyx_pybuffer_scra2;
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("compute_mu", 0);
  __pyx_pybuffer_mu1.pybuffer.buf = NULL;
  __pyx_pybuffer_mu1.refcount = 0;
  __pyx_pybuffernd_mu1.data = NULL;
  __pyx_pybuffernd_mu1.rcbuffer = &amp;__pyx_pybuffer_mu1;
  __pyx_pybuffer_mu2.pybuffer.buf = NULL;
  __pyx_pybuffer_mu2.refcount = 0;
  __pyx_pybuffernd_mu2.data = NULL;
  __pyx_pybuffernd_mu2.rcbuffer = &amp;__pyx_pybuffer_mu2;
  __pyx_pybuffer_pi.pybuffer.buf = NULL;
  __pyx_pybuffer_pi.refcount = 0;
  __pyx_pybuffernd_pi.data = NULL;
  __pyx_pybuffernd_pi.rcbuffer = &amp;__pyx_pybuffer_pi;
  __pyx_pybuffer_pj.pybuffer.buf = NULL;
  __pyx_pybuffer_pj.refcount = 0;
  __pyx_pybuffernd_pj.data = NULL;
  __pyx_pybuffernd_pj.rcbuffer = &amp;__pyx_pybuffer_pj;
  __pyx_pybuffer_new1.pybuffer.buf = NULL;
  __pyx_pybuffer_new1.refcount = 0;
  __pyx_pybuffernd_new1.data = NULL;
  __pyx_pybuffernd_new1.rcbuffer = &amp;__pyx_pybuffer_new1;
  __pyx_pybuffer_new2.pybuffer.buf = NULL;
  __pyx_pybuffer_new2.refcount = 0;
  __pyx_pybuffernd_new2.data = NULL;
  __pyx_pybuffernd_new2.rcbuffer = &amp;__pyx_pybuffer_new2;
  __pyx_pybuffer_scra1.pybuffer.buf = NULL;
  __pyx_pybuffer_scra1.refcount = 0;
  __pyx_pybuffernd_scra1.data = NULL;
  __pyx_pybuffernd_scra1.rcbuffer = &amp;__pyx_pybuffer_scra1;
  __pyx_pybuffer_scra2.pybuffer.buf = NULL;
  __pyx_pybuffer_scra2.refcount = 0;
  __pyx_pybuffernd_scra2.data = NULL;
  __pyx_pybuffernd_scra2.rcbuffer = &amp;__pyx_pybuffer_scra2;
  __pyx_pybuffer_W.pybuffer.buf = NULL;
  __pyx_pybuffer_W.refcount = 0;
  __pyx_pybuffernd_W.data = NULL;
  __pyx_pybuffernd_W.rcbuffer = &amp;__pyx_pybuffer_W;
  __pyx_pybuffer_Pi.pybuffer.buf = NULL;
  __pyx_pybuffer_Pi.refcount = 0;
  __pyx_pybuffernd_Pi.data = NULL;
  __pyx_pybuffernd_Pi.rcbuffer = &amp;__pyx_pybuffer_Pi;
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_W.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_v_W, &amp;__Pyx_TypeInfo_nn___pyx_t_8epitopsy_6cython_12optimize_dca_DTYPE_float_t, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack) == -1)) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 309; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  }
  __pyx_pybuffernd_W.diminfo[0].strides = __pyx_pybuffernd_W.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_W.diminfo[0].shape = __pyx_pybuffernd_W.rcbuffer-&gt;pybuffer.shape[0]; __pyx_pybuffernd_W.diminfo[1].strides = __pyx_pybuffernd_W.rcbuffer-&gt;pybuffer.strides[1]; __pyx_pybuffernd_W.diminfo[1].shape = __pyx_pybuffernd_W.rcbuffer-&gt;pybuffer.shape[1];
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_Pi.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_v_Pi, &amp;__Pyx_TypeInfo_nn___pyx_t_8epitopsy_6cython_12optimize_dca_DTYPE_float_t, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack) == -1)) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 309; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  }
  __pyx_pybuffernd_Pi.diminfo[0].strides = __pyx_pybuffernd_Pi.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_Pi.diminfo[0].shape = __pyx_pybuffernd_Pi.rcbuffer-&gt;pybuffer.shape[0]; __pyx_pybuffernd_Pi.diminfo[1].strides = __pyx_pybuffernd_Pi.rcbuffer-&gt;pybuffer.strides[1]; __pyx_pybuffernd_Pi.diminfo[1].shape = __pyx_pybuffernd_Pi.rcbuffer-&gt;pybuffer.shape[1];
/* … */
  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_9);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_18);
  { PyObject *__pyx_type, *__pyx_value, *__pyx_tb;
    <span class='pyx_c_api'>__Pyx_ErrFetch</span>(&amp;__pyx_type, &amp;__pyx_value, &amp;__pyx_tb);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_Pi.rcbuffer-&gt;pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_W.rcbuffer-&gt;pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_mu1.rcbuffer-&gt;pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_mu2.rcbuffer-&gt;pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_new1.rcbuffer-&gt;pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_new2.rcbuffer-&gt;pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_pi.rcbuffer-&gt;pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_pj.rcbuffer-&gt;pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_scra1.rcbuffer-&gt;pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_scra2.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_ErrRestore</span>(__pyx_type, __pyx_value, __pyx_tb);}
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("epitopsy.cython.optimize_dca.compute_mu", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = 0;
  goto __pyx_L2;
  __pyx_L0:;
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_Pi.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_W.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_mu1.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_mu2.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_new1.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_new2.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_pi.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_pj.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_scra1.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_scra2.rcbuffer-&gt;pybuffer);
  __pyx_L2:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_mu1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_mu2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_pi);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_pj);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_new1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_new2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_scra1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_scra2);
  <span class='refnanny'>__Pyx_XGIVEREF</span>(__pyx_r);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line310")'> 310:         np.ndarray[DTYPE_float_t, ndim=2] Pi, int q):</pre>
<pre id='line310' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line311")'> 311:     cdef float epsilon = 1e-4</pre>
<pre id='line311' class='code' style='background-color: #FFFFff'>  __pyx_v_epsilon = 1e-4;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line312")'> 312:     cdef float diff = 1.0</pre>
<pre id='line312' class='code' style='background-color: #FFFFff'>  __pyx_v_diff = 1.0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line313")'> 313:     cdef float q_float = &lt;float&gt; q</pre>
<pre id='line313' class='code' style='background-color: #FFFFff'>  __pyx_v_q_float = ((float)__pyx_v_q);
</pre><pre class='line' style='background-color: #FFFF3e' onclick='toggleDiv("line314")'> 314:     cdef np.ndarray[DTYPE_float_t, ndim=1] mu1 = np.ones(q)/q_float</pre>
<pre id='line314' class='code' style='background-color: #FFFF3e'>  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 314; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_1, __pyx_n_s_ones);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 314; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_q);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 314; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_t_3 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 314; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_3, 0, __pyx_t_1);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_1);
  __pyx_t_1 = 0;
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_2, __pyx_t_3, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 314; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_3 = <span class='py_c_api'>PyFloat_FromDouble</span>(__pyx_v_q_float);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 314; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyNumber_Divide</span>(__pyx_t_1, __pyx_t_3);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 314; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  if (!(likely(((__pyx_t_2) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_2, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 314; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_t_4 = ((PyArrayObject *)__pyx_t_2);
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_mu1.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_t_4, &amp;__Pyx_TypeInfo_nn___pyx_t_8epitopsy_6cython_12optimize_dca_DTYPE_float_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) {
      __pyx_v_mu1 = ((PyArrayObject *)Py_None); <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None); __pyx_pybuffernd_mu1.rcbuffer-&gt;pybuffer.buf = NULL;
      <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 314; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    } else {__pyx_pybuffernd_mu1.diminfo[0].strides = __pyx_pybuffernd_mu1.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_mu1.diminfo[0].shape = __pyx_pybuffernd_mu1.rcbuffer-&gt;pybuffer.shape[0];
    }
  }
  __pyx_t_4 = 0;
  __pyx_v_mu1 = ((PyArrayObject *)__pyx_t_2);
  __pyx_t_2 = 0;
</pre><pre class='line' style='background-color: #FFFF3e' onclick='toggleDiv("line315")'> 315:     cdef np.ndarray[DTYPE_float_t, ndim=1] mu2 = np.ones(q)/q_float</pre>
<pre id='line315' class='code' style='background-color: #FFFF3e'>  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 315; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_2, __pyx_n_s_ones);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 315; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_q);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 315; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  __pyx_t_1 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 315; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 0, __pyx_t_2);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_2);
  __pyx_t_2 = 0;
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_3, __pyx_t_1, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 315; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = <span class='py_c_api'>PyFloat_FromDouble</span>(__pyx_v_q_float);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 315; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyNumber_Divide</span>(__pyx_t_2, __pyx_t_1);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 315; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  if (!(likely(((__pyx_t_3) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_3, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 315; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_t_5 = ((PyArrayObject *)__pyx_t_3);
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_mu2.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_t_5, &amp;__Pyx_TypeInfo_nn___pyx_t_8epitopsy_6cython_12optimize_dca_DTYPE_float_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) {
      __pyx_v_mu2 = ((PyArrayObject *)Py_None); <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None); __pyx_pybuffernd_mu2.rcbuffer-&gt;pybuffer.buf = NULL;
      <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 315; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    } else {__pyx_pybuffernd_mu2.diminfo[0].strides = __pyx_pybuffernd_mu2.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_mu2.diminfo[0].shape = __pyx_pybuffernd_mu2.rcbuffer-&gt;pybuffer.shape[0];
    }
  }
  __pyx_t_5 = 0;
  __pyx_v_mu2 = ((PyArrayObject *)__pyx_t_3);
  __pyx_t_3 = 0;
</pre><pre class='line' style='background-color: #FFFF46' onclick='toggleDiv("line316")'> 316:     cdef np.ndarray[DTYPE_float_t, ndim=1] pi = Pi[i,:]</pre>
<pre id='line316' class='code' style='background-color: #FFFF46'>  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_i);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 316; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  __pyx_t_1 = <span class='py_c_api'>PyTuple_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 316; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 0, __pyx_t_3);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_slice__4);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 1, __pyx_slice__4);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_slice__4);
  __pyx_t_3 = 0;
  __pyx_t_3 = <span class='py_c_api'>PyObject_GetItem</span>(((PyObject *)__pyx_v_Pi), __pyx_t_1);<span class='error_goto'> if (unlikely(__pyx_t_3 == NULL)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 316; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>;
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  if (!(likely(((__pyx_t_3) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_3, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 316; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_t_6 = ((PyArrayObject *)__pyx_t_3);
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_pi.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_t_6, &amp;__Pyx_TypeInfo_nn___pyx_t_8epitopsy_6cython_12optimize_dca_DTYPE_float_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) {
      __pyx_v_pi = ((PyArrayObject *)Py_None); <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None); __pyx_pybuffernd_pi.rcbuffer-&gt;pybuffer.buf = NULL;
      <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 316; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    } else {__pyx_pybuffernd_pi.diminfo[0].strides = __pyx_pybuffernd_pi.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_pi.diminfo[0].shape = __pyx_pybuffernd_pi.rcbuffer-&gt;pybuffer.shape[0];
    }
  }
  __pyx_t_6 = 0;
  __pyx_v_pi = ((PyArrayObject *)__pyx_t_3);
  __pyx_t_3 = 0;
/* … */
  __pyx_slice__4 = <span class='py_c_api'>PySlice_New</span>(Py_None, Py_None, Py_None);<span class='error_goto'> if (unlikely(!__pyx_slice__4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 316; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_slice__4);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_slice__4);
</pre><pre class='line' style='background-color: #FFFF46' onclick='toggleDiv("line317")'> 317:     cdef np.ndarray[DTYPE_float_t, ndim=1] pj = Pi[j,:]</pre>
<pre id='line317' class='code' style='background-color: #FFFF46'>  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_j);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 317; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  __pyx_t_1 = <span class='py_c_api'>PyTuple_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 317; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 0, __pyx_t_3);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_slice__5);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 1, __pyx_slice__5);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_slice__5);
  __pyx_t_3 = 0;
  __pyx_t_3 = <span class='py_c_api'>PyObject_GetItem</span>(((PyObject *)__pyx_v_Pi), __pyx_t_1);<span class='error_goto'> if (unlikely(__pyx_t_3 == NULL)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 317; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>;
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  if (!(likely(((__pyx_t_3) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_3, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 317; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_t_7 = ((PyArrayObject *)__pyx_t_3);
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_pj.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_t_7, &amp;__Pyx_TypeInfo_nn___pyx_t_8epitopsy_6cython_12optimize_dca_DTYPE_float_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) {
      __pyx_v_pj = ((PyArrayObject *)Py_None); <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None); __pyx_pybuffernd_pj.rcbuffer-&gt;pybuffer.buf = NULL;
      <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 317; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    } else {__pyx_pybuffernd_pj.diminfo[0].strides = __pyx_pybuffernd_pj.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_pj.diminfo[0].shape = __pyx_pybuffernd_pj.rcbuffer-&gt;pybuffer.shape[0];
    }
  }
  __pyx_t_7 = 0;
  __pyx_v_pj = ((PyArrayObject *)__pyx_t_3);
  __pyx_t_3 = 0;
/* … */
  __pyx_slice__5 = <span class='py_c_api'>PySlice_New</span>(Py_None, Py_None, Py_None);<span class='error_goto'> if (unlikely(!__pyx_slice__5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 317; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_slice__5);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_slice__5);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line318")'> 318:     cdef np.ndarray[DTYPE_float_t, ndim=1] new1</pre>
<pre id='line318' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line319")'> 319:     cdef np.ndarray[DTYPE_float_t, ndim=1] new2</pre>
<pre id='line319' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line320")'> 320:     cdef np.ndarray[DTYPE_float_t, ndim=1] scra1</pre>
<pre id='line320' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line321")'> 321:     cdef np.ndarray[DTYPE_float_t, ndim=1] scra2</pre>
<pre id='line321' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line322")'> 322: </pre>
<pre id='line322' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line323")'> 323:     while diff &gt; epsilon:</pre>
<pre id='line323' class='code' style='background-color: #FFFFff'>  while (1) {
    __pyx_t_8 = ((__pyx_v_diff &gt; __pyx_v_epsilon) != 0);
    if (!__pyx_t_8) break;
</pre><pre class='line' style='background-color: #FFFF27' onclick='toggleDiv("line324")'> 324:         scra1 = np.dot(mu2, np.transpose(W))</pre>
<pre id='line324' class='code' style='background-color: #FFFF27'>    __pyx_t_3 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 324; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
    __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_3, __pyx_n_s_dot);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 324; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
    __pyx_t_3 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 324; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
    __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_3, __pyx_n_s_transpose);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 324; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
    __pyx_t_3 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 324; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_v_W));
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_3, 0, ((PyObject *)__pyx_v_W));
    <span class='refnanny'>__Pyx_GIVEREF</span>(((PyObject *)__pyx_v_W));
    __pyx_t_9 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_2, __pyx_t_3, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 324; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_9);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
    __pyx_t_3 = <span class='py_c_api'>PyTuple_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 324; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_v_mu2));
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_3, 0, ((PyObject *)__pyx_v_mu2));
    <span class='refnanny'>__Pyx_GIVEREF</span>(((PyObject *)__pyx_v_mu2));
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_3, 1, __pyx_t_9);
    <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_9);
    __pyx_t_9 = 0;
    __pyx_t_9 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_1, __pyx_t_3, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 324; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_9);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
    if (!(likely(((__pyx_t_9) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_9, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 324; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    __pyx_t_10 = ((PyArrayObject *)__pyx_t_9);
    {
      __Pyx_BufFmt_StackElem __pyx_stack[1];
      <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_scra1.rcbuffer-&gt;pybuffer);
      __pyx_t_11 = <span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_scra1.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_t_10, &amp;__Pyx_TypeInfo_nn___pyx_t_8epitopsy_6cython_12optimize_dca_DTYPE_float_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack);
      if (unlikely(__pyx_t_11 &lt; 0)) {
        <span class='py_c_api'>PyErr_Fetch</span>(&amp;__pyx_t_12, &amp;__pyx_t_13, &amp;__pyx_t_14);
        if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_scra1.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_v_scra1, &amp;__Pyx_TypeInfo_nn___pyx_t_8epitopsy_6cython_12optimize_dca_DTYPE_float_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) {
          Py_XDECREF(__pyx_t_12); Py_XDECREF(__pyx_t_13); Py_XDECREF(__pyx_t_14);
          <span class='pyx_c_api'>__Pyx_RaiseBufferFallbackError</span>();
        } else {
          <span class='py_c_api'>PyErr_Restore</span>(__pyx_t_12, __pyx_t_13, __pyx_t_14);
        }
      }
      __pyx_pybuffernd_scra1.diminfo[0].strides = __pyx_pybuffernd_scra1.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_scra1.diminfo[0].shape = __pyx_pybuffernd_scra1.rcbuffer-&gt;pybuffer.shape[0];
      if (unlikely(__pyx_t_11 &lt; 0)) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 324; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    }
    __pyx_t_10 = 0;
    <span class='pyx_macro_api'>__Pyx_XDECREF_SET</span>(__pyx_v_scra1, ((PyArrayObject *)__pyx_t_9));
    __pyx_t_9 = 0;
</pre><pre class='line' style='background-color: #FFFF34' onclick='toggleDiv("line325")'> 325:         scra2 = np.dot(mu1, W)</pre>
<pre id='line325' class='code' style='background-color: #FFFF34'>    __pyx_t_9 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 325; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_9);
    __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_9, __pyx_n_s_dot);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 325; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_9); __pyx_t_9 = 0;
    __pyx_t_9 = <span class='py_c_api'>PyTuple_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 325; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_9);
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_v_mu1));
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_9, 0, ((PyObject *)__pyx_v_mu1));
    <span class='refnanny'>__Pyx_GIVEREF</span>(((PyObject *)__pyx_v_mu1));
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_v_W));
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_9, 1, ((PyObject *)__pyx_v_W));
    <span class='refnanny'>__Pyx_GIVEREF</span>(((PyObject *)__pyx_v_W));
    __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_3, __pyx_t_9, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 325; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_9); __pyx_t_9 = 0;
    if (!(likely(((__pyx_t_1) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_1, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 325; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    __pyx_t_15 = ((PyArrayObject *)__pyx_t_1);
    {
      __Pyx_BufFmt_StackElem __pyx_stack[1];
      <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_scra2.rcbuffer-&gt;pybuffer);
      __pyx_t_11 = <span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_scra2.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_t_15, &amp;__Pyx_TypeInfo_nn___pyx_t_8epitopsy_6cython_12optimize_dca_DTYPE_float_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack);
      if (unlikely(__pyx_t_11 &lt; 0)) {
        <span class='py_c_api'>PyErr_Fetch</span>(&amp;__pyx_t_14, &amp;__pyx_t_13, &amp;__pyx_t_12);
        if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_scra2.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_v_scra2, &amp;__Pyx_TypeInfo_nn___pyx_t_8epitopsy_6cython_12optimize_dca_DTYPE_float_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) {
          Py_XDECREF(__pyx_t_14); Py_XDECREF(__pyx_t_13); Py_XDECREF(__pyx_t_12);
          <span class='pyx_c_api'>__Pyx_RaiseBufferFallbackError</span>();
        } else {
          <span class='py_c_api'>PyErr_Restore</span>(__pyx_t_14, __pyx_t_13, __pyx_t_12);
        }
      }
      __pyx_pybuffernd_scra2.diminfo[0].strides = __pyx_pybuffernd_scra2.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_scra2.diminfo[0].shape = __pyx_pybuffernd_scra2.rcbuffer-&gt;pybuffer.shape[0];
      if (unlikely(__pyx_t_11 &lt; 0)) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 325; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    }
    __pyx_t_15 = 0;
    <span class='pyx_macro_api'>__Pyx_XDECREF_SET</span>(__pyx_v_scra2, ((PyArrayObject *)__pyx_t_1));
    __pyx_t_1 = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line326")'> 326: </pre>
<pre id='line326' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF4d' onclick='toggleDiv("line327")'> 327:         new1 = pi / scra1</pre>
<pre id='line327' class='code' style='background-color: #FFFF4d'>    __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyNumber_Divide</span>(((PyObject *)__pyx_v_pi), ((PyObject *)__pyx_v_scra1));<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 327; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
    if (!(likely(((__pyx_t_1) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_1, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 327; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    __pyx_t_16 = ((PyArrayObject *)__pyx_t_1);
    {
      __Pyx_BufFmt_StackElem __pyx_stack[1];
      <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_new1.rcbuffer-&gt;pybuffer);
      __pyx_t_11 = <span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_new1.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_t_16, &amp;__Pyx_TypeInfo_nn___pyx_t_8epitopsy_6cython_12optimize_dca_DTYPE_float_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack);
      if (unlikely(__pyx_t_11 &lt; 0)) {
        <span class='py_c_api'>PyErr_Fetch</span>(&amp;__pyx_t_12, &amp;__pyx_t_13, &amp;__pyx_t_14);
        if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_new1.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_v_new1, &amp;__Pyx_TypeInfo_nn___pyx_t_8epitopsy_6cython_12optimize_dca_DTYPE_float_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) {
          Py_XDECREF(__pyx_t_12); Py_XDECREF(__pyx_t_13); Py_XDECREF(__pyx_t_14);
          <span class='pyx_c_api'>__Pyx_RaiseBufferFallbackError</span>();
        } else {
          <span class='py_c_api'>PyErr_Restore</span>(__pyx_t_12, __pyx_t_13, __pyx_t_14);
        }
      }
      __pyx_pybuffernd_new1.diminfo[0].strides = __pyx_pybuffernd_new1.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_new1.diminfo[0].shape = __pyx_pybuffernd_new1.rcbuffer-&gt;pybuffer.shape[0];
      if (unlikely(__pyx_t_11 &lt; 0)) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 327; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    }
    __pyx_t_16 = 0;
    <span class='pyx_macro_api'>__Pyx_XDECREF_SET</span>(__pyx_v_new1, ((PyArrayObject *)__pyx_t_1));
    __pyx_t_1 = 0;
</pre><pre class='line' style='background-color: #FFFF33' onclick='toggleDiv("line328")'> 328:         new1 = new1 / np.sum(new1)</pre>
<pre id='line328' class='code' style='background-color: #FFFF33'>    __pyx_t_1 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 328; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
    __pyx_t_9 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_1, __pyx_n_s_sum);<span class='error_goto'> if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 328; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_9);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_1 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 328; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_v_new1));
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 0, ((PyObject *)__pyx_v_new1));
    <span class='refnanny'>__Pyx_GIVEREF</span>(((PyObject *)__pyx_v_new1));
    __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_9, __pyx_t_1, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 328; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_9); __pyx_t_9 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyNumber_Divide</span>(((PyObject *)__pyx_v_new1), __pyx_t_3);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 328; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
    if (!(likely(((__pyx_t_1) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_1, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 328; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    __pyx_t_16 = ((PyArrayObject *)__pyx_t_1);
    {
      __Pyx_BufFmt_StackElem __pyx_stack[1];
      <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_new1.rcbuffer-&gt;pybuffer);
      __pyx_t_11 = <span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_new1.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_t_16, &amp;__Pyx_TypeInfo_nn___pyx_t_8epitopsy_6cython_12optimize_dca_DTYPE_float_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack);
      if (unlikely(__pyx_t_11 &lt; 0)) {
        <span class='py_c_api'>PyErr_Fetch</span>(&amp;__pyx_t_14, &amp;__pyx_t_13, &amp;__pyx_t_12);
        if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_new1.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_v_new1, &amp;__Pyx_TypeInfo_nn___pyx_t_8epitopsy_6cython_12optimize_dca_DTYPE_float_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) {
          Py_XDECREF(__pyx_t_14); Py_XDECREF(__pyx_t_13); Py_XDECREF(__pyx_t_12);
          <span class='pyx_c_api'>__Pyx_RaiseBufferFallbackError</span>();
        } else {
          <span class='py_c_api'>PyErr_Restore</span>(__pyx_t_14, __pyx_t_13, __pyx_t_12);
        }
      }
      __pyx_pybuffernd_new1.diminfo[0].strides = __pyx_pybuffernd_new1.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_new1.diminfo[0].shape = __pyx_pybuffernd_new1.rcbuffer-&gt;pybuffer.shape[0];
      if (unlikely(__pyx_t_11 &lt; 0)) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 328; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    }
    __pyx_t_16 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_v_new1, ((PyArrayObject *)__pyx_t_1));
    __pyx_t_1 = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line329")'> 329: </pre>
<pre id='line329' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF4d' onclick='toggleDiv("line330")'> 330:         new2 = pj / scra2</pre>
<pre id='line330' class='code' style='background-color: #FFFF4d'>    __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyNumber_Divide</span>(((PyObject *)__pyx_v_pj), ((PyObject *)__pyx_v_scra2));<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 330; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
    if (!(likely(((__pyx_t_1) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_1, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 330; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    __pyx_t_17 = ((PyArrayObject *)__pyx_t_1);
    {
      __Pyx_BufFmt_StackElem __pyx_stack[1];
      <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_new2.rcbuffer-&gt;pybuffer);
      __pyx_t_11 = <span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_new2.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_t_17, &amp;__Pyx_TypeInfo_nn___pyx_t_8epitopsy_6cython_12optimize_dca_DTYPE_float_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack);
      if (unlikely(__pyx_t_11 &lt; 0)) {
        <span class='py_c_api'>PyErr_Fetch</span>(&amp;__pyx_t_12, &amp;__pyx_t_13, &amp;__pyx_t_14);
        if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_new2.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_v_new2, &amp;__Pyx_TypeInfo_nn___pyx_t_8epitopsy_6cython_12optimize_dca_DTYPE_float_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) {
          Py_XDECREF(__pyx_t_12); Py_XDECREF(__pyx_t_13); Py_XDECREF(__pyx_t_14);
          <span class='pyx_c_api'>__Pyx_RaiseBufferFallbackError</span>();
        } else {
          <span class='py_c_api'>PyErr_Restore</span>(__pyx_t_12, __pyx_t_13, __pyx_t_14);
        }
      }
      __pyx_pybuffernd_new2.diminfo[0].strides = __pyx_pybuffernd_new2.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_new2.diminfo[0].shape = __pyx_pybuffernd_new2.rcbuffer-&gt;pybuffer.shape[0];
      if (unlikely(__pyx_t_11 &lt; 0)) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 330; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    }
    __pyx_t_17 = 0;
    <span class='pyx_macro_api'>__Pyx_XDECREF_SET</span>(__pyx_v_new2, ((PyArrayObject *)__pyx_t_1));
    __pyx_t_1 = 0;
</pre><pre class='line' style='background-color: #FFFF33' onclick='toggleDiv("line331")'> 331:         new2 = new2 / np.sum(new2)</pre>
<pre id='line331' class='code' style='background-color: #FFFF33'>    __pyx_t_1 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 331; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
    __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_1, __pyx_n_s_sum);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 331; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_1 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 331; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_v_new2));
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 0, ((PyObject *)__pyx_v_new2));
    <span class='refnanny'>__Pyx_GIVEREF</span>(((PyObject *)__pyx_v_new2));
    __pyx_t_9 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_3, __pyx_t_1, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 331; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_9);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyNumber_Divide</span>(((PyObject *)__pyx_v_new2), __pyx_t_9);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 331; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_9); __pyx_t_9 = 0;
    if (!(likely(((__pyx_t_1) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_1, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 331; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    __pyx_t_17 = ((PyArrayObject *)__pyx_t_1);
    {
      __Pyx_BufFmt_StackElem __pyx_stack[1];
      <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_new2.rcbuffer-&gt;pybuffer);
      __pyx_t_11 = <span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_new2.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_t_17, &amp;__Pyx_TypeInfo_nn___pyx_t_8epitopsy_6cython_12optimize_dca_DTYPE_float_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack);
      if (unlikely(__pyx_t_11 &lt; 0)) {
        <span class='py_c_api'>PyErr_Fetch</span>(&amp;__pyx_t_14, &amp;__pyx_t_13, &amp;__pyx_t_12);
        if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_new2.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_v_new2, &amp;__Pyx_TypeInfo_nn___pyx_t_8epitopsy_6cython_12optimize_dca_DTYPE_float_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) {
          Py_XDECREF(__pyx_t_14); Py_XDECREF(__pyx_t_13); Py_XDECREF(__pyx_t_12);
          <span class='pyx_c_api'>__Pyx_RaiseBufferFallbackError</span>();
        } else {
          <span class='py_c_api'>PyErr_Restore</span>(__pyx_t_14, __pyx_t_13, __pyx_t_12);
        }
      }
      __pyx_pybuffernd_new2.diminfo[0].strides = __pyx_pybuffernd_new2.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_new2.diminfo[0].shape = __pyx_pybuffernd_new2.rcbuffer-&gt;pybuffer.shape[0];
      if (unlikely(__pyx_t_11 &lt; 0)) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 331; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    }
    __pyx_t_17 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_v_new2, ((PyArrayObject *)__pyx_t_1));
    __pyx_t_1 = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line332")'> 332: </pre>
<pre id='line332' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF20' onclick='toggleDiv("line333")'> 333:         diff = np.max([np.abs(new1-mu1), np.abs(new2-mu2)])</pre>
<pre id='line333' class='code' style='background-color: #FFFF20'>    __pyx_t_1 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 333; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
    __pyx_t_9 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_1, __pyx_n_s_max);<span class='error_goto'> if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 333; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_9);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_1 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 333; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
    __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_1, __pyx_n_s_abs);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 333; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_1 = <span class='py_c_api'>PyNumber_Subtract</span>(((PyObject *)__pyx_v_new1), ((PyObject *)__pyx_v_mu1));<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 333; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
    __pyx_t_2 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 333; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_2, 0, __pyx_t_1);
    <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_1);
    __pyx_t_1 = 0;
    __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_3, __pyx_t_2, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 333; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_t_2 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 333; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
    __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_2, __pyx_n_s_abs);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 333; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_t_2 = <span class='py_c_api'>PyNumber_Subtract</span>(((PyObject *)__pyx_v_new2), ((PyObject *)__pyx_v_mu2));<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 333; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
    __pyx_t_18 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_18)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 333; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_18);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_18, 0, __pyx_t_2);
    <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_2);
    __pyx_t_2 = 0;
    __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_3, __pyx_t_18, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 333; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_18); __pyx_t_18 = 0;
    __pyx_t_18 = <span class='py_c_api'>PyList_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_18)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 333; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_18);
    <span class='py_macro_api'>PyList_SET_ITEM</span>(__pyx_t_18, 0, __pyx_t_1);
    <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_1);
    <span class='py_macro_api'>PyList_SET_ITEM</span>(__pyx_t_18, 1, __pyx_t_2);
    <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_2);
    __pyx_t_1 = 0;
    __pyx_t_2 = 0;
    __pyx_t_2 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 333; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_2, 0, __pyx_t_18);
    <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_18);
    __pyx_t_18 = 0;
    __pyx_t_18 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_9, __pyx_t_2, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_18)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 333; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_18);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_9); __pyx_t_9 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_t_19 = __pyx_<span class='py_c_api'>PyFloat_AsFloat</span>(__pyx_t_18);<span class='error_goto'> if (unlikely((__pyx_t_19 == (float)-1) &amp;&amp; PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 333; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_18); __pyx_t_18 = 0;
    __pyx_v_diff = __pyx_t_19;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line334")'> 334: </pre>
<pre id='line334' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF55' onclick='toggleDiv("line335")'> 335:         mu1 = new1</pre>
<pre id='line335' class='code' style='background-color: #FFFF55'>    {
      __Pyx_BufFmt_StackElem __pyx_stack[1];
      <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_mu1.rcbuffer-&gt;pybuffer);
      __pyx_t_11 = <span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_mu1.rcbuffer-&gt;pybuffer, (PyObject*)((PyArrayObject *)__pyx_v_new1), &amp;__Pyx_TypeInfo_nn___pyx_t_8epitopsy_6cython_12optimize_dca_DTYPE_float_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack);
      if (unlikely(__pyx_t_11 &lt; 0)) {
        <span class='py_c_api'>PyErr_Fetch</span>(&amp;__pyx_t_12, &amp;__pyx_t_13, &amp;__pyx_t_14);
        if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_mu1.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_v_mu1, &amp;__Pyx_TypeInfo_nn___pyx_t_8epitopsy_6cython_12optimize_dca_DTYPE_float_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) {
          Py_XDECREF(__pyx_t_12); Py_XDECREF(__pyx_t_13); Py_XDECREF(__pyx_t_14);
          <span class='pyx_c_api'>__Pyx_RaiseBufferFallbackError</span>();
        } else {
          <span class='py_c_api'>PyErr_Restore</span>(__pyx_t_12, __pyx_t_13, __pyx_t_14);
        }
      }
      __pyx_pybuffernd_mu1.diminfo[0].strides = __pyx_pybuffernd_mu1.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_mu1.diminfo[0].shape = __pyx_pybuffernd_mu1.rcbuffer-&gt;pybuffer.shape[0];
      if (unlikely(__pyx_t_11 &lt; 0)) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 335; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    }
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_v_new1));
    <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_v_mu1, ((PyArrayObject *)__pyx_v_new1));
</pre><pre class='line' style='background-color: #FFFF55' onclick='toggleDiv("line336")'> 336:         mu2 = new2</pre>
<pre id='line336' class='code' style='background-color: #FFFF55'>    {
      __Pyx_BufFmt_StackElem __pyx_stack[1];
      <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_mu2.rcbuffer-&gt;pybuffer);
      __pyx_t_11 = <span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_mu2.rcbuffer-&gt;pybuffer, (PyObject*)((PyArrayObject *)__pyx_v_new2), &amp;__Pyx_TypeInfo_nn___pyx_t_8epitopsy_6cython_12optimize_dca_DTYPE_float_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack);
      if (unlikely(__pyx_t_11 &lt; 0)) {
        <span class='py_c_api'>PyErr_Fetch</span>(&amp;__pyx_t_14, &amp;__pyx_t_13, &amp;__pyx_t_12);
        if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_mu2.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_v_mu2, &amp;__Pyx_TypeInfo_nn___pyx_t_8epitopsy_6cython_12optimize_dca_DTYPE_float_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) {
          Py_XDECREF(__pyx_t_14); Py_XDECREF(__pyx_t_13); Py_XDECREF(__pyx_t_12);
          <span class='pyx_c_api'>__Pyx_RaiseBufferFallbackError</span>();
        } else {
          <span class='py_c_api'>PyErr_Restore</span>(__pyx_t_14, __pyx_t_13, __pyx_t_12);
        }
      }
      __pyx_pybuffernd_mu2.diminfo[0].strides = __pyx_pybuffernd_mu2.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_mu2.diminfo[0].shape = __pyx_pybuffernd_mu2.rcbuffer-&gt;pybuffer.shape[0];
      if (unlikely(__pyx_t_11 &lt; 0)) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 336; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    }
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_v_new2));
    <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_v_mu2, ((PyArrayObject *)__pyx_v_new2));
  }
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line337")'> 337: </pre>
<pre id='line337' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF7f' onclick='toggleDiv("line338")'> 338:     return [mu1, mu2]</pre>
<pre id='line338' class='code' style='background-color: #FFFF7f'>  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
  __pyx_t_18 = <span class='py_c_api'>PyList_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_18)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 338; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_18);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_v_mu1));
  <span class='py_macro_api'>PyList_SET_ITEM</span>(__pyx_t_18, 0, ((PyObject *)__pyx_v_mu1));
  <span class='refnanny'>__Pyx_GIVEREF</span>(((PyObject *)__pyx_v_mu1));
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_v_mu2));
  <span class='py_macro_api'>PyList_SET_ITEM</span>(__pyx_t_18, 1, ((PyObject *)__pyx_v_mu2));
  <span class='refnanny'>__Pyx_GIVEREF</span>(((PyObject *)__pyx_v_mu2));
  __pyx_r = ((PyObject*)__pyx_t_18);
  __pyx_t_18 = 0;
  goto __pyx_L0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line339")'> 339: </pre>
<pre id='line339' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF33' onclick='toggleDiv("line340")'> 340: cdef float compute_di(int i, int j, np.ndarray[DTYPE_float_t, ndim=2] W,</pre>
<pre id='line340' class='code' style='background-color: #FFFF33'>static float __pyx_f_8epitopsy_6cython_12optimize_dca_compute_di(int __pyx_v_i, int __pyx_v_j, PyArrayObject *__pyx_v_W, PyArrayObject *__pyx_v_mu1, PyArrayObject *__pyx_v_mu2, PyArrayObject *__pyx_v_Pi) {
  double __pyx_v_tiny;
  PyObject *__pyx_v_Pdir = NULL;
  PyObject *__pyx_v_Pfac = NULL;
  PyObject *__pyx_v_DI = NULL;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_Pi;
  __Pyx_Buffer __pyx_pybuffer_Pi;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_W;
  __Pyx_Buffer __pyx_pybuffer_W;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_mu1;
  __Pyx_Buffer __pyx_pybuffer_mu1;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_mu2;
  __Pyx_Buffer __pyx_pybuffer_mu2;
  float __pyx_r;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("compute_di", 0);
  __pyx_pybuffer_W.pybuffer.buf = NULL;
  __pyx_pybuffer_W.refcount = 0;
  __pyx_pybuffernd_W.data = NULL;
  __pyx_pybuffernd_W.rcbuffer = &amp;__pyx_pybuffer_W;
  __pyx_pybuffer_mu1.pybuffer.buf = NULL;
  __pyx_pybuffer_mu1.refcount = 0;
  __pyx_pybuffernd_mu1.data = NULL;
  __pyx_pybuffernd_mu1.rcbuffer = &amp;__pyx_pybuffer_mu1;
  __pyx_pybuffer_mu2.pybuffer.buf = NULL;
  __pyx_pybuffer_mu2.refcount = 0;
  __pyx_pybuffernd_mu2.data = NULL;
  __pyx_pybuffernd_mu2.rcbuffer = &amp;__pyx_pybuffer_mu2;
  __pyx_pybuffer_Pi.pybuffer.buf = NULL;
  __pyx_pybuffer_Pi.refcount = 0;
  __pyx_pybuffernd_Pi.data = NULL;
  __pyx_pybuffernd_Pi.rcbuffer = &amp;__pyx_pybuffer_Pi;
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_W.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_v_W, &amp;__Pyx_TypeInfo_nn___pyx_t_8epitopsy_6cython_12optimize_dca_DTYPE_float_t, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack) == -1)) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 340; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  }
  __pyx_pybuffernd_W.diminfo[0].strides = __pyx_pybuffernd_W.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_W.diminfo[0].shape = __pyx_pybuffernd_W.rcbuffer-&gt;pybuffer.shape[0]; __pyx_pybuffernd_W.diminfo[1].strides = __pyx_pybuffernd_W.rcbuffer-&gt;pybuffer.strides[1]; __pyx_pybuffernd_W.diminfo[1].shape = __pyx_pybuffernd_W.rcbuffer-&gt;pybuffer.shape[1];
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_mu1.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_v_mu1, &amp;__Pyx_TypeInfo_nn___pyx_t_8epitopsy_6cython_12optimize_dca_DTYPE_float_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 340; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  }
  __pyx_pybuffernd_mu1.diminfo[0].strides = __pyx_pybuffernd_mu1.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_mu1.diminfo[0].shape = __pyx_pybuffernd_mu1.rcbuffer-&gt;pybuffer.shape[0];
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_mu2.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_v_mu2, &amp;__Pyx_TypeInfo_nn___pyx_t_8epitopsy_6cython_12optimize_dca_DTYPE_float_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 340; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  }
  __pyx_pybuffernd_mu2.diminfo[0].strides = __pyx_pybuffernd_mu2.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_mu2.diminfo[0].shape = __pyx_pybuffernd_mu2.rcbuffer-&gt;pybuffer.shape[0];
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_Pi.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_v_Pi, &amp;__Pyx_TypeInfo_nn___pyx_t_8epitopsy_6cython_12optimize_dca_DTYPE_float_t, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack) == -1)) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 340; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  }
  __pyx_pybuffernd_Pi.diminfo[0].strides = __pyx_pybuffernd_Pi.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_Pi.diminfo[0].shape = __pyx_pybuffernd_Pi.rcbuffer-&gt;pybuffer.shape[0]; __pyx_pybuffernd_Pi.diminfo[1].strides = __pyx_pybuffernd_Pi.rcbuffer-&gt;pybuffer.strides[1]; __pyx_pybuffernd_Pi.diminfo[1].shape = __pyx_pybuffernd_Pi.rcbuffer-&gt;pybuffer.shape[1];
/* … */
  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_5);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_6);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_7);
  { PyObject *__pyx_type, *__pyx_value, *__pyx_tb;
    <span class='pyx_c_api'>__Pyx_ErrFetch</span>(&amp;__pyx_type, &amp;__pyx_value, &amp;__pyx_tb);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_Pi.rcbuffer-&gt;pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_W.rcbuffer-&gt;pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_mu1.rcbuffer-&gt;pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_mu2.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_ErrRestore</span>(__pyx_type, __pyx_value, __pyx_tb);}
  <span class='pyx_c_api'>__Pyx_WriteUnraisable</span>("epitopsy.cython.optimize_dca.compute_di", __pyx_clineno, __pyx_lineno, __pyx_filename, 0);
  __pyx_r = 0;
  goto __pyx_L2;
  __pyx_L0:;
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_Pi.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_W.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_mu1.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_mu2.rcbuffer-&gt;pybuffer);
  __pyx_L2:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_Pdir);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_Pfac);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_DI);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line341")'> 341:         np.ndarray[DTYPE_float_t, ndim=1] mu1,</pre>
<pre id='line341' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line342")'> 342:         np.ndarray[DTYPE_float_t, ndim=1] mu2,</pre>
<pre id='line342' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line343")'> 343:         np.ndarray[DTYPE_float_t, ndim=2] Pi):</pre>
<pre id='line343' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line344")'> 344:     tiny = 1.0e-100</pre>
<pre id='line344' class='code' style='background-color: #FFFFff'>  __pyx_v_tiny = 1.0e-100;
</pre><pre class='line' style='background-color: #FFFF31' onclick='toggleDiv("line345")'> 345:     Pdir = W * np.dot(mu1.reshape(-1,1),mu2.reshape(1,-1))</pre>
<pre id='line345' class='code' style='background-color: #FFFF31'>  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 345; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_1, __pyx_n_s_dot);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 345; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(((PyObject *)__pyx_v_mu1), __pyx_n_s_reshape);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 345; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_1, __pyx_tuple__6, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 345; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(((PyObject *)__pyx_v_mu2), __pyx_n_s_reshape);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 345; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
/* … */
  __pyx_tuple__6 = <span class='py_c_api'>PyTuple_Pack</span>(2, __pyx_int_neg_1, __pyx_int_1);<span class='error_goto'> if (unlikely(!__pyx_tuple__6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 345; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_tuple__6);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_tuple__6);
  __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_1, __pyx_tuple__7, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 345; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = <span class='py_c_api'>PyTuple_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 345; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 0, __pyx_t_3);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_3);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 1, __pyx_t_4);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_4);
  __pyx_t_3 = 0;
  __pyx_t_4 = 0;
  __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_2, __pyx_t_1, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 345; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = <span class='py_c_api'>PyNumber_Multiply</span>(((PyObject *)__pyx_v_W), __pyx_t_4);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 345; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_v_Pdir = __pyx_t_1;
  __pyx_t_1 = 0;
  __pyx_tuple__7 = <span class='py_c_api'>PyTuple_Pack</span>(2, __pyx_int_1, __pyx_int_neg_1);<span class='error_goto'> if (unlikely(!__pyx_tuple__7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 345; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_tuple__7);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_tuple__7);
</pre><pre class='line' style='background-color: #FFFF55' onclick='toggleDiv("line346")'> 346:     Pdir = Pdir / np.sum(Pdir)</pre>
<pre id='line346' class='code' style='background-color: #FFFF55'>  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 346; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_1, __pyx_n_s_sum);<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 346; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 346; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_Pdir);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 0, __pyx_v_Pdir);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_v_Pdir);
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_4, __pyx_t_1, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 346; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyNumber_Divide</span>(__pyx_v_Pdir, __pyx_t_2);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 346; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_v_Pdir, __pyx_t_1);
  __pyx_t_1 = 0;
</pre><pre class='line' style='background-color: #FFFF1c' onclick='toggleDiv("line347")'> 347:     Pfac = np.dot(Pi[i,:].reshape(-1,1), Pi[j,:].reshape(1,-1))</pre>
<pre id='line347' class='code' style='background-color: #FFFF1c'>  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 347; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_1, __pyx_n_s_dot);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 347; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_i);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 347; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_t_4 = <span class='py_c_api'>PyTuple_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 347; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_4, 0, __pyx_t_1);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_slice__8);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_4, 1, __pyx_slice__8);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_slice__8);
  __pyx_t_1 = 0;
  __pyx_t_1 = <span class='py_c_api'>PyObject_GetItem</span>(((PyObject *)__pyx_v_Pi), __pyx_t_4);<span class='error_goto'> if (unlikely(__pyx_t_1 == NULL)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 347; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>;
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_1, __pyx_n_s_reshape);<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 347; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
/* … */
  __pyx_slice__8 = <span class='py_c_api'>PySlice_New</span>(Py_None, Py_None, Py_None);<span class='error_goto'> if (unlikely(!__pyx_slice__8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 347; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_slice__8);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_slice__8);
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_4, __pyx_tuple__9, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 347; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_j);<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 347; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  __pyx_tuple__9 = <span class='py_c_api'>PyTuple_Pack</span>(2, __pyx_int_neg_1, __pyx_int_1);<span class='error_goto'> if (unlikely(!__pyx_tuple__9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 347; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_tuple__9);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_tuple__9);
  __pyx_t_3 = <span class='py_c_api'>PyTuple_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 347; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_3, 0, __pyx_t_4);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_slice__10);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_3, 1, __pyx_slice__10);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_slice__10);
  __pyx_t_4 = 0;
  __pyx_t_4 = <span class='py_c_api'>PyObject_GetItem</span>(((PyObject *)__pyx_v_Pi), __pyx_t_3);<span class='error_goto'> if (unlikely(__pyx_t_4 == NULL)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 347; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>;
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_4, __pyx_n_s_reshape);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 347; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_slice__10 = <span class='py_c_api'>PySlice_New</span>(Py_None, Py_None, Py_None);<span class='error_goto'> if (unlikely(!__pyx_slice__10)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 347; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_slice__10);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_slice__10);
  __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_3, __pyx_tuple__11, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 347; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_3 = <span class='py_c_api'>PyTuple_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 347; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_3, 0, __pyx_t_1);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_1);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_3, 1, __pyx_t_4);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_4);
  __pyx_t_1 = 0;
  __pyx_t_4 = 0;
  __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_2, __pyx_t_3, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 347; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_v_Pfac = __pyx_t_4;
  __pyx_t_4 = 0;
  __pyx_tuple__11 = <span class='py_c_api'>PyTuple_Pack</span>(2, __pyx_int_1, __pyx_int_neg_1);<span class='error_goto'> if (unlikely(!__pyx_tuple__11)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 347; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_tuple__11);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_tuple__11);
</pre><pre class='line' style='background-color: #FFFF1d' onclick='toggleDiv("line348")'> 348:     DI = np.trace( np.dot(Pdir.transpose(), np.log( (Pdir+tiny) / (Pfac+tiny))))</pre>
<pre id='line348' class='code' style='background-color: #FFFF1d'>  __pyx_t_4 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 348; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_4, __pyx_n_s_trace);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 348; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_t_4 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 348; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_4, __pyx_n_s_dot);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 348; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_Pdir, __pyx_n_s_transpose);<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 348; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_4, __pyx_empty_tuple, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 348; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_t_4 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 348; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_4, __pyx_n_s_log);<span class='error_goto'> if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 348; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_t_4 = <span class='py_c_api'>PyFloat_FromDouble</span>(__pyx_v_tiny);<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 348; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  __pyx_t_6 = <span class='py_c_api'>PyNumber_Add</span>(__pyx_v_Pdir, __pyx_t_4);<span class='error_goto'> if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 348; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_t_4 = <span class='py_c_api'>PyFloat_FromDouble</span>(__pyx_v_tiny);<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 348; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  __pyx_t_7 = <span class='py_c_api'>PyNumber_Add</span>(__pyx_v_Pfac, __pyx_t_4);<span class='error_goto'> if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 348; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyNumber_Divide</span>(__pyx_t_6, __pyx_t_7);<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 348; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
  __pyx_t_7 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 348; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_7, 0, __pyx_t_4);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_4);
  __pyx_t_4 = 0;
  __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_5, __pyx_t_7, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 348; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
  __pyx_t_7 = <span class='py_c_api'>PyTuple_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 348; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_7, 0, __pyx_t_1);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_1);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_7, 1, __pyx_t_4);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_4);
  __pyx_t_1 = 0;
  __pyx_t_4 = 0;
  __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_2, __pyx_t_7, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 348; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
  __pyx_t_7 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 348; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_7, 0, __pyx_t_4);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_4);
  __pyx_t_4 = 0;
  __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_3, __pyx_t_7, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 348; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
  __pyx_v_DI = __pyx_t_4;
  __pyx_t_4 = 0;
</pre><pre class='line' style='background-color: #FFFFaa' onclick='toggleDiv("line349")'> 349:     return DI</pre>
<pre id='line349' class='code' style='background-color: #FFFFaa'>  __pyx_t_8 = __pyx_<span class='py_c_api'>PyFloat_AsFloat</span>(__pyx_v_DI);<span class='error_goto'> if (unlikely((__pyx_t_8 == (float)-1) &amp;&amp; PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 349; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_r = __pyx_t_8;
  goto __pyx_L0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line350")'> 350: </pre>
<pre id='line350' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF4f' onclick='toggleDiv("line351")'> 351: cdef list calculate_mi(int i, int j, np.ndarray[DTYPE_float_t, ndim=4] P2_np,</pre>
<pre id='line351' class='code' style='background-color: #FFFF4f'>static PyObject *__pyx_f_8epitopsy_6cython_12optimize_dca_calculate_mi(int __pyx_v_i, int __pyx_v_j, PyArrayObject *__pyx_v_P2_np, PyArrayObject *__pyx_v_P1_np, int __pyx_v_q) {
  float __pyx_v_M;
  float __pyx_v_q_float;
  int __pyx_v_alpha;
  int __pyx_v_beta;
  __Pyx_memviewslice __pyx_v_P2 = { 0, 0, { 0 }, { 0 }, { 0 } };
  __Pyx_memviewslice __pyx_v_P1 = { 0, 0, { 0 }, { 0 }, { 0 } };
  float __pyx_v_s1;
  float __pyx_v_s2;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_P1_np;
  __Pyx_Buffer __pyx_pybuffer_P1_np;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_P2_np;
  __Pyx_Buffer __pyx_pybuffer_P2_np;
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("calculate_mi", 0);
  __pyx_pybuffer_P2_np.pybuffer.buf = NULL;
  __pyx_pybuffer_P2_np.refcount = 0;
  __pyx_pybuffernd_P2_np.data = NULL;
  __pyx_pybuffernd_P2_np.rcbuffer = &amp;__pyx_pybuffer_P2_np;
  __pyx_pybuffer_P1_np.pybuffer.buf = NULL;
  __pyx_pybuffer_P1_np.refcount = 0;
  __pyx_pybuffernd_P1_np.data = NULL;
  __pyx_pybuffernd_P1_np.rcbuffer = &amp;__pyx_pybuffer_P1_np;
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_P2_np.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_v_P2_np, &amp;__Pyx_TypeInfo_nn___pyx_t_8epitopsy_6cython_12optimize_dca_DTYPE_float_t, PyBUF_FORMAT| PyBUF_STRIDES, 4, 0, __pyx_stack) == -1)) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 351; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  }
  __pyx_pybuffernd_P2_np.diminfo[0].strides = __pyx_pybuffernd_P2_np.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_P2_np.diminfo[0].shape = __pyx_pybuffernd_P2_np.rcbuffer-&gt;pybuffer.shape[0]; __pyx_pybuffernd_P2_np.diminfo[1].strides = __pyx_pybuffernd_P2_np.rcbuffer-&gt;pybuffer.strides[1]; __pyx_pybuffernd_P2_np.diminfo[1].shape = __pyx_pybuffernd_P2_np.rcbuffer-&gt;pybuffer.shape[1]; __pyx_pybuffernd_P2_np.diminfo[2].strides = __pyx_pybuffernd_P2_np.rcbuffer-&gt;pybuffer.strides[2]; __pyx_pybuffernd_P2_np.diminfo[2].shape = __pyx_pybuffernd_P2_np.rcbuffer-&gt;pybuffer.shape[2]; __pyx_pybuffernd_P2_np.diminfo[3].strides = __pyx_pybuffernd_P2_np.rcbuffer-&gt;pybuffer.strides[3]; __pyx_pybuffernd_P2_np.diminfo[3].shape = __pyx_pybuffernd_P2_np.rcbuffer-&gt;pybuffer.shape[3];
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_P1_np.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_v_P1_np, &amp;__Pyx_TypeInfo_nn___pyx_t_8epitopsy_6cython_12optimize_dca_DTYPE_float_t, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack) == -1)) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 351; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  }
  __pyx_pybuffernd_P1_np.diminfo[0].strides = __pyx_pybuffernd_P1_np.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_P1_np.diminfo[0].shape = __pyx_pybuffernd_P1_np.rcbuffer-&gt;pybuffer.shape[0]; __pyx_pybuffernd_P1_np.diminfo[1].strides = __pyx_pybuffernd_P1_np.rcbuffer-&gt;pybuffer.strides[1]; __pyx_pybuffernd_P1_np.diminfo[1].shape = __pyx_pybuffernd_P1_np.rcbuffer-&gt;pybuffer.shape[1];
/* … */
  /* function exit code */
  __pyx_L1_error:;
  __PYX_XDEC_MEMVIEW(&amp;__pyx_t_1, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_t_2, 1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_38);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_39);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_40);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_41);
  { PyObject *__pyx_type, *__pyx_value, *__pyx_tb;
    <span class='pyx_c_api'>__Pyx_ErrFetch</span>(&amp;__pyx_type, &amp;__pyx_value, &amp;__pyx_tb);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_P1_np.rcbuffer-&gt;pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_P2_np.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_ErrRestore</span>(__pyx_type, __pyx_value, __pyx_tb);}
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("epitopsy.cython.optimize_dca.calculate_mi", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = 0;
  goto __pyx_L2;
  __pyx_L0:;
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_P1_np.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_P2_np.rcbuffer-&gt;pybuffer);
  __pyx_L2:;
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_P2, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_P1, 1);
  <span class='refnanny'>__Pyx_XGIVEREF</span>(__pyx_r);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line352")'> 352:         np.ndarray[DTYPE_float_t, ndim=2] P1_np, int q):</pre>
<pre id='line352' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line353")'> 353:     cdef float M = 0.</pre>
<pre id='line353' class='code' style='background-color: #FFFFff'>  __pyx_v_M = 0.;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line354")'> 354:     cdef float q_float = &lt;float&gt; q</pre>
<pre id='line354' class='code' style='background-color: #FFFFff'>  __pyx_v_q_float = ((float)__pyx_v_q);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line355")'> 355:     cdef int alpha, beta</pre>
<pre id='line355' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line356")'> 356: </pre>
<pre id='line356' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line357")'> 357:     # memory views</pre>
<pre id='line357' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line358")'> 358:     cdef double [:,:,:,:] P2 = P2_np</pre>
<pre id='line358' class='code' style='background-color: #FFFFd4'>  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_dsdsdsds_double</span>(((PyObject *)__pyx_v_P2_np));
  if (unlikely(!__pyx_t_1.memview)) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 358; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_v_P2 = __pyx_t_1;
  __pyx_t_1.memview = NULL;
  __pyx_t_1.data = NULL;
</pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line359")'> 359:     cdef double [:,:] P1 = P1_np</pre>
<pre id='line359' class='code' style='background-color: #FFFFd4'>  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_dsds_double</span>(((PyObject *)__pyx_v_P1_np));
  if (unlikely(!__pyx_t_2.memview)) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 359; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_v_P1 = __pyx_t_2;
  __pyx_t_2.memview = NULL;
  __pyx_t_2.data = NULL;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line360")'> 360: </pre>
<pre id='line360' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line361")'> 361:     for alpha in range(q):</pre>
<pre id='line361' class='code' style='background-color: #FFFFff'>  __pyx_t_3 = __pyx_v_q;
  for (__pyx_t_4 = 0; __pyx_t_4 &lt; __pyx_t_3; __pyx_t_4+=1) {
    __pyx_v_alpha = __pyx_t_4;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line362")'> 362:         for beta in range(q):</pre>
<pre id='line362' class='code' style='background-color: #FFFFff'>    __pyx_t_5 = __pyx_v_q;
    for (__pyx_t_6 = 0; __pyx_t_6 &lt; __pyx_t_5; __pyx_t_6+=1) {
      __pyx_v_beta = __pyx_t_6;
</pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line363")'> 363:             if P2[i,j,alpha, beta] &gt; 0:</pre>
<pre id='line363' class='code' style='background-color: #FFFFd4'>      __pyx_t_7 = __pyx_v_i;
      __pyx_t_8 = __pyx_v_j;
      __pyx_t_9 = __pyx_v_alpha;
      __pyx_t_10 = __pyx_v_beta;
      __pyx_t_11 = -1;
      if (__pyx_t_7 &lt; 0) {
        __pyx_t_7 += __pyx_v_P2.shape[0];
        if (unlikely(__pyx_t_7 &lt; 0)) __pyx_t_11 = 0;
      } else if (unlikely(__pyx_t_7 &gt;= __pyx_v_P2.shape[0])) __pyx_t_11 = 0;
      if (__pyx_t_8 &lt; 0) {
        __pyx_t_8 += __pyx_v_P2.shape[1];
        if (unlikely(__pyx_t_8 &lt; 0)) __pyx_t_11 = 1;
      } else if (unlikely(__pyx_t_8 &gt;= __pyx_v_P2.shape[1])) __pyx_t_11 = 1;
      if (__pyx_t_9 &lt; 0) {
        __pyx_t_9 += __pyx_v_P2.shape[2];
        if (unlikely(__pyx_t_9 &lt; 0)) __pyx_t_11 = 2;
      } else if (unlikely(__pyx_t_9 &gt;= __pyx_v_P2.shape[2])) __pyx_t_11 = 2;
      if (__pyx_t_10 &lt; 0) {
        __pyx_t_10 += __pyx_v_P2.shape[3];
        if (unlikely(__pyx_t_10 &lt; 0)) __pyx_t_11 = 3;
      } else if (unlikely(__pyx_t_10 &gt;= __pyx_v_P2.shape[3])) __pyx_t_11 = 3;
      if (unlikely(__pyx_t_11 != -1)) {
        <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_11);
        <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 363; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      }
      __pyx_t_12 = (((*((double *) ( /* dim=3 */ (( /* dim=2 */ (( /* dim=1 */ (( /* dim=0 */ (__pyx_v_P2.data + __pyx_t_7 * __pyx_v_P2.strides[0]) ) + __pyx_t_8 * __pyx_v_P2.strides[1]) ) + __pyx_t_9 * __pyx_v_P2.strides[2]) ) + __pyx_t_10 * __pyx_v_P2.strides[3]) ))) &gt; 0.0) != 0);
      if (__pyx_t_12) {
</pre><pre class='line' style='background-color: #FFFF4d' onclick='toggleDiv("line364")'> 364:                 M = M + P2[i,j,alpha,beta] * log(P2[i,j,alpha,beta] / P1[i,alpha] / P1[j,beta]) / log(q_float)</pre>
<pre id='line364' class='code' style='background-color: #FFFF4d'>        __pyx_t_11 = __pyx_v_i;
        __pyx_t_13 = __pyx_v_j;
        __pyx_t_14 = __pyx_v_alpha;
        __pyx_t_15 = __pyx_v_beta;
        __pyx_t_16 = -1;
        if (__pyx_t_11 &lt; 0) {
          __pyx_t_11 += __pyx_v_P2.shape[0];
          if (unlikely(__pyx_t_11 &lt; 0)) __pyx_t_16 = 0;
        } else if (unlikely(__pyx_t_11 &gt;= __pyx_v_P2.shape[0])) __pyx_t_16 = 0;
        if (__pyx_t_13 &lt; 0) {
          __pyx_t_13 += __pyx_v_P2.shape[1];
          if (unlikely(__pyx_t_13 &lt; 0)) __pyx_t_16 = 1;
        } else if (unlikely(__pyx_t_13 &gt;= __pyx_v_P2.shape[1])) __pyx_t_16 = 1;
        if (__pyx_t_14 &lt; 0) {
          __pyx_t_14 += __pyx_v_P2.shape[2];
          if (unlikely(__pyx_t_14 &lt; 0)) __pyx_t_16 = 2;
        } else if (unlikely(__pyx_t_14 &gt;= __pyx_v_P2.shape[2])) __pyx_t_16 = 2;
        if (__pyx_t_15 &lt; 0) {
          __pyx_t_15 += __pyx_v_P2.shape[3];
          if (unlikely(__pyx_t_15 &lt; 0)) __pyx_t_16 = 3;
        } else if (unlikely(__pyx_t_15 &gt;= __pyx_v_P2.shape[3])) __pyx_t_16 = 3;
        if (unlikely(__pyx_t_16 != -1)) {
          <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_16);
          <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 364; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        }
        __pyx_t_16 = __pyx_v_i;
        __pyx_t_17 = __pyx_v_j;
        __pyx_t_18 = __pyx_v_alpha;
        __pyx_t_19 = __pyx_v_beta;
        __pyx_t_20 = -1;
        if (__pyx_t_16 &lt; 0) {
          __pyx_t_16 += __pyx_v_P2.shape[0];
          if (unlikely(__pyx_t_16 &lt; 0)) __pyx_t_20 = 0;
        } else if (unlikely(__pyx_t_16 &gt;= __pyx_v_P2.shape[0])) __pyx_t_20 = 0;
        if (__pyx_t_17 &lt; 0) {
          __pyx_t_17 += __pyx_v_P2.shape[1];
          if (unlikely(__pyx_t_17 &lt; 0)) __pyx_t_20 = 1;
        } else if (unlikely(__pyx_t_17 &gt;= __pyx_v_P2.shape[1])) __pyx_t_20 = 1;
        if (__pyx_t_18 &lt; 0) {
          __pyx_t_18 += __pyx_v_P2.shape[2];
          if (unlikely(__pyx_t_18 &lt; 0)) __pyx_t_20 = 2;
        } else if (unlikely(__pyx_t_18 &gt;= __pyx_v_P2.shape[2])) __pyx_t_20 = 2;
        if (__pyx_t_19 &lt; 0) {
          __pyx_t_19 += __pyx_v_P2.shape[3];
          if (unlikely(__pyx_t_19 &lt; 0)) __pyx_t_20 = 3;
        } else if (unlikely(__pyx_t_19 &gt;= __pyx_v_P2.shape[3])) __pyx_t_20 = 3;
        if (unlikely(__pyx_t_20 != -1)) {
          <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_20);
          <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 364; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        }
        __pyx_t_21 = (*((double *) ( /* dim=3 */ (( /* dim=2 */ (( /* dim=1 */ (( /* dim=0 */ (__pyx_v_P2.data + __pyx_t_16 * __pyx_v_P2.strides[0]) ) + __pyx_t_17 * __pyx_v_P2.strides[1]) ) + __pyx_t_18 * __pyx_v_P2.strides[2]) ) + __pyx_t_19 * __pyx_v_P2.strides[3]) )));
        __pyx_t_20 = __pyx_v_i;
        __pyx_t_22 = __pyx_v_alpha;
        __pyx_t_23 = -1;
        if (__pyx_t_20 &lt; 0) {
          __pyx_t_20 += __pyx_v_P1.shape[0];
          if (unlikely(__pyx_t_20 &lt; 0)) __pyx_t_23 = 0;
        } else if (unlikely(__pyx_t_20 &gt;= __pyx_v_P1.shape[0])) __pyx_t_23 = 0;
        if (__pyx_t_22 &lt; 0) {
          __pyx_t_22 += __pyx_v_P1.shape[1];
          if (unlikely(__pyx_t_22 &lt; 0)) __pyx_t_23 = 1;
        } else if (unlikely(__pyx_t_22 &gt;= __pyx_v_P1.shape[1])) __pyx_t_23 = 1;
        if (unlikely(__pyx_t_23 != -1)) {
          <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_23);
          <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 364; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        }
        __pyx_t_24 = (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_P1.data + __pyx_t_20 * __pyx_v_P1.strides[0]) ) + __pyx_t_22 * __pyx_v_P1.strides[1]) )));
        if (unlikely(__pyx_t_24 == 0)) {
          #ifdef WITH_THREAD
          PyGILState_STATE __pyx_gilstate_save = PyGILState_Ensure();
          #endif
          <span class='py_c_api'>PyErr_SetString</span>(PyExc_ZeroDivisionError, "float division");
          #ifdef WITH_THREAD
          PyGILState_Release(__pyx_gilstate_save);
          #endif
          <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 364; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        }
        __pyx_t_25 = (__pyx_t_21 / __pyx_t_24);
        __pyx_t_23 = __pyx_v_j;
        __pyx_t_26 = __pyx_v_beta;
        __pyx_t_27 = -1;
        if (__pyx_t_23 &lt; 0) {
          __pyx_t_23 += __pyx_v_P1.shape[0];
          if (unlikely(__pyx_t_23 &lt; 0)) __pyx_t_27 = 0;
        } else if (unlikely(__pyx_t_23 &gt;= __pyx_v_P1.shape[0])) __pyx_t_27 = 0;
        if (__pyx_t_26 &lt; 0) {
          __pyx_t_26 += __pyx_v_P1.shape[1];
          if (unlikely(__pyx_t_26 &lt; 0)) __pyx_t_27 = 1;
        } else if (unlikely(__pyx_t_26 &gt;= __pyx_v_P1.shape[1])) __pyx_t_27 = 1;
        if (unlikely(__pyx_t_27 != -1)) {
          <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_27);
          <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 364; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        }
        __pyx_t_24 = (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_P1.data + __pyx_t_23 * __pyx_v_P1.strides[0]) ) + __pyx_t_26 * __pyx_v_P1.strides[1]) )));
        if (unlikely(__pyx_t_24 == 0)) {
          #ifdef WITH_THREAD
          PyGILState_STATE __pyx_gilstate_save = PyGILState_Ensure();
          #endif
          <span class='py_c_api'>PyErr_SetString</span>(PyExc_ZeroDivisionError, "float division");
          #ifdef WITH_THREAD
          PyGILState_Release(__pyx_gilstate_save);
          #endif
          <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 364; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        }
        __pyx_t_21 = ((*((double *) ( /* dim=3 */ (( /* dim=2 */ (( /* dim=1 */ (( /* dim=0 */ (__pyx_v_P2.data + __pyx_t_11 * __pyx_v_P2.strides[0]) ) + __pyx_t_13 * __pyx_v_P2.strides[1]) ) + __pyx_t_14 * __pyx_v_P2.strides[2]) ) + __pyx_t_15 * __pyx_v_P2.strides[3]) ))) * log((__pyx_t_25 / __pyx_t_24)));
        __pyx_t_24 = log(__pyx_v_q_float);
        if (unlikely(__pyx_t_24 == 0)) {
          #ifdef WITH_THREAD
          PyGILState_STATE __pyx_gilstate_save = PyGILState_Ensure();
          #endif
          <span class='py_c_api'>PyErr_SetString</span>(PyExc_ZeroDivisionError, "float division");
          #ifdef WITH_THREAD
          PyGILState_Release(__pyx_gilstate_save);
          #endif
          <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 364; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        }
        __pyx_v_M = (__pyx_v_M + (__pyx_t_21 / __pyx_t_24));
        goto __pyx_L7;
      }
      __pyx_L7:;
    }
  }
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line365")'> 365: </pre>
<pre id='line365' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line366")'> 366:     cdef float s1 = 0.</pre>
<pre id='line366' class='code' style='background-color: #FFFFff'>  __pyx_v_s1 = 0.;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line367")'> 367:     cdef float s2 = 0.</pre>
<pre id='line367' class='code' style='background-color: #FFFFff'>  __pyx_v_s2 = 0.;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line368")'> 368: </pre>
<pre id='line368' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line369")'> 369:     for alpha in range(q):</pre>
<pre id='line369' class='code' style='background-color: #FFFFff'>  __pyx_t_3 = __pyx_v_q;
  for (__pyx_t_4 = 0; __pyx_t_4 &lt; __pyx_t_3; __pyx_t_4+=1) {
    __pyx_v_alpha = __pyx_t_4;
</pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line370")'> 370:         if P1[i,alpha] &gt; 0:</pre>
<pre id='line370' class='code' style='background-color: #FFFFd4'>    __pyx_t_5 = __pyx_v_i;
    __pyx_t_6 = __pyx_v_alpha;
    __pyx_t_27 = -1;
    if (__pyx_t_5 &lt; 0) {
      __pyx_t_5 += __pyx_v_P1.shape[0];
      if (unlikely(__pyx_t_5 &lt; 0)) __pyx_t_27 = 0;
    } else if (unlikely(__pyx_t_5 &gt;= __pyx_v_P1.shape[0])) __pyx_t_27 = 0;
    if (__pyx_t_6 &lt; 0) {
      __pyx_t_6 += __pyx_v_P1.shape[1];
      if (unlikely(__pyx_t_6 &lt; 0)) __pyx_t_27 = 1;
    } else if (unlikely(__pyx_t_6 &gt;= __pyx_v_P1.shape[1])) __pyx_t_27 = 1;
    if (unlikely(__pyx_t_27 != -1)) {
      <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_27);
      <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 370; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    }
    __pyx_t_12 = (((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_P1.data + __pyx_t_5 * __pyx_v_P1.strides[0]) ) + __pyx_t_6 * __pyx_v_P1.strides[1]) ))) &gt; 0.0) != 0);
    if (__pyx_t_12) {
</pre><pre class='line' style='background-color: #FFFF86' onclick='toggleDiv("line371")'> 371:             s1 = s1 - P1[i,alpha] * log(P1[i,alpha])/log(q_float)</pre>
<pre id='line371' class='code' style='background-color: #FFFF86'>      __pyx_t_27 = __pyx_v_i;
      __pyx_t_28 = __pyx_v_alpha;
      __pyx_t_29 = -1;
      if (__pyx_t_27 &lt; 0) {
        __pyx_t_27 += __pyx_v_P1.shape[0];
        if (unlikely(__pyx_t_27 &lt; 0)) __pyx_t_29 = 0;
      } else if (unlikely(__pyx_t_27 &gt;= __pyx_v_P1.shape[0])) __pyx_t_29 = 0;
      if (__pyx_t_28 &lt; 0) {
        __pyx_t_28 += __pyx_v_P1.shape[1];
        if (unlikely(__pyx_t_28 &lt; 0)) __pyx_t_29 = 1;
      } else if (unlikely(__pyx_t_28 &gt;= __pyx_v_P1.shape[1])) __pyx_t_29 = 1;
      if (unlikely(__pyx_t_29 != -1)) {
        <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_29);
        <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 371; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      }
      __pyx_t_29 = __pyx_v_i;
      __pyx_t_30 = __pyx_v_alpha;
      __pyx_t_31 = -1;
      if (__pyx_t_29 &lt; 0) {
        __pyx_t_29 += __pyx_v_P1.shape[0];
        if (unlikely(__pyx_t_29 &lt; 0)) __pyx_t_31 = 0;
      } else if (unlikely(__pyx_t_29 &gt;= __pyx_v_P1.shape[0])) __pyx_t_31 = 0;
      if (__pyx_t_30 &lt; 0) {
        __pyx_t_30 += __pyx_v_P1.shape[1];
        if (unlikely(__pyx_t_30 &lt; 0)) __pyx_t_31 = 1;
      } else if (unlikely(__pyx_t_30 &gt;= __pyx_v_P1.shape[1])) __pyx_t_31 = 1;
      if (unlikely(__pyx_t_31 != -1)) {
        <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_31);
        <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 371; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      }
      __pyx_t_24 = ((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_P1.data + __pyx_t_27 * __pyx_v_P1.strides[0]) ) + __pyx_t_28 * __pyx_v_P1.strides[1]) ))) * log((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_P1.data + __pyx_t_29 * __pyx_v_P1.strides[0]) ) + __pyx_t_30 * __pyx_v_P1.strides[1]) )))));
      __pyx_t_21 = log(__pyx_v_q_float);
      if (unlikely(__pyx_t_21 == 0)) {
        #ifdef WITH_THREAD
        PyGILState_STATE __pyx_gilstate_save = PyGILState_Ensure();
        #endif
        <span class='py_c_api'>PyErr_SetString</span>(PyExc_ZeroDivisionError, "float division");
        #ifdef WITH_THREAD
        PyGILState_Release(__pyx_gilstate_save);
        #endif
        <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 371; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      }
      __pyx_v_s1 = (__pyx_v_s1 - (__pyx_t_24 / __pyx_t_21));
      goto __pyx_L10;
    }
    __pyx_L10:;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line372")'> 372: </pre>
<pre id='line372' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line373")'> 373:         if P1[j,alpha] &gt; 0:</pre>
<pre id='line373' class='code' style='background-color: #FFFFd4'>    __pyx_t_31 = __pyx_v_j;
    __pyx_t_32 = __pyx_v_alpha;
    __pyx_t_33 = -1;
    if (__pyx_t_31 &lt; 0) {
      __pyx_t_31 += __pyx_v_P1.shape[0];
      if (unlikely(__pyx_t_31 &lt; 0)) __pyx_t_33 = 0;
    } else if (unlikely(__pyx_t_31 &gt;= __pyx_v_P1.shape[0])) __pyx_t_33 = 0;
    if (__pyx_t_32 &lt; 0) {
      __pyx_t_32 += __pyx_v_P1.shape[1];
      if (unlikely(__pyx_t_32 &lt; 0)) __pyx_t_33 = 1;
    } else if (unlikely(__pyx_t_32 &gt;= __pyx_v_P1.shape[1])) __pyx_t_33 = 1;
    if (unlikely(__pyx_t_33 != -1)) {
      <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_33);
      <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 373; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    }
    __pyx_t_12 = (((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_P1.data + __pyx_t_31 * __pyx_v_P1.strides[0]) ) + __pyx_t_32 * __pyx_v_P1.strides[1]) ))) &gt; 0.0) != 0);
    if (__pyx_t_12) {
</pre><pre class='line' style='background-color: #FFFF86' onclick='toggleDiv("line374")'> 374:             s2 = s2 - P1[j,alpha] * log(P1[j,alpha])/log(q_float)</pre>
<pre id='line374' class='code' style='background-color: #FFFF86'>      __pyx_t_33 = __pyx_v_j;
      __pyx_t_34 = __pyx_v_alpha;
      __pyx_t_35 = -1;
      if (__pyx_t_33 &lt; 0) {
        __pyx_t_33 += __pyx_v_P1.shape[0];
        if (unlikely(__pyx_t_33 &lt; 0)) __pyx_t_35 = 0;
      } else if (unlikely(__pyx_t_33 &gt;= __pyx_v_P1.shape[0])) __pyx_t_35 = 0;
      if (__pyx_t_34 &lt; 0) {
        __pyx_t_34 += __pyx_v_P1.shape[1];
        if (unlikely(__pyx_t_34 &lt; 0)) __pyx_t_35 = 1;
      } else if (unlikely(__pyx_t_34 &gt;= __pyx_v_P1.shape[1])) __pyx_t_35 = 1;
      if (unlikely(__pyx_t_35 != -1)) {
        <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_35);
        <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 374; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      }
      __pyx_t_35 = __pyx_v_j;
      __pyx_t_36 = __pyx_v_alpha;
      __pyx_t_37 = -1;
      if (__pyx_t_35 &lt; 0) {
        __pyx_t_35 += __pyx_v_P1.shape[0];
        if (unlikely(__pyx_t_35 &lt; 0)) __pyx_t_37 = 0;
      } else if (unlikely(__pyx_t_35 &gt;= __pyx_v_P1.shape[0])) __pyx_t_37 = 0;
      if (__pyx_t_36 &lt; 0) {
        __pyx_t_36 += __pyx_v_P1.shape[1];
        if (unlikely(__pyx_t_36 &lt; 0)) __pyx_t_37 = 1;
      } else if (unlikely(__pyx_t_36 &gt;= __pyx_v_P1.shape[1])) __pyx_t_37 = 1;
      if (unlikely(__pyx_t_37 != -1)) {
        <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_37);
        <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 374; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      }
      __pyx_t_21 = ((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_P1.data + __pyx_t_33 * __pyx_v_P1.strides[0]) ) + __pyx_t_34 * __pyx_v_P1.strides[1]) ))) * log((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_P1.data + __pyx_t_35 * __pyx_v_P1.strides[0]) ) + __pyx_t_36 * __pyx_v_P1.strides[1]) )))));
      __pyx_t_24 = log(__pyx_v_q_float);
      if (unlikely(__pyx_t_24 == 0)) {
        #ifdef WITH_THREAD
        PyGILState_STATE __pyx_gilstate_save = PyGILState_Ensure();
        #endif
        <span class='py_c_api'>PyErr_SetString</span>(PyExc_ZeroDivisionError, "float division");
        #ifdef WITH_THREAD
        PyGILState_Release(__pyx_gilstate_save);
        #endif
        <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 374; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      }
      __pyx_v_s2 = (__pyx_v_s2 - (__pyx_t_21 / __pyx_t_24));
      goto __pyx_L11;
    }
    __pyx_L11:;
  }
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line375")'> 375: </pre>
<pre id='line375' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF4b' onclick='toggleDiv("line376")'> 376:     return [M, s1, s2]</pre>
<pre id='line376' class='code' style='background-color: #FFFF4b'>  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
  __pyx_t_38 = <span class='py_c_api'>PyFloat_FromDouble</span>(__pyx_v_M);<span class='error_goto'> if (unlikely(!__pyx_t_38)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 376; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_38);
  __pyx_t_39 = <span class='py_c_api'>PyFloat_FromDouble</span>(__pyx_v_s1);<span class='error_goto'> if (unlikely(!__pyx_t_39)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 376; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_39);
  __pyx_t_40 = <span class='py_c_api'>PyFloat_FromDouble</span>(__pyx_v_s2);<span class='error_goto'> if (unlikely(!__pyx_t_40)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 376; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_40);
  __pyx_t_41 = <span class='py_c_api'>PyList_New</span>(3);<span class='error_goto'> if (unlikely(!__pyx_t_41)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 376; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_41);
  <span class='py_macro_api'>PyList_SET_ITEM</span>(__pyx_t_41, 0, __pyx_t_38);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_38);
  <span class='py_macro_api'>PyList_SET_ITEM</span>(__pyx_t_41, 1, __pyx_t_39);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_39);
  <span class='py_macro_api'>PyList_SET_ITEM</span>(__pyx_t_41, 2, __pyx_t_40);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_40);
  __pyx_t_38 = 0;
  __pyx_t_39 = 0;
  __pyx_t_40 = 0;
  __pyx_r = ((PyObject*)__pyx_t_41);
  __pyx_t_41 = 0;
  goto __pyx_L0;
</pre></body></html>

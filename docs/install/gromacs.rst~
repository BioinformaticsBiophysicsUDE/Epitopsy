**************************
Gromacs --- MD simulations
**************************

Epitopsy can call Gromacs.

Installation procedure
======================

.. highlight:: bash

For the impatients
------------------

.. note::

    Before upgrading to another version of Gromacs, always remove the old
    version with ``sudo rm -rf /usr/local/gromacs`` first.

Open a shell and type::

    cd $HOME/Downloads/
    wget ftp://ftp.gromacs.org/pub/gromacs/gromacs-4.6.5.tar.gz
    tar xfz gromacs-4.6.5.tar.gz
    cd gromacs-4.6.5
    mkdir build; cd $_
    cmake .. -DGMX_DOUBLE=ON -DGMX_BUILD_OWN_FFTW=ON
    make -j $(nproc)
    sudo make install
    echo -e '\nsource /usr/local/gromacs/bin/GMXRC' >> $HOME/.bashrc
    make clean; cd ../..; rm -rf gromacs-4.6.5/ gromacs-4.6.5.tar.gz

Step-by-step installation
-------------------------

.. note::

    Before upgrading to another version of Gromacs, always remove the old
    version with ``sudo rm -rf /usr/local/gromacs`` first.

To compile FFTW if not already present on your machine, open a shell and type::

    cd $HOME/Downloads/
    wget ftp://ftp.fftw.org/pub/fftw/fftw-3.3.3.tar.gz
    tar xfz fftw-3.3.3.tar.gz
    cd fftw-3.3.3
    ./configure # sudo ./configure # --prefix=/home/user/bin/fftw  --enable-float (for single precision)
    make
    make install
    cd ..
    rm -rf fftw-3.3.3 fftw-3.3.3.tar.gz

You may follow the `official Gromacs installation procedure
<http://www.gromacs.org/Documentation/Installation_Instructions>`_ to get
started. It should answer all your questions. Here is the
procedure, put in a nutshell::

    cd $HOME/Downloads/
    wget ftp://ftp.gromacs.org/pub/gromacs/gromacs-4.6.5.tar.gz
    tar xvfz gromacs-4.6.5.tar.gz
    cd gromacs-4.6.5
    mkdir build
    cd build
    cmake .. -DGMX_DOUBLE=ON -DGMX_BUILD_OWN_FFTW=ON # to disable quotes: -DGMX_COOL_QUOTES=OFF
    make -j $(nproc) # or "make -j N" with N the number of CPU cores to use
    echo "Finished"
    sudo make install

You should now source the location of Gromacs in your .bashrc using the GMXRC
bash file, if you did not already do it during a previous installation::

    echo -e "\n# added by $(whoami) on $(date) to source Gromacs executables" >> $HOME/.bashrc
    echo "source /usr/local/gromacs/bin/GMXRC" >> $HOME/.bashrc
    echo "export GMXLIB=/usr/local/gromacs/share/gromacs/top/" >> $HOME/.bashrc
    echo "export GMXBIN=/usr/local/gromacs/bin/" >> $HOME/.bashrc
    echo "export GMXDATA=/usr/local/gromacs/share/" >> $HOME/.bashrc
    echo "export GMXLDLIB=/usr/local/gromacs/lib/" >> $HOME/.bashrc
    echo "export GMXMAN=/usr/local/gromacs/share/man/" >> $HOME/.bashrc

..    echo -e '\nsource /usr/local/gromacs/bin/GMXRC' | sudo tee -a /etc/bash.bashrc # does not change anything, the python interpreter does not read it!!

Check if the shell command ``mdrun_d -version 2>/dev/null | grep -e
"VERSION [0-9\.]*"`` outputs ``VERSION 4.6.5``, and remove the installation
files and the archive::

    make clean
    cd ../..
    rm -rf gromacs-4.6.5/ gromacs-4.6.5.tar.gz

To completely erase Gromacs from your machine, you may follow the `official
Gromacs uninstallation procedure
<http://www.gromacs.org/Documentation/Removing_Installation>`_.

Gromacs workflow chart
======================

Below is a worflow chart for a typical Gromacs simulation. Starting with a PDB
structure :file:`prot.pdb`, a gmx file and a topology file are generated by
pdb2gmx. The structure is relaxed in vacuum, solubilized and neutralized,
minimized in solution, then minimized in the NVT and NPT ensembles, and
eventually used in the production MD.

.. image:: ../_static/figures/GROMACS.*
   :target: ../_static/figures/GROMACS.pdf
   :width: 789 px
   :height: 2800 px
   :scale: 80 %
   :alt: Workflow chart listing all input and output files for every program used in Gromacs
   :align: center


.. highlight:: python



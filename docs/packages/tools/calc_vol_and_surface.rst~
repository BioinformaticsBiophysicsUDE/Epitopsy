
:mod:`calc_vol_and_surface` --- Calculation of Volume and Surface
=================================================================

.. module:: calc_vol_and_surface
   :synopsis: Calculation of Volume and Surface.
.. moduleauthor:: Christoph Wilms <christoph.wilms@uni-due.de>
.. sectionauthor:: Jean-Noel Grad <jean-noel.grad@uni-due.de>


This module provides direct coupling analysis operations.


.. include:: <mmlalias.txt>
.. include:: <isogrk3.txt>
.. include:: <isotech.txt>
.. |_| unicode:: 0xA0 
   :trim:
.. |kbT| replace:: k\ :sub:`B`\ T 

.. _calc_vol_and_surface-syntax:

Module Syntax
-------------

Empty.

.. _contents-of-module-calc_vol_and_surface:

Module Contents
---------------

.. function:: calc_vol_and_surface(pdb_path, energy_cutoff, zipped=True, result_path="result_data.txt", energy_box=None, counter_box=None, raise_error=True, conc=1.)

    :param pdb_path: path to the pdb file (not used)
    :type  pdb_path: str
    :param energy_cutoff: energy treshold in units of |kbT|, must be positive
    :type  energy_cutoff: float
    :param zipped: are the matrices gzipped or not? (optional)
    :type  zipped: bool
    :param result_path: path to which the results are to be written (optional)
    :type  result_path: str
    :param energy_box: path to the Gibbs free energy text file generated by
        :func:`calculate_partition_function.calculate_interaction_energy`
        (optional), if ``None``, opens "gibbs_free_energy.dx" from the
        working directory
    :type  energy_box: str
    :param counter_box: path to the counter matrix text file generated by
        :func:`calculate_partition_function.calculate_interaction_energy`
        (optional), if ``None``, opens "counter_matrix.dx.gz" from the
        working directory
    :type  counter_box: str
    :param raise_error: if ``True``, raises an error when the isosurface
        extends beyond the DXbox boundaries, otherwise just prints an error
        on the screen (optional)
    :type  raise_error: bool
    :param conc: salt concentration
    :type  conc: float

    :returns: a dictionary quantifying the Gibbs free energy around the
        protein within the boundaries of the DXBox (see below).
    :raises ValueError: if the algorithm touched the borders of the box
    :raises ValueError: if **energy_cutoff** |leq| 0

    The dictionary is also written to disk at **result_path**. It contains
    following calculations (with *t* being **energy_cutoff**):

    +----------------------------+---------------------------------+---------------------------------------------------------------+
    |            key             |          value (formula)        |                      description                              |
    +============================+=================================+===============================================================+
    | normal_total_volume        | :math:`V = V_+ + V_- + V_0`     | total number of grid points outside the protein (int)         |
    |                            |                                 |                                                               |
    +----------------------------+---------------------------------+---------------------------------------------------------------+
    | normal_neutral_volume      | :math:`V_0 = \sum_i^V         \ | number of neither favorable or unfavorable grid               |
    |                            | [+t \leq \Delta G_i \leq -t]`   | points outside the protein (int)                              |
    +----------------------------+---------------------------------+---------------------------------------------------------------+
    | normal_fav_volume          | :math:`V_+ = \sum_i^V         \ | number of favorable grid points outside the protein (int)     |
    |                            | [\Delta G_i < -t]`              |                                                               |
    +----------------------------+---------------------------------+---------------------------------------------------------------+
    | normal_unfav_volume        | :math:`V_- = \sum_i^V         \ | number of unfavorable grid points outside the protein (int)   |
    |                            | [\Delta G_i > +t]`              |                                                               |
    +----------------------------+---------------------------------+---------------------------------------------------------------+
    | normal_fav_volume_score    | :math:`wV_+ = \sum_i^V        \ | summation of the Gibbs free energy over all favorable grid    |
    |                            | \Delta G_i [\Delta G_i < -t]`   | points outside the protein (float, < 0, in units of |kbT|)    |
    +----------------------------+---------------------------------+---------------------------------------------------------------+
    | normal_unfav_volume_score  | :math:`wV_- = \sum_i^V        \ | summation of the Gibbs free energy over all unfavorable grid  |
    |                            | \Delta G_i [\Delta G_i > +t]`   | point outside the protein (float, > 0, in units of |kbT|)     |
    +----------------------------+---------------------------------+---------------------------------------------------------------+
    | normal_total_surface       | :math:`S = A_+ + A_- + V_0`     | total number of grid points on the protein surface (int)      |
    |                            |                                 |                                                               |
    +----------------------------+---------------------------------+---------------------------------------------------------------+
    | normal_neutral_surface     | :math:`A_0 = \sum_i^S         \ | number of neither favorable or unfavorable grid points on     |
    |                            | [+t \leq \Delta G_i \leq -t]`   | the protein surface (int)                                     |
    +----------------------------+---------------------------------+---------------------------------------------------------------+
    | normal_fav_surface         | :math:`A_+ = \sum_i^S         \ | number of favorable grid points on the protein surface (int)  |
    |                            | [\Delta G_i < -t]`              |                                                               |
    +----------------------------+---------------------------------+---------------------------------------------------------------+
    | normal_unfav_surface       | :math:`A_- = \sum_i^S         \ | number of unfavorable grid points on the protein surface      |
    |                            | [\Delta G_i > +t]`              | (int)                                                         |
    +----------------------------+---------------------------------+---------------------------------------------------------------+
    | normal_fav_surface_score   | :math:`wA_+ = \sum_i^S        \ | summation of the Gibbs free energy over all favorable grid    |
    |                            | \Delta G_i [\Delta G_i < -t]`   | points on the protein surface (float, < 0, in units of |kbT|) |
    +----------------------------+---------------------------------+---------------------------------------------------------------+
    | normal_unfav_surface_score | :math:`wA_- = \sum_i^S        \ | summation of the Gibbs free energy over all unfavorable grid  |
    |                            | \Delta G_i [\Delta G_i > +t]`   | points on the protein surface (float, > 0, in units of |kbT|) |
    +----------------------------+---------------------------------+---------------------------------------------------------------+

    Using the Iverson bracket notation: :math:`[P] = \begin{cases} 1 & \text{when }
    P \text{ is true} \\ 0 & \text{when } P \text{ is false} \end{cases}`

    .. highlight:: bash

    Output from :file:`gibbs_free_energy.dx`::

        # energy cutoff:                      1.0
        DG:                        -7.41489284032
        conc:                                 1.0
        normal_total_volume:             16156569
        normal_neutral_volume:           15469239
        normal_fav_volume:                 566194
        normal_unfav_volume:               121136
        normal_fav_volume_score:   -989039.489084
        normal_unfav_volume_score:  177463.490532
        normal_total_surface:               98262
        normal_neutral_surface:             86543
        normal_fav_surface:                 11719
        normal_unfav_surface:                   0
        normal_fav_surface_score:  -20950.6659235
        normal_unfav_surface_score:           0.0

    .. highlight:: python

.. function:: process_vol(energy_box, vdw_box, energy_cutoff, result_dict, raise_error, vdw_type)

    This function is not well designed.

    :param probability_box: DXBox contains the energies.
    :param vdw_box: flooded VDWBox.
    :param energy_cutoff: count grid points with an energy < limit
    :param result_dict: dictionary

    :returns: updated dictionary
    


.. function:: process_surface(energy_box, surface_index, energy_cutoff, result_dict, vdw_type)

    Docstring missing.

.. function:: check_indices(indices, box, raise_error)

    Docstring missing.



'''
Created on Sep 30, 2011

@author: Christoph Wilms
'''

from subprocess import call

if __name__ == '__main__':
    """
    This scripts builds all extensions that have been built with cython.
    """
    python_version = '2' # 2 or 3
    
    # this list contains all files
    file_list = []
    
    file_list.append('cython/CalculateInteractionEnergyCython')
    
    file_list.append('cython/dx_cython')
    
    file_list.append('cython/pdb_cython')
    
    file_list.append('cython/FFTCorrelationScoringCython')
    
    file_list.append('cython/optimizer_cython')
    
    file_list.append('cython/fast_dca')
    
    file_list.append('cython/test_dca')
    

    # compiler  + options:
    compiler = ['gcc']
    compiler.append('-shared')
    compiler.append('-pthread')
    compiler.append('-fPIC')
    compiler.append('-fwrapv')
    compiler.append('-O2')
    compiler.append('-Wall')
    compiler.append('-fopenmp')
    compiler.append('-fno-strict-aliasing')
    if python_version == '2':
        compiler.append('-I/usr/include/python2.7')
    elif python_version == '3':
        compiler.append('-I/usr/include/python3.2dmu')
    else:
        raise ValueError('Unkwon python version: {0}'.format(python_version))
    compiler.append('-o')
    compiler.append
    
    for file_path in file_list:
        print('#### compiling {0}'.format(file_path))
        call(['cython', '-{0}'.format(python_version), '-a', '{0}.pyx'.format(file_path)])
        call(compiler + ['{0}.so'.format(file_path), '{0}.c'.format(file_path)])
        
